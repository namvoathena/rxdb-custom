!function n(i,o,a){function s(t,e){if(!o[t]){if(!i[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(u)return u(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=o[t]={exports:{}},i[t][0].call(r.exports,function(e){return s(i[t][1][e]||e)},r,r.exports,n,i,o,a)}return o[t].exports}for(var u="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.pushAtSortPosition=function(e,t,r,n){var i,o=e.length,a=o-1,s=0;if(0===o)return e.push(t),0;for(;n<=a;)i=e[s=n+(a-n>>1)],r(i,t)<=0?n=s+1:a=s-1;r(i,t)<=0&&s++;return e.splice(s,0,t),s}},{}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.AbstractNode=void 0;const n=e("./util"),i=e("./find-similar-node");r.AbstractNode=class{constructor(e,t,r){this.level=e,this.id=(0,n.nextNodeId)(),this.deleted=!1,this.type=r,(this.rootNode=t)&&this.rootNode.addNode(this)}isEqualToOtherNode(e,t=this.toString()){return t===e.toString()}remove(){if(this.ensureNotDeleted("remove"),this.isInternalNode())if(0<this.parents.size)throw new Error("cannot remove node with parents "+this.id);var e;this.branches&&((e=this).branches.areBranchesStrictEqual()?e.branches.getBranch("0"):(e.branches.getBranch("0").parents.remove(e),e.branches.getBranch("1"))).parents.remove(e),this.deleted=!0,this.rootNode.removeNode(this)}toJSON(e=!1){var t,r={id:e?this.id:void 0,deleted:e?this.deleted:void 0,type:this.type,level:this.level};return e&&this.parents&&(r.parents=this.parents.toString()),this.isLeafNode()&&(r.value=this.asLeafNode().value),this.branches&&!this.branches.deleted&&(t=this.branches,r.branches={0:t.getBranch("0").toJSON(e),1:t.getBranch("1").toJSON(e)}),r}toString(){let e="<"+this.type+":"+this.level;var t;return this.branches&&(t=this.branches,e=(e+="|0:"+t.getBranch("0"))+"|1:"+t.getBranch("1")),this.isLeafNode()&&(e+="|v:"+this.asLeafNode().value),e+=">"}isRootNode(){return"RootNode"===this.type}isInternalNode(){return"InternalNode"===this.type}isLeafNode(){return"LeafNode"===this.type}asRootNode(){if(this.isRootNode())return this;throw new Error("ouch")}asInternalNode(){if(this.isInternalNode())return this;throw new Error("ouch")}asLeafNode(){if(this.isLeafNode())return this;throw new Error("ouch")}ensureNotDeleted(e="unknown"){if(this.deleted)throw new Error("forbidden operation "+e+" on deleted node "+this.id)}log(){console.log(JSON.stringify(this.toJSON(!0),null,2))}applyEliminationRule(e){this.ensureNotDeleted("applyEliminationRule"),e=e||this.rootNode.getNodesOfLevel(this.level);const r=(0,i.findSimilarNode)(this,e);if(r){e=this.parents.getAll();const n=[];return e.forEach(e=>{var t=e.branches.getKeyOfNode(this);e.branches.setBranch(t,r),e.branches.areBranchesStrictEqual()&&n.push(e),this.parents.remove(e)}),n.forEach(e=>{e.isInternalNode()&&e.applyReductionRule()}),!0}return!1}}},{"./find-similar-node":7,"./util":20}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ensureNodesNotStrictEqual=r.Branches=void 0;r.Branches=class{constructor(e){this.node=e,this.deleted=!1,this.branches={}}setBranch(e,t){this.branches[e]!==t&&(this.branches[e]=t).parents.add(this.node)}getKeyOfNode(e){if(this.getBranch("0")===e)return"0";if(this.getBranch("1")===e)return"1";throw new Error("none matched")}getBranch(e){return this.branches[e]}getBothBranches(){return[this.getBranch("0"),this.getBranch("1")]}hasBranchAsNode(e){return this.getBranch("0")===e||this.getBranch("1")===e}hasNodeIdAsBranch(e){return this.getBranch("0").id===e||this.getBranch("1").id===e}areBranchesStrictEqual(){return this.branches[0]===this.branches[1]}hasEqualBranches(){return JSON.stringify(this.branches[0])===JSON.stringify(this.branches[1])}},r.ensureNodesNotStrictEqual=function(e,t){if(e===t)throw new Error("cannot have two strict equal branches")}},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createBddFromTruthTable=void 0;const u=e("./root-node"),c=e("./util"),l=e("./internal-node"),f=e("./leaf-node");r.createBddFromTruthTable=function(e){var r,n,i=new u.RootNode,t=e.keys().next().value.length,t=Math.pow(2,t);if(e.size!==t)throw new Error("truth table has missing entries");for([r,n]of e){let t=i;for(let e=0;e<r.length-1;e++){var o=e+1,a=r.charAt(e);t.branches.getBranch(a)||t.branches.setBranch(a,new l.InternalNode(o,i,t)),t=t.branches.getBranch(a)}var s=(0,c.lastChar)(r);if(t.branches.getBranch(s))throw new Error("leafNode already exists, this should not happen");t.branches.setBranch(s,new f.LeafNode(r.length,i,n,t))}return i}},{"./internal-node":9,"./leaf-node":10,"./root-node":19,"./util":20}],5:[function(e,t,r){"use strict";function c(e,t=new Set){var r;return t.add(e),e.isLeafNode()||(r=(e=e).branches.getBranch("0"),t.add(r),c(r,t),r=e.branches.getBranch("1"),t.add(r),c(r,t)),t}Object.defineProperty(r,"__esModule",{value:!0}),r.getNodesRecursive=r.ensureCorrectBdd=void 0,r.ensureCorrectBdd=function(t){var e=JSON.stringify(t.toJSON(!0));let r=[];const n=new Map;t.getLevels().forEach(e=>{e=t.getNodesOfLevel(e);e.forEach(e=>{n.set(e.id,e)}),r=r.concat(e)});var i=c(t);if(r.length!==i.size){const s=r.map(e=>e.id).sort();var o=Array.from(i).map(e=>e.id).sort().filter(e=>!s.includes(e));if(i.size>r.length){const u=o[0];var a=r.find(e=>!!e.isInternalNode()&&e.branches.hasNodeIdAsBranch(u));console.log("referenceToFirst:"),null!=a&&a.log()}throw new Error("ensureCorrectBdd() nodes in list not equal size to recursive nodes allNodes: "+r.length+" recursiveNodes: "+i.size+" nodesOnlyInRecursive: "+o.join(", ")+" ")}if(r.forEach(e=>{if(!e.isRootNode()){const t=e;if(e.deleted)throw new Error("ensureCorrectBdd() bdd includes a deleted node");if(0===t.parents.size)throw new Error("ensureCorrectBdd() node has no parent "+t.id);if(t.isInternalNode()){const r=t;e=r.branches.getBothBranches();if(r.branches.areBranchesStrictEqual())throw new Error("ensureCorrectBdd() node has two equal branches: "+e.map(e=>e.id).join(", "));e.forEach(e=>{if(!e.parents.has(r))throw new Error("ensureCorrectBdd() branch must have the node as parent")})}t.parents.getAll().forEach(e=>{if(!e.branches.hasBranchAsNode(t))throw new Error("ensureCorrectBdd() parent node does not have child as branch")})}}),e.includes('"deleted":true'))throw new Error("ensureCorrectBdd() bdd includes a deleted node")},r.getNodesRecursive=c},{}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fillTruthTable=void 0;const a=e("./util");r.fillTruthTable=function(e,t,r){var n=(0,a.maxBinaryWithLength)(t);let i=(0,a.minBinaryWithLength)(t),o=!1;for(;!o;)e.has(i)||e.set(i,r),i===n?o=!0:i=(0,a.getNextStateSet)(i)}},{"./util":20}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.findSimilarNode=void 0,r.findSimilarNode=function(t,r){var n=t.toString();for(let e=0;e<r.length;e++){var i=r[e];if(t!==i&&!i.deleted&&t.isEqualToOtherNode(i,n))return i}return null}},{}],8:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./minimal-string/index"),r),i(e("./abstract-node"),r),i(e("./branches"),r),i(e("./create-bdd-from-truth-table"),r),i(e("./ensure-correct-bdd"),r),i(e("./fill-truth-table"),r),i(e("./find-similar-node"),r),i(e("./internal-node"),r),i(e("./leaf-node"),r),i(e("./optimize-brute-force"),r),i(e("./parents"),r),i(e("./root-node"),r),i(e("./util"),r)},{"./abstract-node":2,"./branches":3,"./create-bdd-from-truth-table":4,"./ensure-correct-bdd":5,"./fill-truth-table":6,"./find-similar-node":7,"./internal-node":9,"./leaf-node":10,"./minimal-string/index":13,"./optimize-brute-force":17,"./parents":18,"./root-node":19,"./util":20}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.InternalNode=void 0;const n=e("./branches"),i=e("./parents");class o extends e("./abstract-node").AbstractNode{constructor(e,t,r){super(e,t,"InternalNode"),this.branches=new n.Branches(this),this.parents=new i.Parents(this),this.parents.add(r)}applyReductionRule(){if(this.branches.hasEqualBranches()){this.ensureNotDeleted("applyReductionRule");const r=this.branches.getBranch("0");return this.parents.getAll().forEach(e=>{var t=e.branches.getKeyOfNode(this);e.branches.setBranch(t,r),this.parents.remove(e),e.branches.areBranchesStrictEqual()&&e.isInternalNode()&&e.applyReductionRule()}),!0}return!1}}r.InternalNode=o},{"./abstract-node":2,"./branches":3,"./parents":18}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LeafNode=void 0;const i=e("./parents");var n=e("./abstract-node");const o=e("./util");class a extends n.AbstractNode{constructor(e,t,r,n){super(e,t,"LeafNode"),this.value=r,this.parents=new i.Parents(this),this.parents.add(n)}removeIfValueEquals(e){return this.ensureNotDeleted(),this.value===e&&(this.parents.getAll().forEach(e=>{var t=e.branches.getKeyOfNode(this),r=e.branches.getBranch((0,o.oppositeBoolean)(t));this.parents.remove(e),e.branches.setBranch(t,r),e.isInternalNode()&&e.applyReductionRule()}),!0)}}r.LeafNode=a},{"./abstract-node":2,"./parents":18,"./util":20}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.nodeToString=r.bddToMinimalString=void 0;const a=e("./string-format"),o=e("./string-format");function s(e,t,r){var n=(0,a.getNextCharId)(r);switch(e.type){case"LeafNode":var i=(0,a.getCharOfValue)(e.asLeafNode().value);return{id:n.char,nextCode:n.nextCode,str:n.char+i};case"InternalNode":var i=t.get(e.asInternalNode().branches.getBranch("0")),o=t.get(e.asInternalNode().branches.getBranch("1"));return{id:n.char,nextCode:n.nextCode,str:n.char+i+o+(0,a.getCharOfLevel)(e.level)};case"RootNode":i=t.get(e.asRootNode().branches.getBranch("0")),o=t.get(e.asRootNode().branches.getBranch("1"));return{id:n.char,nextCode:n.nextCode,str:""+i+o+(0,a.getCharOfLevel)(e.level)};default:throw new Error("unknown node type")}}r.bddToMinimalString=function(t){let r="",n=o.FIRST_CHAR_CODE_FOR_ID;var e=t.getLeafNodes().length;if(99<e)throw new Error("cannot build string with too many leaf nodes");r+=e.toString().padStart(2,"0"),e=t.levels.slice().reverse();const i=new Map;return e.forEach(e=>{t.getNodesOfLevel(e).forEach(e=>{var t=s(e,i,n);n=t.nextCode,i.set(e,t.id),r+=t.str})}),r},r.nodeToString=s},{"./string-format":16}],12:[function(e,t,r){"use strict";function n(e){var t=e.branches.getBranch("0"),r=e.branches.getBranch("1");return{l:e.level,0:t.isLeafNode()?t.asLeafNode().value:n(t),1:r.isLeafNode()?r.asLeafNode().value:n(r)}}Object.defineProperty(r,"__esModule",{value:!0}),r.nodeToSimpleBddNode=r.bddToSimpleBdd=void 0,r.bddToSimpleBdd=n,r.nodeToSimpleBddNode=n},{}],13:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./bdd-to-minimal-string"),r),i(e("./minimal-string-to-simple-bdd"),r),i(e("./resolve-with-simple-bdd"),r),i(e("./string-format"),r),i(e("./bdd-to-simple-bdd"),r)},{"./bdd-to-minimal-string":11,"./bdd-to-simple-bdd":12,"./minimal-string-to-simple-bdd":14,"./resolve-with-simple-bdd":15,"./string-format":16}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.minimalStringToSimpleBdd=void 0;const d=e("../util"),p=e("./string-format");r.minimalStringToSimpleBdd=function(e){var t=new Map,r=2+2*parseInt(e.charAt(0)+e.charAt(1),10),n=e.substring(2,r),i=(0,d.splitStringToChunks)(n,2);for(let e=0;e<i.length;e++){var o=i[e],a=o.charAt(0),o=(0,p.getNumberOfChar)(o.charAt(1));t.set(a,o)}var n=e.substring(r,e.length-3),s=(0,d.splitStringToChunks)(n,4);for(let e=0;e<s.length;e++){var u=s[e],c=u.charAt(0),l=u.charAt(1),f=u.charAt(2),u=(0,p.getNumberOfChar)(u.charAt(3));if(!t.has(l))throw new Error("missing node with id "+l);if(!t.has(f))throw new Error("missing node with id "+f);l=t.get(l),f=t.get(f);t.set(c,{l:u,0:l,1:f})}return r=e.slice(-3),n=r.charAt(0),e=r.charAt(1),{l:(0,p.getNumberOfChar)(r.charAt(2)),0:t.get(n),1:t.get(e)}}},{"../util":20,"./string-format":16}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.resolveWithSimpleBdd=void 0;const a=e("../util");r.resolveWithSimpleBdd=function(e,t,r){let n=e,i=e.l;for(;;){var o=t[i](r),o=(0,a.booleanToBooleanString)(o);if("number"==typeof(n=n[o])||"string"==typeof n)return n;i=n.l}}},{"../util":20}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getNextCharId=r.FIRST_CHAR_CODE_FOR_ID=r.getCharOfValue=r.getNumberOfChar=r.getCharOfLevel=r.CHAR_CODE_OFFSET=void 0,r.CHAR_CODE_OFFSET=40,r.getCharOfLevel=function(e){return e=r.CHAR_CODE_OFFSET+e,String.fromCharCode(e)},r.getNumberOfChar=function(e){return e.charCodeAt(0)-r.CHAR_CODE_OFFSET},r.getCharOfValue=function(e){return e=r.CHAR_CODE_OFFSET+e,String.fromCharCode(e)},r.FIRST_CHAR_CODE_FOR_ID=97,r.getNextCharId=function(e){return 128<=e&&e<=160&&(e=161),{char:String.fromCharCode(e),nextCode:e+1}}},{}],17:[function(e,t,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.getArrayWithIndexes=m.changeKeyOrder=m.shuffleBooleanOrdering=m.optimizeBruteForce=m.defaultCompareResults=void 0;const b=e("./create-bdd-from-truth-table"),v=e("./util");function g(e){var t=c((0,v.firstKeyOfMap)(e).length),t=(0,v.shuffleArray)(t);const r={},n={};t.forEach((e,t)=>{r[t]=e,n[e]=t});var i,o,a=new Map;for([i,o]of e.entries()){var s=u(i,r);a.set(s,o)}return{newTable:a,mapping:r,mappingBeforeToAfter:n}}function u(e,r){return e.split("").map((e,t)=>({char:e,indexBefore:t,indexAfter:r[t]})).sort((e,t)=>e.indexAfter-t.indexAfter).map(e=>e.char).join("")}function c(e){var t=[];let r=0;for(;r<e;)t.push(r),r++;return t}m.defaultCompareResults=function(e,t){return e.countNodes()<=t.countNodes()?e:t},m.optimizeBruteForce=async function({truthTable:e,iterations:t=1/0,onBetterBdd:r=()=>null,compareResults:n=m.defaultCompareResults,afterBddCreation:i=()=>null,log:o=!1}){var a=(0,b.createBddFromTruthTable)(e);i(a),a.minimize();let s={truthTable:e,bdd:a},u=(o&&(a.log(),console.log("initial nodes amount: "+a.countNodes())),0);for(;u<t;){u++,o&&(console.log("-".repeat(50)),console.log("optimizeBruteForce() itterate once"));const l=g(e),f=(0,b.createBddFromTruthTable)(l.newTable),d=new Map,p=(0,v.lastOfArray)(f.getLevels()),h=[],y=(f.getLevels().filter(e=>e!==p).forEach(e=>{const t=l.mappingBeforeToAfter[e],r=(h.push(t),new Set);d.set(t,r),f.getNodesOfLevel(e).forEach(e=>{e.level=t,r.add(e)})}),new Set);f.getNodesOfLevel(p).forEach(e=>y.add(e)),d.set(p,y),h.push(p),f.nodesByLevel=d,f.levels=h,i(f),f.minimize(),o&&(console.log("got new bdd with nodes amount of "+f.countNodes()),console.dir(l.mappingBeforeToAfter));var c=await n(s.bdd,f);if("RootNode"!==c.type)throw new Error("compareResults did not return a bdd");c===f&&(o&&(console.log("#".repeat(50)),console.log("found better bdd "+f.countNodes())),r(s={bdd:f,truthTable:l.newTable}))}return s},m.shuffleBooleanOrdering=g,m.changeKeyOrder=u,m.getArrayWithIndexes=c},{"./create-bdd-from-truth-table":4,"./util":20}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Parents=void 0;r.Parents=class{constructor(e){this.node=e,this.parents=new Set}remove(e){this.parents.delete(e),0===this.parents.size&&this.node.remove()}getAll(){return Array.from(this.parents)}add(e){if(this.node.level===e.level)throw new Error("a node cannot be parent of a node with the same level");this.parents.add(e)}has(e){return this.parents.has(e)}toString(){var e=[];for(const t of this.parents)e.push(t.id);return e.join(", ")}get size(){return this.parents.size}}},{}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RootNode=void 0;var n=e("./abstract-node");const i=e("./branches"),u=e("./util"),o=e("./minimal-string");class a extends n.AbstractNode{constructor(){super(0,null,"RootNode"),this.branches=new i.Branches(this),this.levels=[],this.nodesByLevel=new Map,this.levels.push(0);var e=new Set;e.add(this),this.nodesByLevel.set(0,e)}addNode(e){var t=e.level,t=(this.levels.includes(t)||this.levels.push(t),this.ensureLevelSetExists(t),this.nodesByLevel.get(t));null!=t&&t.add(e)}removeNode(e){var t=this.nodesByLevel.get(e.level);if(!t.has(e))throw new Error("removed non-existing node "+e.id);t.delete(e)}ensureLevelSetExists(e){this.nodesByLevel.has(e)||this.nodesByLevel.set(e,new Set)}getLevels(){return Array.from(this.levels).sort((e,t)=>e-t)}getNodesOfLevel(e){this.ensureLevelSetExists(e);e=this.nodesByLevel.get(e);return Array.from(e)}countNodes(){let t=0;return this.getLevels().forEach(e=>{e=this.getNodesOfLevel(e).length;t+=e}),t}minimize(n=!1){let e=!1;for(;!e;){n&&console.log("minimize() itterate once");let t=0,r=(0,u.lastOfArray)(this.getLevels());for(;0<r;){var i=this.getNodesOfLevel(r);n&&console.log("minimize() run for level "+r+" with "+i.length+" nodes");let e=0;for(const s of i)if(e++,n&&e%4e3==0&&console.log("minimize() node #"+s.id),s.isLeafNode()&&s.asLeafNode().applyEliminationRule()&&t++,!s.deleted&&s.isInternalNode()){var o=s,a=o.applyReductionRule();let e=!1;o.deleted||(e=o.applyEliminationRule(i)),(a||e)&&t++}r--}0===t?e=!0:n&&console.log("minimize() itteration done with "+t+" minimisations")}}getLeafNodes(){var e=(0,u.lastOfArray)(this.getLevels());return this.getNodesOfLevel(e).reverse()}removeIrrelevantLeafNodes(t){let r=!1;for(;!r;){let e=0;for(const n of this.getLeafNodes())n.removeIfValueEquals(t)&&e++;this.minimize(),0===e&&(r=!0)}}resolve(e,t){let r=this;for(;;){var n=e[r.level](t),n=(0,u.booleanToBooleanString)(n);if((r=r.branches.getBranch(n)).isLeafNode())return r.asLeafNode().value}}toSimpleBdd(){return(0,o.bddToSimpleBdd)(this)}}r.RootNode=a},{"./abstract-node":2,"./branches":3,"./minimal-string":13,"./util":20}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.splitStringToChunks=r.lastOfArray=r.shuffleArray=r.firstKeyOfMap=r.getNextStateSet=r.maxBinaryWithLength=r.minBinaryWithLength=r.binaryToDecimal=r.oppositeBinary=r.decimalToPaddedBinary=r.nextNodeId=r.lastChar=r.oppositeBoolean=r.booleanToBooleanString=r.booleanStringToBoolean=void 0,r.booleanStringToBoolean=function(e){return"1"===e},r.booleanToBooleanString=function(e){return e?"1":"0"},r.oppositeBoolean=function(e){return"1"===e?"0":"1"},r.lastChar=function(e){return e.slice(-1)};const n=function(t){let r="";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length;for(let e=0;e<t;e++)r+=n.charAt(Math.floor(Math.random()*i));return r}(4);let i=0;function o(e,t){return(e>>>0).toString(2).padStart(t,"0")}function a(e){return parseInt(e,2)}r.nextNodeId=function(){var e="node_"+n+"_"+i;return i++,e},r.decimalToPaddedBinary=o,r.oppositeBinary=function(e){if("1"===e)return"0";if("0"===e)return"1";throw new Error("non-binary given")},r.binaryToDecimal=a,r.minBinaryWithLength=function(e){return new Array(e).fill(0).map(()=>"0").join("")},r.maxBinaryWithLength=function(e){return new Array(e).fill(0).map(()=>"1").join("")},r.getNextStateSet=function(e){return o(a(e)+1,e.length)},r.firstKeyOfMap=function(e){return e.keys().next().value},r.shuffleArray=function(t){for(let e=t.length-1;0<e;e--){var r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t},r.lastOfArray=function(e){return e[e.length-1]},r.splitStringToChunks=function(r,n){var i=[];for(let e=0,t=r.length;e<t;e+=n)i.push(r.substring(e,e+n));return i}},{}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.OPEN_BROADCAST_CHANNELS=r.BroadcastChannel=void 0,r.clearNodeFolder=function(e){e=(0,s.fillOptionsWithDefaults)(e);e=(0,a.chooseMethod)(e);return"node"===e.type?e.clearNodeFolder().then(function(){return!0}):o.PROMISE_RESOLVED_FALSE},r.enforceOptions=function(e){i=e};function n(e,t){var r;this.id=c++,u.add(this),this.name=e,i&&(t=i),this.options=(0,s.fillOptionsWithDefaults)(t),this.method=(0,a.chooseMethod)(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,e=(r=this).method.create(r.name,r.options),(0,o.isPromise)(e)?(r._prepP=e).then(function(e){r._state=e}):r._state=e}var i,o=e("./util.js"),a=e("./method-chooser.js"),s=e("./options.js"),u=new Set,c=(r.OPEN_BROADCAST_CHANNELS=u,0);function l(t,e,r){var n={time:t.method.microSeconds(),type:e,data:r};return(t._prepP||o.PROMISE_RESOLVED_VOID).then(function(){var e=t.method.postMessage(t._state,n);return t._uMP.add(e),e.catch().then(function(){return t._uMP.delete(e)}),e})}function f(e){return 0<e._addEL.message.length||0<e._addEL.internal.length}function d(e,t,r){e._addEL[t].push(r);var n,i,o=e;!o._iL&&f(o)&&(n=function(r){o._addEL[r.type].forEach(function(e){var t=e.time-1e5;r.time>=t&&e.fn(r.data)})},i=o.method.microSeconds(),o._prepP?o._prepP.then(function(){o._iL=!0,o.method.onMessage(o._state,n,i)}):(o._iL=!0,o.method.onMessage(o._state,n,i)))}function p(e,t,r){e._addEL[t]=e._addEL[t].filter(function(e){return e!==r});t=e;t._iL&&!f(t)&&(t._iL=!1,e=t.method.microSeconds(),t.method.onMessage(t._state,null,e))}(r.BroadcastChannel=n)._pubkey=!0,n.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return l(this,"message",e)},postInternal:function(e){return l(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};p(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,d(this,"message",t)):this._onML=null},addEventListener:function(e,t){var r=this.method.microSeconds();d(this,e,{time:r,fn:t})},removeEventListener:function(e,t){var r=this._addEL[e].find(function(e){return e.fn===t});p(this,e,r)},close:function(){var e,t=this;if(!this.closed)return u.delete(this),this.closed=!0,e=this._prepP||o.PROMISE_RESOLVED_VOID,this._onML=null,this._addEL.message=[],e.then(function(){return Promise.all(Array.from(t._uMP))}).then(function(){return Promise.all(t._befC.map(function(e){return e()}))}).then(function(){return t.method.close(t._state)})},get type(){return this.method.type},get isClosed(){return this.closed}}},{"./method-chooser.js":27,"./options.js":32,"./util.js":33}],22:[function(e,t,r){"use strict";e=e("./index.js");t.exports={BroadcastChannel:e.BroadcastChannel,createLeaderElection:e.createLeaderElection,clearNodeFolder:e.clearNodeFolder,enforceOptions:e.enforceOptions,beLeader:e.beLeader}},{"./index.js":23}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"BroadcastChannel",{enumerable:!0,get:function(){return n.BroadcastChannel}}),Object.defineProperty(r,"OPEN_BROADCAST_CHANNELS",{enumerable:!0,get:function(){return n.OPEN_BROADCAST_CHANNELS}}),Object.defineProperty(r,"beLeader",{enumerable:!0,get:function(){return o.beLeader}}),Object.defineProperty(r,"clearNodeFolder",{enumerable:!0,get:function(){return n.clearNodeFolder}}),Object.defineProperty(r,"createLeaderElection",{enumerable:!0,get:function(){return i.createLeaderElection}}),Object.defineProperty(r,"enforceOptions",{enumerable:!0,get:function(){return n.enforceOptions}});var n=e("./broadcast-channel.js"),i=e("./leader-election.js"),o=e("./leader-election-util.js")},{"./broadcast-channel.js":21,"./leader-election-util.js":24,"./leader-election.js":26}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.beLeader=function(t){t.isLeader=!0,t._hasLeader=!0;function e(e){"leader"===e.context&&"apply"===e.action&&i(t,"tell"),"leader"!==e.context||"tell"!==e.action||t._dpLC||(t._dpLC=!0,t._dpL(),i(t,"tell"))}var r=(0,n.add)(function(){return t.die()});t._unl.push(r);return t.broadcastChannel.addEventListener("internal",e),t._lstns.push(e),i(t,"tell")},r.sendLeaderMessage=i;var n=e("unload");function i(e,t){t={context:"leader",action:t,token:e.token};return e.broadcastChannel.postInternal(t)}},{unload:644}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LeaderElectionWebLock=void 0;function n(e,t){var r=this;(this.broadcastChannel=e)._befC.push(function(){return r.die()}),this._options=t,this.isLeader=!1,this.isDead=!1,this.token=(0,i.randomToken)(),this._lstns=[],this._unl=[],this._dpL=function(){},this._dpLC=!1,this._wKMC={},this.lN="pubkey-bc||"+e.method.type+"||"+e.name}var i=e("./util.js"),o=e("./leader-election-util.js");(r.LeaderElectionWebLock=n).prototype={hasLeader:function(){var t=this;return navigator.locks.query().then(function(e){e=e.held?e.held.filter(function(e){return e.name===t.lN}):[];return!!(e&&0<e.length)})},awaitLeadership:function(){var t,r=this;return this._wLMP||(this._wKMC.c=new AbortController,t=new Promise(function(e,t){r._wKMC.res=e,r._wKMC.rej=t}),this._wLMP=new Promise(function(e){navigator.locks.request(r.lN,{signal:r._wKMC.c.signal},function(){return(r._wKMC.c=void 0,o.beLeader)(r),e(),t}).catch(function(){})})),this._wLMP},set onduplicate(e){},die:function(){var t=this;return this._lstns.forEach(function(e){return t.broadcastChannel.removeEventListener("internal",e)}),this._lstns=[],this._unl.forEach(function(e){return e.remove()}),this._unl=[],this.isLeader&&(this.isLeader=!1),this.isDead=!0,this._wKMC.res&&this._wKMC.res(),this._wKMC.c&&this._wKMC.c.abort("LeaderElectionWebLock.die() called"),(0,o.sendLeaderMessage)(this,"death")}}},{"./leader-election-util.js":24,"./util.js":33}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createLeaderElection=function(e,t){if(e._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");t=function(e,t){e=e||{};(e=JSON.parse(JSON.stringify(e))).fallbackInterval||(e.fallbackInterval=3e3);e.responseTime||(e.responseTime=t.method.averageResponseTime(t.options));return e}(t,e);var r=new((0,s.supportsWebLockAPI)()?n.LeaderElectionWebLock:i)(e,t);return e._befC.push(function(){return r.die()}),e._leaderElector=r};var s=e("./util.js"),u=e("./leader-election-util.js"),n=e("./leader-election-web-lock.js"),i=function(e,t){function r(e){"leader"===e.context&&("death"===e.action&&(n._hasLeader=!1),"tell"===e.action)&&(n._hasLeader=!0)}var n=this;this.broadcastChannel=e,this._options=t,this.isLeader=!1,this._hasLeader=!1,this.isDead=!1,this.token=(0,s.randomToken)(),this._aplQ=s.PROMISE_RESOLVED_VOID,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;this.broadcastChannel.addEventListener("internal",r),this._lstns.push(r)};i.prototype={hasLeader:function(){return Promise.resolve(this._hasLeader)},applyOnce:function(o){var a=this;return this.isLeader?(0,s.sleep)(0,!0):this.isDead?(0,s.sleep)(0,!1):1<this._aplQC?this._aplQ:(this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then(function(){return a.isLeader?s.PROMISE_RESOLVED_TRUE:(t=!1,e=new Promise(function(e){r=function(){t=!0,e()}}),a.broadcastChannel.addEventListener("internal",n=function(e){"leader"===e.context&&e.token!=a.token&&("apply"===e.action&&e.token>a.token&&r(),"tell"===e.action)&&(r(),a._hasLeader=!0)}),i=o?4*a._options.responseTime:a._options.responseTime,(0,u.sendLeaderMessage)(a,"apply").then(function(){return Promise.race([(0,s.sleep)(i),e.then(function(){return Promise.reject(new Error)})])}).then(function(){return(0,u.sendLeaderMessage)(a,"apply")}).then(function(){return Promise.race([(0,s.sleep)(i),e.then(function(){return Promise.reject(new Error)})])}).catch(function(){}).then(function(){return a.broadcastChannel.removeEventListener("internal",n),!t&&(0,u.beLeader)(a).then(function(){return!0})}));var t,r,e,n,i}).then(function(){a._aplQC=a._aplQC-1}),this._aplQ.then(function(){return a.isLeader}))},awaitLeadership:function(){return this._aLP||(this._aLP=function(i){if(i.isLeader)return s.PROMISE_RESOLVED_VOID;return new Promise(function(e){var t=!1;function r(){t||(t=!0,i.broadcastChannel.removeEventListener("internal",n),e(!0))}i.applyOnce().then(function(){i.isLeader&&r()});(function e(){return(0,s.sleep)(i._options.fallbackInterval).then(function(){if(!i.isDead&&!t)return i.isLeader?void r():i.applyOnce(!0).then(function(){(i.isLeader?r:e)()})})})();var n=function(e){"leader"===e.context&&"death"===e.action&&(i._hasLeader=!1,i.applyOnce().then(function(){i.isLeader&&r()}))};i.broadcastChannel.addEventListener("internal",n),i._lstns.push(n)})}(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var t=this;return this._lstns.forEach(function(e){return t.broadcastChannel.removeEventListener("internal",e)}),this._lstns=[],this._unl.forEach(function(e){return e.remove()}),this._unl=[],this.isLeader&&(this._hasLeader=!1,this.isLeader=!1),this.isDead=!0,(0,u.sendLeaderMessage)(this,"death")}}},{"./leader-election-util.js":24,"./leader-election-web-lock.js":25,"./util.js":33}],27:[function(e,t,r){"use strict";e("@babel/runtime/helpers/typeof");Object.defineProperty(r,"__esModule",{value:!0}),r.chooseMethod=function(t){var e=[].concat(t.methods,a).filter(Boolean);if(t.type){if("simulate"===t.type)return o.SimulateMethod;var r=e.find(function(e){return e.type===t.type});if(r)return r;throw new Error("method-type "+t.type+" not found")}t.webWorkerSupport||(e=e.filter(function(e){return"idb"!==e.type}));r=e.find(function(e){return e.canBeUsed()});{if(r)return r;throw new Error("No usable method found in "+JSON.stringify(a.map(function(e){return e.type})))}};var r=e("./methods/native.js"),n=e("./methods/indexed-db.js"),i=e("./methods/localstorage.js"),o=e("./methods/simulate.js");var a=[r.NativeMethod,n.IndexedDBMethod,i.LocalstorageMethod]},{"./methods/indexed-db.js":28,"./methods/localstorage.js":29,"./methods/native.js":30,"./methods/simulate.js":31,"@babel/runtime/helpers/typeof":34}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TRANSACTION_SETTINGS=r.IndexedDBMethod=void 0,r.averageResponseTime=S,r.canBeUsed=w,r.cleanOldMessages=m,r.close=g,r.commitIndexedDBTransaction=f,r.create=b,r.createDatabase=u,r.getAllMessages=function(e){var r=e.transaction(c,"readonly",l),n=r.objectStore(c),i=[];return new Promise(function(t){n.openCursor().onsuccess=function(e){e=e.target.result;e?(i.push(e.value),e.continue()):(f(r),t(i))}})},r.getIdb=s,r.getMessagesHigherThan=p,r.getOldMessages=y,r.microSeconds=void 0,r.onMessage=_,r.postMessage=O,r.removeMessagesById=h,r.type=void 0,r.writeMessage=d;var i=e("../util.js"),o=e("oblivious-set"),a=e("../options.js"),e=i.microSeconds,n=(r.microSeconds=e,"pubkey.broadcast-channel-0-"),c="messages",l={durability:"relaxed"};r.TRANSACTION_SETTINGS=l;function s(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function f(e){e.commit&&e.commit()}function u(e){var r=s().open(n+e);return r.onupgradeneeded=function(e){e.target.result.createObjectStore(c,{keyPath:"id",autoIncrement:!0})},new Promise(function(e,t){r.onerror=function(e){return t(e)},r.onsuccess=function(){e(r.result)}})}function d(e,t,r){var n={uuid:t,time:(new Date).getTime(),data:r},i=e.transaction([c],"readwrite",l);return new Promise(function(e,t){i.oncomplete=function(){return e()},i.onerror=function(e){return t(e)},i.objectStore(c).add(n),f(i)})}function p(e,n){var i,o=e.transaction(c,"readonly",l),a=o.objectStore(c),s=[],u=IDBKeyRange.bound(n+1,1/0);return a.getAll?(i=a.getAll(u),new Promise(function(t,r){i.onerror=function(e){return r(e)},i.onsuccess=function(e){t(e.target.result)}})):new Promise(function(t,r){var e=function(){try{return u=IDBKeyRange.bound(n+1,1/0),a.openCursor(u)}catch(e){return a.openCursor()}}();e.onerror=function(e){return r(e)},e.onsuccess=function(e){e=e.target.result;e?e.value.id<n+1?e.continue(n+1):(s.push(e.value),e.continue()):(f(o),t(s))}})}function h(e,t){var r;return e.closed?Promise.resolve([]):(r=e.db.transaction(c,"readwrite",l).objectStore(c),Promise.all(t.map(function(e){var t=r.delete(e);return new Promise(function(e){t.onsuccess=function(){return e()}})})))}function y(e,t){var n=(new Date).getTime()-t,i=e.transaction(c,"readonly",l),o=i.objectStore(c),a=[];return new Promise(function(r){o.openCursor().onsuccess=function(e){var t,e=e.target.result;e?(t=e.value).time<n?(a.push(t),e.continue()):(f(i),r(a)):r(a)}})}function m(t){return y(t.db,t.options.idb.ttl).then(function(e){return h(t,e.map(function(e){return e.id}))})}function b(r,n){return n=(0,a.fillOptionsWithDefaults)(n),u(r).then(function(e){var t={closed:!1,lastCursorId:0,channelName:r,options:n,uuid:(0,i.randomToken)(),eMIs:new o.ObliviousSet(2*n.idb.ttl),writeBlockPromise:i.PROMISE_RESOLVED_VOID,messagesCallback:null,readQueuePromises:[],db:e};return e.onclose=function(){t.closed=!0,n.idb.onclose&&n.idb.onclose()},function e(t){if(t.closed)return;v(t).then(function(){return(0,i.sleep)(t.options.idb.fallbackInterval)}).then(function(){return e(t)})}(t),t})}function v(r){return!r.closed&&r.messagesCallback?p(r.db,r.lastCursorId).then(function(e){return e.filter(function(e){return!!e}).map(function(e){return e.id>r.lastCursorId&&(r.lastCursorId=e.id),e}).filter(function(e){return t=r,(e=e).uuid!==t.uuid&&!(t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime);var t}).sort(function(e,t){return e.time-t.time}).forEach(function(e){r.messagesCallback&&(r.eMIs.add(e.id),r.messagesCallback(e.data))}),i.PROMISE_RESOLVED_VOID}):i.PROMISE_RESOLVED_VOID}function g(e){e.closed=!0,e.db.close()}function O(e,t){return e.writeBlockPromise=e.writeBlockPromise.then(function(){return d(e.db,e.uuid,t)}).then(function(){0===(0,i.randomInt)(0,10)&&m(e)}),e.writeBlockPromise}function _(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t,v(e)}function w(){return!!s()}function S(e){return 2*e.idb.fallbackInterval}r.type="idb",r.IndexedDBMethod={create:b,close:g,onMessage:_,postMessage:O,canBeUsed:w,type:"idb",averageResponseTime:S,microSeconds:e}},{"../options.js":32,"../util.js":33,"oblivious-set":316}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LocalstorageMethod=void 0,r.addStorageEventListener=f,r.averageResponseTime=b,r.canBeUsed=m,r.close=h,r.create=p,r.getLocalStorage=u,r.microSeconds=void 0,r.onMessage=y,r.postMessage=l,r.removeStorageEventListener=d,r.storageKey=c,r.type=void 0;var o=e("oblivious-set"),a=e("../options.js"),s=e("../util.js"),e=s.microSeconds,i=(r.microSeconds=e,"pubkey.broadcastChannel-"),n="localstorage";function u(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function c(e){return i+e}function l(i,o){return new Promise(function(n){(0,s.sleep)().then(function(){var e=c(i.channelName),t={token:(0,s.randomToken)(),time:(new Date).getTime(),data:o,uuid:i.uuid},t=JSON.stringify(t),r=(u().setItem(e,t),document.createEvent("Event"));r.initEvent("storage",!0,!0),r.key=e,r.newValue=t,window.dispatchEvent(r),n()})})}function f(e,t){function r(e){e.key===n&&t(JSON.parse(e.newValue))}var n=i+e;return window.addEventListener("storage",r),r}function d(e){window.removeEventListener("storage",e)}function p(e,t){var r,n,i;if(t=(0,a.fillOptionsWithDefaults)(t),m())return r=(0,s.randomToken)(),n=new o.ObliviousSet(t.localstorage.removeTimeout),(i={channelName:e,uuid:r,eMIs:n}).listener=f(e,function(e){!i.messagesCallback||e.uuid===r||!e.token||n.has(e.token)||e.data.time&&e.data.time<i.messagesCallbackTime||(n.add(e.token),i.messagesCallback(e.data))}),i;throw new Error("BroadcastChannel: localstorage cannot be used")}function h(e){d(e.listener)}function y(e,t,r){e.messagesCallbackTime=r,e.messagesCallback=t}function m(){var e=u();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}function b(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120}r.type=n,r.LocalstorageMethod={create:p,close:h,onMessage:y,postMessage:l,canBeUsed:m,type:n,averageResponseTime:b,microSeconds:e}},{"../options.js":32,"../util.js":33,"oblivious-set":316}],30:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.NativeMethod=void 0,r.averageResponseTime=c,r.canBeUsed=u,r.close=o,r.create=i,r.microSeconds=void 0,r.onMessage=s,r.postMessage=a,r.type=void 0;var n=e("../util.js"),e=n.microSeconds;r.microSeconds=e;function i(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t}function o(e){e.bc.close(),e.subFns=[]}function a(e,t){try{return e.bc.postMessage(t,!1),n.PROMISE_RESOLVED_VOID}catch(e){return Promise.reject(e)}}function s(e,t){e.messagesCallback=t}function u(){if("undefined"==typeof window&&"undefined"==typeof self||"function"!=typeof BroadcastChannel)return!1;if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}function c(){return 150}r.type="native",r.NativeMethod={create:i,close:o,onMessage:s,postMessage:a,canBeUsed:u,type:"native",averageResponseTime:c,microSeconds:e}},{"../util.js":33}],31:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SimulateMethod=void 0,r.averageResponseTime=l,r.canBeUsed=c,r.close=a,r.create=o,r.microSeconds=void 0,r.onMessage=u,r.postMessage=s,r.type=void 0;var e=e("../util.js").microSeconds,n=(r.microSeconds=e,"simulate"),i=(r.type=n,new Set);function o(e){e={name:e,messagesCallback:null};return i.add(e),e}function a(e){i.delete(e)}function s(t,r){return new Promise(function(e){return setTimeout(function(){Array.from(i).filter(function(e){return e.name===t.name}).filter(function(e){return e!==t}).filter(function(e){return!!e.messagesCallback}).forEach(function(e){return e.messagesCallback(r)}),e()},5)})}function u(e,t){e.messagesCallback=t}function c(){return!0}function l(){return 5}r.SimulateMethod={create:o,close:a,onMessage:u,postMessage:s,canBeUsed:c,type:n,averageResponseTime:l,microSeconds:e}},{"../util.js":33}],32:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fillOptionsWithDefaults=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0);t.idb||(t.idb={});t.idb.ttl||(t.idb.ttl=45e3);t.idb.fallbackInterval||(t.idb.fallbackInterval=150);e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose);t.localstorage||(t.localstorage={});t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4);e.methods&&(t.methods=e.methods);t.node||(t.node={});t.node.ttl||(t.node.ttl=12e4);t.node.maxParallelWrites||(t.node.maxParallelWrites=2048);void 0===t.node.useFastPath&&(t.node.useFastPath=!0);return t}},{}],33:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PROMISE_RESOLVED_VOID=r.PROMISE_RESOLVED_TRUE=r.PROMISE_RESOLVED_FALSE=void 0,r.isPromise=function(e){return e&&"function"==typeof e.then},r.microSeconds=function(){var e=(new Date).getTime();return e===i?1e3*e+ ++o:(o=0,1e3*(i=e))},r.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},r.randomToken=function(){return Math.random().toString(36).substring(2)},r.sleep=function(t,r){t=t||0;return new Promise(function(e){return setTimeout(function(){return e(r)},t)})},r.supportsWebLockAPI=function(){return"undefined"!=typeof navigator&&void 0!==navigator.locks&&"function"==typeof navigator.locks.request};var n=Promise.resolve(!1),n=(r.PROMISE_RESOLVED_FALSE=n,Promise.resolve(!0)),n=(r.PROMISE_RESOLVED_TRUE=n,Promise.resolve());r.PROMISE_RESOLVED_VOID=n;var i=0,o=0},{}],34:[function(e,t,r){function n(e){return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],35:[function(e,t,r){"use strict";var n=e("get-intrinsic"),i=e("./"),o=i(n("String.prototype.indexOf"));t.exports=function(e,t){t=n(e,!!t);return"function"==typeof t&&-1<o(e,".prototype.")?i(t):t}},{"./":36,"get-intrinsic":54}],36:[function(t,e,r){"use strict";var n=t("function-bind"),i=t("get-intrinsic"),o=t("set-function-length"),a=i("%TypeError%"),s=i("%Function.prototype.apply%"),u=i("%Function.prototype.call%"),c=i("%Reflect.apply%",!0)||n.call(u,s),t=i("%Object.defineProperty%",!0),l=i("%Math.max%");if(t)try{t({},"a",{value:1})}catch(e){t=null}e.exports=function(e){if("function"!=typeof e)throw new a("a function is required");var t=c(n,u,arguments);return o(t,1+l(0,e.length-(arguments.length-1)),!0)};function f(){return c(n,s,arguments)}t?t(e.exports,"apply",{value:f}):e.exports.apply=f},{"function-bind":52,"get-intrinsic":54,"set-function-length":641}],37:[function(e,t,r){!function(j){!function(){var e=function(){"use strict";function g(e,t){return null!=t&&e instanceof t}var O,_,w;try{O=Map}catch(e){O=function(){}}try{_=Set}catch(e){_=function(){}}try{w=Promise}catch(e){w=function(){}}function S(e,p,t,h,y){"object"==typeof p&&(t=p.depth,h=p.prototype,y=p.includeNonEnumerable,p=p.circular);var m=[],b=[],v=void 0!==j;return void 0===p&&(p=!0),function n(e,i){if(null===e)return null;if(0===i)return e;var r,t,o;if("object"!=typeof e)return e;if(g(e,O))r=new O;else if(g(e,_))r=new _;else if(g(e,w))r=new w(function(t,r){e.then(function(e){t(n(e,i-1))},function(e){r(n(e,i-1))})});else if(S.__isArray(e))r=[];else if(S.__isRegExp(e))r=new RegExp(e.source,x(e)),e.lastIndex&&(r.lastIndex=e.lastIndex);else if(S.__isDate(e))r=new Date(e.getTime());else{if(v&&j.isBuffer(e))return r=j.allocUnsafe?j.allocUnsafe(e.length):new j(e.length),e.copy(r),r;g(e,Error)?r=Object.create(e):void 0===h?(t=Object.getPrototypeOf(e),r=Object.create(t)):(r=Object.create(h),t=h)}if(p){var a=m.indexOf(e);if(-1!=a)return b[a];m.push(e),b.push(r)}for(u in g(e,O)&&e.forEach(function(e,t){t=n(t,i-1),e=n(e,i-1),r.set(t,e)}),g(e,_)&&e.forEach(function(e){e=n(e,i-1),r.add(e)}),e)(o=t?Object.getOwnPropertyDescriptor(t,u):o)&&null==o.set||(r[u]=n(e[u],i-1));if(Object.getOwnPropertySymbols)for(var s=Object.getOwnPropertySymbols(e),u=0;u<s.length;u++){var c=s[u];(f=Object.getOwnPropertyDescriptor(e,c))&&!f.enumerable&&!y||(r[c]=n(e[c],i-1),f.enumerable)||Object.defineProperty(r,c,{enumerable:!1})}if(y)for(var l=Object.getOwnPropertyNames(e),u=0;u<l.length;u++){var f,d=l[u];(f=Object.getOwnPropertyDescriptor(e,d))&&f.enumerable||(r[d]=n(e[d],i-1),Object.defineProperty(r,d,{enumerable:!1}))}return r}(e,t=void 0===t?1/0:t)}function t(e){return Object.prototype.toString.call(e)}function x(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return S.clonePrototype=function(e){var t;return null===e?null:((t=function(){}).prototype=e,new t)},S.__objToStr=t,S.__isDate=function(e){return"object"==typeof e&&"[object Date]"===t(e)},S.__isArray=function(e){return"object"==typeof e&&"[object Array]"===t(e)},S.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===t(e)},S.__getRegExpFlags=x,S}();"object"==typeof t&&t.exports&&(t.exports=e)}.call(this)}.call(this,e("buffer").Buffer)},{buffer:649}],38:[function(e,t,r){"use strict";e=e("./index.js");t.exports={IdleQueue:e.IdleQueue}},{"./index.js":39}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.IdleQueue=void 0;function n(){this._parallels=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1)||1,this._qC=0,this._iC=new Set,this._lHN=0,this._hPM=new Map,this._pHM=new Map}function i(e,t){var r;t&&(t._timeoutObj&&clearTimeout(t._timeoutObj),e._pHM.has(t)&&(r=e._pHM.get(t),e._hPM.delete(r),e._pHM.delete(t)),e._iC.delete(t))}function o(t){t._tryIR||0===t._iC.size||(t._tryIR=!0,setTimeout(function(){t.isIdle()?setTimeout(function(){var e;t.isIdle()&&0!==(e=t)._iC.size&&(e._iC.values().next().value._manRes(),setTimeout(function(){return o(e)},0)),t._tryIR=!1},0):t._tryIR=!1},0))}(r.IdleQueue=n).prototype={isIdle:function(){return this._qC<this._parallels},lock:function(){this._qC++},unlock:function(){this._qC--,o(this)},wrapCall:function(e){var t,r=this;this.lock();try{t=e()}catch(e){throw this.unlock(),e}return t.then&&"function"==typeof t.then?t.then(function(e){return r.unlock(),e}).catch(function(e){throw r.unlock(),e}):(this.unlock(),t)},requestIdlePromise:function(e){var t,r=this,n=(e=e||{},new Promise(function(e){return t=e}));return n._manRes=function(){i(r,n),t()},e.timeout&&(e=setTimeout(function(){n._manRes()},e.timeout),n._timeoutObj=e),this._iC.add(n),o(this),n},cancelIdlePromise:function(e){i(this,e)},requestIdleCallback:function(e,t){var r=this._lHN++,t=this.requestIdlePromise(t);return this._hPM.set(r,t),this._pHM.set(t,r),t.then(function(){return e()}),r},cancelIdleCallback:function(e){e=this._hPM.get(e);this.cancelIdlePromise(e)},clear:function(){var t=this;this._iC.forEach(function(e){return i(t,e)}),this._qC=0,this._iC.clear(),this._hPM=new Map,this._pHM=new Map}}},{}],40:[function(e,t,r){var l=e("object-keys"),f=e("is-arguments"),d=e("object-is"),p=e("is-regex"),h=e("regexp.prototype.flags"),y=e("is-date-object"),m=Date.prototype.getTime;function b(e,t,r){r=r||{};if(r.strict?!d(e,t):e!==t){if(!e||!t||"object"!=typeof e&&"object"!=typeof t)return r.strict?d(e,t):e==t;var n,i,o=e,a=t,s=r;if(typeof o!=typeof a)return!1;if(v(o)||v(a))return!1;if(o.prototype!==a.prototype)return!1;if(f(o)!==f(a))return!1;e=p(o),t=p(a);if(e!==t)return!1;if(e||t)return o.source===a.source&&h(o)===h(a);if(y(o)&&y(a))return m.call(o)===m.call(a);if(e=g(o),t=g(a),e!==t)return!1;if(e||t){if(o.length!==a.length)return!1;for(n=0;n<o.length;n++)if(o[n]!==a[n])return!1}else{if(typeof o!=typeof a)return!1;try{var u=l(o),c=l(a)}catch(e){return!1}if(u.length!==c.length)return!1;for(u.sort(),c.sort(),n=u.length-1;0<=n;n--)if(u[n]!=c[n])return!1;for(n=u.length-1;0<=n;n--)if(i=u[n],!b(o[i],a[i],s))return!1}}return!0}function v(e){return null==e}function g(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length||"function"!=typeof e.copy||"function"!=typeof e.slice||0<e.length&&"number"!=typeof e[0])}t.exports=b},{"is-arguments":62,"is-date-object":63,"is-regex":64,"object-is":310,"object-keys":314,"regexp.prototype.flags":319}],41:[function(e,t,r){"use strict";var n=e("has-property-descriptors")(),i=e("get-intrinsic"),u=n&&i("%Object.defineProperty%",!0);if(u)try{u({},"a",{value:1})}catch(e){u=!1}var c=i("%SyntaxError%"),l=i("%TypeError%"),f=e("gopd");t.exports=function(e,t,r){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new l("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new l("`property` must be a string or a symbol`");if(3<arguments.length&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new l("`nonEnumerable`, if provided, must be a boolean or null");if(4<arguments.length&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new l("`nonWritable`, if provided, must be a boolean or null");if(5<arguments.length&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new l("`nonConfigurable`, if provided, must be a boolean or null");if(6<arguments.length&&"boolean"!=typeof arguments[6])throw new l("`loose`, if provided, must be a boolean");var n=3<arguments.length?arguments[3]:null,i=4<arguments.length?arguments[4]:null,o=5<arguments.length?arguments[5]:null,a=6<arguments.length&&arguments[6],s=!!f&&f(e,t);if(u)u(e,t,{configurable:null===o&&s?s.configurable:!o,enumerable:null===n&&s?s.enumerable:!n,value:r,writable:null===i&&s?s.writable:!i});else{if(!a&&(n||i||o))throw new c("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=r}}},{"get-intrinsic":54,gopd:55,"has-property-descriptors":56}],42:[function(e,t,r){"use strict";function n(e,t){var r=2<arguments.length?arguments[2]:{},n=o(t);a&&(n=s.call(n,Object.getOwnPropertySymbols(t)));for(var i=0;i<n.length;i+=1)!function(e,t,r,n){if(t in e)if(!0===n){if(e[t]===r)return}else if(!c(n)||!n())return;l?u(e,t,r,!0):u(e,t,r)}(e,n[i],t[n[i]],r[n[i]])}var o=e("object-keys"),a="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),i=Object.prototype.toString,s=Array.prototype.concat,u=e("define-data-property"),c=function(e){return"function"==typeof e&&"[object Function]"===i.call(e)},l=e("has-property-descriptors")();n.supportsDescriptors=!!l,t.exports=n},{"define-data-property":41,"has-property-descriptors":56,"object-keys":314}],43:[function(e,r,n){!function(un,cn){!function(){var e,t;e=this,t=function(){"use strict";var T=function(e,t){return(T=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)};var v=function(){return(v=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function $(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||((n=n||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}var d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:un,w=Object.keys,g=Array.isArray;function s(t,r){return"object"==typeof r&&w(r).forEach(function(e){t[e]=r[e]}),t}"undefined"==typeof Promise||d.Promise||(d.Promise=Promise);var F=Object.getPrototypeOf,L={}.hasOwnProperty;function b(e,t){return L.call(e,t)}function B(t,r){"function"==typeof r&&(r=r(F(t))),("undefined"==typeof Reflect?w:Reflect.ownKeys)(r).forEach(function(e){u(t,e,r[e])})}var q=Object.defineProperty;function u(e,t,r,n){q(e,t,s(r&&b(r,"get")&&"function"==typeof r.get?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function U(t){return{from:function(e){return t.prototype=Object.create(e.prototype),u(t.prototype,"constructor",t),{extend:B.bind(null,t.prototype)}}}}var W=Object.getOwnPropertyDescriptor;function V(e,t){return W(e,t)||(e=F(e))&&V(e,t)}var z=[].slice;function K(e,t,r){return z.call(e,t,r)}function Q(e,t){return t(e)}function H(e){if(!e)throw new Error("Assertion Failed")}function G(e){d.setImmediate?cn(e):setTimeout(e,0)}function J(e,n){return e.reduce(function(e,t,r){t=n(t,r);return t&&(e[t[0]]=t[1]),e},{})}function c(e,t){if(b(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var r=[],n=0,i=t.length;n<i;++n){var o=c(e,t[n]);r.push(o)}return r}var a,s=t.indexOf(".");return-1===s||void 0===(a=e[t.substr(0,s)])?void 0:c(a,t.substr(s+1))}function S(e,t,r){if(e&&void 0!==t&&!("isFrozen"in Object&&Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){H("string"!=typeof r&&"length"in r);for(var n=0,i=t.length;n<i;++n)S(e,t[n],r[n])}else{var o,a,s=t.indexOf(".");-1!==s?(o=t.substr(0,s),""===(s=t.substr(s+1))?void 0===r?g(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=r:S(a=(a=e[o])&&b(e,o)?a:e[o]={},s,r)):void 0===r?g(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function Y(e){var t,r={};for(t in e)b(e,t)&&(r[t]=e[t]);return r}var X=[].concat;function Z(e){return X.apply([],e)}var e="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Z([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(e){return d[e]}),ee=e.map(function(e){return d[e]}),l=(J(e,function(e){return[e,!0]}),null);function te(e){l="undefined"!=typeof WeakMap&&new WeakMap;e=function e(t){if(!t||"object"!=typeof t)return t;var r=l&&l.get(t);if(r)return r;if(g(t)){r=[],l&&l.set(t,r);for(var n=0,i=t.length;n<i;++n)r.push(e(t[n]))}else if(0<=ee.indexOf(t.constructor))r=t;else{var o,a=F(t);for(o in r=a===Object.prototype?{}:Object.create(a),l&&l.set(t,r),t)b(t,o)&&(r[o]=e(t[o]))}return r}(e);return l=null,e}var re={}.toString;function ne(e){return re.call(e).slice(8,-1)}var ie="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",oe="symbol"==typeof ie?function(e){var t;return null!=e&&(t=e[ie])&&t.apply(e)}:function(){return null},ae={};function r(e){var t,r,n,i;if(1===arguments.length){if(g(e))return e.slice();if(this===ae&&"string"==typeof e)return[e];if(i=oe(e))for(r=[];!(n=i.next()).done;)r.push(n.value);else{if(null==e)return[e];if("number"!=typeof(t=e.length))return[e];for(r=new Array(t);t--;)r[t]=e[t]}}else for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}var se="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},f="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ue(e,t){f=e,ce=t}var ce=function(){return!0},le=!new Error("").stack;function fe(){if(le)try{throw new Error}catch(e){return e}return new Error}function de(e,t){var r=e.stack;return r?(t=t||0,0===r.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),r.split("\n").slice(t).filter(ce).map(function(e){return"\n"+e}).join("")):""}var e=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],t=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(e),pe={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function he(e,t){this._e=fe(),this.name=e,this.message=t}function ye(e,t){return e+". Errors: "+Object.keys(t).map(function(e){return t[e].toString()}).filter(function(e,t,r){return r.indexOf(e)===t}).join("\n")}function me(e,t,r,n){this._e=fe(),this.failures=t,this.failedKeys=n,this.successCount=r,this.message=ye(e,t)}function be(e,t){this._e=fe(),this.name="BulkError",this.failures=Object.keys(t).map(function(e){return t[e]}),this.failuresByPos=t,this.message=ye(e,t)}U(he).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+de(this._e,2))}},toString:function(){return this.name+": "+this.message}}),U(me).from(he),U(be).from(he);var ve=t.reduce(function(e,t){return e[t]=t+"Error",e},{}),ge=he,O=t.reduce(function(e,r){var n=r+"Error";function t(e,t){this._e=fe(),this.name=n,e?"string"==typeof e?(this.message="".concat(e).concat(t?"\n "+t:""),this.inner=t||null):"object"==typeof e&&(this.message="".concat(e.name," ").concat(e.message),this.inner=e):(this.message=pe[r]||n,this.inner=null)}return U(t).from(ge),e[r]=t,e},{}),Oe=(O.Syntax=SyntaxError,O.Type=TypeError,O.Range=RangeError,e.reduce(function(e,t){return e[t+"Error"]=O[t],e},{}));e=t.reduce(function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=O[t]),e},{});function _(){}function _e(e){return e}function we(t,r){return null==t||t===_e?r:function(e){return r(t(e))}}function Se(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function xe(i,o){return i===_?o:function(){var e=i.apply(this,arguments),t=(void 0!==e&&(arguments[0]=e),this.onsuccess),r=this.onerror,n=(this.onsuccess=null,this.onerror=null,o.apply(this,arguments));return t&&(this.onsuccess=this.onsuccess?Se(t,this.onsuccess):t),r&&(this.onerror=this.onerror?Se(r,this.onerror):r),void 0!==n?n:e}}function je(r,n){return r===_?n:function(){r.apply(this,arguments);var e=this.onsuccess,t=this.onerror;this.onsuccess=this.onerror=null,n.apply(this,arguments),e&&(this.onsuccess=this.onsuccess?Se(e,this.onsuccess):e),t&&(this.onerror=this.onerror?Se(t,this.onerror):t)}}function Pe(i,o){return i===_?o:function(e){var t=i.apply(this,arguments),e=(s(e,t),this.onsuccess),r=this.onerror,n=(this.onsuccess=null,this.onerror=null,o.apply(this,arguments));return e&&(this.onsuccess=this.onsuccess?Se(e,this.onsuccess):e),r&&(this.onerror=this.onerror?Se(r,this.onerror):r),void 0===t?void 0===n?void 0:n:s(t,n)}}function Ee(e,t){return e===_?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function Me(i,o){return i===_?o:function(){var e=i.apply(this,arguments);if(e&&"function"==typeof e.then){for(var t=this,r=arguments.length,n=new Array(r);r--;)n[r]=arguments[r];return e.then(function(){return o.apply(t,n)})}return o.apply(this,arguments)}}e.ModifyError=me,e.DexieError=he,e.BulkError=be;var Ae={},Ie=100,ke=100,Ce="undefined"==typeof Promise?[]:(t=Promise.resolve(),"undefined"!=typeof crypto&&crypto.subtle?[Ce=crypto.subtle.digest("SHA-512",new Uint8Array([0])),F(Ce),t]:[t,F(t),t]),Re=Ce[0],De=Ce[1],Ne=Ce[2],Te=De&&De.then,$e=Re&&Re.constructor,Fe=!!Ne,Le=!1,Be=Ne?function(){Ne.then(ot)}:d.setImmediate?cn.bind(null,ot):d.MutationObserver?function(){var e=document.createElement("div");new MutationObserver(function(){ot(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(ot,0)},qe=function(e,t){Ge.push([e,t]),We&&(Be(),We=!1)},Ue=!0,We=!0,Ve=[],ze=[],Ke=null,Qe=_e,He={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:xt,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(e){try{xt(e[0],e[1])}catch(e){}})}},x=He,Ge=[],Je=0,Ye=[];function m(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=_,this._lib=!1;var t=this._PSD=x;if(f&&(this._stackHolder=fe(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==Ae)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],!1===this._state&&et(this,this._value)}else this._state=null,this._value=null,++t.ref,!function t(n,e){try{e(function(r){if(null===n._state){if(r===n)throw new TypeError("A promise cannot be resolved with itself.");var e=n._lib&&at();r&&"function"==typeof r.then?t(n,function(e,t){r instanceof m?r._then(e,t):r.then(e,t)}):(n._state=!0,n._value=r,tt(n)),e&&st()}},et.bind(null,n))}catch(e){et(n,e)}}(this,e)}var Xe={get:function(){var s=x,t=pt;function e(r,n){var i=this,o=!s.global&&(s!==x||t!==pt),a=o&&!E(),e=new m(function(e,t){rt(i,new Ze(_t(r,s,o,a),_t(n,s,o,a),e,t,s))});return f&&it(e,this),e}return e.prototype=Ae,e},set:function(e){u(this,"then",e&&e.prototype===Ae?Xe:{get:function(){return e},set:Xe.set})}};function Ze(e,t,r,n,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=r,this.reject=n,this.psd=i}function et(t,r){if(ze.push(r),null===t._state){var n,e=t._lib&&at();if(r=Qe(r),t._state=!1,t._value=r,f&&null!==r&&"object"==typeof r&&!r._promise){var i=function(){var e=V(r,"stack");r._promise=t,u(r,"stack",{get:function(){return Le?e&&(e.get?e.get.apply(r):e.value):t.stack}})};var o=void 0;var a=void 0;try{i.apply(null,a)}catch(e){o&&o(e)}}n=t,Ve.some(function(e){return e._value===n._value})||Ve.push(n),tt(t),e&&st()}}function tt(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)rt(e,t[r]);var i=e._PSD;--i.ref||i.finalize(),0===Je&&(++Je,qe(function(){0==--Je&&ut()},[]))}function rt(e,t){if(null===e._state)e._listeners.push(t);else{var r=e._state?t.onFulfilled:t.onRejected;if(null===r)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Je,qe(nt,[r,e,t])}}function nt(e,t,r){try{var n,i=(Ke=t)._value;t._state?n=e(i):(ze.length&&(ze=[]),n=e(i),-1===ze.indexOf(i)&&function(e){var t=Ve.length;for(;t;)if(Ve[--t]._value===e._value)return Ve.splice(t,1)}(t)),r.resolve(n)}catch(e){r.reject(e)}finally{Ke=null,0==--Je&&ut(),--r.psd.ref||r.psd.finalize()}}function it(e,t){var r=t?t._numPrev+1:0;r<Ie&&(e._prev=t,e._numPrev=r)}function ot(){at()&&st()}function at(){var e=Ue;return We=Ue=!1,e}function st(){var e,t,r;do{for(;0<Ge.length;)for(e=Ge,Ge=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}}while(0<Ge.length);We=Ue=!0}function ut(){for(var e=Ve,t=(Ve=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)}),Ye.slice(0)),r=t.length;r;)t[--r]()}function ct(e){return new m(Ae,!1,e)}function j(r,n){var i=x;return function(){var e=at(),t=x;try{return a(i,!0),r.apply(this,arguments)}catch(e){n&&n(e)}finally{a(t,!1),e&&st()}}}B(m.prototype,{then:Xe,_then:function(e,t){rt(this,new Ze(null,null,e,t,x))},catch:function(e){var t,r;return 1===arguments.length?this.then(null,e):(t=e,r=arguments[1],"function"==typeof t?this.then(null,function(e){return(e instanceof t?r:ct)(e)}):this.then(null,function(e){return(e&&e.name===t?r:ct)(e)}))},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),ct(e)})},stack:{get:function(){if(this._stack)return this._stack;try{Le=!0;var e=function e(t,r,n){if(r.length===n)return r;var i="";{var o,a,s;!1===t._state&&(null!=(o=t._value)?(a=o.name||"Error",s=o.message||o,i=de(o,0)):(a=o,s=""),r.push(a+(s?": "+s:"")+i))}f&&((i=de(t._stackHolder,2))&&-1===r.indexOf(i)&&r.push(i),t._prev)&&e(t._prev,r,n);return r}(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{Le=!1}}},timeout:function(n,i){var o=this;return n<1/0?new m(function(e,t){var r=setTimeout(function(){return t(new O.Timeout(i))},n);o.then(e,t).finally(clearTimeout.bind(null,r))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&u(m.prototype,Symbol.toStringTag,"Dexie.Promise"),He.env=vt(),B(m,{all:function(){var o=r.apply(null,arguments).map(mt);return new m(function(r,n){0===o.length&&r([]);var i=o.length;o.forEach(function(e,t){return m.resolve(e).then(function(e){o[t]=e,--i||r(o)},n)})})},resolve:function(r){var e;return r instanceof m?r:r&&"function"==typeof r.then?new m(function(e,t){r.then(e,t)}):(it(e=new m(Ae,!0,r),Ke),e)},reject:ct,race:function(){var e=r.apply(null,arguments).map(mt);return new m(function(t,r){e.map(function(e){return m.resolve(e).then(t,r)})})},PSD:{get:function(){return x},set:function(e){return x=e}},totalEchoes:{get:function(){return pt}},newPSD:P,usePSD:gt,scheduler:{get:function(){return qe},set:function(e){qe=e}},rejectionMapper:{get:function(){return Qe},set:function(e){Qe=e}},follow:function(i,r){return new m(function(e,t){return P(function(r,n){var e=x;e.unhandleds=[],e.onunhandled=n,e.finalize=Se(function(){var t,e=this;t=function(){0===e.unhandleds.length?r():n(e.unhandleds[0])},Ye.push(function e(){t(),Ye.splice(Ye.indexOf(e),1)}),++Je,qe(function(){0==--Je&&ut()},[])},e.finalize),i()},r,e,t)})}}),$e&&($e.allSettled&&u(m,"allSettled",function(){var e=r.apply(null,arguments).map(mt);return new m(function(r){0===e.length&&r([]);var n=e.length,i=new Array(n);e.forEach(function(e,t){return m.resolve(e).then(function(e){return i[t]={status:"fulfilled",value:e}},function(e){return i[t]={status:"rejected",reason:e}}).then(function(){return--n||r(i)})})})}),$e.any)&&"undefined"!=typeof AggregateError&&u(m,"any",function(){var e=r.apply(null,arguments).map(mt);return new m(function(r,n){0===e.length&&n(new AggregateError([]));var i=e.length,o=new Array(i);e.forEach(function(e,t){return m.resolve(e).then(function(e){return r(e)},function(e){o[t]=e,--i||n(new AggregateError(o))})})})});var o={awaits:0,echoes:0,id:0},lt=0,ft=[],dt=0,pt=0,ht=0;function P(e,t,r,n){var i=x,o=Object.create(i),a=(o.parent=i,o.ref=0,o.global=!1,o.id=++ht,He.env),a=(o.env=Fe?{Promise:m,PromiseProp:{value:m,configurable:!0,writable:!0},all:m.all,race:m.race,allSettled:m.allSettled,any:m.any,resolve:m.resolve,reject:m.reject,nthen:wt(a.nthen,o),gthen:wt(a.gthen,o)}:{},t&&s(o,t),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()},gt(o,e,r,n));return 0===o.ref&&o.finalize(),a}function yt(){return o.id||(o.id=++lt),++o.awaits,o.echoes+=ke,o.id}function E(){return!!o.awaits&&(0==--o.awaits&&(o.id=0),o.echoes=o.awaits*ke,!0)}function mt(e){return o.echoes&&e&&e.constructor===$e?(yt(),e.then(function(e){return E(),e},function(e){return E(),M(e)})):e}function bt(){var e=ft[ft.length-1];ft.pop(),a(e,!1)}function a(e,t){var r,n,i=x;(t?!o.echoes||dt++&&e===x:!dt||--dt&&e===x)||Ot(t?function(e){++pt,o.echoes&&0!=--o.echoes||(o.echoes=o.id=0),ft.push(x),a(e,!0)}.bind(null,e):bt),e!==x&&(x=e,i===He&&(He.env=vt()),Fe)&&(r=He.env.Promise,n=e.env,De.then=n.nthen,r.prototype.then=n.gthen,i.global||e.global)&&(Object.defineProperty(d,"Promise",n.PromiseProp),r.all=n.all,r.race=n.race,r.resolve=n.resolve,r.reject=n.reject,n.allSettled&&(r.allSettled=n.allSettled),n.any)&&(r.any=n.any)}function vt(){var e=d.Promise;return Fe?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(d,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:De.then,gthen:e.prototype.then}:{}}function gt(e,t,r,n,i){var o=x;try{return a(e,!0),t(r,n,i)}finally{a(o,!1)}}function Ot(e){Te.call(Re,e)}function _t(t,r,n,i){return"function"!=typeof t?t:function(){var e=x;n&&yt(),a(r,!0);try{return t.apply(this,arguments)}finally{a(e,!1),i&&Ot(E)}}}function wt(r,n){return function(e,t){return r.call(this,_t(e,n),_t(t,n))}}-1===(""+Te).indexOf("[native code]")&&(yt=E=_);var St="unhandledrejection";function xt(e,t){var r;try{r=t.onuncatched(e)}catch(e){}if(!1!==r)try{var n,i={promise:t,reason:e};if(d.document&&document.createEvent?((n=document.createEvent("Event")).initEvent(St,!0,!0),s(n,i)):d.CustomEvent&&s(n=new CustomEvent(St,{detail:i}),i),n&&d.dispatchEvent&&(dispatchEvent(n),!d.PromiseRejectionEvent)&&d.onunhandledrejection)try{d.onunhandledrejection(n)}catch(e){}f&&n&&!n.defaultPrevented&&console.warn("Unhandled rejection: ".concat(e.stack||e))}catch(e){}}var M=m.reject;function jt(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)}var t="4.0.0-alpha.4",Pt=String.fromCharCode(65535),A="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Et="String expected.",Mt=[],At="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),It=At,kt=At,Ct="__dbnames",Rt="readonly",Dt="readwrite";function Nt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var Tt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function $t(t){return"string"!=typeof t||/\./.test(t)?function(e){return e}:function(e){return void 0===e[t]&&t in e&&delete(e=te(e))[t],e}}function Ft(){throw O.Type()}n.prototype._trans=function(e,n,t){var r=this._tx||x.trans,i=this.name;function o(e,t,r){if(r.schema[i])return n(r.idbtrans,r);throw new O.NotFound("Table "+i+" not part of transaction")}var a=at();try{return r&&r.db===this.db?r===x.trans?r._promise(e,o,t):P(function(){return r._promise(e,o,t)},{trans:r,transless:x.transless||x}):function t(r,n,i,o){if(r.idbdb&&(r._state.openComplete||x.letThrough||r._vip)){var a=r._createTransaction(n,i,r._dbSchema);try{a.create(),r._state.PR1398_maxLoop=3}catch(e){return e.name===ve.InvalidState&&r.isOpen()&&0<--r._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),r._close(),r.open().then(function(){return t(r,n,i,o)})):M(e)}return a._promise(n,function(e,t){return P(function(){return x.trans=a,o(e,t,a)})}).then(function(e){return a._completion.then(function(){return e})})}if(r._state.openComplete)return M(new O.DatabaseClosed(r._state.dbOpenError));if(!r._state.isBeingOpened){if(!r._options.autoOpen)return M(new O.DatabaseClosed);r.open().catch(_)}return r._state.dbReadyPromise.then(function(){return t(r,n,i,o)})}(this.db,e,[this.name],o)}finally{a&&st()}},n.prototype.get=function(t,e){var r=this;return t&&t.constructor===Object?this.where(t).first(e):this._trans("readonly",function(e){return r.core.get({trans:e,key:t}).then(function(e){return r.hook.reading.fire(e)})}).then(e)},n.prototype.where=function(o){if("string"==typeof o)return new this.db.WhereClause(this,o);if(g(o))return new this.db.WhereClause(this,"[".concat(o.join("+"),"]"));var r=w(o);if(1===r.length)return this.where(r[0]).equals(o[r[0]]);var e=this.schema.indexes.concat(this.schema.primKey).filter(function(t){return t.compound&&r.every(function(e){return 0<=t.keyPath.indexOf(e)})&&t.keyPath.every(function(e){return 0<=r.indexOf(e)})})[0];if(e&&this.db._maxKey!==Pt)return this.where(e.name).equals(e.keyPath.map(function(e){return o[e]}));!e&&f&&console.warn("The query ".concat(JSON.stringify(o)," on ").concat(this.name," would benefit of a ")+"compound index [".concat(r.join("+"),"]"));var a=this.schema.idxByName,n=this.db._deps.indexedDB;function s(e,t){try{return 0===n.cmp(e,t)}catch(e){return!1}}var t=r.reduce(function(e,t){var r=e[0],e=e[1],n=a[t],i=o[t];return[r||n,r||!n?Nt(e,n&&n.multi?function(e){e=c(e,t);return g(e)&&e.some(function(e){return s(i,e)})}:function(e){return s(i,c(e,t))}):e]},[null,null]),i=t[0],t=t[1];return i?this.where(i.name).equals(o[i.keyPath]).filter(t):e?this.filter(t):this.where(r).equals("")},n.prototype.filter=function(e){return this.toCollection().and(e)},n.prototype.count=function(e){return this.toCollection().count(e)},n.prototype.offset=function(e){return this.toCollection().offset(e)},n.prototype.limit=function(e){return this.toCollection().limit(e)},n.prototype.each=function(e){return this.toCollection().each(e)},n.prototype.toArray=function(e){return this.toCollection().toArray(e)},n.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},n.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,g(e)?"[".concat(e.join("+"),"]"):e))},n.prototype.reverse=function(){return this.toCollection().reverse()},n.prototype.mapToClass=function(n){for(var o=this.db,a=this.name,i=((this.schema.mappedClass=n).prototype instanceof Ft&&(n=function(e){var t=i,r=e;if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}function i(){return null!==e&&e.apply(this,arguments)||this}return T(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n),Object.defineProperty(i.prototype,"db",{get:function(){return o},enumerable:!1,configurable:!0}),i.prototype.table=function(){return a},i}(n)),new Set),e=n.prototype;e;e=F(e))Object.getOwnPropertyNames(e).forEach(function(e){return i.add(e)});function t(e){if(!e)return e;var t,r=Object.create(n.prototype);for(t in e)if(!i.has(t))try{r[t]=e[t]}catch(e){}return r}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),n},n.prototype.defineClass=function(){return this.mapToClass(function(e){s(this,e)})},n.prototype.add=function(t,r){var n=this,e=this.schema.primKey,i=e.auto,o=e.keyPath,a=t;return o&&i&&(a=$t(o)(t)),this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"add",keys:null!=r?[r]:null,values:[a]})}).then(function(e){return e.numFailures?m.reject(e.failures[0]):e.lastResult}).then(function(e){if(o)try{S(t,o,e)}catch(e){}return e})},n.prototype.update=function(t,r){if("object"!=typeof t||g(t))return this.where(":id").equals(t).modify(r);var e=c(t,this.schema.primKey.keyPath);if(void 0===e)return M(new O.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof r?w(r).forEach(function(e){S(t,e,r[e])}):r(t,{value:t,primKey:e})}catch(e){}return this.where(":id").equals(e).modify(r)},n.prototype.put=function(t,r){var n=this,e=this.schema.primKey,i=e.auto,o=e.keyPath,a=t;return o&&i&&(a=$t(o)(t)),this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"put",values:[a],keys:null!=r?[r]:null})}).then(function(e){return e.numFailures?m.reject(e.failures[0]):e.lastResult}).then(function(e){if(o)try{S(t,o,e)}catch(e){}return e})},n.prototype.delete=function(t){var r=this;return this._trans("readwrite",function(e){return r.core.mutate({trans:e,type:"delete",keys:[t]})}).then(function(e){return e.numFailures?m.reject(e.failures[0]):void 0})},n.prototype.clear=function(){var t=this;return this._trans("readwrite",function(e){return t.core.mutate({trans:e,type:"deleteRange",range:Tt})}).then(function(e){return e.numFailures?m.reject(e.failures[0]):void 0})},n.prototype.bulkGet=function(t){var r=this;return this._trans("readonly",function(e){return r.core.getMany({keys:t,trans:e}).then(function(e){return e.map(function(e){return r.hook.reading.fire(e)})})})},n.prototype.bulkAdd=function(n,e,t){var o=this,a=Array.isArray(e)?e:void 0,s=(t=t||(a?void 0:e))?t.allKeys:void 0;return this._trans("readwrite",function(e){var t=o.schema.primKey,r=t.auto,t=t.keyPath;if(t&&a)throw new O.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==n.length)throw new O.InvalidArgument("Arguments objects and keys must have the same length");var i=n.length,r=t&&r?n.map($t(t)):n;return o.core.mutate({trans:e,type:"add",keys:a,values:r,wantResults:s}).then(function(e){var t=e.numFailures,r=e.results,n=e.lastResult,e=e.failures;if(0===t)return s?r:n;throw new be("".concat(o.name,".bulkAdd(): ").concat(t," of ").concat(i," operations failed"),e)})})},n.prototype.bulkPut=function(n,e,t){var o=this,a=Array.isArray(e)?e:void 0,s=(t=t||(a?void 0:e))?t.allKeys:void 0;return this._trans("readwrite",function(e){var t=o.schema.primKey,r=t.auto,t=t.keyPath;if(t&&a)throw new O.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==n.length)throw new O.InvalidArgument("Arguments objects and keys must have the same length");var i=n.length,r=t&&r?n.map($t(t)):n;return o.core.mutate({trans:e,type:"put",keys:a,values:r,wantResults:s}).then(function(e){var t=e.numFailures,r=e.results,n=e.lastResult,e=e.failures;if(0===t)return s?r:n;throw new be("".concat(o.name,".bulkPut(): ").concat(t," of ").concat(i," operations failed"),e)})})},n.prototype.bulkDelete=function(t){var n=this,i=t.length;return this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"delete",keys:t})}).then(function(e){var t=e.numFailures,r=e.lastResult,e=e.failures;if(0===t)return r;throw new be("".concat(n.name,".bulkDelete(): ").concat(t," of ").concat(i," operations failed"),e)})};var Lt=n;function n(){}function Bt(i){function t(e,t){if(t){for(var r=arguments.length,n=new Array(r-1);--r;)n[r-1]=arguments[r];return a[e].subscribe.apply(null,n),i}if("string"==typeof e)return a[e]}var a={};t.addEventType=s;for(var e=1,r=arguments.length;e<r;++e)s(arguments[e]);return t;function s(e,r,n){var i,o;if("object"!=typeof e)return r=r||Ee,o={subscribers:[],fire:n=n||_,subscribe:function(e){-1===o.subscribers.indexOf(e)&&(o.subscribers.push(e),o.fire=r(o.fire,e))},unsubscribe:function(t){o.subscribers=o.subscribers.filter(function(e){return e!==t}),o.fire=o.subscribers.reduce(r,n)}},a[e]=t[e]=o;w(i=e).forEach(function(e){var t=i[e];if(g(t))s(e,i[e][0],i[e][1]);else{if("asap"!==t)throw new O.InvalidArgument("Invalid event config");var r=s(e,_e,function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];r.subscribers.forEach(function(e){G(function(){e.apply(null,t)})})})}})}}function qt(e,t){return U(t).from({prototype:e}),t}function Ut(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Wt(e,t){e.filter=Nt(e.filter,t)}function Vt(e,t,r){var n=e.replayFilter;e.replayFilter=n?function(){return Nt(n(),t())}:t,e.justLimit=r&&!n}function zt(e,t){if(e.isPrimKey)return t.primaryKey;var r=t.getIndexByKeyPath(e.index);if(r)return r;throw new O.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed")}function Kt(e,t,r){var n=zt(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:n,range:e.range}})}function Qt(e,o,t,r){var a,n,s=e.replayFilter?Nt(e.filter,e.replayFilter()):e.filter;return e.or?(a={},n=function(e,t,r){var n,i;s&&!s(t,r,function(e){return t.stop(e)},function(e){return t.fail(e)})||("[object ArrayBuffer]"===(i=""+(n=t.primaryKey))&&(i=""+new Uint8Array(n)),b(a,i))||(a[i]=!0,o(e,t,r))},Promise.all([e.or._iterate(n,t),Ht(Kt(e,r,t),e.algorithm,n,!e.keysOnly&&e.valueMapper)])):Ht(Kt(e,r,t),Nt(e.algorithm,s),o,!e.keysOnly&&e.valueMapper)}function Ht(e,n,i,o){var a=j(o?function(e,t,r){return i(o(e),t,r)}:i);return e.then(function(r){if(r)return r.start(function(){var t=function(){return r.continue()};n&&!n(r,function(e){return t=e},function(e){r.stop(e),t=_},function(e){r.fail(e),t=_})||a(r.value,r,function(e){return t=e}),t()})})}function I(e,t){try{var r=Gt(e),n=Gt(t);if(r!==n)return"Array"===r?1:"Array"===n?-1:"binary"===r?1:"binary"===n?-1:"string"===r?1:"string"===n?-1:"Date"===r?1:"Date"!==n?NaN:-1;switch(r){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":for(var i=Jt(e),o=Jt(t),a=i.length,s=o.length,u=a<s?a:s,c=0;c<u;++c)if(i[c]!==o[c])return i[c]<o[c]?-1:1;return a===s?0:a<s?-1:1;case"Array":for(var l=e,f=t,d=l.length,p=f.length,h=d<p?d:p,y=0;y<h;++y){var m=I(l[y],f[y]);if(0!==m)return m}return d===p?0:d<p?-1:1}}catch(e){}return NaN}function Gt(e){var t=typeof e;return"object"==t&&(ArrayBuffer.isView(e)||"ArrayBuffer"===(t=ne(e)))?"binary":t}function Jt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}i.prototype._read=function(e,t){var r=this._ctx;return r.error?r.table._trans(null,M.bind(null,r.error)):r.table._trans("readonly",e).then(t)},i.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,M.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},i.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Nt(t.algorithm,e)},i.prototype._iterate=function(e,t){return Qt(this._ctx,e,t,this._ctx.table.core)},i.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&s(r,e),t._ctx=r,t},i.prototype.raw=function(){return this._ctx.valueMapper=null,this},i.prototype.each=function(t){var r=this._ctx;return this._read(function(e){return Qt(r,t,e,r.table.core)})},i.prototype.count=function(e){var i=this;return this._read(function(e){var t,r=i._ctx,n=r.table.core;return Ut(r,!0)?n.count({trans:e,query:{index:zt(r,n.schema),range:r.range}}).then(function(e){return Math.min(e,r.limit)}):(t=0,Qt(r,function(){return++t,!1},e,n).then(function(){return t}))}).then(e)},i.prototype.sortBy=function(e,t){var r=e.split(".").reverse(),n=r[0],i=r.length-1;function o(e,t){return t?o(e[r[t]],t-1):e[n]}var a="next"===this._ctx.dir?1:-1;function s(e,t){e=o(e,i),t=o(t,i);return e<t?-a:t<e?a:0}return this.toArray(function(e){return e.sort(s)}).then(t)},i.prototype.toArray=function(e){var o=this;return this._read(function(e){var t,r,n,i=o._ctx;return"next"===i.dir&&Ut(i,!0)&&0<i.limit?(t=i.valueMapper,r=zt(i,i.table.core.schema),i.table.core.query({trans:e,limit:i.limit,values:!0,query:{index:r,range:i.range}}).then(function(e){e=e.result;return t?e.map(t):e})):(n=[],Qt(i,function(e){return n.push(e)},e,i.table.core).then(function(){return n}))},e)},i.prototype.offset=function(t){var e=this._ctx;return t<=0||(e.offset+=t,Ut(e)?Vt(e,function(){var r=t;return function(e,t){return 0===r||(1===r?--r:t(function(){e.advance(r),r=0}),!1)}}):Vt(e,function(){var e=t;return function(){return--e<0}})),this},i.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Vt(this._ctx,function(){var n=e;return function(e,t,r){return--n<=0&&t(r),0<=n}},!0),this},i.prototype.until=function(n,i){return Wt(this._ctx,function(e,t,r){return!n(e.value)||(t(r),i)}),this},i.prototype.first=function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},i.prototype.last=function(e){return this.reverse().first(e)},i.prototype.filter=function(t){var e;return Wt(this._ctx,function(e){return t(e.value)}),(e=this._ctx).isMatch=Nt(e.isMatch,t),this},i.prototype.and=function(e){return this.filter(e)},i.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},i.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},i.prototype.desc=function(){return this.reverse()},i.prototype.eachKey=function(r){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,t){r(t.key,t)})},i.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},i.prototype.eachPrimaryKey=function(r){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,t){r(t.primaryKey,t)})},i.prototype.keys=function(e){var t=this._ctx,r=(t.keysOnly=!t.isMatch,[]);return this.each(function(e,t){r.push(t.key)}).then(function(){return r}).then(e)},i.prototype.primaryKeys=function(e){var r=this._ctx;if("next"===r.dir&&Ut(r,!0)&&0<r.limit)return this._read(function(e){var t=zt(r,r.table.core.schema);return r.table.core.query({trans:e,values:!1,limit:r.limit,query:{index:t,range:r.range}})}).then(function(e){return e.result}).then(e);r.keysOnly=!r.isMatch;var n=[];return this.each(function(e,t){n.push(t.primaryKey)}).then(function(){return n}).then(e)},i.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},i.prototype.firstKey=function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},i.prototype.lastKey=function(e){return this.reverse().firstKey(e)},i.prototype.distinct=function(){var r,e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];return e&&e.multi&&(r={},Wt(this._ctx,function(e){var e=e.primaryKey.toString(),t=b(r,e);return r[e]=!0,!t})),this},i.prototype.modify=function(O){var r=this,_=this._ctx;return this._write(function(p){function h(e,t){var r=t.failures,t=t.numFailures;u+=e-t;for(var n=0,i=w(r);n<i.length;n++){var o=i[n];s.push(r[o])}}y="function"==typeof O?O:(o=w(O),a=o.length,function(e){for(var t=!1,r=0;r<a;++r){var n=o[r],i=O[n];c(e,n)!==i&&(S(e,n,i),t=!0)}return t});var o,a,y,m=_.table.core,e=m.schema.primaryKey,b=e.outbound,v=e.extractKey,g=r.db._options.modifyChunkSize||200,s=[],u=0,t=[];return r.clone().primaryKeys().then(function(f){function d(c){var l=Math.min(g,f.length-c);return m.getMany({trans:p,keys:f.slice(c,c+l),cache:"immutable"}).then(function(e){for(var r=[],t=[],n=b?[]:null,i=[],o=0;o<l;++o){var a=e[o],s={value:te(a),primKey:f[c+o]};!1!==y.call(s,s.value,s)&&(null==s.value?i.push(f[c+o]):b||0===I(v(a),v(s.value))?(t.push(s.value),b&&n.push(f[c+o])):(i.push(f[c+o]),r.push(s.value)))}var u=Ut(_)&&_.limit===1/0&&("function"!=typeof O||O===Xt)&&{index:_.index,range:_.range};return Promise.resolve(0<r.length&&m.mutate({trans:p,type:"add",values:r}).then(function(e){for(var t in e.failures)i.splice(parseInt(t),1);h(r.length,e)})).then(function(){return(0<t.length||u&&"object"==typeof O)&&m.mutate({trans:p,type:"put",keys:n,values:t,criteria:u,changeSpec:"function"!=typeof O&&O}).then(function(e){return h(t.length,e)})}).then(function(){return(0<i.length||u&&O===Xt)&&m.mutate({trans:p,type:"delete",keys:i,criteria:u}).then(function(e){return h(i.length,e)})}).then(function(){return f.length>c+l&&d(c+g)})})}return d(0).then(function(){if(0<s.length)throw new me("Error modifying one or more objects",s,u,t);return f.length})})})},i.prototype.delete=function(){var i=this._ctx,r=i.range;return Ut(i)&&(i.isPrimKey&&!kt||3===r.type)?this._write(function(e){var t=i.table.core.schema.primaryKey,n=r;return i.table.core.count({trans:e,query:{index:t,range:n}}).then(function(r){return i.table.core.mutate({trans:e,type:"deleteRange",range:n}).then(function(e){var t=e.failures,e=(e.lastResult,e.results,e.numFailures);if(e)throw new me("Could not delete some values",Object.keys(t).map(function(e){return t[e]}),r-e);return r-e})})}):this.modify(Xt)};var Yt=i;function i(){}var Xt=function(e,t){return t.value=null};function Zt(e,t){return e<t?-1:e===t?0:1}function er(e,t){return t<e?-1:e===t?0:1}function k(e,t,r){e=e instanceof ir?new e.Collection(e):e;return e._ctx.error=new(r||TypeError)(t),e}function tr(e){return new e.Collection(e,function(){return nr("")}).limit(0)}function rr(e,u,r,n){var i,c,l,f,d,p,h,y=r.length;if(!r.every(function(e){return"string"==typeof e}))return k(e,Et);function t(e){i="next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()},c="next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()},l="next"===e?Zt:er;var t=r.map(function(e){return{lower:c(e),upper:i(e)}}).sort(function(e,t){return l(e.lower,t.lower)});f=t.map(function(e){return e.upper}),d=t.map(function(e){return e.lower}),h="next"===(p=e)?"":n}t("next");var e=new e.Collection(e,function(){return C(f[0],d[y-1]+n)}),m=(e._ondirectionchange=function(e){t(e)},0);return e._addAlgorithm(function(e,t,r){var n=e.key;if("string"==typeof n){var i=c(n);if(u(i,d,m))return!0;for(var o=null,a=m;a<y;++a){var s=function(e,t,r,n,i,o){for(var a=Math.min(e.length,n.length),s=-1,u=0;u<a;++u){var c=t[u];if(c!==n[u])return i(e[u],r[u])<0?e.substr(0,u)+r[u]+r.substr(u+1):i(e[u],n[u])<0?e.substr(0,u)+n[u]+r.substr(u+1):0<=s?e.substr(0,s)+t[s]+r.substr(s+1):null;i(e[u],c)<0&&(s=u)}return a<n.length&&"next"===o?e+r.substr(e.length):a<e.length&&"prev"===o?e.substr(0,r.length):s<0?null:e.substr(0,s)+n[s]+r.substr(s+1)}(n,i,f[a],d[a],l,p);null===s&&null===o?m=a+1:(null===o||0<l(o,s))&&(o=s)}t(null!==o?function(){e.continue(o+h)}:r)}return!1}),e}function C(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function nr(e){return{type:1,lower:e,upper:e}}Object.defineProperty(p.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),p.prototype.between=function(e,t,r,n){r=!1!==r,n=!0===n;try{return 0<this._cmp(e,t)||0===this._cmp(e,t)&&(r||n)&&(!r||!n)?tr(this):new this.Collection(this,function(){return C(e,t,!r,!n)})}catch(e){return k(this,A)}},p.prototype.equals=function(e){return null==e?k(this,A):new this.Collection(this,function(){return nr(e)})},p.prototype.above=function(e){return null==e?k(this,A):new this.Collection(this,function(){return C(e,void 0,!0)})},p.prototype.aboveOrEqual=function(e){return null==e?k(this,A):new this.Collection(this,function(){return C(e,void 0,!1)})},p.prototype.below=function(e){return null==e?k(this,A):new this.Collection(this,function(){return C(void 0,e,!1,!0)})},p.prototype.belowOrEqual=function(e){return null==e?k(this,A):new this.Collection(this,function(){return C(void 0,e)})},p.prototype.startsWith=function(e){return"string"!=typeof e?k(this,Et):this.between(e,e+Pt,!0,!0)},p.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):rr(this,function(e,t){return 0===e.indexOf(t[0])},[e],Pt)},p.prototype.equalsIgnoreCase=function(e){return rr(this,function(e,t){return e===t[0]},[e],"")},p.prototype.anyOfIgnoreCase=function(){var e=r.apply(ae,arguments);return 0===e.length?tr(this):rr(this,function(e,t){return-1!==t.indexOf(e)},e,"")},p.prototype.startsWithAnyOfIgnoreCase=function(){var e=r.apply(ae,arguments);return 0===e.length?tr(this):rr(this,function(t,e){return e.some(function(e){return 0===t.indexOf(e)})},e,Pt)},p.prototype.anyOf=function(){var e,i,t=this,o=r.apply(ae,arguments),a=this._cmp;try{o.sort(a)}catch(e){return k(this,A)}return 0===o.length?tr(this):((e=new this.Collection(this,function(){return C(o[0],o[o.length-1])}))._ondirectionchange=function(e){a="next"===e?t._ascending:t._descending,o.sort(a)},i=0,e._addAlgorithm(function(e,t,r){for(var n=e.key;0<a(n,o[i]);)if(++i===o.length)return t(r),!1;return 0===a(n,o[i])||(t(function(){e.continue(o[i])}),!1)}),e)},p.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},p.prototype.noneOf=function(){var e=r.apply(ae,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return k(this,A)}var t=e.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},p.prototype.inAnyRange=function(e,t){var o=this,a=this._cmp,s=this._ascending,r=this._descending,u=this._min,c=this._max;if(0===e.length)return tr(this);if(!e.every(function(e){return void 0!==e[0]&&void 0!==e[1]&&s(e[0],e[1])<=0}))return k(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",O.InvalidArgument);var n=!t||!1!==t.includeLowers,i=t&&!0===t.includeUppers;var l,f=s;function d(e,t){return f(e[0],t[0])}try{(l=e.reduce(function(e,t){for(var r=0,n=e.length;r<n;++r){var i=e[r];if(a(t[0],i[1])<0&&0<a(t[1],i[0])){i[0]=u(i[0],t[0]),i[1]=c(i[1],t[1]);break}}return r===n&&e.push(t),e},[])).sort(d)}catch(e){return k(this,A)}var p=0,h=i?function(e){return 0<s(e,l[p][1])}:function(e){return 0<=s(e,l[p][1])},y=n?function(e){return 0<r(e,l[p][0])}:function(e){return 0<=r(e,l[p][0])};var m=h,t=new this.Collection(this,function(){return C(l[0][0],l[l.length-1][1],!n,!i)});return t._ondirectionchange=function(e){f="next"===e?(m=h,s):(m=y,r),l.sort(d)},t._addAlgorithm(function(e,t,r){for(var n,i=e.key;m(i);)if(++p===l.length)return t(r),!1;return!h(n=i)&&!y(n)||(0===o._cmp(i,l[p][1])||0===o._cmp(i,l[p][0])||t(function(){f===s?e.continue(l[p][0]):e.continue(l[p][1])}),!1)}),t},p.prototype.startsWithAnyOf=function(){var e=r.apply(ae,arguments);return e.every(function(e){return"string"==typeof e})?0===e.length?tr(this):this.inAnyRange(e.map(function(e){return[e,e+Pt]})):k(this,"startsWithAnyOf() only works with strings")};var ir=p;function p(){}function R(t){return j(function(e){return or(e),t(e.target.error),!1})}function or(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var ar="storagemutated",sr="x-storagemutated-1",ur=Bt(null,ar),cr=(h.prototype._lock=function(){return H(!x.global),++this._reculock,1!==this._reculock||x.global||(x.lockOwnerFor=this),this},h.prototype._unlock=function(){if(H(!x.global),0==--this._reculock)for(x.global||(x.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{gt(e[1],e[0])}catch(e){}}return this},h.prototype._locked=function(){return this._reculock&&x.lockOwnerFor!==this},h.prototype.create=function(t){var r=this;if(this.mode){var e=this.db.idbdb,n=this.db._state.dbOpenError;if(H(!this.idbtrans),!t&&!e)switch(n&&n.name){case"DatabaseClosedError":throw new O.DatabaseClosed(n);case"MissingAPIError":throw new O.MissingAPI(n.message,n);default:throw new O.OpenFailed(n)}if(!this.active)throw new O.TransactionInactive;H(null===this._completion._state),(t=this.idbtrans=t||(this.db.core||e).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=j(function(e){or(e),r._reject(t.error)}),t.onabort=j(function(e){or(e),r.active&&r._reject(new O.Abort(t.error)),r.active=!1,r.on("abort").fire(e)}),t.oncomplete=j(function(){r.active=!1,r._resolve(),"mutatedParts"in t&&ur.storagemutated.fire(t.mutatedParts)})}return this},h.prototype._promise=function(r,n,i){var e,o=this;return"readwrite"===r&&"readwrite"!==this.mode?M(new O.ReadOnly("Transaction is readonly")):this.active?this._locked()?new m(function(e,t){o._blockedFuncs.push([function(){o._promise(r,n,i).then(e,t)},x])}):i?P(function(){var e=new m(function(e,t){o._lock();var r=n(e,t,o);r&&r.then&&r.then(e,t)});return e.finally(function(){return o._unlock()}),e._lib=!0,e}):((e=new m(function(e,t){var r=n(e,t,o);r&&r.then&&r.then(e,t)}))._lib=!0,e):M(new O.TransactionInactive)},h.prototype._root=function(){return this.parent?this.parent._root():this},h.prototype.waitFor=function(e){var t,n=this._root(),i=m.resolve(e),o=(n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return i}):(n._waitingFor=i,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function e(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=e)}()),n._waitingFor);return new m(function(t,r){i.then(function(e){return n._waitingQueue.push(j(t.bind(null,e)))},function(e){return n._waitingQueue.push(j(r.bind(null,e)))}).finally(function(){n._waitingFor===o&&(n._waitingFor=null)})})},h.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new O.Abort))},h.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(b(t,e))return t[e];var r=this.schema[e];if(r)return(r=new this.db.Table(e,r,this)).core=this.db.core.table(e),t[e]=r;throw new O.NotFound("Table "+e+" not part of transaction")},h);function h(){}function lr(e,t,r,n,i,o,a){return{name:e,keyPath:t,unique:r,multi:n,auto:i,compound:o,src:(r&&!a?"&":"")+(n?"*":"")+(i?"++":"")+fr(t)}}function fr(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function dr(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:J(r,function(e){return[e.name,e]})}}var pr=function(e){try{return e.only([[]]),pr=function(){return[[]]},[[]]}catch(e){return pr=function(){return Pt},Pt}};function hr(t){return null==t?function(){}:"string"==typeof t?1===(r=t).split(".").length?function(e){return e[r]}:function(e){return c(e,r)}:function(e){return c(e,t)};var r}function yr(e){return[].slice.call(e)}var mr=0;function br(e){return null==e?":id":"string"==typeof e?e:"[".concat(e.join("+"),"]")}function vr(e,i,t){function _(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var t=e.lower,r=e.upper,n=e.lowerOpen,e=e.upperOpen;return void 0===t?void 0===r?null:i.upperBound(r,!!e):void 0===r?i.lowerBound(t,!!n):i.bound(t,r,!!n,!!e)}function r(e){var d,O=e.name;return{name:O,schema:e,mutate:function(e){var y=e.trans,m=e.type,b=e.keys,v=e.values,g=e.range;return new Promise(function(t,e){t=j(t);var r=y.objectStore(O),n=null==r.keyPath,i="put"===m||"add"===m;if(!i&&"delete"!==m&&"deleteRange"!==m)throw new Error("Invalid operation type: "+m);var o,a=(b||v||{length:1}).length;if(b&&v&&b.length!==v.length)throw new Error("Given keys array must have same length as given values array.");if(0===a)return t({numFailures:0,failures:{},results:[],lastResult:void 0});function s(e){++l,or(e)}var u=[],c=[],l=0;if("deleteRange"===m){if(4===g.type)return t({numFailures:l,failures:c,results:[],lastResult:void 0});3===g.type?u.push(o=r.clear()):u.push(o=r.delete(_(g)))}else{var n=i?n?[v,b]:[v,null]:[b,null],f=n[0],d=n[1];if(i)for(var p=0;p<a;++p)u.push(o=d&&void 0!==d[p]?r[m](f[p],d[p]):r[m](f[p])),o.onerror=s;else for(p=0;p<a;++p)u.push(o=r[m](f[p])),o.onerror=s}function h(e){e=e.target.result,u.forEach(function(e,t){return null!=e.error&&(c[t]=e.error)}),t({numFailures:l,failures:c,results:"delete"===m?b:u.map(function(e){return e.result}),lastResult:e})}o.onerror=function(e){s(e),h(e)},o.onsuccess=h})},getMany:function(e){var f=e.trans,d=e.keys;return new Promise(function(t,e){t=j(t);for(var r,n=f.objectStore(O),i=d.length,o=new Array(i),a=0,s=0,u=function(e){e=e.target;o[e._pos]=e.result,++s===a&&t(o)},c=R(e),l=0;l<i;++l)null!=d[l]&&((r=n.get(d[l]))._pos=l,r.onsuccess=u,r.onerror=c,++a);0===a&&t(o)})},get:function(e){var n=e.trans,i=e.key;return new Promise(function(t,e){t=j(t);var r=n.objectStore(O).get(i);r.onsuccess=function(e){return t(e.target.result)},r.onerror=R(e)})},query:(d=a,function(f){return new Promise(function(r,e){r=j(r);var n,i,o,t=f.trans,a=f.values,s=f.limit,u=f.query,c=s===1/0?void 0:s,l=u.index,u=u.range,t=t.objectStore(O),t=l.isPrimaryKey?t:t.index(l.name),l=_(u);if(0===s)return r({result:[]});d?((u=a?t.getAll(l,c):t.getAllKeys(l,c)).onsuccess=function(e){return r({result:e.target.result})},u.onerror=R(e)):(n=0,i=!a&&"openKeyCursor"in t?t.openKeyCursor(l):t.openCursor(l),o=[],i.onsuccess=function(e){var t=i.result;return!t||(o.push(a?t.value:t.primaryKey),++n===s)?r({result:o}):void t.continue()},i.onerror=R(e))})}),openCursor:function(e){var c=e.trans,o=e.values,a=e.query,s=e.reverse,l=e.unique;return new Promise(function(t,r){t=j(t);var e=a.index,n=a.range,i=c.objectStore(O),i=e.isPrimaryKey?i:i.index(e.name),e=s?l?"prevunique":"prev":l?"nextunique":"next",u=!o&&"openKeyCursor"in i?i.openKeyCursor(_(n),e):i.openCursor(_(n),e);u.onerror=R(r),u.onsuccess=j(function(e){var n,i,o,a,s=u.result;s?(s.___id=++mr,s.done=!1,n=s.continue.bind(s),i=(i=s.continuePrimaryKey)&&i.bind(s),o=s.advance.bind(s),a=function(){throw new Error("Cursor not stopped")},s.trans=c,s.stop=s.continue=s.continuePrimaryKey=s.advance=function(){throw new Error("Cursor not started")},s.fail=j(r),s.next=function(){var e=this,t=1;return this.start(function(){return t--?e.continue():e.stop()}).then(function(){return e})},s.start=function(e){function t(){if(u.result)try{e()}catch(e){s.fail(e)}else s.done=!0,s.start=function(){throw new Error("Cursor behind last entry")},s.stop()}var r=new Promise(function(t,e){t=j(t),u.onerror=R(e),s.fail=e,s.stop=function(e){s.stop=s.continue=s.continuePrimaryKey=s.advance=a,t(e)}});return u.onsuccess=j(function(e){u.onsuccess=t,t()}),s.continue=n,s.continuePrimaryKey=i,s.advance=o,t(),r},t(s)):t(null)},r)})},count:function(e){var t=e.query,i=e.trans,o=t.index,a=t.range;return new Promise(function(t,e){var r=i.objectStore(O),r=o.isPrimaryKey?r:r.index(o.name),n=_(a),n=n?r.count(n):r.count();n.onsuccess=j(function(e){return t(e.target.result)}),n.onerror=R(e)})}}}n=t,o=yr((t=e).objectStoreNames);var n,t={schema:{name:t.name,tables:o.map(function(e){return n.objectStore(e)}).map(function(t){var e=t.keyPath,r=t.autoIncrement,n=g(e),i={},n={name:t.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==e,compound:n,keyPath:e,autoIncrement:r,unique:!0,extractKey:hr(e)},indexes:yr(t.indexNames).map(function(e){return t.index(e)}).map(function(e){var t=e.name,r=e.unique,n=e.multiEntry,e=e.keyPath,t={name:t,compound:g(e),keyPath:e,unique:r,multiEntry:n,extractKey:hr(e)};return i[br(e)]=t}),getIndexByKeyPath:function(e){return i[br(e)]}};return i[":id"]=n.primaryKey,null!=e&&(i[br(e)]=n.primaryKey),n})},hasGetAll:0<o.length&&"getAll"in n.objectStore(o[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},o=t.schema,a=t.hasGetAll,t=o.tables.map(r),s={};return t.forEach(function(e){return s[e.name]=e}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(s[e])return s[e];throw new Error("Table '".concat(e,"' not found"))},MIN_KEY:-1/0,MAX_KEY:pr(i),schema:o}}function gr(e,t,r,n){var i=r.IDBKeyRange;return r.indexedDB,r=vr(t,i,n),{dbcore:e.dbcore.reduce(function(e,t){t=t.create;return v(v({},e),t(e))},r)}}function Or(e,t){var r=e._novip,e=t.db,e=gr(r._middlewares,e,r._deps,t);r.core=e.dbcore,r.tables.forEach(function(e){var t=e.name;r.core.schema.tables.some(function(e){return e.name===t})&&(e.core=r.core.table(t),r[t]instanceof r.Table)&&(r[t].core=e.core)})}function _r(e,t,r,i){var o=e._novip;r.forEach(function(r){var n=i[r];t.forEach(function(e){var t=V(e,r);(!t||"value"in t&&void 0===t.value)&&(e===o.Transaction.prototype||e instanceof o.Transaction?u(e,r,{get:function(){return this.table(r)},set:function(e){q(this,r,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):e[r]=new o.Table(r,n))})})}function wr(e,t){var r=e._novip;t.forEach(function(e){for(var t in e)e[t]instanceof r.Table&&delete e[t]})}function Sr(e,t){return e._cfg.version-t._cfg.version}function xr(r,n,i,e){var o=r._dbSchema,a=r._createTransaction("readwrite",r._storeNames,o),s=(a.create(i),a._completion.catch(e),a._reject.bind(a)),h=x.transless||x;P(function(){var e,u,c,l,f,t,d,p;x.trans=a,x.transless=h,(0===n?(w(o).forEach(function(e){Pr(i,e,o[e].primKey,o[e].indexes)}),Or(r,i),m.follow(function(){return r.on.populate.fire(a)})):(u=n,c=a,l=i,f=(e=r)._novip,t=[],e=f._versions,d=f._dbSchema=Mr(0,f.idbdb,l),p=!1,e.filter(function(e){return e._cfg.version>=u}).forEach(function(s){t.push(function(){var t,r,n,i=d,e=s._cfg.dbschema,o=(Ar(f,i,l),Ar(f,e,l),d=f._dbSchema=e,jr(i,e)),a=(o.add.forEach(function(e){Pr(l,e[0],e[1].primKey,e[1].indexes)}),o.change.forEach(function(e){if(e.recreate)throw new O.Upgrade("Not yet support for changing primary key");var t=l.objectStore(e.name);e.add.forEach(function(e){return Er(t,e)}),e.change.forEach(function(e){t.deleteIndex(e.name),Er(t,e)}),e.del.forEach(function(e){return t.deleteIndex(e)})}),s._cfg.contentUpgrade);if(a&&s._cfg.version>u)return Or(f,l),c._memoizedTables={},p=!0,t=Y(e),o.del.forEach(function(e){t[e]=i[e]}),wr(f,[f.Transaction.prototype]),_r(f,[f.Transaction.prototype],w(t),t),c.schema=t,(r=se(a))&&yt(),e=m.follow(function(){var e;(n=a(c))&&r&&(e=E.bind(null,null),n.then(e,e))}),n&&"function"==typeof n.then?m.resolve(n):e.then(function(){return n})}),t.push(function(e){var t,r,n;p&&It||(t=s._cfg.dbschema,r=t,n=e,[].slice.call(n.db.objectStoreNames).forEach(function(e){return null==r[e]&&n.db.deleteObjectStore(e)})),wr(f,[f.Transaction.prototype]),_r(f,[f.Transaction.prototype],f._storeNames,f._dbSchema),c.schema=f._dbSchema})}),function e(){return t.length?m.resolve(t.shift()(c.idbtrans)).then(e):m.resolve()}().then(function(){var t,r;r=l,w(t=d).forEach(function(e){r.db.objectStoreNames.contains(e)||Pr(r,e,t[e].primKey,t[e].indexes)})}))).catch(s)})}function jr(e,t){var r,n={del:[],add:[],change:[]};for(r in e)t[r]||n.del.push(r);for(r in t){var i=e[r],o=t[r];if(i){var a={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!At)a.recreate=!0,n.change.push(a);else{var s=i.idxByName,u=o.idxByName,c=void 0;for(c in s)u[c]||a.del.push(c);for(c in u){var l=s[c],f=u[c];l?l.src!==f.src&&a.change.push(f):a.add.push(f)}(0<a.del.length||0<a.add.length||0<a.change.length)&&n.change.push(a)}}else n.add.push([r,o])}return n}function Pr(e,t,r,n){var i=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});n.forEach(function(e){return Er(i,e)})}function Er(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Mr(e,t,s){var u={};return K(t.objectStoreNames,0).forEach(function(e){for(var t=s.objectStore(e),r=lr(fr(a=t.keyPath),a||"",!1,!1,!!t.autoIncrement,a&&"string"!=typeof a,!0),n=[],i=0;i<t.indexNames.length;++i){var o=t.index(t.indexNames[i]),a=o.keyPath,o=lr(o.name,a,!!o.unique,!!o.multiEntry,!1,a&&"string"!=typeof a,!1);n.push(o)}u[e]=dr(e,r,n)}),u}function Ar(e,t,r){for(var n=e._novip,i=r.db.objectStoreNames,o=0;o<i.length;++o){var a=i[o],s=r.objectStore(a);n._hasGetAll="getAll"in s;for(var u=0;u<s.indexNames.length;++u){var c,l=s.indexNames[u],f=s.index(l).keyPath,f="string"==typeof f?f:"["+K(f).join("+")+"]";t[a]&&(c=t[a].idxByName[f])&&(c.name=l,delete t[a].idxByName[f],t[a].idxByName[l]=c)}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&d.WorkerGlobalScope&&d instanceof d.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}kr.prototype._parseStoresSpec=function(n,i){w(n).forEach(function(e){if(null!==n[e]){var t=n[e].split(",").map(function(e,t){var r=(e=e.trim()).replace(/([&*]|\+\+)/g,""),n=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return lr(r,n||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),g(n),0===t)}),r=t.shift();if(r.multi)throw new O.Schema("Primary key cannot be multi-valued");t.forEach(function(e){if(e.auto)throw new O.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new O.Schema("Index must have a name and cannot be an empty string")}),i[e]=dr(e,r,t)}})},kr.prototype.stores=function(e){var t=this.db,e=(this._cfg.storesSource=this._cfg.storesSource?s(this._cfg.storesSource,e):e,t._versions),r={},n={};return e.forEach(function(e){s(r,e._cfg.storesSource),n=e._cfg.dbschema={},e._parseStoresSpec(r,n)}),t._dbSchema=n,wr(t,[t._allTables,t,t.Transaction.prototype]),_r(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],w(n),n),t._storeNames=w(n),this},kr.prototype.upgrade=function(e){return this._cfg.contentUpgrade=Me(this._cfg.contentUpgrade||_,e),this};var Ir=kr;function kr(){}function Cr(e,t){var r=e._dbNamesDB;return r||(r=e._dbNamesDB=new Yr(Ct,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),r.table("dbnames")}function Rr(e){return e&&"function"==typeof e.databases}function Dr(e){return P(function(){return x.letThrough=!0,e()})}function Nr(d){var p=d._state,n=d._deps.indexedDB;if(p.isBeingOpened||d.idbdb)return p.dbReadyPromise.then(function(){return p.dbOpenError?M(p.dbOpenError):d});f&&(p.openCanceller._stackHolder=fe()),p.isBeingOpened=!0,p.dbOpenError=null,p.openComplete=!1;var t=p.openCanceller;function e(){if(p.openCanceller!==t)throw new O.DatabaseClosed("db.open() was cancelled")}var r,i=p.dbReadyResolve,h=null,y=!1;return m.race([t,("undefined"==typeof navigator?m.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){function t(){return indexedDB.databases().finally(e)}r=setInterval(t,100),t()}).finally(function(){return clearInterval(r)}):Promise.resolve()).then(function(){return new m(function(c,r){if(e(),!n)throw new O.MissingAPI;var l=d.name,f=p.autoSchema?n.open(l):n.open(l,Math.round(10*d.verno));if(!f)throw new O.MissingAPI;f.onerror=R(r),f.onblocked=j(d._fireOnBlocked),f.onupgradeneeded=j(function(e){var t;h=f.transaction,p.autoSchema&&!d._options.allowEmptyDB?(f.onerror=or,h.abort(),f.result.close(),(t=n.deleteDatabase(l)).onsuccess=t.onerror=j(function(){r(new O.NoSuchDatabase("Database ".concat(l," doesnt exist")))})):(h.onerror=R(r),t=e.oldVersion>Math.pow(2,62)?0:e.oldVersion,y=t<1,d._novip.idbdb=f.result,xr(d,t/10,h,r))},r),f.onsuccess=j(function(){h=null;var e,t,r,n,i,o,a=d._novip.idbdb=f.result,s=K(a.objectStoreNames);if(0<s.length)try{var u=a.transaction(1===(i=s).length?i[0]:i,"readonly");p.autoSchema?(o=a,n=u,(r=(r=d)._novip).verno=o.version/10,n=r._dbSchema=Mr(0,o,n),r._storeNames=K(o.objectStoreNames,0),_r(r,[r._allTables],w(n),n)):(Ar(d,d._dbSchema,u),t=u,((t=jr(Mr(0,(e=d).idbdb,t),e._dbSchema)).add.length||t.change.some(function(e){return e.add.length||e.change.length}))&&console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Or(d,u)}catch(e){}Mt.push(d),a.onversionchange=j(function(e){p.vcFired=!0,d.on("versionchange").fire(e)}),a.onclose=j(function(e){d.on("close").fire(e)}),y&&(s=d._deps,i=l,o=s.indexedDB,s=s.IDBKeyRange,Rr(o)||i===Ct||Cr(o,s).put({name:i}).catch(_)),c()},r)})})]).then(function(){return e(),p.onReadyBeingFired=[],m.resolve(Dr(function(){return d.on.ready.fire(d.vip)})).then(function e(){var t;if(0<p.onReadyBeingFired.length)return t=p.onReadyBeingFired.reduce(Me,_),p.onReadyBeingFired=[],m.resolve(Dr(function(){return t(d.vip)})).then(e)})}).finally(function(){p.onReadyBeingFired=null,p.isBeingOpened=!1}).then(function(){return d}).catch(function(e){p.dbOpenError=e;try{h&&h.abort()}catch(e){}return t===p.openCanceller&&d._close(),M(e)}).finally(function(){p.openComplete=!0,i()})}function Tr(t){function e(e){return t.next(e)}var n=r(e),i=r(function(e){return t.throw(e)});function r(r){return function(e){var e=r(e),t=e.value;return e.done?t:t&&"function"==typeof t.then?t.then(n,i):g(t)?Promise.all(t).then(n,i):n(t)}}return r(e)()}function $r(e,t,r){for(var n=g(e)?e.slice():[e],i=0;i<r;++i)n.push(t);return n}var Fr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(f){return v(v({},f),{table:function(e){var a=f.table(e),e=a.schema,s={},u=[];function c(e,t,r){var n=br(e),n=s[n]=s[n]||[],i=null==e?0:"string"==typeof e?1:e.length,o=0<t,o=v(v({},r),{isVirtual:o,keyTail:t,keyLength:i,extractKey:hr(e),unique:!o&&r.unique});return n.push(o),o.isPrimaryKey||u.push(o),1<i&&c(2===i?e[0]:e.slice(0,i-1),t+1,r),n.sort(function(e,t){return e.keyTail-t.keyTail}),o}var t=c(e.primaryKey.keyPath,0,e.primaryKey);s[":id"]=[t];for(var r=0,n=e.indexes;r<n.length;r++){var i=n[r];c(i.keyPath,0,i)}function l(e){var t,r=e.query.index;return r.isVirtual?v(v({},e),{query:{index:r,range:(t=e.query.range,r=r.keyTail,{type:1===t.type?2:t.type,lower:$r(t.lower,t.lowerOpen?f.MAX_KEY:f.MIN_KEY,r),lowerOpen:!0,upper:$r(t.upper,t.upperOpen?f.MIN_KEY:f.MAX_KEY,r),upperOpen:!0})}}):e}return v(v({},a),{schema:v(v({},e),{primaryKey:t,indexes:u,getIndexByKeyPath:function(e){return(e=s[br(e)])&&e[0]}}),count:function(e){return a.count(l(e))},query:function(e){return a.query(l(e))},openCursor:function(t){var e=t.query.index,n=e.keyTail,r=e.isVirtual,i=e.keyLength;return r?a.openCursor(l(t)).then(function(e){return e&&o(e)}):a.openCursor(t);function o(r){return Object.create(r,{continue:{value:function(e){null!=e?r.continue($r(e,t.reverse?f.MAX_KEY:f.MIN_KEY,n)):t.unique?r.continue(r.key.slice(0,i).concat(t.reverse?f.MIN_KEY:f.MAX_KEY,n)):r.continue()}},continuePrimaryKey:{value:function(e,t){r.continuePrimaryKey($r(e,f.MAX_KEY,n),t)}},primaryKey:{get:function(){return r.primaryKey}},key:{get:function(){var e=r.key;return 1===i?e[0]:e.slice(0,i)}},value:{get:function(){return r.value}}})}}})}})}};function Lr(i,o,a,s){return a=a||{},s=s||"",w(i).forEach(function(e){var t,r,n;b(o,e)?(t=i[e],r=o[e],"object"==typeof t&&"object"==typeof r&&t&&r?(n=ne(t))!==ne(r)?a[s+e]=o[e]:"Object"===n?Lr(t,r,a,s+e+"."):t!==r&&(a[s+e]=o[e]):t!==r&&(a[s+e]=o[e])):a[s+e]=void 0}),w(o).forEach(function(e){b(i,e)||(a[s+e]=o[e])}),a}var Br={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return v(v({},e),{table:function(n){var y=e.table(n),m=y.schema.primaryKey;return v(v({},y),{mutate:function(e){var t=x.trans,r=t.table(n).hook,d=r.deleting,p=r.creating,h=r.updating;switch(e.type){case"add":if(p.fire===_)break;return t._promise("readwrite",function(){return a(e)},!0);case"put":if(p.fire===_&&h.fire===_)break;return t._promise("readwrite",function(){return a(e)},!0);case"delete":if(d.fire===_)break;return t._promise("readwrite",function(){return a(e)},!0);case"deleteRange":if(d.fire===_)break;return t._promise("readwrite",function(){return function r(n,i,o){return y.query({trans:n,values:!1,query:{index:m,range:i},limit:o}).then(function(e){var t=e.result;return a({type:"delete",keys:t,trans:n}).then(function(e){return 0<e.numFailures?Promise.reject(e.failures[0]):t.length<o?{failures:[],numFailures:0,lastResult:void 0}:r(n,v(v({},i),{lower:t[t.length-1],lowerOpen:!0}),o)})})}(e.trans,e.range,1e4)},!0)}return y.mutate(e);function a(c){var e,t,r,l=x.trans,f=c.keys||(r=m,"delete"===(e=c).type?e.keys:e.keys||e.values.map(r.extractKey));if(f)return"delete"!==(c="add"===c.type||"put"===c.type?v(v({},c),{keys:f}):v({},c)).type&&(c.values=$([],c.values,!0)),c.keys&&(c.keys=$([],c.keys,!0)),e=y,r=f,("add"===(t=c).type?Promise.resolve([]):e.getMany({trans:t.trans,keys:r,cache:"immutable"})).then(function(s){var u=f.map(function(e,t){var r,n,i,o=s[t],a={onerror:null,onsuccess:null};return"delete"===c.type?d.fire.call(a,e,o,l):"add"===c.type||void 0===o?(r=p.fire.call(a,e,c.values[t],l),null==e&&null!=r&&(c.keys[t]=e=r,m.outbound||S(c.values[t],m.keyPath,e))):(r=Lr(o,c.values[t]),(n=h.fire.call(a,r,e,o,l))&&(i=c.values[t],Object.keys(n).forEach(function(e){b(i,e)?i[e]=n[e]:S(i,e,n[e])}))),a});return y.mutate(c).then(function(e){for(var t=e.failures,r=e.results,n=e.numFailures,e=e.lastResult,i=0;i<f.length;++i){var o=(r||f)[i],a=u[i];null==o?a.onerror&&a.onerror(t[i]):a.onsuccess&&a.onsuccess("put"===c.type&&s[i]?c.values[i]:o)}return{failures:t,results:r,numFailures:n,lastResult:e}}).catch(function(t){return u.forEach(function(e){return e.onerror&&e.onerror(t)}),Promise.reject(t)})});throw new Error("Keys missing")}}})}})}};function qr(e,t,r){try{if(!t)return null;if(t.keys.length<e.length)return null;for(var n=[],i=0,o=0;i<t.keys.length&&o<e.length;++i)0===I(t.keys[i],e[o])&&(n.push(r?te(t.values[i]):t.values[i]),++o);return n.length===e.length?n:null}catch(e){return null}}var Ur={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var r=t.table(e);return v(v({},r),{getMany:function(t){var e;return t.cache?(e=qr(t.keys,t.trans._cache,"clone"===t.cache))?m.resolve(e):r.getMany(t).then(function(e){return t.trans._cache={keys:t.keys,values:"clone"===t.cache?te(e):e},e}):r.getMany(t)},mutate:function(e){return"add"!==e.type&&(e.trans._cache=null),r.mutate(e)}})}}}};function Wr(e){return!("from"in e)}var D=function(e,t){var r;if(!this)return r=new D,e&&"d"in e&&s(r,e),r;s(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Vr(e,t,r){var n=I(t,r);if(!isNaN(n)){if(0<n)throw RangeError();if(Wr(e))return s(e,{from:t,to:r,d:1});var n=e.l,i=e.r;if(I(r,e.from)<0)return n?Vr(n,t,r):e.l={from:t,to:r,d:1,l:null,r:null},Hr(e);if(0<I(t,e.to))return i?Vr(i,t,r):e.r={from:t,to:r,d:1,l:null,r:null},Hr(e);I(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),0<I(r,e.to)&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1);t=!e.r;n&&!e.l&&zr(e,n),i&&t&&zr(e,i)}}function zr(e,t){Wr(t)||!function e(t,r){var n=r.from,i=r.to,o=r.l,r=r.r;Vr(t,n,i),o&&e(t,o),r&&e(t,r)}(e,t)}function Kr(e,t){var r=Qr(t),n=r.next();if(!n.done)for(var i=n.value,o=Qr(e),a=o.next(i.from),s=a.value;!n.done&&!a.done;){if(I(s.from,i.to)<=0&&0<=I(s.to,i.from))return!0;I(i.from,s.from)<0?i=(n=r.next(s.from)).value:s=(a=o.next(i.from)).value}return!1}function Qr(e){var r=Wr(e)?null:{s:0,n:e};return{next:function(e){for(var t=0<arguments.length;r;)switch(r.s){case 0:if(r.s=1,t)for(;r.n.l&&I(e,r.n.from)<0;)r={up:r,n:r.n.l,s:1};else for(;r.n.l;)r={up:r,n:r.n.l,s:1};case 1:if(r.s=2,!t||I(e,r.n.to)<=0)return{value:r.n,done:!1};case 2:if(r.n.r){r.s=3,r={up:r,n:r.n.r,s:0};continue}case 3:r=r.up}return{done:!0}}}}function Hr(e){var t,r,n,i=((null==(i=e.r)?void 0:i.d)||0)-((null==(i=e.l)?void 0:i.d)||0),i=1<i?"r":i<-1?"l":"";i&&(t="r"==i?"l":"r",r=v({},e),n=e[i],e.from=n.from,e.to=n.to,e[i]=n[i],r[i]=n[t],(e[t]=r).d=Gr(r)),e.d=Gr(e)}function Gr(e){var t=e.r,e=e.l;return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}B(D.prototype,((Zr={add:function(e){return zr(this,e),this},addKey:function(e){return Vr(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(e){return Vr(t,e,e)}),this}})[ie]=function(){return Qr(this)},Zr));var Jr={stack:"dbcore",level:0,create:function(n){var m=n.schema.name,b=new D(n.MIN_KEY,n.MAX_KEY);return v(v({},n),{table:function(p){function e(e){var t=(e=e.query).index,e=e.range;return[t,new D(null!=(t=e.lower)?t:n.MIN_KEY,null!=(t=e.upper)?t:n.MAX_KEY)]}var h=n.table(p),y=h.schema,t=y.primaryKey,c=t.extractKey,l=t.outbound,r=v(v({},h),{mutate:function(e){function r(e){return e="idb://".concat(m,"/").concat(p,"/").concat(e),n[e]||(n[e]=new D)}var t=e.trans,n=t.mutatedParts||(t.mutatedParts={}),i=r(""),u=r(":dels"),c=e.type,t="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[],l=t[0],f=t[1],d=e.trans._cache;return h.mutate(e).then(function(e){var t,o,a,s;return g(l)?("delete"!==c&&(l=e.results),i.addKeys(l),(t=qr(l,d))||"add"===c||u.addKeys(l),(t||f)&&(o=r,a=t,s=f,y.indexes.forEach(function(t){var r=o(t.name||"");function n(e){return null!=e?t.extractKey(e):null}function i(e){t.multiEntry&&g(e)?e.forEach(function(e){return r.addKey(e)}):r.addKey(e)}(a||s).forEach(function(e,t){var r=a&&n(a[t]),t=s&&n(s[t]);0!==I(r,t)&&(null!=r&&i(r),null!=t)&&i(t)})}))):l?(t={from:l.lower,to:l.upper},u.add(t),i.add(t)):(i.add(b),u.add(b),y.indexes.forEach(function(e){return r(e.name).add(b)})),e})}}),f={get:function(e){return[t,new D(e.key)]},getMany:function(e){return[t,(new D).addKeys(e.keys)]},count:e,query:e,openCursor:e};return w(f).forEach(function(u){r[u]=function(i){var t=x.subscr;if(t){var o,e=function(e){e="idb://".concat(m,"/").concat(p,"/").concat(e);return t[e]||(t[e]=new D)},a=e(""),s=e(":dels"),r=f[u](i),n=r[0],r=r[1];if(e(n.name||"").add(r),!n.isPrimaryKey){if("count"!==u)return o="query"===u&&l&&i.values&&h.query(v(v({},i),{values:!1})),h[u].apply(this,arguments).then(function(t){if("query"===u){if(l&&i.values)return o.then(function(e){e=e.result;return a.addKeys(e),t});var e=i.values?t.result.map(c):t.result;(i.values?a:s).addKeys(e)}else{var r,n;if("openCursor"===u)return n=i.values,(r=t)&&Object.create(r,{key:{get:function(){return s.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return s.addKey(e),e}},value:{get:function(){return n&&a.addKey(r.primaryKey),r.value}}})}return t});s.add(b)}}return h[u].apply(this,arguments)}}),r}})}};y.prototype.version=function(t){if(isNaN(t)||t<.1)throw new O.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new O.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,r=e.filter(function(e){return e._cfg.version===t})[0];return r||(r=new this.Version(t),e.push(r),e.sort(Sr),r.stores({}),this._state.autoSchema=!1),r},y.prototype._whenReady=function(e){var r=this;return this.idbdb&&(this._state.openComplete||x.letThrough||this._vip)?e():new m(function(e,t){if(r._state.openComplete)return t(new O.DatabaseClosed(r._state.dbOpenError));if(!r._state.isBeingOpened){if(!r._options.autoOpen)return void t(new O.DatabaseClosed);r.open().catch(_)}r._state.dbReadyPromise.then(e,t)}).then(e)},y.prototype.use=function(e){var t=e.stack,r=e.create,n=e.level,e=e.name,i=(e&&this.unuse({stack:t,name:e}),this._middlewares[t]||(this._middlewares[t]=[]));return i.push({stack:t,create:r,level:null==n?10:n,name:e}),i.sort(function(e,t){return e.level-t.level}),this},y.prototype.unuse=function(e){var t=e.stack,r=e.name,n=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(e){return n?e.create!==n:!!r&&e.name!==r})),this},y.prototype.open=function(){return Nr(this)},y.prototype._close=function(){var r=this._state,e=Mt.indexOf(this);if(0<=e&&Mt.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}r.dbReadyPromise=new m(function(e){r.dbReadyResolve=e}),r.openCanceller=new m(function(e,t){r.cancelOpen=t})},y.prototype.close=function(){this._close();var e=this._state;this._options.autoOpen=!1,e.dbOpenError=new O.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)},y.prototype.delete=function(){var i=this,r=0<arguments.length,o=this._state;return new m(function(n,t){function e(){i.close();var e=i._deps.indexedDB.deleteDatabase(i.name);e.onsuccess=j(function(){var e,t,r;e=i._deps,t=i.name,r=e.indexedDB,e=e.IDBKeyRange,Rr(r)||t===Ct||Cr(r,e).delete(t).catch(_),n()}),e.onerror=R(t),e.onblocked=i._fireOnBlocked}if(r)throw new O.InvalidArgument("Arguments not allowed in db.delete()");o.isBeingOpened?o.dbReadyPromise.then(e):e()})},y.prototype.backendDB=function(){return this.idbdb},y.prototype.isOpen=function(){return null!==this.idbdb},y.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},y.prototype.hasFailed=function(){return null!==this._state.dbOpenError},y.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(y.prototype,"tables",{get:function(){var t=this;return w(this._allTables).map(function(e){return t._allTables[e]})},enumerable:!1,configurable:!0}),y.prototype.transaction=function(){var e=function(e,t,r){var n=arguments.length;if(n<2)throw new O.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];return r=i.pop(),[e,Z(i),r]}.apply(this,arguments);return this._transaction.apply(this,e)},y.prototype._transaction=function(e,t,r){var n,i,o=this,a=x.trans,s=(a&&a.db===this&&-1===e.indexOf("!")||(a=null),-1!==e.indexOf("?"));e=e.replace("!","").replace("?","");try{if(i=t.map(function(e){e=e instanceof o.Table?e.name:e;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e}),"r"==e||e===Rt)n=Rt;else{if("rw"!=e&&e!=Dt)throw new O.InvalidArgument("Invalid transaction mode: "+e);n=Dt}if(a){if(a.mode===Rt&&n===Dt){if(!s)throw new O.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a=null}a&&i.forEach(function(e){if(a&&-1===a.storeNames.indexOf(e)){if(!s)throw new O.SubTransaction("Table "+e+" not included in parent transaction.");a=null}}),s&&a&&!a.active&&(a=null)}}catch(r){return a?a._promise(null,function(e,t){t(r)}):M(r)}var u=function i(o,a,s,u,c){return m.resolve().then(function(){var e=x.transless||x,t=o._createTransaction(a,s,o._dbSchema,u),e={trans:t,transless:e};if(u)t.idbtrans=u.idbtrans;else try{t.create(),o._state.PR1398_maxLoop=3}catch(e){return e.name===ve.InvalidState&&o.isOpen()&&0<--o._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),o._close(),o.open().then(function(){return i(o,a,s,null,c)})):M(e)}var r,n=se(c),e=(n&&yt(),m.follow(function(){var e;(r=c.call(t,t))&&(n?(e=E.bind(null,null),r.then(e,e)):"function"==typeof r.next&&"function"==typeof r.throw&&(r=Tr(r)))},e));return(r&&"function"==typeof r.then?m.resolve(r).then(function(e){return t.active?e:M(new O.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):e.then(function(){return r})).then(function(e){return u&&t._resolve(),t._completion.then(function(){return e})}).catch(function(e){return t._reject(e),M(e)})})}.bind(null,this,n,i,a,r);return a?a._promise(n,u,"lock"):x.trans?gt(x.transless,function(){return o._whenReady(u)}):this._whenReady(u)},y.prototype.table=function(e){if(b(this._allTables,e))return this._allTables[e];throw new O.InvalidTable("Table ".concat(e," does not exist"))};var Yr=y;function y(e,t){var o,n,a,r,i,s=this,u=(this._middlewares={},this.verno=0,y.dependencies),u=(this._options=t=v({addons:y.addons,autoOpen:!0,indexedDB:u.indexedDB,IDBKeyRange:u.IDBKeyRange},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},t.addons),c=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:_,dbReadyPromise:null,cancelOpen:_,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3});c.dbReadyPromise=new m(function(e){c.dbReadyResolve=e}),c.openCanceller=new m(function(e,t){c.cancelOpen=t}),this._state=c,this.name=e,this.on=Bt(this,"populate","blocked","versionchange","close",{ready:[Me,_]}),this.on.ready.subscribe=Q(this.on.ready.subscribe,function(i){return function(r,n){y.vip(function(){var t,e=s._state;e.openComplete?(e.dbOpenError||m.resolve().then(r),n&&i(r)):e.onReadyBeingFired?(e.onReadyBeingFired.push(r),n&&i(r)):(i(r),t=s,n||i(function e(){t.on.ready.unsubscribe(r),t.on.ready.unsubscribe(e)}))})}}),this.Collection=(o=this,qt(Yt.prototype,function(e,t){this.db=o;var r=Tt,n=null;if(t)try{r=t()}catch(e){n=e}var t=e._ctx,e=t.table,i=e.hook.reading.fire;this._ctx={table:e,index:t.index,isPrimKey:!t.index||e.schema.primKey.keyPath&&t.index===e.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:n,or:t.or,valueMapper:i!==_e?i:null}})),this.Table=(n=this,qt(Lt.prototype,function(e,t,r){this.db=n,this._tx=r,this.name=e,this.schema=t,this.hook=n._allTables[e]?n._allTables[e].hook:Bt(null,{creating:[xe,_],reading:[we,_e],updating:[Pe,_],deleting:[je,_]})})),this.Transaction=(a=this,qt(cr.prototype,function(e,t,r,n,i){var o=this;this.db=a,this.mode=e,this.storeNames=t,this.schema=r,this.chromeTransactionDurability=n,this.idbtrans=null,this.on=Bt(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new m(function(e,t){o._resolve=e,o._reject=t}),this._completion.then(function(){o.active=!1,o.on.complete.fire()},function(e){var t=o.active;return o.active=!1,o.on.error.fire(e),o.parent?o.parent._reject(e):t&&o.idbtrans&&o.idbtrans.abort(),M(e)})})),this.Version=(r=this,qt(Ir.prototype,function(e){this.db=r,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(i=this,qt(ir.prototype,function(e,t,r){this.db=i,this._ctx={table:e,index:":id"===t?null:t,or:r};var n=i._deps.indexedDB;if(!n)throw new O.MissingAPI;this._cmp=this._ascending=n.cmp.bind(n),this._descending=function(e,t){return n.cmp(t,e)},this._max=function(e,t){return 0<n.cmp(e,t)?e:t},this._min=function(e,t){return n.cmp(e,t)<0?e:t},this._IDBKeyRange=i._deps.IDBKeyRange})),this.on("versionchange",function(e){0<e.newVersion?console.warn("Another connection wants to upgrade database '".concat(s.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(s.name,"'. Closing db now to resume the delete request.")),s.close()}),this.on("blocked",function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('".concat(s.name,"') was blocked")):console.warn("Upgrade '".concat(s.name,"' blocked by other connection holding version ").concat(e.oldVersion/10))}),this._maxKey=pr(t.IDBKeyRange),this._createTransaction=function(e,t,r,n){return new s.Transaction(e,t,r,s._options.chromeTransactionDurability,n)},this._fireOnBlocked=function(t){s.on("blocked").fire(t),Mt.filter(function(e){return e.name===s.name&&e!==s&&!e._state.vcFired}).map(function(e){return e.on("versionchange").fire(t)})},this.use(Fr),this.use(Br),this.use(Jr),this.use(Ur),this.vip=Object.create(this,{_vip:{value:!0}}),u.forEach(function(e){return e(s)})}var Xr,Zr="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",en=(tn.prototype.subscribe=function(e,t,r){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:r})},tn.prototype[Zr]=function(){return this},tn);function tn(e){this._subscribe=e}function rn(t,r){return w(r).forEach(function(e){zr(t[e]||(t[e]=new D),r[e])}),t}function nn(y){return new en(function(i){var o=se(y);var a=!1,s={},u={},c={get closed(){return a},unsubscribe:function(){a=!0,ur.storagemutated.unsubscribe(p)}},l=(i.start&&i.start(c),!1),f=!1;function d(){return w(u).some(function(e){return s[e]&&Kr(s[e],u[e])})}var p=function(e){rn(s,e),d()&&h()},h=function(){var t,e,r;function n(){return P(y,{subscr:e,trans:null})}l||a||(s={},e=t={},o&&yt(),r=x.trans?gt(x.transless,n):n(),o&&r.then(E,E),r=r,f||(ur(ar,p),f=!0),l=!0,Promise.resolve(r).then(function(e){l=!1,a||(d()?h():(s={},u=t,i.next&&i.next(e)))},function(e){["DatabaseClosedError","AbortError"].includes(null==e?void 0:e.name)||(l=!1,i.error&&i.error(e),c.unsubscribe())}))};return h(),c})}try{Xr={indexedDB:d.indexedDB||d.mozIndexedDB||d.webkitIndexedDB||d.msIndexedDB,IDBKeyRange:d.IDBKeyRange||d.webkitIDBKeyRange}}catch(e){Xr={indexedDB:null,IDBKeyRange:null}}var on=Yr;function an(e){var t=N;try{N=!0,ur.storagemutated.fire(e)}finally{N=t}}B(on,v(v({},e),{delete:function(e){return new on(e,{addons:[]}).delete()},exists:function(e){return new on(e,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=on.dependencies,r=t.indexedDB,t=t.IDBKeyRange,(Rr(r)?Promise.resolve(r.databases()).then(function(e){return e.map(function(e){return e.name}).filter(function(e){return e!==Ct})}):Cr(r,t).toCollection().primaryKeys()).then(e)}catch(e){return M(new O.MissingAPI)}var t,r},defineClass:function(){return function(e){s(this,e)}},ignoreTransaction:function(e){return x.trans?gt(x.transless,e):e()},vip:Dr,async:function(t){return function(){try{var e=Tr(t.apply(this,arguments));return e&&"function"==typeof e.then?e:m.resolve(e)}catch(e){return M(e)}}},spawn:function(e,t,r){try{var n=Tr(e.apply(r,t||[]));return n&&"function"==typeof n.then?n:m.resolve(n)}catch(e){return M(e)}},currentTransaction:{get:function(){return x.trans||null}},waitFor:function(e,t){e=m.resolve("function"==typeof e?on.ignoreTransaction(e):e).timeout(t||6e4);return x.trans?x.trans.waitFor(e):e},Promise:m,debug:{get:function(){return f},set:function(e){ue(e,"dexie"===e?function(){return!0}:jt)}},derive:U,extend:s,props:B,override:Q,Events:Bt,on:ur,liveQuery:nn,extendObservabilitySet:rn,getByKeyPath:c,setByKeyPath:S,delByKeyPath:function(t,e){"string"==typeof e?S(t,e,void 0):"length"in e&&[].map.call(e,function(e){S(t,e,void 0)})},shallowClone:Y,deepClone:te,getObjectDiff:Lr,cmp:I,asap:G,minKey:-1/0,addons:[],connections:Mt,errnames:ve,dependencies:Xr,semVer:t,version:t.split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,r){return e+t/Math.pow(10,2*r)})})),on.maxKey=pr(on.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(ur(ar,function(e){var t;N||(At?(t=document.createEvent("CustomEvent")).initCustomEvent(sr,!0,!0,e):t=new CustomEvent(sr,{detail:e}),N=!0,dispatchEvent(t),N=!1)}),addEventListener(sr,function(e){e=e.detail;N||an(e)}));var sn,N=!1;return"undefined"!=typeof BroadcastChannel?("function"==typeof(sn=new BroadcastChannel(sr)).unref&&sn.unref(),ur(ar,function(e){N||sn.postMessage(e)}),sn.onmessage=function(e){e.data&&an(e.data)}):"undefined"!=typeof self&&"undefined"!=typeof navigator&&(ur(ar,function(t){try{N||("undefined"!=typeof localStorage&&localStorage.setItem(sr,JSON.stringify({trig:Math.random(),changedParts:t})),"object"==typeof self.clients&&$([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(e){return e.postMessage({type:sr,changedParts:t})}))}catch(e){}}),"undefined"!=typeof addEventListener&&addEventListener("storage",function(e){e.key===sr&&(e=JSON.parse(e.newValue))&&an(e.changedParts)}),Zr=self.document&&navigator.serviceWorker)&&Zr.addEventListener("message",function(e){e=e.data;e&&e.type===sr&&an(e.changedParts)}),m.rejectionMapper=function(e,t){return!e||e instanceof he||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Oe[e.name]?e:(t=new Oe[e.name](t||e.message,e),"stack"in e&&u(t,"stack",{get:function(){return this.inner.stack}}),t)},ue(f,jt),v(Yr,Object.freeze({__proto__:null,Dexie:Yr,liveQuery:nn,Entity:Ft,cmp:I,default:Yr,RangeSet:D,mergeRanges:zr,rangesOverlap:Kr}),{default:Yr}),Yr},"object"==typeof n&&void 0!==r?r.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Dexie=t()}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("timers").setImmediate)},{timers:652}],44:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.unknownAction=r.runFullQueryAgain=r.removeExistingAndInsertAtSortPosition=r.insertAtSortPosition=r.alwaysWrong=r.replaceExisting=r.removeExisting=r.removeLastInsertLast=r.removeFirstInsertFirst=r.removeLastInsertFirst=r.removeFirstInsertLast=r.removeLastItem=r.removeFirstItem=r.insertLast=r.insertFirst=r.doNothing=void 0;const n=e("array-push-at-sort-position");r.doNothing=e=>{},r.insertFirst=e=>{e.previousResults.unshift(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},r.insertLast=e=>{e.previousResults.push(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},r.removeFirstItem=e=>{var t=e.previousResults.shift();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},r.removeLastItem=e=>{var t=e.previousResults.pop();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},r.removeFirstInsertLast=e=>{(0,r.removeFirstItem)(e),(0,r.insertLast)(e)},r.removeLastInsertFirst=e=>{(0,r.removeLastItem)(e),(0,r.insertFirst)(e)},r.removeFirstInsertFirst=e=>{(0,r.removeFirstItem)(e),(0,r.insertFirst)(e)},r.removeLastInsertLast=e=>{(0,r.removeLastItem)(e),(0,r.insertLast)(e)},r.removeExisting=t=>{t.keyDocumentMap&&t.keyDocumentMap.delete(t.changeEvent.id);var r=t.queryParams.primaryKey,n=t.previousResults;for(let e=0;e<n.length;e++)if(n[e][r]===t.changeEvent.id){n.splice(e,1);break}},r.replaceExisting=t=>{var r=t.changeEvent.doc,n=t.queryParams.primaryKey,i=t.previousResults;for(let e=0;e<i.length;e++)if(i[e][n]===t.changeEvent.id){i[e]=r,t.keyDocumentMap&&t.keyDocumentMap.set(t.changeEvent.id,r);break}},r.alwaysWrong=e=>{var t={_id:"wrongHuman"+(new Date).getTime()};e.previousResults.length=0,e.previousResults.push(t),e.keyDocumentMap&&(e.keyDocumentMap.clear(),e.keyDocumentMap.set(t._id,t))},r.insertAtSortPosition=t=>{const r=t.changeEvent.id;var e=t.changeEvent.doc;if(t.keyDocumentMap){if(t.keyDocumentMap.has(r))return;t.keyDocumentMap.set(r,e)}else if(t.previousResults.find(e=>e[t.queryParams.primaryKey]===r))return;(0,n.pushAtSortPosition)(t.previousResults,e,t.queryParams.sortComparator,0)},r.removeExistingAndInsertAtSortPosition=e=>{(0,r.removeExisting)(e),(0,r.insertAtSortPosition)(e)},r.runFullQueryAgain=e=>{throw new Error("Action runFullQueryAgain must be implemented by yourself")};r.unknownAction=e=>{throw new Error("Action unknownAction should never be called")}},{"array-push-at-sort-position":1}],45:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.actionFunctions=r.orderedActionList=void 0;e=e("./action-functions");r.orderedActionList=["doNothing","insertFirst","insertLast","removeFirstItem","removeLastItem","removeFirstInsertLast","removeLastInsertFirst","removeFirstInsertFirst","removeLastInsertLast","removeExisting","replaceExisting","alwaysWrong","insertAtSortPosition","removeExistingAndInsertAtSortPosition","runFullQueryAgain","unknownAction"],r.actionFunctions={doNothing:e.doNothing,insertFirst:e.insertFirst,insertLast:e.insertLast,removeFirstItem:e.removeFirstItem,removeLastItem:e.removeLastItem,removeFirstInsertLast:e.removeFirstInsertLast,removeLastInsertFirst:e.removeLastInsertFirst,removeFirstInsertFirst:e.removeFirstInsertFirst,removeLastInsertLast:e.removeLastInsertLast,removeExisting:e.removeExisting,replaceExisting:e.replaceExisting,alwaysWrong:e.alwaysWrong,insertAtSortPosition:e.insertAtSortPosition,removeExistingAndInsertAtSortPosition:e.removeExistingAndInsertAtSortPosition,runFullQueryAgain:e.runFullQueryAgain,unknownAction:e.unknownAction}},{"./action-functions":44}],46:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.resolveInput=r.getSimpleBdd=r.minimalBddString=void 0;const n=e("binary-decision-diagram"),i=e("../states");r.minimalBddString="14a2b0c/d1e,f+g5h.i4j*k-l)m(n6ohk1pdf1qef1rin-sjn-ton-ugn-vmn-whn-xkn-yln-zdf5{ef5|wx5}df7~dz7ef7¡bk7¢e{7£g|7¤ry7¥dp7¦gk7§eq7¨gt7©ac7ªmv7«gu7¬nm7­iy7®nw7¯¤s8°«¦8±¬k8²ªm8³®v8´«n8µ¬n8¶vm8·xv8¸mn8¹­j8º®m8»xm8¼­¹3½}~3¾©°3¿¢3À¡£3Ám±3Â®º3Ãmº3Ä©´3Åb®3Æmµ3Çm»3Èx»3Ékn3Êm¸3Ë¼j6ÌÂm6ÍÆÃ6ÎÈm6Ïnm6ÐÊÇ6ÑÌÎ,ÒÍÐ,ÓÅÉ,Ô²¶,Õ³·,Ö®n,×º»,Ømf9ÙËÁ9Úym9ÛmÏ9ÜÑÒ9Ýz{2Þpq2ß½¿2à¾À2á¥§2â°¨2ãÄÓ2ä´Ö2åÝn0æÞn0çØÛ0èÙÜ0éßn0êàã0ë²Ô0ì¯Õ0íán0îâä0ï¹×0ðçv/ñåæ/òçë/óèì/ôéí/õêî/öÚy/÷òm(øóï(ùöy(ú÷ø:ûôõ:ümù:ýðñ4þúû4ÿþý*Āüm*ÿĀ.";let o;function a(){return o=o||(0,n.minimalStringToSimpleBdd)(r.minimalBddString)}r.getSimpleBdd=a;r.resolveInput=e=>(0,n.resolveWithSimpleBdd)(a(),i.stateResolveFunctionByIndex,e)},{"../states":48,"binary-decision-diagram":8}],47:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.runAction=r.calculateActionFunction=r.calculateActionName=r.calculateActionFromMap=void 0;const o=e("./states"),a=e("./actions"),s=e("./bdd/bdd.generated");function u(e){e=(0,s.resolveInput)(e);return a.orderedActionList[e]}i(e("./states"),r),i(e("./util"),r),r.calculateActionFromMap=function(e,t){return t=(0,o.getStateSet)(t),(e=e.get(t))?{action:e,stateSet:t}:{action:"runFullQueryAgain",stateSet:t}},r.calculateActionName=u,r.calculateActionFunction=function(e){return e=u(e),a.actionFunctions[e]},r.runAction=function(e,t,r,n,i){return(0,a.actionFunctions[e])({queryParams:t,changeEvent:r,previousResults:n,keyDocumentMap:i}),n}},{"./actions":45,"./bdd/bdd.generated":46,"./states":48,"./util":50}],48:[function(e,t,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),r=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},o=(Object.defineProperty(i,"__esModule",{value:!0}),i.logStateSet=i.getStateSet=i.resolveState=i.stateResolveFunctionByIndex=i.stateResolveFunctions=i.orderedStateList=void 0,e("./state-resolver"));function a(e,t){var r=i.stateResolveFunctions[e];if(r)return r(t);throw new Error("resolveState() has no function for "+e)}r(e("./state-resolver"),i),i.orderedStateList=["isInsert","isUpdate","isDelete","hasLimit","isFindOne","hasSkip","wasResultsEmpty","previousUnknown","wasLimitReached","wasFirst","wasLast","sortParamsChanged","wasInResult","wasSortedBeforeFirst","wasSortedAfterLast","isSortedBeforeFirst","isSortedAfterLast","wasMatching","doesMatchNow"],i.stateResolveFunctions={isInsert:o.isInsert,isUpdate:o.isUpdate,isDelete:o.isDelete,hasLimit:o.hasLimit,isFindOne:o.isFindOne,hasSkip:o.hasSkip,wasResultsEmpty:o.wasResultsEmpty,previousUnknown:o.previousUnknown,wasLimitReached:o.wasLimitReached,wasFirst:o.wasFirst,wasLast:o.wasLast,sortParamsChanged:o.sortParamsChanged,wasInResult:o.wasInResult,wasSortedBeforeFirst:o.wasSortedBeforeFirst,wasSortedAfterLast:o.wasSortedAfterLast,isSortedBeforeFirst:o.isSortedBeforeFirst,isSortedAfterLast:o.isSortedAfterLast,wasMatching:o.wasMatching,doesMatchNow:o.doesMatchNow},i.stateResolveFunctionByIndex={0:o.isInsert,1:o.isUpdate,2:o.isDelete,3:o.hasLimit,4:o.isFindOne,5:o.hasSkip,6:o.wasResultsEmpty,7:o.previousUnknown,8:o.wasLimitReached,9:o.wasFirst,10:o.wasLast,11:o.sortParamsChanged,12:o.wasInResult,13:o.wasSortedBeforeFirst,14:o.wasSortedAfterLast,15:o.isSortedBeforeFirst,16:o.isSortedAfterLast,17:o.wasMatching,18:o.doesMatchNow},i.resolveState=a,i.getStateSet=function(t){let r="";for(let e=0;e<i.orderedStateList.length;e++){var n=a(i.orderedStateList[e],t);r+=n?"1":"0"}return r},i.logStateSet=function(r){i.orderedStateList.forEach((e,t)=>{console.log("state: "+e+" : "+r[t])})}},{"./state-resolver":49}],49:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.wasResultsEmpty=r.doesMatchNow=r.wasMatching=r.isSortedAfterLast=r.isSortedBeforeFirst=r.wasSortedAfterLast=r.wasSortedBeforeFirst=r.wasLast=r.wasFirst=r.wasInResult=r.sortParamsChanged=r.wasLimitReached=r.previousUnknown=r.isUpdate=r.isInsert=r.isDelete=r.hasSkip=r.isFindOne=r.hasLimit=void 0;const o=e("../util");r.hasLimit=e=>!!e.queryParams.limit,r.isFindOne=e=>1===e.queryParams.limit,r.hasSkip=e=>!!(e.queryParams.skip&&0<e.queryParams.skip),r.isDelete=e=>"DELETE"===e.changeEvent.operation,r.isInsert=e=>"INSERT"===e.changeEvent.operation,r.isUpdate=e=>"UPDATE"===e.changeEvent.operation,r.previousUnknown=e=>e.changeEvent.previous===o.UNKNOWN_VALUE,r.wasLimitReached=e=>(0,r.hasLimit)(e)&&e.previousResults.length>=e.queryParams.limit,r.sortParamsChanged=e=>{var t=e.queryParams.sortFields,r=e.changeEvent.previous,n=e.changeEvent.doc;if(n){if(!r||r===o.UNKNOWN_VALUE)return!0;for(let e=0;e<t.length;e++){var i=t[e];if((0,o.getProperty)(r,i)!==(0,o.getProperty)(n,i))return!0}}return!1},r.wasInResult=e=>{var t=e.changeEvent.id;if(e.keyDocumentMap)return e.keyDocumentMap.has(t);var r=e.queryParams.primaryKey,n=e.previousResults;for(let e=0;e<n.length;e++)if(n[e][r]===t)return!0;return!1},r.wasFirst=e=>{var t=e.previousResults[0];return!(!t||t[e.queryParams.primaryKey]!==e.changeEvent.id)},r.wasLast=e=>{var t=(0,o.lastOfArray)(e.previousResults);return!(!t||t[e.queryParams.primaryKey]!==e.changeEvent.id)},r.wasSortedBeforeFirst=e=>{var t,r=e.changeEvent.previous;return!(!r||r===o.UNKNOWN_VALUE||!(t=e.previousResults[0]))&&(t[e.queryParams.primaryKey]===e.changeEvent.id||e.queryParams.sortComparator(r,t)<0)},r.wasSortedAfterLast=e=>{var t,r=e.changeEvent.previous;return!(!r||r===o.UNKNOWN_VALUE||!(t=(0,o.lastOfArray)(e.previousResults)))&&(t[e.queryParams.primaryKey]===e.changeEvent.id||0<e.queryParams.sortComparator(r,t))},r.isSortedBeforeFirst=e=>{var t,r=e.changeEvent.doc;return!!r&&!!(t=e.previousResults[0])&&(t[e.queryParams.primaryKey]===e.changeEvent.id||e.queryParams.sortComparator(r,t)<0)},r.isSortedAfterLast=e=>{var t,r=e.changeEvent.doc;return!!r&&!!(t=(0,o.lastOfArray)(e.previousResults))&&(t[e.queryParams.primaryKey]===e.changeEvent.id||0<e.queryParams.sortComparator(r,t))},r.wasMatching=e=>{var t=e.changeEvent.previous;return!(!t||t===o.UNKNOWN_VALUE)&&e.queryParams.queryMatcher(t)},r.doesMatchNow=e=>{var t=e.changeEvent.doc;return!!t&&e.queryParams.queryMatcher(t)};r.wasResultsEmpty=e=>0===e.previousResults.length},{"../util":50}],50:[function(e,t,i){"use strict";function r(e){return e.startsWith("-")?e.substr(1):e}function o(e){var t=typeof e;return null!==e&&("object"==t||"function"==t)}Object.defineProperty(i,"__esModule",{value:!0}),i.getProperty=i.isObject=i.roundToTwoDecimals=i.mergeSets=i.ensureNotFalsy=i.flatClone=i.cloneMap=i.objectToMap=i.mapToObject=i.replaceCharAt=i.getSortFieldsOfQuery=i.normalizeSortField=i.tryToFillPreviousDoc=i.shuffleArray=i.randomOfArray=i.lastOfArray=i.UNKNOWN_VALUE=void 0,i.UNKNOWN_VALUE="UNKNOWN",i.lastOfArray=function(e){return e[e.length-1]},i.randomOfArray=function(e){return e[Math.floor(Math.random()*e.length)]},i.shuffleArray=function(e){return e.slice().sort(()=>Math.random()-.5)},i.tryToFillPreviousDoc=function(e){var t;if(e.changeEvent.previous===i.UNKNOWN_VALUE){const r=e.changeEvent.id,n=e.queryParams.primaryKey;e.keyDocumentMap?(t=e.keyDocumentMap.get(r))&&(e.changeEvent.previous=t):(t=e.previousResults.find(e=>e[n]===r))&&(e.changeEvent.previous=t)}},i.normalizeSortField=r,i.getSortFieldsOfQuery=function(e){return e.sort?e.sort.map(e=>Array.isArray(e)?e[0].map(e=>r(e)):r(e)):["_id"]},i.replaceCharAt=function(e,t,r){return e.substr(0,t)+r+e.substr(t+r.length)},i.mapToObject=function(e){const r={};return e.forEach((e,t)=>{r[t]=e}),r},i.objectToMap=function(e){const r=new Map;return Object.entries(e).forEach(([e,t])=>{r.set(e,t)}),r},i.cloneMap=function(e){const r=new Map;return e.forEach((e,t)=>{r[t]=e}),r},i.flatClone=function(e){return Object.assign({},e)},i.ensureNotFalsy=function(e){if(e)return e;throw new Error("ensureNotFalsy() is falsy")},i.mergeSets=function(e){let t=new Set;return e.forEach(e=>{t=new Set([...t,...e])}),t},i.roundToTwoDecimals=function(e){return parseFloat(e.toFixed(2))},i.isObject=o,i.getProperty=function(t,e,r){if(Array.isArray(e)&&(e=e.join(".")),!o(t)||"string"!=typeof e)return void 0===r?t:r;var n=e.split(".");if(0===n.length)return r;for(let e=0;e<n.length;e++){var i=n[e];if(null==(t=function(e,t){{var r;if("number"!=typeof t&&Array.isArray(e))return r=Number.parseInt(t,10),Number.isInteger(r)&&e[r]===e[t]}return}(t,i)?e===n.length-1?void 0:null:t[i])){if(e!==n.length-1)return r;break}}return void 0===t?r:t}},{}],51:[function(e,t,r){"use strict";function u(e,t){for(var r=[],n=0;n<e.length;n+=1)r[n]=e[n];for(var i=0;i<t.length;i+=1)r[i+e.length]=t[i];return r}var c=Object.prototype.toString,l=Math.max;t.exports=function(t){var r=this;if("function"!=typeof r||"[object Function]"!==c.apply(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var n,e,i=function(e,t){for(var r=[],n=t||0,i=0;n<e.length;n+=1,i+=1)r[i]=e[n];return r}(arguments,1),o=l(0,r.length-i.length),a=[],s=0;s<o;s++)a[s]="$"+s;return n=Function("binder","return function ("+function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=t);return r}(a,",")+"){ return binder.apply(this,arguments); }")(function(){var e;return this instanceof n?(e=r.apply(this,u(i,arguments)),Object(e)===e?e:this):r.apply(t,u(i,arguments))}),r.prototype&&((e=function(){}).prototype=r.prototype,n.prototype=new e,e.prototype=null),n}},{}],52:[function(e,t,r){"use strict";e=e("./implementation");t.exports=Function.prototype.bind||e},{"./implementation":51}],53:[function(e,t,r){"use strict";function n(){return"string"==typeof function(){}.name}var i=Object.getOwnPropertyDescriptor;if(i)try{i([],"length")}catch(e){i=null}n.functionsHaveConfigurableNames=function(){var e;return!!(n()&&i&&(e=i(function(){},"name"))&&e.configurable)};var o=Function.prototype.bind;n.boundFunctionsHaveNames=function(){return n()&&"function"==typeof o&&""!==function(){}.bind().name},t.exports=n},{}],54:[function(e,t,r){"use strict";var n,d=SyntaxError,i=Function,p=TypeError,o=function(e){try{return i('"use strict"; return ('+e+").constructor;")()}catch(e){}},h=Object.getOwnPropertyDescriptor;if(h)try{h({},"")}catch(e){h=null}function a(){throw new p}var s=h?function(){try{return a}catch(e){try{return h(arguments,"callee").get}catch(e){return a}}}():a,u=e("has-symbols")(),c=e("has-proto")(),l=Object.getPrototypeOf||(c?function(e){return e.__proto__}:null),y={},c="undefined"!=typeof Uint8Array&&l?l(Uint8Array):n,m={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":u&&l?l([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":y,"%AsyncGenerator%":y,"%AsyncGeneratorFunction%":y,"%AsyncIteratorPrototype%":y,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":i,"%GeneratorFunction%":y,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":u&&l?l(l([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&u&&l?l((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&u&&l?l((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":u&&l?l(""[Symbol.iterator]()):n,"%Symbol%":u?Symbol:n,"%SyntaxError%":d,"%ThrowTypeError%":s,"%TypedArray%":c,"%TypeError%":p,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};if(l)try{null.error}catch(e){u=l(l(e));m["%Error.prototype%"]=u}function b(e){var t,r;return"%AsyncFunction%"===e?t=o("async function () {}"):"%GeneratorFunction%"===e?t=o("function* () {}"):"%AsyncGeneratorFunction%"===e?t=o("async function* () {}"):"%AsyncGenerator%"===e?(r=b("%AsyncGeneratorFunction%"))&&(t=r.prototype):"%AsyncIteratorPrototype%"===e&&(r=b("%AsyncGenerator%"))&&l&&(t=l(r.prototype)),m[e]=t}var v={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},s=e("function-bind"),g=e("hasown"),O=s.call(Function.call,Array.prototype.concat),_=s.call(Function.apply,Array.prototype.splice),w=s.call(Function.call,String.prototype.replace),S=s.call(Function.call,String.prototype.slice),x=s.call(Function.call,RegExp.prototype.exec),j=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,P=/\\(\\)?/g;t.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new p("intrinsic name must be a non-empty string");if(1<arguments.length&&"boolean"!=typeof t)throw new p('"allowMissing" argument must be a boolean');if(null===x(/^%?[^%]*%?$/,e))throw new d("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(e){var t=S(e,0,1),r=S(e,-1);if("%"===t&&"%"!==r)throw new d("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new d("invalid intrinsic syntax, expected opening `%`");var i=[];return w(e,j,function(e,t,r,n){i[i.length]=r?w(n,P,"$1"):t||e}),i}(e),n=0<r.length?r[0]:"",i=function(e,t){var r,n=e;if(g(v,n)&&(n="%"+(r=v[n])[0]+"%"),g(m,n)){var i=m[n];if(void 0!==(i=i===y?b(n):i)||t)return{alias:r,name:n,value:i};throw new p("intrinsic "+e+" exists, but is not available. Please file an issue!")}throw new d("intrinsic "+e+" does not exist!")}("%"+n+"%",t),o=(i.name,i.value),a=!1,i=i.alias;i&&(n=i[0],_(r,O([0,1],i)));for(var s=1,u=!0;s<r.length;s+=1){var c=r[s],l=S(c,0,1),f=S(c,-1);if(('"'===l||"'"===l||"`"===l||'"'===f||"'"===f||"`"===f)&&l!==f)throw new d("property names with quotes must have matching quotes");if("constructor"!==c&&u||(a=!0),g(m,l="%"+(n+="."+c)+"%"))o=m[l];else if(null!=o){if(!(c in o)){if(t)return;throw new p("base intrinsic for "+e+" exists, but the property is not available.")}o=h&&s+1>=r.length?(u=!!(f=h(o,c)))&&"get"in f&&!("originalValue"in f.get)?f.get:o[c]:(u=g(o,c),o[c]),u&&!a&&(m[l]=o)}}return o}},{"function-bind":52,"has-proto":57,"has-symbols":58,hasown:61}],55:[function(t,e,r){"use strict";t=t("get-intrinsic")("%Object.getOwnPropertyDescriptor%",!0);if(t)try{t([],"length")}catch(e){t=null}e.exports=t},{"get-intrinsic":54}],56:[function(e,t,r){"use strict";function n(){if(i)try{return i({},"a",{value:1}),!0}catch(e){}return!1}var i=e("get-intrinsic")("%Object.defineProperty%",!0);n.hasArrayLengthDefineBug=function(){if(!n())return null;try{return 1!==i([],"length",{value:1}).length}catch(e){return!0}},t.exports=n},{"get-intrinsic":54}],57:[function(e,t,r){"use strict";var n={foo:{}},i=Object;t.exports=function(){return{__proto__:n}.foo===n.foo&&!({__proto__:null}instanceof i)}},{}],58:[function(e,t,r){"use strict";var n="undefined"!=typeof Symbol&&Symbol,i=e("./shams");t.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&i()}},{"./shams":59}],59:[function(e,t,r){"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"!=typeof Symbol.iterator){var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){r=Object.getOwnPropertyDescriptor(e,t);if(42!==r.value||!0!==r.enumerable)return!1}}return!0}},{}],60:[function(e,t,r){"use strict";var n=e("has-symbols/shams");t.exports=function(){return n()&&!!Symbol.toStringTag}},{"has-symbols/shams":59}],61:[function(e,t,r){"use strict";var n=Function.prototype.call,i=Object.prototype.hasOwnProperty,e=e("function-bind");t.exports=e.call(n,i)},{"function-bind":52}],62:[function(e,t,r){"use strict";function n(e){return!(o&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===a(e)}function i(e){return!!n(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&0<=e.length&&"[object Array]"!==a(e)&&"[object Function]"===a(e.callee)}var o=e("has-tostringtag/shams")(),a=e("call-bind/callBound")("Object.prototype.toString"),e=function(){return n(arguments)}();n.isLegacyArguments=i,t.exports=e?n:i},{"call-bind/callBound":35,"has-tostringtag/shams":60}],63:[function(e,t,r){"use strict";var n=Date.prototype.getDay,i=Object.prototype.toString,o=e("has-tostringtag/shams")();t.exports=function(e){if("object"!=typeof e||null===e)return!1;if(!o)return"[object Date]"===i.call(e);try{return n.call(e),!0}catch(e){return!1}}},{"has-tostringtag/shams":60}],64:[function(e,t,r){"use strict";var n,i,o,a,s,u=e("call-bind/callBound"),e=e("has-tostringtag/shams")(),c=(e&&(n=u("Object.prototype.hasOwnProperty"),i=u("RegExp.prototype.exec"),o={},s={toString:a=function(){throw o},valueOf:a},"symbol"==typeof Symbol.toPrimitive)&&(s[Symbol.toPrimitive]=a),u("Object.prototype.toString")),l=Object.getOwnPropertyDescriptor;t.exports=e?function(e){if(!e||"object"!=typeof e)return!1;var t=l(e,"lastIndex");if(!(t&&n(t,"value")))return!1;try{i(e,s)}catch(e){return e===o}}:function(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&"[object RegExp]"===c(e)}},{"call-bind/callBound":35,"has-tostringtag/shams":60}],65:[function(e,o,a){!function(i,$){!function(){var e,t,r,n;e="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i?i:this,t=function(){"use strict";function r(e){return e.replace(/=/g,"").replace(/[+\/]/g,function(e){return"+"==e?"-":"_"})}function e(e){for(var t,r,n,i="",o=e.length%3,a=0;a<e.length;){if(255<(t=e.charCodeAt(a++))||255<(r=e.charCodeAt(a++))||255<(n=e.charCodeAt(a++)))throw new TypeError("invalid character found");i+=w[(t=t<<16|r<<8|n)>>18&63]+w[t>>12&63]+w[t>>6&63]+w[63&t]}return o?i.slice(0,o-3)+"===".substring(o):i}function t(e,t){return(t=void 0===t?!1:t)?r(A(e)):A(e)}function n(e){var t;return e.length<2?(t=e.charCodeAt(0))<128?e:t<2048?j(192|t>>>6)+j(128|63&t):j(224|t>>>12&15)+j(128|t>>>6&63)+j(128|63&t):(t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320),j(240|t>>>18&7)+j(128|t>>>12&63)+j(128|t>>>6&63)+j(128|63&t))}function i(e){return e.replace(I,n)}function o(e,t){return(t=void 0===t?!1:t)?r(k(e)):k(e)}function a(e){return o(e,!0)}function s(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return j(55296+(t>>>10))+j(56320+(1023&t));case 3:return j((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return j((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}}function u(e){return e.replace(C,s)}function c(e){if(e=e.replace(/\s+/g,""),!x.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));for(var t,r,n,i="",o=0;o<e.length;)t=S[e.charAt(o++)]<<18|S[e.charAt(o++)]<<12|(r=S[e.charAt(o++)])<<6|(n=S[e.charAt(o++)]),i+=64===r?j(t>>16&255):64===n?j(t>>16&255,t>>8&255):j(t>>16&255,t>>8&255,255&t);return i}function l(e){return D(f(e))}function f(e){return E(e.replace(/[-_]/g,function(e){return"-"==e?"+":"/"}))}function d(e){return T(f(e))}function p(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}}function h(){function e(e,t){Object.defineProperty(String.prototype,e,p(t))}e("fromBase64",function(){return d(this)}),e("toBase64",function(e){return o(this,e)}),e("toBase64URI",function(){return o(this,!0)}),e("toBase64URL",function(){return o(this,!0)}),e("toUint8Array",function(){return l(this)})}function y(){function e(e,t){Object.defineProperty(Uint8Array.prototype,e,p(t))}e("toBase64",function(e){return t(this,e)}),e("toBase64URI",function(){return t(this,!0)}),e("toBase64URL",function(){return t(this,!0)})}var m,b="function"==typeof atob,v="function"==typeof btoa,g="function"==typeof $,O="function"==typeof TextDecoder?new TextDecoder:void 0,_="function"==typeof TextEncoder?new TextEncoder:void 0,w=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),S=(m={},w.forEach(function(e,t){return m[e]=t}),m),x=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,j=String.fromCharCode.bind(String),P="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):function(e){return new Uint8Array(Array.prototype.slice.call(e,0))},E=function(e){return e.replace(/[^A-Za-z0-9\+\/]/g,"")},M=v?function(e){return btoa(e)}:g?function(e){return $.from(e,"binary").toString("base64")}:e,A=g?function(e){return $.from(e).toString("base64")}:function(e){for(var t=[],r=0,n=e.length;r<n;r+=4096)t.push(j.apply(null,e.subarray(r,r+4096)));return M(t.join(""))},I=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,k=g?function(e){return $.from(e,"utf8").toString("base64")}:_?function(e){return A(_.encode(e))}:function(e){return M(i(e))},C=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,R=b?function(e){return atob(E(e))}:g?function(e){return $.from(e,"base64").toString("binary")}:c,D=g?function(e){return P($.from(e,"base64"))}:function(e){return P(R(e).split("").map(function(e){return e.charCodeAt(0)}))},T=g?function(e){return $.from(e,"base64").toString("utf8")}:O?function(e){return O.decode(D(e))}:function(e){return u(R(e))},N={version:"3.7.5",VERSION:"3.7.5",atob:R,atobPolyfill:c,btoa:M,btoaPolyfill:e,fromBase64:d,toBase64:o,encode:o,encodeURI:a,encodeURL:a,utob:i,btou:u,decode:d,isValid:function(e){return"string"==typeof e&&(e=e.replace(/\s+/g,"").replace(/={0,2}$/,""),!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e))},fromUint8Array:t,toUint8Array:l,extendString:h,extendUint8Array:y,extendBuiltins:function(){h(),y()},Base64:{}};return Object.keys(N).forEach(function(e){return N.Base64[e]=N[e]}),N},"object"==typeof a&&void 0!==o?o.exports=t():"function"==typeof define&&define.amd?define(t):(r=e.Base64,(n=t()).noConflict=function(){return e.Base64=r,n},e.Meteor&&(Base64=n),e.Base64=n)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{buffer:649}],66:[function(e,t,r){var n,i;n=this,i=function(){return e.prototype.closeDatabase=function(){this.catalog&&this.catalog.db&&(this.catalog.db.close(),this.catalog.db=null)},e.prototype.checkAvailability=function(){return!("undefined"==typeof indexedDB||!indexedDB)},e.prototype.loadKey=e.prototype.loadDatabase=function(t,r){var e=this.app,n=this;null===this.catalog||null===this.catalog.db?this.catalog=new a(function(e){n.catalog=e,n.loadDatabase(t,r)}):this.catalog.getAppKey(e,t,function(e){"function"==typeof r?0===e.id?r(null):r(e.val):console.log(e.val)})},e.prototype.saveKey=e.prototype.saveDatabase=function(t,r,n){var e=this.app,i=this;function o(e){e&&!0===e.success?n(null):n(new Error("Error saving database")),i.options.closeAfterSave&&i.closeDatabase()}null===this.catalog||null===this.catalog.db?this.catalog=new a(function(e){i.saveDatabase(t,r,o)}):this.catalog.setAppKey(e,t,r,o)},e.prototype.deleteKey=e.prototype.deleteDatabase=function(t,r){var e=this.app,n=this;null===this.catalog||null===this.catalog.db?this.catalog=new a(function(e){n.catalog=e,n.deleteDatabase(t,r)}):this.catalog.getAppKey(e,t,function(e){e=e.id;0!==e?n.catalog.deleteAppKey(e,r):"function"==typeof r&&r({success:!0})})},e.prototype.deleteDatabasePartitions=function(t){var r=this;this.getDatabaseList(function(e){e.forEach(function(e){e.startsWith(t)&&r.deleteDatabase(e)})})},e.prototype.getKeyList=e.prototype.getDatabaseList=function(n){var e=this.app,t=this;null===this.catalog||null===this.catalog.db?this.catalog=new a(function(e){t.catalog=e,t.getDatabaseList(n)}):this.catalog.getAppKeys(e,function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].key);"function"==typeof n?n(t):t.forEach(function(e){console.log(e)})})},e.prototype.getCatalogSummary=function(s){this.app;var t=this;null===this.catalog||null===this.catalog.db?this.catalog=new a(function(e){t.catalog=e,t.getCatalogSummary(s)}):this.catalog.getAllKeys(function(e){for(var t,r,n,i,o=[],a=0;a<e.length;a++)r=(t=e[a]).app||"",n=t.key||"",i=t.val||"",r=2*r.length+2*n.length+i.length+1,o.push({app:t.app,key:t.key,size:r});"function"==typeof s?s(o):o.forEach(function(e){console.log(e)})})},a.prototype.initializeLokiCatalog=function(t){var e=indexedDB.open("LokiCatalog",1),r=this;e.onupgradeneeded=function(e){var e=e.target.result;e.objectStoreNames.contains("LokiAKV")&&e.deleteObjectStore("LokiAKV"),e.objectStoreNames.contains("LokiAKV")||((e=e.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0})).createIndex("app","app",{unique:!1}),e.createIndex("key","key",{unique:!1}),e.createIndex("appkey","appkey",{unique:!0}))},e.onsuccess=function(e){r.db=e.target.result,"function"==typeof t&&t(r)},e.onerror=function(e){throw e}},a.prototype.getAppKey=function(e,t,r){var n,i,e=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("appkey").get(e+","+t);e.onsuccess=(n=r,function(e){e=e.target.result;null==e&&(e={id:0,success:!1}),"function"==typeof n?n(e):console.log(e)}),e.onerror=(i=r,function(e){if("function"!=typeof i)throw e;i({id:0,success:!1})})},a.prototype.getAppKeyById=function(e,t,r){var n,i;this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").get(e).onsuccess=(n=r,i=t,function(e){"function"==typeof i?i(e.target.result,n):console.log(e.target.result)})},a.prototype.setAppKey=function(n,i,o,a){var t,s=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV"),u=s.index("appkey").get(n+","+i);u.onsuccess=function(e){var t,r,e=e.target.result,e=(null==e?e={app:n,key:i,appkey:n+","+i,val:o}:e.val=o,s.put(e));e.onerror=(t=a,function(e){"function"==typeof t?t({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(u.error))}),e.onsuccess=(r=a,function(e){"function"==typeof r&&r({success:!0})})},u.onerror=(t=a,function(e){"function"==typeof t?t({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(u.error))})},a.prototype.deleteAppKey=function(e,t){var r,n,i=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV").delete(e);i.onsuccess=(r=t,function(e){"function"==typeof r&&r({success:!0})}),i.onerror=(n=t,function(e){"function"==typeof n?n({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(i.error))})},a.prototype.getAppKeys=function(e,t){var r,n,i,o=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("app"),e=IDBKeyRange.only(e),o=o.openCursor(e);o.onsuccess=(r=[],n=t,function(e){var t,e=e.target.result;e?(t=e.value,r.push(t),e.continue()):"function"==typeof n?n(r):console.log(r)}),o.onerror=(i=t,function(e){"function"==typeof i?i(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(e))})},a.prototype.getAllKeys=function(e){var r,n,t,i=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").openCursor();i.onsuccess=(r=[],n=e,function(e){var t,e=e.target.result;e?(t=e.value,r.push(t),e.continue()):"function"==typeof n?n(r):console.log(r)}),i.onerror=(t=e,function(e){"function"==typeof t&&t(null)})},e;function e(e,t){if(this.app="loki",this.options=t||{},void 0!==e&&(this.app=e),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}function a(e){this.db=null,this.initializeLokiCatalog(e)}},"function"==typeof define&&define.amd?define([],i):"object"==typeof r?t.exports=i():n.LokiIndexedAdapter=i()},{}],67:[function(L,r,n){!function($,F){!function(){var e,t;e=this,t=function(){"use strict";var w=Object.prototype.hasOwnProperty;function p(e){var t,r;if(Array.isArray(e)){for(r=0;r<e.length;r++)p(e[r]);a(e)}else if(null!==e&&"object"==typeof e){for(t in e)e.hasOwnProperty(t)&&p(e[t]);a(e)}}function a(e){Object.isFrozen(e)||Object.freeze(e)}function s(e){return Object.isFrozen(e)?d(e,"shallow"):e}var S={copyProperties:function(e,t){for(var r in e)t[r]=e[r]},resolveTransformObject:function(e,t,r){var n,i;if("number"!=typeof r&&(r=0),!(10<=++r))for(n in e)"string"==typeof e[n]&&0===e[n].indexOf("[%lktxp]")?(i=e[n].substring(8),t.hasOwnProperty(i)&&(e[n]=t[i])):"object"==typeof e[n]&&(e[n]=S.resolveTransformObject(e[n],t,r));return e},resolveTransformParams:function(e,t){var r,n,i=[];if(void 0===t)return e;for(r=0;r<e.length;r++)n=d(e[r],"shallow-recurse-objects"),i.push(S.resolveTransformObject(n,t));return i},getIn:function(e,t,r){if(null!=e){if(!r)return e[t];if("string"==typeof t&&(t=t.split(".")),!Array.isArray(t))throw new Error("path must be a string or array. Found "+typeof t);for(var n=0,i=t.length;null!=e&&n<i;)e=e[t[n++]];return n&&n==i?e:void 0}}},v={aeq:e,lt:t,gt:r};function e(e,t){var r,n,i,o;if(e===t)return!0;if(!e||!t||!0===e||!0===t||e!=e||t!=t){switch(e){case void 0:case null:i=1;break;case!1:i=3;break;case!0:i=4;break;case"":i=5;break;default:i=e==e?9:0}switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}if(9!==i||9!==o)return i===o}return r=Number(e),n=Number(t),r==r||n==n?r===n:e.toString()==t.toString()}function t(e,t,r){var n,i,o,a;if(!e||!t||!0===e||!0===t||e!=e||t!=t){switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}switch(t){case void 0:case null:a=1;break;case!1:a=3;break;case!0:a=4;break;case"":a=5;break;default:a=t==t?9:0}if(9!==o||9!==a)return o===a?r:o<a}return n=Number(e),i=Number(t),n==n&&i==i?n<i||!(i<n)&&r:n==n&&i!=i||(i!=i||n==n)&&(e<t||!(t<e)&&(e==t?r:(n=e.toString())<(i=t.toString())||n==i&&r))}function r(e,t,r){var n,i,o,a;if(!e||!t||!0===e||!0===t||e!=e||t!=t){switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}switch(t){case void 0:case null:a=1;break;case!1:a=3;break;case!0:a=4;break;case"":a=5;break;default:a=t==t?9:0}if(9!==o||9!==a)return o===a?r:a<o}return n=Number(e),i=Number(t),n==n&&i==i?i<n||!(n<i)&&r:(n!=n||i==i)&&(i==i&&n!=n||t<e||!(e<t)&&(e==t?r:(n=e.toString(),(i=t.toString())<n||n==i&&r)))}function h(e,t,r){return v.aeq(e,t)?0:v.lt(e,t,!1)?r?1:-1:v.gt(e,t,!1)?r?-1:1:0}function x(e,t,r,n,i,o){var a,s=o||0,o=t[s],u=!1;if("object"==typeof e&&o in e&&(a=e[o]),s+1>=t.length)u=r(a,n,i);else if(Array.isArray(a))for(var c=0,l=a.length;c<l&&!0!==(u=x(a[c],t,r,n,i,s+1));c+=1);else u=x(a,t,r,n,i,s+1);return u}function n(t){return"string"==typeof t||Array.isArray(t)?function(e){return-1!==t.indexOf(e)}:"object"==typeof t&&null!==t?function(e){return w.call(t,e)}:null}function o(e,t,r){for(var n in t)if(w.call(t,n))return j[n](e,t[n],r);return!1}var j={$eq:function(e,t){return e===t},$aeq:function(e,t){return e==t},$ne:function(e,t){return t!=t?e==e:e!==t},$dteq:function(e,t){return v.aeq(e,t)},$gt:function(e,t){return v.gt(e,t,!1)},$gte:function(e,t){return v.gt(e,t,!0)},$lt:function(e,t){return v.lt(e,t,!1)},$lte:function(e,t){return v.lt(e,t,!0)},$jgt:function(e,t){return t<e},$jgte:function(e,t){return t<=e},$jlt:function(e,t){return e<t},$jlte:function(e,t){return e<=t},$between:function(e,t){return null!=e&&v.gt(e,t[0],!0)&&v.lt(e,t[1],!0)},$jbetween:function(e,t){return null!=e&&e>=t[0]&&e<=t[1]},$in:function(e,t){return-1!==t.indexOf(e)},$inSet:function(e,t){return t.has(e)},$nin:function(e,t){return-1===t.indexOf(e)},$keyin:function(e,t){return e in t},$nkeyin:function(e,t){return!(e in t)},$definedin:function(e,t){return void 0!==t[e]},$undefinedin:function(e,t){return void 0===t[e]},$regex:function(e,t){return t.test(e)},$containsString:function(e,t){return"string"==typeof e&&-1!==e.indexOf(t)},$containsNone:function(e,t){return!j.$containsAny(e,t)},$containsAny:function(e,t){e=n(e);return null!==e&&(Array.isArray(t)?t.some(e):e(t))},$contains:function(e,t){e=n(e);return null!==e&&(Array.isArray(t)?t.every(e):e(t))},$elemMatch:function(e,n){return!!Array.isArray(e)&&e.some(function(r){return Object.keys(n).every(function(e){var t=n[e];return"object"==typeof t&&t||(t={$eq:t}),-1!==e.indexOf(".")?x(r,e.split("."),o,n[e],r):o(r[e],t,r)})})},$type:function(e,t,r){var n=typeof e;return"object"===n&&(Array.isArray(e)?n="array":e instanceof Date&&(n="date")),"object"!=typeof t?n===t:o(n,t,r)},$finite:function(e,t){return t===isFinite(e)},$size:function(e,t,r){return!!Array.isArray(e)&&("object"!=typeof t?e.length===t:o(e.length,t,r))},$len:function(e,t,r){return"string"==typeof e&&("object"!=typeof t?e.length===t:o(e.length,t,r))},$where:function(e,t){return!0===t(e)},$not:function(e,t,r){return!o(e,t,r)},$and:function(e,t,r){for(var n=0,i=t.length;n<i;n+=1)if(!o(e,t[n],r))return!1;return!0},$or:function(e,t,r){for(var n=0,i=t.length;n<i;n+=1)if(o(e,t[n],r))return!0;return!1},$exists:function(e,t){return t?void 0!==e:void 0===e}},P=(["$eq","$aeq","$ne","$dteq","$gt","$gte","$lt","$lte","$jgt","$jgte","$jlt","$jlte","$type"].forEach(function(e){var n=j[e];j["$"+e]=function(e,t,r){if("string"==typeof t)return n(e,r[t]);if("function"==typeof t)return n(e,t(r));throw new Error("Invalid argument to $$ matcher")}}),{$eq:j.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0});function d(t,e){if(null==t)return null;switch(e||"parse-stringify"){case"parse-stringify":r=JSON.parse(JSON.stringify(t));break;case"jquery-extend-deep":r=jQuery.extend(!0,{},t);break;case"shallow":r=Object.create(t.constructor.prototype),Object.keys(t).map(function(e){r[e]=t[e]});break;case"shallow-assign":r=Object.create(t.constructor.prototype),Object.assign(r,t);break;case"shallow-recurse-objects":var r=d(t,"shallow");Object.keys(t).forEach(function(e){"object"==typeof t[e]&&"Object"===t[e].constructor.name?r[e]=d(t[e],"shallow-recurse-objects"):Array.isArray(t[e])&&(r[e]=function(e,t){if("parse-stringify"==t)return d(e,t);for(var r=[],n=0,i=e.length;n<i;n++)r[n]=d(e[n],t);return r}(t[e],"shallow-recurse-objects"))})}return r}function i(){try{return window&&void 0!==window.localStorage&&null!==window.localStorage}catch(e){}}function u(){}function c(e,t){this.filename=e||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=!(!t||!t.hasOwnProperty("verbose"))&&t.verbose,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]};t&&t.hasOwnProperty("env")?this.ENV=t.env:this.ENV=void 0!==F&&(F.android||F.NSObject)?"NATIVESCRIPT":"undefined"==typeof window||void 0!==F&&F.window&&void 0!==$?"NODEJS":"undefined"==typeof document||-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER","undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(t,!0),this.on("init",this.clearChanges)}function l(e){this.hashStore={},this.options=e||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}function f(e,t){if(this.mode="reference",this.adapter=null,this.options=t||{},this.dbref=null,this.dbname="",this.pageIterator={},!e)throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");if("reference"===e.mode)throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=e,this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=26214400),this.options.hasOwnProperty("delimiter")||(this.options.delimiter="$<\n")}function y(){try{this.fs=L("fs")}catch(e){this.fs=null}}function m(){}function b(e,t){return this.collection=e,this.filteredrows=[],this.filterInitialized=!1,this}function g(e,t,r){this.collection=e,this.name=t,this.rebuildPending=!1,this.options=r||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new b(e),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.collection.disableFreeze||Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[],filter:[],sort:[]}}function O(e,t){this.name=e,this.data=[],this.idIndex=null,this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var s=this,r=((t=t||{}).hasOwnProperty("unique")&&(Array.isArray(t.unique)||(t.unique=[t.unique]),t.unique.forEach(function(e){s.uniqueNames.push(e)})),t.hasOwnProperty("exact")&&t.exact.forEach(function(e){s.constraints.exact[e]=new N(e)}),this.adaptiveBinaryIndices=!t.hasOwnProperty("adaptiveBinaryIndices")||t.adaptiveBinaryIndices,this.transactional=!!t.hasOwnProperty("transactional")&&t.transactional,this.cloneObjects=!!t.hasOwnProperty("clone")&&t.clone,this.cloneMethod=t.hasOwnProperty("cloneMethod")?t.cloneMethod:"parse-stringify",this.asyncListeners=!!t.hasOwnProperty("asyncListeners")&&t.asyncListeners,this.disableMeta=!!t.hasOwnProperty("disableMeta")&&t.disableMeta,this.disableChangesApi=!t.hasOwnProperty("disableChangesApi")||t.disableChangesApi,this.disableDeltaChangesApi=!t.hasOwnProperty("disableDeltaChangesApi")||t.disableDeltaChangesApi,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=!!t.hasOwnProperty("autoupdate")&&t.autoupdate,this.serializableIndices=!t.hasOwnProperty("serializableIndices")||t.serializableIndices,this.disableFreeze=!t.hasOwnProperty("disableFreeze")||t.disableFreeze,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(t.ttl||-1,t.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.dirtyIds=[],[]);if(t&&t.indices)if("[object Array]"===Object.prototype.toString.call(t.indices))r=t.indices;else{if("string"!=typeof t.indices)throw new TypeError("Indices needs to be a string or an array of strings");r=[t.indices]}for(var n=0;n<r.length;n++)this.ensureIndex(r[n]);function u(e,t){var r=null!==t&&"object"==typeof t?Object.keys(t):null;if(r&&r.length&&["string","boolean","number"].indexOf(typeof t)<0){for(var n={},i=0;i<r.length;i++){var o,a=r[i];t.hasOwnProperty(a)&&(!e.hasOwnProperty(a)||0<=s.uniqueNames.indexOf(a)||"$loki"==a||"meta"==a?n[a]=t[a]:void 0!==(o=u(e[a],t[a]))&&o!={}&&(n[a]=o))}return 0===Object.keys(n).length?void 0:n}return e===t?void 0:t}function i(){s.changes=[]}this.observerCallback=function(e){var t="function"==typeof Set?new Set:[];t.add||(t.add=function(e){return-1===this.indexOf(e)&&this.push(e),this}),e.forEach(function(e){t.add(e.object)}),t.forEach(function(e){if(!w.call(e,"$loki"))return s.removeAutoUpdateObserver(e);try{s.update(e)}catch(e){}})},this.getChangeDelta=function(e,t){return t?u(t,e):JSON.parse(JSON.stringify(e))},this.getObjectDelta=u,this.getChanges=function(){return s.changes},this.flushChanges=i,this.setChangesApi=function(e){s.disableChangesApi=!e,e||(s.disableDeltaChangesApi=!1)},this.on("delete",function(e){s.disableChangesApi||s.createChange(s.name,"R",e)}),this.on("warning",function(e){s.lokiConsoleWrapper.warn(e)}),i()}function _(e){return-1!==e.indexOf(".")}function E(e){return parseFloat(e,10)}function M(e,t){return e+t}function T(e,t){return e-t}function A(e){return e.reduce(M,0)/e.length}function I(e,t,r){if(!1===r)return e[t];for(var n=t.split("."),i=e;0<n.length;)i=i[n.shift()];return i}function k(e,t,r){for(var n,i,o=0,a=e.length;o<a;){if(0===(n=r.apply(null,[t,e[i=o+a>>1]])))return{found:!0,index:i};n<0?a=i:o=1+i}return{found:!1,index:a}}function C(r){return function(e,t){return k(e,t,r)}}function R(){}function D(e){this.field=e,this.keyMap=Object.create(null),this.lokiMap=Object.create(null)}function N(e){this.index=Object.create(null),this.field=e}return u.prototype.events={},u.prototype.asyncListeners=!1,u.prototype.on=function(e,t){var r=this;return Array.isArray(e)?e.forEach(function(e){r.on(e,t)}):(this.events[e]||(this.events[e]=[])).push(t),t},u.prototype.emit=function(e){var t,r=this;if(!e||!this.events[e])throw new Error("No event "+e+" defined");this.events[e].length&&(t=Array.prototype.slice.call(arguments,1),this.events[e].forEach(function(e){r.asyncListeners?setTimeout(function(){e.apply(r,t)},1):e.apply(r,t)}))},u.prototype.addListener=u.prototype.on,u.prototype.removeListener=function(e,t){var r=this;Array.isArray(e)?e.forEach(function(e){r.removeListener(e,t)}):this.events[e]&&(e=this.events[e]).splice(e.indexOf(t),1)},((c.prototype=new u).constructor=c).prototype.getIndexedAdapter=function(){var e;return e="function"==typeof L?L("./loki-indexed-adapter.js"):e},c.prototype.configureOptions=function(e,t){var r,n={fs:y,localStorage:m,memory:l};this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,void 0!==e&&(this.options=e,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof n[e.persistenceMethod]&&(this.persistenceMethod=e.persistenceMethod,this.persistenceAdapter=new n[e.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=e.adapter,this.options.adapter=null,this.isIncremental="incremental"===this.persistenceAdapter.mode),e.autoload&&t&&(r=this,setTimeout(function(){r.loadDatabase(e,e.autoloadCallback)},1)),this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(e,e.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves"))&&(this.throttledSaves=this.options.throttledSaves),this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter="$<\n"),null===this.persistenceAdapter&&(this.persistenceMethod={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"}[this.ENV],this.persistenceMethod)&&(this.persistenceAdapter=new n[this.persistenceMethod])},c.prototype.copy=function(e){var t,r,n=new c(this.filename,{env:"NA"});if(e=e||{},n.loadJSONObject(this,{retainDirtyFlags:!0}),e.hasOwnProperty("removeNonSerializable")&&!0===e.removeNonSerializable)for(n.autosaveHandle=null,n.persistenceAdapter=null,t=n.collections.length,r=0;r<t;r++)n.collections[r].constraints=null,n.collections[r].ttl=null;return n},c.prototype.addCollection=function(e,t){var r,n=this.collections.length;if(t&&!0===t.disableMeta){if(!1===t.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===t.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof t.ttl&&0<t.ttl)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(r=0;r<n;r+=1)if(this.collections[r].name===e)return this.collections[r];t=new O(e,t);return t.isIncremental=this.isIncremental,this.collections.push(t),this.verbose&&(t.lokiConsoleWrapper=console),t},c.prototype.loadCollection=function(e){if(!e.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(e)},c.prototype.getCollection=function(e){for(var t=this.collections.length,r=0;r<t;r+=1)if(this.collections[r].name===e)return this.collections[r];return this.emit("warning","collection "+e+" not found"),null},c.prototype.renameCollection=function(e,t){e=this.getCollection(e);return e&&(e.name=t),e},c.prototype.listCollections=function(){for(var e=this.collections.length,t=[];e--;)t.push({name:this.collections[e].name,type:this.collections[e].objType,count:this.collections[e].data.length});return t},c.prototype.removeCollection=function(e){for(var t=this.collections.length,r=0;r<t;r+=1)if(this.collections[r].name===e){var n,i=new O(e,{}),o=this.collections[r];for(n in o)o.hasOwnProperty(n)&&i.hasOwnProperty(n)&&(o[n]=i[n]);return void this.collections.splice(r,1)}},c.prototype.getName=function(){return this.name},c.prototype.serializeReplacer=function(e,t){switch(e){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":return null;case"throttledSavePending":case"throttledCallbacks":return;case"lokiConsoleWrapper":return null;default:return t}},c.prototype.toJson=c.prototype.serialize=function(e){switch((e=e||{}).hasOwnProperty("serializationMethod")||(e.serializationMethod=this.options.serializationMethod),e.serializationMethod){case"normal":return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured();default:return JSON.stringify(this,this.serializeReplacer)}},c.prototype.serializeDestructured=function(e){var t,r,n,i,o,a=[];if((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),!0===e.partitioned&&e.hasOwnProperty("partition")&&0<=e.partition)return this.serializeCollection({delimited:e.delimited,delimiter:e.delimiter,collectionIndex:e.partition});for((o=new c(this.filename)).loadJSONObject(this),t=0;t<o.collections.length;t++)o.collections[t].data=[];if(!0===e.partitioned&&-1===e.partition)return o.serialize({serializationMethod:"normal"});for(a.push(o.serialize({serializationMethod:"normal"})),o=null,t=0;t<this.collections.length;t++)if(n=this.serializeCollection({delimited:e.delimited,delimiter:e.delimiter,collectionIndex:t}),!1===e.partitioned&&!1===e.delimited){if(!Array.isArray(n))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(i=n.length,r=0;r<i;r++)a.push(n[r]),n[r]=null;a.push("")}else a.push(n);return e.partitioned?(e.delimited,a):e.delimited?(a.push(""),a.join(e.delimiter)):(a.push(""),a)},c.prototype.serializeCollection=function(e){var t,r,n=[];if((e=e||{}).hasOwnProperty("delimited")||(e.delimited=!0),!e.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(t=this.collections[e.collectionIndex].data.length,n=[],r=0;r<t;r++)n.push(JSON.stringify(this.collections[e.collectionIndex].data[r]));return e.delimited?(n.push(""),n.join(e.delimiter)):n},c.prototype.deserializeDestructured=function(e,t){var r,n,i,o=[],a=0,s=1,u=!1;if((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),t.partitioned){if(t.hasOwnProperty("partition"))return-1===t.partition?JSON.parse(e[0]):this.deserializeCollection(e[t.partition+1],t);for(n=(r=JSON.parse(e[0])).collections.length,a=0;a<n;a++)r.collections[a].data=this.deserializeCollection(e[a+1],t)}else{if(t.delimited){if(o=e.split(t.delimiter),e=null,0===o.length)return null}else o=e;for(n=(r=JSON.parse(o[0])).collections.length,o[0]=null;!u;)o[s],""===o[s]?++a>n&&(u=!0):(i=JSON.parse(o[s]),r.collections[a].data.push(i)),o[s++]=null}return r},c.prototype.deserializeCollection=function(e,t){var r,n,i=[];for((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),t.delimited?(i=e.split(t.delimiter)).pop():i=e,n=i.length,r=0;r<n;r++)i[r]=JSON.parse(i[r]);return i},c.prototype.loadJSON=function(e,t){var r;if(0===e.length)r={};else switch(this.options.serializationMethod){case"normal":case"pretty":r=JSON.parse(e);break;case"destructured":r=this.deserializeDestructured(e);break;default:r=JSON.parse(e)}this.loadJSONObject(r,t)},c.prototype.loadJSONObject=function(e,t){var r,n,i,o,a,s,u=0,c=e.collections?e.collections.length:0;for(this.name=e.name,e.hasOwnProperty("throttledSaves")&&t&&!t.hasOwnProperty("throttledSaves")&&(this.throttledSaves=e.throttledSaves),this.collections=[];u<c;u+=1){if(r=e.collections[u],(n=this.addCollection(r.name,{disableChangesApi:r.disableChangesApi,disableDeltaChangesApi:r.disableDeltaChangesApi,disableMeta:r.disableMeta,disableFreeze:!r.hasOwnProperty("disableFreeze")||r.disableFreeze})).adaptiveBinaryIndices=!!r.hasOwnProperty("adaptiveBinaryIndices")&&!0===r.adaptiveBinaryIndices,n.transactional=r.transactional,n.asyncListeners=r.asyncListeners,n.cloneObjects=r.cloneObjects,n.cloneMethod=r.cloneMethod||"parse-stringify",n.autoupdate=r.autoupdate,n.changes=r.changes,n.dirtyIds=r.dirtyIds||[],t&&!0===t.retainDirtyFlags?n.dirty=r.dirty:n.dirty=!1,i=r.data.length,o=0,t&&t.hasOwnProperty(r.name))for(a=function(e){var r,n=t[e.name];return n.proto?(r=n.inflate||S.copyProperties,function(e){var t=new n.proto;return r(e,t),t}):n.inflate}(r);o<i;o++)s=a(r.data[o]),n.data[o]=s,n.addAutoUpdateObserver(s),n.disableFreeze||p(n.data[o]);else for(;o<i;o++)n.data[o]=r.data[o],n.addAutoUpdateObserver(n.data[o]),n.disableFreeze||p(n.data[o]);if(n.maxId=void 0===r.maxId?0:r.maxId,void 0!==r.binaryIndices&&(n.binaryIndices=r.binaryIndices),void 0!==r.transforms&&(n.transforms=r.transforms),n.uniqueNames=[],r.hasOwnProperty("uniqueNames")&&(n.uniqueNames=r.uniqueNames),void 0!==r.DynamicViews){for(var l=0;l<r.DynamicViews.length;l++){var f=r.DynamicViews[l],d=n.addDynamicView(f.name,f.options);d.resultdata=f.resultdata,d.resultsdirty=f.resultsdirty,d.filterPipeline=f.filterPipeline,d.sortCriteriaSimple=f.sortCriteriaSimple,d.sortCriteria=f.sortCriteria,d.sortFunction=null,d.sortDirty=f.sortDirty,n.disableFreeze||(p(d.filterPipeline),d.sortCriteriaSimple?p(d.sortCriteriaSimple):d.sortCriteria&&p(d.sortCriteria)),d.resultset.filteredrows=f.resultset.filteredrows,d.resultset.filterInitialized=f.resultset.filterInitialized,d.rematerialize({removeWhereFilters:!0})}e.databaseVersion<1.5&&(n.ensureAllIndexes(!0),n.dirty=!0)}}},c.prototype.close=function(e){this.autosave&&(this.autosaveDisable(),this.autosaveDirty())&&(this.saveDatabase(e),e=void 0),e&&this.on("close",e),this.emit("close")},c.prototype.generateChangesNotification=function(e){function t(e){return e.name}var r=[],n=e||this.collections.map(t);return this.collections.forEach(function(e){-1!==n.indexOf(e.name)&&(r=r.concat(e.getChanges()))}),r},c.prototype.serializeChanges=function(e){return JSON.stringify(this.generateChangesNotification(e))},c.prototype.clearChanges=function(){this.collections.forEach(function(e){e.flushChanges&&e.flushChanges()})},l.prototype.loadDatabase=function(e,t){var r=this;this.options.asyncResponses?setTimeout(function(){r.hashStore.hasOwnProperty(e)?t(r.hashStore[e].value):t(null)},this.options.asyncTimeout):this.hashStore.hasOwnProperty(e)?t(this.hashStore[e].value):t(null)},l.prototype.saveDatabase=function(e,t,r){var n,i=this;this.options.asyncResponses?setTimeout(function(){n=i.hashStore.hasOwnProperty(e)?i.hashStore[e].savecount:0,i.hashStore[e]={savecount:n+1,lastsave:new Date,value:t},r()},this.options.asyncTimeout):(n=this.hashStore.hasOwnProperty(e)?this.hashStore[e].savecount:0,this.hashStore[e]={savecount:n+1,lastsave:new Date,value:t},r())},l.prototype.deleteDatabase=function(e,t){this.hashStore.hasOwnProperty(e)&&delete this.hashStore[e],"function"==typeof t&&t()},f.prototype.loadDatabase=function(e,r){var n=this;this.dbname=e,this.dbref=new c(e),this.adapter.loadDatabase(e,function(e){var t;e?("string"!=typeof e&&r(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()")),t=JSON.parse(e),n.dbref.loadJSONObject(t),t=null,n.dbref.collections.length,0===n.dbref.collections.length?r(n.dbref):(n.pageIterator={collection:0,pageIndex:0},n.loadNextPartition(0,function(){r(n.dbref)}))):r(e)})},f.prototype.loadNextPartition=function(t,r){var e=this.dbname+"."+t,n=this;!0===this.options.paging?(this.pageIterator.pageIndex=0,this.loadNextPage(r)):this.adapter.loadDatabase(e,function(e){e=n.dbref.deserializeCollection(e,{delimited:!0,collectionIndex:t});n.dbref.collections[t].data=e,++t<n.dbref.collections.length?n.loadNextPartition(t,r):r()})},f.prototype.loadNextPage=function(i){var e=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,o=this;this.adapter.loadDatabase(e,function(e){var t,r=e.split(o.options.delimiter),n=r.length,e=(e="")===r[n-1];for(e&&(r.pop(),""===r[(n=r.length)-1])&&1===n&&(r.pop(),n=r.length),t=0;t<n;t++)o.dbref.collections[o.pageIterator.collection].data.push(JSON.parse(r[t])),r[t]=null;r=[],e?++o.pageIterator.collection<o.dbref.collections.length?o.loadNextPartition(o.pageIterator.collection,i):i():(o.pageIterator.pageIndex++,o.loadNextPage(i))})},f.prototype.exportDatabase=function(e,t,r){var n,i=t.collections.length;for(this.dbref=t,this.dbname=e,this.dirtyPartitions=[-1],n=0;n<i;n++)t.collections[n].dirty&&this.dirtyPartitions.push(n);this.saveNextPartition(function(e){r(e)})},f.prototype.saveNextPartition=function(t){var r=this,e=this.dirtyPartitions.shift(),n=this.dbname+(-1===e?"":"."+e);this.options.paging&&-1!==e?(this.pageIterator={collection:e,docIndex:0,pageIndex:0},this.saveNextPage(function(e){0===r.dirtyPartitions.length?t(e):r.saveNextPartition(t)})):(e=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:e}),this.adapter.saveDatabase(n,e,function(e){e?t(e):0===r.dirtyPartitions.length?t(null):r.saveNextPartition(t)}))},f.prototype.saveNextPage=function(t){function e(e){c="",e&&t(e),l?t(null):(n.pageIterator.pageIndex++,n.saveNextPage(t))}var r,n=this,i=this.dbref.collections[this.pageIterator.collection],o=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,a=0,s=i.data.length,u=this.options.delimiter.length,c="",l=!1,f=!1;for(0===i.data.length&&(l=!0);;)if(l||(r=JSON.stringify(i.data[this.pageIterator.docIndex]),c+=r,a+=r.length,++this.pageIterator.docIndex>=s&&(l=!0)),(f=a>=this.options.pageSize?!0:f)&&!l||(c+=this.options.delimiter,a+=u),l||f)return void this.adapter.saveDatabase(o,c,e)},y.prototype.loadDatabase=function(r,n){var i=this;this.fs.stat(r,function(e,t){!e&&t.isFile()?i.fs.readFile(r,{encoding:"utf8"},function(e,t){n(e?new Error(e):t)}):n(null)})},y.prototype.saveDatabase=function(t,e,r){var n=this,i=t+"~";this.fs.writeFile(i,e,function(e){e?r(new Error(e)):n.fs.rename(i,t,r)})},y.prototype.deleteDatabase=function(e,t){this.fs.unlink(e,function(e){e?t(new Error(e)):t()})},m.prototype.loadDatabase=function(e,t){i()?t(localStorage.getItem(e)):t(new Error("localStorage is not available"))},m.prototype.saveDatabase=function(e,t,r){i()?(localStorage.setItem(e,t),r(null)):r(new Error("localStorage is not available"))},m.prototype.deleteDatabase=function(e,t){i()?(localStorage.removeItem(e),t(null)):t(new Error("localStorage is not available"))},c.prototype.throttledSaveDrain=function(e,t){var r=this,n=(new Date).getTime();this.throttledSaves||e(!0),(t=t||{}).hasOwnProperty("recursiveWait")||(t.recursiveWait=!0),t.hasOwnProperty("recursiveWaitLimit")||(t.recursiveWaitLimit=!1),t.hasOwnProperty("recursiveWaitLimitDuration")||(t.recursiveWaitLimitDuration=2e3),t.hasOwnProperty("started")||(t.started=(new Date).getTime()),this.throttledSaves&&this.throttledSavePending?t.recursiveWait?this.throttledCallbacks.push(function(){r.throttledSavePending?t.recursiveWaitLimit&&n-t.started>t.recursiveWaitLimitDuration?e(!1):r.throttledSaveDrain(e,t):e(!0)}):this.throttledCallbacks.push(e):e(!0)},c.prototype.loadDatabaseInternal=function(r,e){var n=e||function(e,t){if(e)throw e},i=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,function(e){if("string"==typeof e){var t=!1;try{i.loadJSON(e,r||{}),t=!0}catch(e){n(e)}t&&(n(null),i.emit("loaded","database "+i.filename+" loaded"))}else e?e instanceof Error?n(e):"object"==typeof e?(i.loadJSONObject(e,r||{}),n(null),i.emit("loaded","database "+i.filename+" loaded")):n("unexpected adapter response : "+e):(n(null),i.emit("loaded","empty database "+i.filename+" loaded"))}):n(new Error("persistenceAdapter not configured"))},c.prototype.loadDatabase=function(t,r){var n=this;this.throttledSaves?this.throttledSaveDrain(function(e){e?(n.throttledSavePending=!0,n.loadDatabaseInternal(t,function(e){0===n.throttledCallbacks.length?n.throttledSavePending=!1:n.saveDatabase(),"function"==typeof r&&r(e)})):"function"==typeof r&&r(new Error("Unable to pause save throttling long enough to read database"))},t):this.loadDatabaseInternal(t,r)},c.prototype.saveDatabaseInternal=function(e){var r,t=e||function(e){if(e)throw e},n=this;this.persistenceAdapter?"incremental"===this.persistenceAdapter.mode?(this.ignoreAutosave=!0,this.persistenceAdapter.saveDatabase(this.filename,function(){var e;if(n.ignoreAutosave=!1,!r)return e=n.copy({removeNonSerializable:!0}),r=n.collections.map(function(e){return[e.dirty,e.dirtyIds]}),n.collections.forEach(function(e){e.dirty=!1,e.dirtyIds=[]}),e;t(new Error("adapter error - getLokiCopy called more than once"))},function(e){n.ignoreAutosave=!1,e&&r&&n.collections.forEach(function(e,t){t=r[t];e.dirty=e.dirty||t[0],e.dirtyIds=e.dirtyIds.concat(t[1])}),t(e)})):"reference"===this.persistenceAdapter.mode&&"function"==typeof this.persistenceAdapter.exportDatabase?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),function(e){n.autosaveClearFlags(),t(e)}):(this.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,this.serialize(),function(e){t(e)})):t(new Error("persistenceAdapter not configured"))},c.prototype.save=c.prototype.saveDatabase=function(e){var r,n;this.throttledSaves?this.throttledSavePending?this.throttledCallbacks.push(e):(r=this.throttledCallbacks,this.throttledCallbacks=[],r.unshift(e),this.throttledSavePending=!0,(n=this).saveDatabaseInternal(function(t){n.throttledSavePending=!1,r.forEach(function(e){"function"==typeof e&&setTimeout(function(){e(t)},1)}),0<n.throttledCallbacks.length&&n.saveDatabase()})):this.saveDatabaseInternal(e)},c.prototype.deleteDatabase=function(e,t){var r="function"!=typeof e||t?t||function(e,t){if(e)throw e}:e;null!==this.persistenceAdapter?this.persistenceAdapter.deleteDatabase(this.filename,function(e){r(e)}):r(new Error("persistenceAdapter not configured"))},c.prototype.autosaveDirty=function(){for(var e=0;e<this.collections.length;e++)if(this.collections[e].dirty)return!0;return!1},c.prototype.autosaveClearFlags=function(){for(var e=0;e<this.collections.length;e++)this.collections[e].dirty=!1},c.prototype.autosaveEnable=function(e,t){this.autosave=!0;var r=5e3,n=this;void 0!==this.autosaveInterval&&null!==this.autosaveInterval&&(r=this.autosaveInterval),this.autosaveHandle=setInterval(function(){n.autosaveDirty()&&!n.ignoreAutosave&&n.saveDatabase(t)},r)},c.prototype.autosaveDisable=function(){void 0!==this.autosaveHandle&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},b.prototype.reset=function(){return 0<this.filteredrows.length&&(this.filteredrows=[]),this.filterInitialized=!1,this},b.prototype.toJSON=function(){var e=this.copy();return e.collection=null,e},b.prototype.limit=function(e){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var t=new b(this.collection);return t.filteredrows=this.filteredrows.slice(0,e),t.filterInitialized=!0,t},b.prototype.offset=function(e){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var t=new b(this.collection);return t.filteredrows=this.filteredrows.slice(e),t.filterInitialized=!0,t},b.prototype.branch=b.prototype.copy=function(){var e=new b(this.collection);return 0<this.filteredrows.length&&(e.filteredrows=this.filteredrows.slice()),e.filterInitialized=this.filterInitialized,e},b.prototype.transform=function(e,t){var r,n,i=this;if("object"!=typeof(e="string"==typeof e&&this.collection.transforms.hasOwnProperty(e)?this.collection.transforms[e]:e)||!Array.isArray(e))throw new Error("Invalid transform");for(void 0!==t&&(e=S.resolveTransformParams(e,t)),r=0;r<e.length;r++)switch((n=e[r]).type){case"find":i.find(n.value);break;case"where":i.where(n.value);break;case"simplesort":i.simplesort(n.property,n.desc||n.options);break;case"compoundsort":i.compoundsort(n.value);break;case"sort":i.sort(n.value);break;case"limit":i=i.limit(n.value);break;case"offset":i=i.offset(n.value);break;case"map":i=i.map(n.value,n.dataOptions);break;case"eqJoin":i=i.eqJoin(n.joinData,n.leftJoinKey,n.rightJoinKey,n.mapFun,n.dataOptions);break;case"mapReduce":i=i.mapReduce(n.mapFunction,n.reduceFunction);break;case"update":i.update(n.value);break;case"remove":i.remove()}return i},b.prototype.sort=function(e){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());function t(e,t){return r(n[e],n[t])}var r,n;r=e,n=this.collection.data;return this.filteredrows.sort(t),this},b.prototype.simplesort=function(r,e){var n,i,o,a,s,t=10,u=this.collection.data.length,c=this.filteredrows.length,l=this.collection.binaryIndices.hasOwnProperty(r);if(!0===(e=void 0!==e&&!1!==e?e:{desc:!1})&&(e={desc:!0}),0===c){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(r))return this.collection.ensureIndex(r),this.filteredrows=this.collection.binaryIndices[r].values.slice(0),e.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!e.disableIndexIntersect&&l&&(u/c<=(t=e.useJavascriptSorting?6:t)||e.forceIndexIntersect)){for(var f=this.filteredrows,d={},p=0;p<c;p++)d[f[p]]=!0;l=this.collection.binaryIndices[r].values;return this.filteredrows=l.filter(function(e){return d[e]}),e.desc&&this.filteredrows.reverse(),this}return e.useJavascriptSorting?this.sort(function(e,t){return e[r]===t[r]?0:e[r]>t[r]?1:e[r]<t[r]?-1:void 0}):(n=r,i=e.desc,o=this.collection.data,this.filteredrows.sort(function(e,t){return s=~n.indexOf(".")?(s=n.split("."),a=S.getIn(o[e],s,!0),S.getIn(o[t],s,!0)):(a=o[e][n],o[t][n]),h(a,s,i)}),this)},b.prototype.compoundsort=function(e){if(0===e.length)throw new Error("Invalid call to compoundsort, need at least one property");var t;if(1===e.length)return t=e[0],Array.isArray(t)?this.simplesort(t[0],t[1]):this.simplesort(t,!1);for(var f,d,r=0,n=e.length;r<n;r+=1)t=e[r],Array.isArray(t)||(e[r]=[t,!1]);return this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex()),f=e,d=this.collection.data,this.filteredrows.sort(function(e,t){for(var r,n,i,o,a=f,s=d[e],u=d[t],c=0,l=a.length;c<l;c++)if(o=~(n=(r=a[c])[0]).indexOf(".")?(o=n.split("."),i=S.getIn(s,o,!0),S.getIn(u,o,!0)):(i=s[n],u[n]),0!==(n=h(i,o,r[1])))return n;return 0}),this},b.prototype.$or=b.prototype.findOr=function(e){for(var t,r,n,i=0,o=[],a=[],s=(this.count(),0),u=e.length;s<u;s++)for(r=(t=this.branch().find(e[s]).filteredrows).length,i=0;i<r;i++)void 0===a[n=t[i]]&&(a[n]=!0,o.push(n));return this.filteredrows=o,this.filterInitialized=!0,this},b.prototype.$and=b.prototype.findAnd=function(e){for(var t=0,r=e.length;t<r;t++){if(0===this.count())return this;this.find(e[t])}return this},b.prototype.find=function(e,t){if(0===this.collection.data.length)this.filteredrows=[],this.filterInitialized=!0;else{var r,n,i,o,a,s,u,c=e||"getAll",e=!1,l=[],f=[],d=null;if(t=t||!1,"object"==typeof c){for(r in c)(o={})[r]=c[r],f.push(o),w.call(c,r)&&(i=c[n=r]);if(1<f.length)return this.find({$and:f},t)}if(n&&"getAll"!==c)if("$and"===n||"$or"===n)this[n](i),t&&1<this.filteredrows.length&&(this.filteredrows=this.filteredrows.slice(0,1));else{if(null===i||"object"!=typeof i||i instanceof Date)a="$eq",s=i;else{if("object"!=typeof i)throw new Error("Do not know what you want to do.");for(u in i)if(w.call(i,u)){s=i[a=u];break}}"$regex"!==a&&"object"!=typeof s||(s=function e(t,r){if("$regex"===t)Array.isArray(r)?r=new RegExp(r[0],r[1]):r instanceof RegExp||(r=new RegExp(r));else if("object"==typeof r)for(var n in r)"$regex"!==n&&"object"!=typeof r[n]||(r[n]=e(n,r[n]));return r}(a,s));var p,h,y=-1!==n.indexOf("."),m=(!this.filterInitialized&&this.collection.binaryIndices[n]&&P[a]&&(!0!==this.collection.adaptiveBinaryIndices&&this.collection.ensureIndex(n),e=!0,d=this.collection.binaryIndices[n]),!e&&"$in"===a&&Array.isArray(s)&&"undefined"!=typeof Set&&(s=new Set(s),a="$inSet"),j[a]),b=this.collection.data,v=0,g=0,O=0;if(this.filterInitialized){if(g=(p=this.filteredrows).length,y){for(n=n.split("."),v=0;v<g;v++)if(x(h=b[O=p[v]],n,m,s,h)&&(l.push(O),t))return this.filteredrows=l,this}else for(v=0;v<g;v++)if(m((h=b[O=p[v]])[n],s,h)&&(l.push(O),t))return this.filteredrows=l,this}else if(e){var _=this.collection.calculateRange(a,n,s);if("$in"!==a){for(v=_[0];v<=_[1];v++)if(!0!==P[a]){if(P[a](S.getIn(b[d.values[v]],n,y),s)&&(l.push(d.values[v]),t))return this.filteredrows=l,this.filterInitialized=!0,this}else if(l.push(d.values[v]),t)return this.filteredrows=l,this.filterInitialized=!0,this}else for(v=0,g=_.length;v<g;v++)if(l.push(d.values[_[v]]),t)return this.filteredrows=l,this.filterInitialized=!0,this}else if(g=b.length,y){for(n=n.split("."),v=0;v<g;v++)if(x(h=b[v],n,m,s,h)&&(l.push(v),t))return this.filteredrows=l,this.filterInitialized=!0,this}else for(v=0;v<g;v++)if(m((h=b[v])[n],s,h)&&(l.push(v),t))return this.filteredrows=l,this.filterInitialized=!0,this;this.filteredrows=l,this.filterInitialized=!0}else t&&(this.filterInitialized?this.filteredrows=this.filteredrows.slice(0,1):(this.filteredrows=0<this.collection.data.length?[0]:[],this.filterInitialized=!0))}return this},b.prototype.where=function(e){var t,r=[];if("function"!=typeof e)throw new TypeError("Argument is not a stored view or a function");t=e;try{if(this.filterInitialized){for(var n=this.filteredrows.length;n--;)!0===t(this.collection.data[this.filteredrows[n]])&&r.push(this.filteredrows[n]);this.filteredrows=r}else{for(var i=this.collection.data.length;i--;)!0===t(this.collection.data[i])&&r.push(i);this.filteredrows=r,this.filterInitialized=!0}return this}catch(e){throw e}},b.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},b.prototype.data=function(e){var t,r,n,i=[],o=this.collection.data;if((e=e||{}).removeMeta&&!e.forceClones&&(e.forceClones=!0,e.forceCloneMethod=e.forceCloneMethod||"shallow"),!this.collection.disableDeltaChangesApi&&this.collection.disableFreeze&&(e.forceClones=!0,e.forceCloneMethod="parse-stringify"),!this.filterInitialized){if(0===this.filteredrows.length){if(this.collection.cloneObjects||e.forceClones){for(s=o.length,n=e.forceCloneMethod||this.collection.cloneMethod,r=0;r<s;r++)t=d(o[r],n),e.removeMeta&&(delete t.$loki,delete t.meta),i.push(t);return i}return o.slice()}this.filterInitialized=!0}var a=this.filteredrows,s=a.length;if(this.collection.cloneObjects||e.forceClones)for(n=e.forceCloneMethod||this.collection.cloneMethod,r=0;r<s;r++)t=d(o[a[r]],n),e.removeMeta&&(delete t.$loki,delete t.meta),i.push(t);else for(r=0;r<s;r++)i.push(o[a[r]]);return i},b.prototype.update=function(e){if("function"!=typeof e)throw new TypeError("Argument is not a function");this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());for(var t,r=this.filteredrows.length,n=this.collection.data,i=0;i<r;i++)this.disableFreeze&&!this.collection.cloneObjects&&this.collection.disableDeltaChangesApi?(e(n[this.filteredrows[i]]),this.collection.update(n[this.filteredrows[i]])):(e(t=d(n[this.filteredrows[i]],this.collection.cloneMethod)),this.collection.update(t));return this},b.prototype.remove=function(){return this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},b.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(e){throw e}},b.prototype.eqJoin=function(e,t,r,n,i){var o,a,s=[],u=[],c="function"==typeof t,l="function"==typeof r,f={},d=(a=this.data(i)).length;if(e instanceof O)s=e.chain().data(i);else if(e instanceof b)s=e.data(i);else{if(!Array.isArray(e))throw new TypeError("joinData needs to be an array or result set");s=e}for(var p=s.length,h=0;h<p;h++)f[o=l?r(s[h]):s[h][r]]=s[h];n=n||function(e,t){return{left:e,right:t}};for(var y=0;y<d;y++)o=c?t(a[y]):a[y][t],u.push(n(a[y],f[o]||{}));return this.collection=new O("joinData"),this.collection.insert(u),this.filteredrows=[],this.filterInitialized=!1,this},b.prototype.map=function(e,t){t=this.data(t).map(e);return this.collection=new O("mappedData"),this.collection.insert(t),this.filteredrows=[],this.filterInitialized=!1,this},((g.prototype=new u).constructor=g).prototype.getSort=function(){return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple},g.prototype.rematerialize=function(e){e=e||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new b(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0);var t,r,n,i=Object.isFrozen(this.filterPipeline);if(e.hasOwnProperty("removeWhereFilters"))for(i&&(this.filterPipeline=this.filterPipeline.slice()),r=t=this.filterPipeline.length;r--;)"where"===this.filterPipeline[r].type&&(r!==this.filterPipeline.length-1&&(this.filterPipeline[r]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var o=this.filterPipeline;for(this.filterPipeline=[],t=o.length,n=0;n<t;n++)this.applyFind(o[n].val,o[n].uid);return i&&Object.freeze(this.filterPipeline),this.data(),this.emit("rebuild",this),this},g.prototype.branchResultset=function(e,t){var r=this.resultset.branch();return void 0===e?r:r.transform(e,t)},g.prototype.toJSON=function(){var e=new g(this.collection,this.name,this.options);return e.resultset=this.resultset,e.resultdata=[],e.resultsdirty=!0,e.filterPipeline=this.filterPipeline,e.sortFunction=this.sortFunction,e.sortCriteria=this.sortCriteria,e.sortCriteriaSimple=this.sortCriteriaSimple||null,e.sortDirty=this.sortDirty,e.collection=null,e},g.prototype.removeFilters=function(e){e=e||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null;var t=Object.isFrozen(this.filterPipeline),r=0<this.filterPipeline.length;this.filterPipeline=[],t&&Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,!(this.sortDirty=!1)===e.queueSortPhase&&this.queueSortPhase(),r&&this.emit("filter")},g.prototype.applySort=function(e){return this.sortFunction=e,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this.emit("sort"),this},g.prototype.applySimpleSort=function(e,t){return this.sortCriteriaSimple={propname:e,options:t||!1},this.collection.disableFreeze||p(this.sortCriteriaSimple),this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},g.prototype.applySortCriteria=function(e){return this.sortCriteria=e,this.collection.disableFreeze||p(this.sortCriteria),this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},g.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},g.prototype.commit=function(){return this.cachedresultset=null,this},g.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},g.prototype._indexOfFilterWithId=function(e){if("string"==typeof e||"number"==typeof e)for(var t=0,r=this.filterPipeline.length;t<r;t+=1)if(e===this.filterPipeline[t].uid)return t;return-1},g.prototype._addFilter=function(e){var t=Object.isFrozen(this.filterPipeline);t&&(this.filterPipeline=this.filterPipeline.slice()),this.collection.disableFreeze||p(e),this.filterPipeline.push(e),t&&Object.freeze(this.filterPipeline),this.resultset[e.type](e.val)},g.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var e=this.filterPipeline,t=Object.isFrozen(e);this.filterPipeline=[];for(var r=0,n=e.length;r<n;r+=1)this._addFilter(e[r]);return t&&Object.freeze(this.filterPipeline),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},g.prototype.applyFilter=function(e){var t,r=this._indexOfFilterWithId(e.uid);return 0<=r?((t=Object.isFrozen(this.filterPipeline))&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline[r]=e,t&&(a(e),Object.freeze(this.filterPipeline)),this.reapplyFilters()):(this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(e),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this)},g.prototype.applyFind=function(e,t){return this.applyFilter({type:"find",val:e,uid:t}),this},g.prototype.applyWhere=function(e,t){return this.applyFilter({type:"where",val:e,uid:t}),this},g.prototype.removeFilter=function(e){var t=this._indexOfFilterWithId(e);if(t<0)throw new Error("Dynamic view does not contain a filter with ID: "+e);e=Object.isFrozen(this.filterPipeline);return e&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline.splice(t,1),e&&Object.freeze(this.filterPipeline),this.reapplyFilters(),this},g.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},g.prototype.data=function(e){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(e)},g.prototype.queueRebuildEvent=function(){var e;this.rebuildPending||(this.rebuildPending=!0,e=this,setTimeout(function(){e.rebuildPending&&(e.rebuildPending=!1,e.emit("rebuild",e))},this.options.minRebuildInterval))},g.prototype.queueSortPhase=function(){var e;this.sortDirty||(this.sortDirty=!0,"active"===(e=this).options.sortPriority?setTimeout(function(){e.performSortPhase()},this.options.minRebuildInterval):this.queueRebuildEvent())},g.prototype.performSortPhase=function(e){(this.sortDirty||this.resultsdirty)&&(e=e||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),e.suppressRebuildEvent||this.emit("rebuild",this))},g.prototype.evaluateDocument=function(e,t){if(this.resultset.filterInitialized){var r,n=this.resultset.filteredrows,t=t?-1:n.indexOf(+e),i=n.length,o=new b(this.collection);o.filteredrows=[e],o.filterInitialized=!0;for(var a=0,s=this.filterPipeline.length;a<s;a++)o[(r=this.filterPipeline[a]).type](r.val);var u=0===o.filteredrows.length?-1:0;-1===t&&-1==u||(-1===t&&-1!=u?(n.push(e),this.options.persistent&&this.resultdata.push(this.collection.data[e]),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent()):-1!==t&&-1==u?(t<i-1?(n.splice(t,1),this.options.persistent&&this.resultdata.splice(t,1)):(n.length=i-1,this.options.persistent&&(this.resultdata.length=i-1)),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent()):-1!==t&&-1!=u&&(this.options.persistent&&(this.resultdata[t]=this.collection.data[e]),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent()))}else this.options.persistent&&(this.resultdata=this.resultset.data()),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent()},g.prototype.removeDocument=function(e){var t,r,n,i={},o={},a=this.resultset,s=this.resultset.filteredrows,u=s.length;if(this.resultset.filterInitialized){for(r=(e=Array.isArray(e)?e:[e]).length,t=0;t<r;t++)i[e[t]]=!0;for(c=0;c<u;c++)i[s[c]]&&(o[c]=!0);0<Object.keys(o).length&&(this.resultset.filteredrows=this.resultset.filteredrows.filter(function(e,t){return!o[t]}),this.options.persistent&&(this.resultdata=this.resultdata.filter(function(e,t){return!o[t]})),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(var u=a.filteredrows.length,c=0;c<u;c++)n=e.filter(function(t){return function(e){return e<a.filteredrows[t]}}(c)),a.filteredrows[c]-=n.length}else this.options.persistent&&(this.resultdata=this.resultset.data()),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent()},g.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(e){throw e}},((O.prototype=new u).contructor=O).prototype.createChange=function(e,t,r,n){this.changes.push({name:e,operation:t,obj:"U"!=t||this.disableDeltaChangesApi?JSON.parse(JSON.stringify(r)):this.getChangeDelta(r,n)})},O.prototype.insertMeta=function(e){var t,r;if(!this.disableMeta&&e)if(Array.isArray(e))for(t=e.length,r=0;r<t;r++)e[r].hasOwnProperty("meta")||(e[r].meta={}),e[r].meta.created=(new Date).getTime(),e[r].meta.revision=0;else e.meta||(e.meta={}),e.meta.created=(new Date).getTime(),e.meta.revision=0},O.prototype.updateMeta=function(e){return!this.disableMeta&&e&&(this.disableFreeze||((e=s(e)).meta=s(e.meta)),e.meta.updated=(new Date).getTime(),e.meta.revision+=1),e},O.prototype.createInsertChange=function(e){this.createChange(this.name,"I",e)},O.prototype.createUpdateChange=function(e,t){this.createChange(this.name,"U",e,t)},O.prototype.insertMetaWithChange=function(e){this.insertMeta(e),this.createInsertChange(e)},O.prototype.updateMetaWithChange=function(e,t,r){return e=this.updateMeta(e,r),this.createUpdateChange(e,t),e},O.prototype.lokiConsoleWrapper={log:function(){},warn:function(){},error:function(){}},O.prototype.addAutoUpdateObserver=function(e){this.autoupdate&&"function"==typeof Object.observe&&Object.observe(e,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},O.prototype.removeAutoUpdateObserver=function(e){this.autoupdate&&"function"==typeof Object.observe&&Object.unobserve(e,this.observerCallback)},O.prototype.addTransform=function(e,t){if(this.transforms.hasOwnProperty(e))throw new Error("a transform by that name already exists");this.transforms[e]=t},O.prototype.getTransform=function(e){return this.transforms[e]},O.prototype.setTransform=function(e,t){this.transforms[e]=t},O.prototype.removeTransform=function(e){delete this.transforms[e]},O.prototype.byExample=function(e){var t,r,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(((r={})[t]=e[t],r));return{$and:n}},O.prototype.findObject=function(e){return this.findOne(this.byExample(e))},O.prototype.findObjects=function(e){return this.find(this.byExample(e))},O.prototype.ttlDaemonFuncGen=function(){var e=this,r=this.ttl.age;return function(){var t=Date.now();e.chain().where(function(e){e=e.meta.updated||e.meta.created;return r<t-e}).remove()}},O.prototype.setTTL=function(e,t){e<0?clearInterval(this.ttl.daemon):(this.ttl.age=e,this.ttl.ttlInterval=t,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),t))},O.prototype.prepareFullDocIndex=function(){for(var e=this.data.length,t=new Array(e),r=0;r<e;r+=1)t[r]=r;return t},O.prototype.configureOptions=function(e){(e=e||{}).hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=e.adaptiveBinaryIndices,this.adaptiveBinaryIndices)&&this.ensureAllIndexes()},O.prototype.ensureIndex=function(e,t){if(void 0===t&&(t=!1),null==e)throw new Error("Attempting to set index without an associated property");var r,n,i,o,a;this.binaryIndices[e]&&!t&&!this.binaryIndices[e].dirty||!0===this.adaptiveBinaryIndices&&this.binaryIndices.hasOwnProperty(e)&&!t||(t={name:e,dirty:!0,values:this.prepareFullDocIndex()},this.binaryIndices[e]=t,r=e,n=this.data,a=!!~r.indexOf(".")&&r.split("."),t.values.sort(function(e,t){if(o=a?(i=S.getIn(n[e],a,!0),S.getIn(n[t],a,!0)):(i=n[e][r],n[t][r]),i!==o){if(v.lt(i,o,!1))return-1;if(v.gt(i,o,!1))return 1}return 0}),t.dirty=!1,this.dirty=!0)},O.prototype.checkAllIndexes=function(e){var t,r=this.binaryIndices,n=[];for(t in r)!w.call(r,t)||this.checkIndex(t,e)||n.push(t);return n},O.prototype.checkIndex=function(e,t){(t=t||{}).randomSamplingFactor&&!1!==t.randomSampling&&(t.randomSampling=!0),t.randomSamplingFactor=t.randomSamplingFactor||.1,(t.randomSamplingFactor<0||1<t.randomSamplingFactor)&&(t.randomSamplingFactor=.1);var r,n,i,o,a,s=!0;if(!this.binaryIndices.hasOwnProperty(e))throw new Error("called checkIndex on property without an index: "+e);if(this.adaptiveBinaryIndices||this.ensureIndex(e),(o=(a=this.binaryIndices[e].values).length)!==this.data.length)return t.repair&&this.ensureIndex(e,!0),!1;if(0===o)return!0;var u=-1!==e.indexOf(".");if(1===o)s=0===a[0];else if(t.randomSampling){if(j.$lte(S.getIn(this.data[a[0]],e,u),S.getIn(this.data[a[1]],e,u))||(s=!1),s=j.$lte(S.getIn(this.data[a[o-2]],e,u),S.getIn(this.data[a[o-1]],e,u))?s:!1)for(n=Math.floor((o-1)*t.randomSamplingFactor),r=0;r<n-1;r++)if(i=Math.floor(Math.random()*(o-1)),!j.$lte(S.getIn(this.data[a[i]],e,u),S.getIn(this.data[a[i+1]],e,u))){s=!1;break}}else for(r=0;r<o-1;r++)if(!j.$lte(S.getIn(this.data[a[r]],e,u),S.getIn(this.data[a[r+1]],e,u))){s=!1;break}return!s&&t.repair&&this.ensureIndex(e,!0),s},O.prototype.getBinaryIndexValues=function(e){for(var t=this.binaryIndices[e].values,r=[],n=0;n<t.length;n++)r.push(S.getIn(this.data[t[n]],e,!0));return r},O.prototype.getUniqueIndex=function(e,t){var r=this.constraints.unique[e];return!r&&t?this.ensureUniqueIndex(e):r},O.prototype.ensureUniqueIndex=function(e){var t=this.constraints.unique[e];return t||-1==this.uniqueNames.indexOf(e)&&this.uniqueNames.push(e),this.constraints.unique[e]=t=new D(e),this.data.forEach(function(e){t.set(e)}),t},O.prototype.ensureAllIndexes=function(e){var t,r=this.binaryIndices;for(t in r)w.call(r,t)&&this.ensureIndex(t,e)},O.prototype.flagBinaryIndexesDirty=function(){var e,t=this.binaryIndices;for(e in t)w.call(t,e)&&(t[e].dirty=!0)},O.prototype.flagBinaryIndexDirty=function(e){this.binaryIndices[e]&&(this.binaryIndices[e].dirty=!0)},O.prototype.count=function(e){return(e?this.chain().find(e).filteredrows:this.data).length},O.prototype.ensureId=function(){if(!this.idIndex){for(var e=this.data,t=0,r=e.length,n=new Array(r);t<r;t++)n[t]=e[t].$loki;this.idIndex=n}},O.prototype.ensureIdAsync=function(e){this.async(function(){this.ensureId()},e)},O.prototype.addDynamicView=function(e,t){e=new g(this,e,t);return this.DynamicViews.push(e),e},O.prototype.removeDynamicView=function(t){this.DynamicViews=this.DynamicViews.filter(function(e){return e.name!==t})},O.prototype.getDynamicView=function(e){for(var t=0;t<this.DynamicViews.length;t++)if(this.DynamicViews[t].name===e)return this.DynamicViews[t];return null},O.prototype.findAndUpdate=function(e,t){"function"==typeof e?this.updateWhere(e,t):this.chain().find(e).update(t)},O.prototype.findAndRemove=function(e){this.chain().find(e).remove()},O.prototype.insert=function(e,t){if(!Array.isArray(e))return this.insertOne(e);var r,n=[],t=t&&!this.cloneObjects&&this.adaptiveBinaryIndices&&0<Object.keys(this.binaryIndices).length;t&&(this.adaptiveBinaryIndices=!1);try{this.emit("pre-insert",e);for(var i=0,o=e.length;i<o;i++){if(!(r=this.insertOne(e[i],!0)))return;n.push(r)}}finally{t&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}return this.emit("insert",n),1===(n=this.cloneObjects?d(n,this.cloneMethod):n).length?n[0]:n},O.prototype.insertOne=function(e,t){var r=null;if("object"!=typeof e?r=new TypeError("Document needs to be an object"):null===e&&(r=new TypeError("Object cannot be null")),null!==r)throw this.emit("error",r),r;r=this.cloneObjects?d(e,this.cloneMethod):e;if(this.disableFreeze||(r=s(r)),this.disableMeta||(void 0===r.meta?r.meta={revision:0,created:0}:this.disableFreeze||(r.meta=s(r.meta))),t||this.emit("pre-insert",r),this.add(r))return this.disableChangesApi?this.insertMeta(r):this.insertMetaWithChange(r),this.disableFreeze||p(r),e=this.cloneObjects?d(r,this.cloneMethod):r,t||this.emit("insert",e),this.addAutoUpdateObserver(e),e},O.prototype.clear=function(e){var t=this;e=e||{},this.data=[],this.idIndex=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,this.constraints={unique:{},exact:{}},!0===e.removeIndices?(this.binaryIndices={},this.uniqueNames=[]):Object.keys(this.binaryIndices).forEach(function(e){t.binaryIndices[e].dirty=!1,t.binaryIndices[e].values=[]})},O.prototype.update=function(e){var t,r,n;if(Array.isArray(e)){n=e.length,(t=!this.cloneObjects&&this.adaptiveBinaryIndices&&0<Object.keys(this.binaryIndices).length)&&(this.adaptiveBinaryIndices=!1);try{for(r=0;r<n;r+=1)this.update(e[r])}finally{t&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}}else{if(!w.call(e,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var i,o,a,s=this.get(e.$loki,!0),u=this;if(!s)throw new Error("Trying to update a document not in collection.");i=s[0],a=s[1],o=this.cloneObjects||!this.disableDeltaChangesApi&&this.disableFreeze?d(e,this.cloneMethod):e,this.emit("pre-update",e),this.uniqueNames.forEach(function(e){u.getUniqueIndex(e,!0).update(i,o)}),(this.data[a]=o)!==e&&this.addAutoUpdateObserver(e);for(var c,l,f=0;f<this.DynamicViews.length;f++)this.DynamicViews[f].evaluateDocument(a,!1);if(this.adaptiveBinaryIndices)for(c in this.binaryIndices)this.adaptiveBinaryIndexUpdate(a,c);else this.flagBinaryIndexesDirty();return this.idIndex[a]=o.$loki,this.isIncremental&&this.dirtyIds.push(o.$loki),this.commit(),this.dirty=!0,o=this.disableChangesApi?this.updateMeta(o):this.updateMetaWithChange(o,i),this.disableFreeze||p(o),l=this.cloneObjects?d(o,this.cloneMethod):o,this.emit("update",l,i),l}catch(e){throw this.rollback(),this.lokiConsoleWrapper.error(e.message),this.emit("error",e),e}}},O.prototype.add=function(e){if("object"!=typeof e)throw new TypeError("Object being added needs to be an object");if(void 0!==e.$loki)throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1);var t=this.maxId;e.$loki=t,this.disableMeta||(e.meta.version=0);for(var r=0,n=this.uniqueNames.length;r<n;r++)this.getUniqueIndex(this.uniqueNames[r],!0).set(e);this.idIndex&&this.idIndex.push(t),this.isIncremental&&this.dirtyIds.push(t),this.data.push(e);for(var i,o=this.data.length-1,a=this.DynamicViews.length,r=0;r<a;r++)this.DynamicViews[r].evaluateDocument(o,!0);if(this.adaptiveBinaryIndices)for(i in this.binaryIndices)this.adaptiveBinaryIndexInsert(o,i);else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?d(e,this.cloneMethod):e}catch(e){throw this.rollback(),this.lokiConsoleWrapper.error(e.message),this.emit("error",e),e}},O.prototype.updateWhere=function(e,t){var r,n=this.where(e),i=0;try{for(;i<n.length;i++)r=t(n[i]),this.update(r)}catch(e){this.rollback(),this.lokiConsoleWrapper.error(e.message)}},O.prototype.removeWhere=function(e){var t;"function"==typeof e?(t=this.data.filter(e),this.remove(t)):this.chain().find(e).remove()},O.prototype.removeDataOnly=function(){this.remove(this.data.slice())},O.prototype.removeBatchByPositions=function(r){var e,t,n,i,o,a=r.length,s={},u=Object.keys(this.binaryIndices).length,c=Object.keys(this.constraints.unique).length,l=this.adaptiveBinaryIndices&&0<Object.keys(this.binaryIndices).length,f=this;try{for(this.startTransaction(),this.ensureId(),n=0;n<a;n++)s[this.idIndex[r[n]]]=!0;if(0<(e=this.DynamicViews.length)||0<u||0<c){if(0<e)for(t=0;t<e;t++)this.DynamicViews[t].removeDocument(r);if(this.adaptiveBinaryIndices&&!l)for(o in this.binaryIndices)this.adaptiveBinaryIndexRemove(r,o);else this.flagBinaryIndexesDirty();c&&this.uniqueNames.forEach(function(e){var t=f.getUniqueIndex(e);if(t)for(n=0;n<a;n++)null!==(i=f.data[r[n]])[e]&&void 0!==i[e]&&t.remove(i[e])})}if(!this.disableChangesApi||1<this.events.delete.length)for(n=0;n<a;n++)this.emit("delete",this.data[r[n]]);if(this.data=this.data.filter(function(e){return!s[e.$loki]}),this.isIncremental)for(n=0;n<a;n++)this.dirtyIds.push(this.idIndex[r[n]]);this.idIndex=this.idIndex.filter(function(e){return!s[e]}),this.adaptiveBinaryIndices&&l&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(e){return this.rollback(),l&&(this.adaptiveBinaryIndices=!0),this.lokiConsoleWrapper.error(e.message),this.emit("error",e),null}},O.prototype.removeBatch=function(e){for(var t=e.length,r=this.data.length,n={},i=[],o=0;o<r;o++)n[this.data[o].$loki]=o;for(o=0;o<t;o++)"object"==typeof e[o]?i.push(n[e[o].$loki]):i.push(n[e[o]]);this.removeBatchByPositions(i)},O.prototype.remove=function(r){if("object"!=typeof(r="number"==typeof r?this.get(r):r))throw new Error("Parameter is not an object");if(Array.isArray(r))this.removeBatch(r);else{if(!w.call(r,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var e=this.get(r.$loki,!0),t=e[1],n=this;this.uniqueNames.forEach(function(e){var t;null!==r[e]&&void 0!==r[e]&&(t=n.getUniqueIndex(e))&&t.remove(r[e])});for(var i,o=0;o<this.DynamicViews.length;o++)this.DynamicViews[o].removeDocument(t);if(this.adaptiveBinaryIndices)for(i in this.binaryIndices)this.adaptiveBinaryIndexRemove(t,i);else this.flagBinaryIndexesDirty();return this.data.splice(t,1),this.removeAutoUpdateObserver(r),this.idIndex.splice(t,1),this.isIncremental&&this.dirtyIds.push(r.$loki),this.commit(),this.dirty=!0,this.emit("delete",e[0]),delete(r=this.disableFreeze?r:s(r)).$loki,delete r.meta,this.disableFreeze||a(r),r}catch(e){return this.rollback(),this.lokiConsoleWrapper.error(e.message),this.emit("error",e),null}}},O.prototype.get=function(e,t){this.idIndex||this.ensureId();var r,t=t||!1,n=this.idIndex,i=n.length-1,o=0;if(e="number"==typeof e?e:parseInt(e,10),isNaN(e))throw new TypeError("Passed id is not an integer");for(;n[o]<n[i];)n[r=o+i>>1]<e?o=1+r:i=r;return i===o&&n[o]===e?t?[this.data[o],o]:this.data[o]:null},O.prototype.getBinaryIndexPosition=function(e,t){var r=S.getIn(this.data[e],t,!0),n=this.binaryIndices[t].values,t=this.calculateRange("$eq",t,r);if(0!==t[0]||-1!==t[1])for(var r=t[0],i=t[1],o=r;o<=i;o++)if(n[o]===e)return o;return null},O.prototype.adaptiveBinaryIndexInsert=function(e,t){var r=-1!==t.indexOf("."),n=this.binaryIndices[t].values,i=S.getIn(this.data[e],t,r),n=(!0===this.serializableIndices&&i instanceof Date&&(this.data[e][t]=i.getTime(),i=S.getIn(this.data[e],t)),0===n.length?0:this.calculateRangeStart(t,i,!0,r));this.binaryIndices[t].values.splice(n,0,e)},O.prototype.adaptiveBinaryIndexUpdate=function(e,t){for(var r=this.binaryIndices[t].values,n=r.length,i=0;i<n&&r[i]!==e;i++);this.binaryIndices[t].values.splice(i,1),this.adaptiveBinaryIndexInsert(e,t)},O.prototype.adaptiveBinaryIndexRemove=function(e,t,r){var n,i,o,a,s,u,c=this.binaryIndices[t],l={};if(Array.isArray(e)){if(1!==(a=e.length)){for(o=0;o<a;o++)l[e[o]]=!0;if(c.values=c.values.filter(function(e){return!l[e]}),!0===r)return;var f=e.slice();for(f.sort(function(e,t){return e-t}),n=c.values.length,i=0;i<n;i++){for(s=c.values[i],o=u=0;o<a&&s>f[o];o++)u++;c.values[i]-=u}return}e=e[0]}if(null===(t=this.getBinaryIndexPosition(e,t)))return null;if(c.values.splice(t,1),!0!==r)for(n=c.values.length,i=0;i<n;i++)c.values[i]>e&&c.values[i]--},O.prototype.calculateRangeStart=function(e,t,r,n){var i,o=this.data,a=this.binaryIndices[e].values,s=0,u=a.length-1;if(0===a.length)return-1;for(S.getIn(o[a[s]],e,n),S.getIn(o[a[u]],e,n);s<u;)v.lt(S.getIn(o[a[i=s+u>>1]],e,n),t,!1)?s=1+i:u=i;var c=s;return v.aeq(t,S.getIn(o[a[c]],e,n))?c:v.lt(t,S.getIn(o[a[c]],e,n),!1)?r?c:c-1:r?c+1:c},O.prototype.calculateRangeEnd=function(e,t,r){var n,i=this.data,o=this.binaryIndices[e].values,a=0,s=o.length-1;if(0===o.length)return-1;for(S.getIn(i[o[a]],e,r),S.getIn(i[o[s]],e,r);a<s;)v.lt(t,S.getIn(i[o[n=a+s>>1]],e,r),!1)?s=n:a=1+n;var u=s;return v.aeq(t,S.getIn(i[o[u]],e,r))?u:v.gt(t,S.getIn(i[o[u]],e,r),!1)?u+1:v.aeq(t,S.getIn(i[o[u-1]],e,r))?u-1:u},O.prototype.calculateRange=function(e,t,r){var n,i,o,a=this.data,s=this.binaryIndices[t].values,u=s.length-1;if(0===a.length)return[0,-1];var c=-1!==t.indexOf("."),l=S.getIn(a[s[0]],t,c),f=S.getIn(a[s[u]],t,c);switch(e){case"$eq":case"$aeq":case"$dteq":if(v.lt(r,l,!1)||v.gt(r,f,!1))return[0,-1];break;case"$gt":if(v.gt(r,f,!0))return[0,-1];if(v.gt(l,r,!1))return[0,u];break;case"$gte":if(v.gt(r,f,!1))return[0,-1];if(v.gt(l,r,!0))return[0,u];break;case"$lt":if(v.lt(r,l,!0))return[0,-1];if(v.lt(f,r,!1))return[0,u];break;case"$lte":if(v.lt(r,l,!1))return[0,-1];if(v.lt(f,r,!0))return[0,u];break;case"$between":return v.gt(r[0],f,!1)?[0,-1]:v.lt(r[1],l,!1)||((n=this.calculateRangeStart(t,r[0],!1,c))<0&&n++,u<(o=this.calculateRangeEnd(t,r[1],c))&&o--,v.gt(S.getIn(a[s[n]],t,c),r[0],!0)||n++,v.lt(S.getIn(a[s[o]],t,c),r[1],!0)||o--,o<n)?[0,-1]:[n,o];case"$in":for(var d=[],p=[],h=0,y=r.length;h<y;h++)for(var m=this.calculateRange("$eq",t,r[h]),b=m[0];b<=m[1];b++)void 0===d[b]&&(d[b]=!0,p.push(b));return p}switch(e){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":n=this.calculateRangeStart(t,r,!1,c),i=S.getIn(a[s[n]],t,c)}switch(e){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":o=this.calculateRangeEnd(t,r,c),S.getIn(a[s[o]],t,c)}switch(e){case"$eq":case"$aeq":case"$dteq":return v.aeq(i,r)?[n,o]:[0,-1];case"$gt":return v.aeq(S.getIn(a[s[o]],t,c),r)?[o+1,u]:[o,u];case"$gte":return v.aeq(S.getIn(a[s[n]],t,c),r)?[n,u]:[n+1,u];case"$lt":return v.aeq(S.getIn(a[s[n]],t,c),r)?[0,n-1]:[0,n];case"$lte":return v.aeq(S.getIn(a[s[o]],t,c),r)?[0,o]:[0,o-1];default:return[0,a.length-1]}},O.prototype.by=function(t,e){var r;return void 0===e?(r=this,function(e){return r.by(t,e)}):(e=this.getUniqueIndex(t,!0).get(e),this.cloneObjects?d(e,this.cloneMethod):e)},O.prototype.findOne=function(e){e=e||{};e=this.chain().find(e,!0).data();return Array.isArray(e)&&0===e.length?null:this.cloneObjects?d(e[0],this.cloneMethod):e[0]},O.prototype.chain=function(e,t){var r=new b(this);return void 0===e?r:r.transform(e,t)},O.prototype.find=function(e){return this.chain().find(e).data()},O.prototype.findOneUnindexed=function(e,t){for(var r=this.data.length;r--;)if(S.getIn(this.data[r],e,!0)===t)return this.data[r];return null},O.prototype.startTransaction=function(){if(this.transactional){this.cachedData=d(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices,this.cachedDirtyIds=this.dirtyIds;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].startTransaction()}},O.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedDirtyIds=null;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].commit()}},O.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex,this.dirtyIds=this.cachedDirtyIds);for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].rollback()}},O.prototype.async=function(e,t){setTimeout(function(){if("function"!=typeof e)throw new TypeError("Argument passed for async execution is not a function");e(),t()},0)},O.prototype.where=function(e){return this.chain().where(e).data()},O.prototype.mapReduce=function(e,t){try{return t(this.data.map(e))}catch(e){throw e}},O.prototype.eqJoin=function(e,t,r,n,i){return new b(this).eqJoin(e,t,r,n,i)},O.prototype.stages={},O.prototype.getStage=function(e){return this.stages[e]||(this.stages[e]={}),this.stages[e]},O.prototype.commitLog=[],O.prototype.stage=function(e,t){var r=JSON.parse(JSON.stringify(t));return this.getStage(e)[t.$loki]=r},O.prototype.commitStage=function(e,t){var r,n=this.getStage(e),i=(new Date).getTime();for(r in n)this.update(n[r]),this.commitLog.push({timestamp:i,message:t,data:JSON.parse(JSON.stringify(n[r]))});this.stages[e]={}},O.prototype.no_op=function(){},O.prototype.extract=function(e){for(var t=0,r=this.data.length,n=_(e),i=[];t<r;t+=1)i.push(I(this.data[t],e,n));return i},O.prototype.max=function(e){return Math.max.apply(null,this.extract(e))},O.prototype.min=function(e){return Math.min.apply(null,this.extract(e))},O.prototype.maxRecord=function(e){for(var t,r=0,n=this.data.length,i=_(e),o={index:0,value:void 0};r<n;r+=1)(void 0===t||t<I(this.data[r],e,i))&&(t=I(this.data[r],e,i),o.index=this.data[r].$loki);return o.value=t,o},O.prototype.minRecord=function(e){for(var t,r=0,n=this.data.length,i=_(e),o={index:0,value:void 0};r<n;r+=1)(void 0===t||t>I(this.data[r],e,i))&&(t=I(this.data[r],e,i),o.index=this.data[r].$loki);return o.value=t,o},O.prototype.extractNumerical=function(e){return this.extract(e).map(E).filter(Number).filter(function(e){return!isNaN(e)})},O.prototype.avg=function(e){return A(this.extractNumerical(e))},O.prototype.stdDev=function(e){return e=this.extractNumerical(e),t=A(e),e=A(e.map(function(e){e-=t;return e*e})),Math.sqrt(e);var t},O.prototype.mode=function(e){var t,r,n,i={};for(r in this.extract(e).forEach(function(e){i[e]?i[e]+=1:i[e]=1}),i)t?t<i[r]&&(n=r):t=i[n=r];return n},O.prototype.median=function(e){var e=this.extractNumerical(e),t=(e.sort(T),Math.floor(e.length/2));return e.length%2?e[t]:(e[t-1]+e[t])/2},R.prototype={keys:[],values:[],sort:function(e,t){return e<t?-1:t<e?1:0},setSort:function(e){this.bs=new C(e)},bs:function(){return new C(this.sort)},set:function(e,t){var r=this.bs(this.keys,e);r.found?this.values[r.index]=t:(this.keys.splice(r.index,0,e),this.values.splice(r.index,0,t))},get:function(e){return this.values[k(this.keys,e,this.sort).index]}},D.prototype.keyMap={},D.prototype.lokiMap={},D.prototype.set=function(e){var t=e[this.field];if(null!=t){if(this.keyMap[t])throw new Error("Duplicate key for property "+this.field+": "+t);this.keyMap[t]=e,this.lokiMap[e.$loki]=t}},D.prototype.get=function(e){return this.keyMap[e]},D.prototype.byId=function(e){return this.keyMap[this.lokiMap[e]]},D.prototype.update=function(e,t){var r;this.lokiMap[e.$loki]!==t[this.field]?(r=this.lokiMap[e.$loki],this.set(t),this.keyMap[r]=void 0):this.keyMap[e[this.field]]=t},D.prototype.remove=function(e){var t=this.keyMap[e];if(null==t)throw new Error("Key is not in unique index: "+this.field);this.keyMap[e]=void 0,this.lokiMap[t.$loki]=void 0},D.prototype.clear=function(){this.keyMap=Object.create(null),this.lokiMap=Object.create(null)},N.prototype={set:function(e,t){this.index[e]?this.index[e].push(t):this.index[e]=[t]},remove:function(e,t){var r,n=this.index[e];for(r in n)n[r]==t&&n.splice(r,1);n.length<1&&(this.index[e]=void 0)},get:function(e){return this.index[e]},clear:function(e){this.index={}}},c.deepFreeze=p,c.freeze=a,c.unFreeze=s,c.LokiOps=j,c.Collection=O,c.DynamicView=g,c.Resultset=b,c.KeyValueStore=R,c.LokiMemoryAdapter=l,c.LokiPartitioningAdapter=f,c.LokiLocalStorageAdapter=m,c.LokiFsAdapter=y,c.persistenceAdapters={fs:y,localStorage:m},c.aeq=e,c.lt=t,c.gt=r,c.Comparators=v,c},"function"==typeof define&&define.amd?define([],t):"object"==typeof n?r.exports=t():e.loki=t()}.call(this)}.call(this,L("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./loki-indexed-adapter.js":66,_process:651,fs:647}],68:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Aggregator=void 0;const s=e("./core"),u=e("./lazy"),c=e("./util");r.Aggregator=class{constructor(e,t){this.pipeline=e,this.options=(0,s.initOptions)(t)}stream(e){let t=(0,u.Lazy)(e);var e=this.options.processingMode,r=(e!=s.ProcessingMode.CLONE_ALL&&e!=s.ProcessingMode.CLONE_INPUT||t.map(c.cloneDeep),new Array);if(!(0,c.isEmpty)(this.pipeline))for(const a of this.pipeline){var n=Object.keys(a),i=n[0],o=(0,s.getOperator)(s.OperatorType.PIPELINE,i,this.options);(0,c.assert)(1===n.length&&!!o,"invalid pipeline operator "+i),r.push(i),t=o(t,a[i],this.options)}return(e==s.ProcessingMode.CLONE_OUTPUT||e==s.ProcessingMode.CLONE_ALL&&(0,c.intersection)([["$group","$unwind"],r]).length)&&t.map(c.cloneDeep),t}run(e){return this.stream(e).value()}}},{"./core":69,"./lazy":71,"./util":307}],69:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.redact=r.computeValue=r.getOperator=r.useOperators=r.Context=r.OperatorType=r.initOptions=r.ComputeOptions=r.ProcessingMode=void 0;const c=e("./util");var n,l;(e=n=r.ProcessingMode||(r.ProcessingMode={})).CLONE_ALL="CLONE_ALL",e.CLONE_INPUT="CLONE_INPUT",e.CLONE_OUTPUT="CLONE_OUTPUT",e.CLONE_OFF="CLONE_OFF";class f{constructor(e,t,r,n=Date.now()){this._opts=e,this._root=t,this._local=r,this.timestamp=n,this.update(t,r)}static init(e,t,r){return e instanceof f?new f(e._opts,(0,c.isNil)(e.root)?t:e.root,Object.assign({},e.local,r)):new f(e,t,r)}update(e,t){return this._root=e,this._local=t&&Object.assign({},t,{variables:Object.assign({},null==(e=this._local)?void 0:e.variables,null==t?void 0:t.variables)}),this}getOptions(){return Object.freeze(Object.assign(Object.assign({},this._opts),{context:i.from(this._opts.context)}))}get root(){return this._root}get local(){return this._local}get idKey(){return this._opts.idKey}get collation(){var e;return null==(e=this._opts)?void 0:e.collation}get processingMode(){var e;return(null==(e=this._opts)?void 0:e.processingMode)||n.CLONE_OFF}get useStrictMode(){var e;return null==(e=this._opts)?void 0:e.useStrictMode}get scriptEnabled(){var e;return null==(e=this._opts)?void 0:e.scriptEnabled}get useGlobalContext(){var e;return null==(e=this._opts)?void 0:e.useGlobalContext}get hashFunction(){var e;return null==(e=this._opts)?void 0:e.hashFunction}get collectionResolver(){var e;return null==(e=this._opts)?void 0:e.collectionResolver}get jsonSchemaValidator(){var e;return null==(e=this._opts)?void 0:e.jsonSchemaValidator}get variables(){var e;return null==(e=this._opts)?void 0:e.variables}get context(){var e;return null==(e=this._opts)?void 0:e.context}}r.ComputeOptions=f,r.initOptions=function(e){return e instanceof f?e.getOptions():Object.freeze(Object.assign(Object.assign({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:n.CLONE_OFF},e),{context:null!=e&&e.context?i.from(null==e?void 0:e.context):i.init({})}))},(e=l=r.OperatorType||(r.OperatorType={})).ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query",e.WINDOW="window";class i{constructor(e){this.operators=(0,c.cloneDeep)(e)}static init(e){return new i((0,c.merge)({[l.ACCUMULATOR]:{},[l.EXPRESSION]:{},[l.PIPELINE]:{},[l.PROJECTION]:{},[l.QUERY]:{},[l.WINDOW]:{}},e,{skipValidation:!0}))}static from(e){return new i(e.operators)}addOperators(e,t){for(var[r,n]of Object.entries(t))this.getOperator(e,r)||(this.operators[e][r]=n);return this}addAccumulatorOps(e){return this.addOperators(l.ACCUMULATOR,e)}addExpressionOps(e){return this.addOperators(l.EXPRESSION,e)}addQueryOps(e){return this.addOperators(l.QUERY,e)}addPipelineOps(e){return this.addOperators(l.PIPELINE,e)}addProjectionOps(e){return this.addOperators(l.PROJECTION,e)}addWindowOps(e){return this.addOperators(l.WINDOW,e)}getOperator(e,t){return e in this.operators&&this.operators[e][t]||null}}const o=(r.Context=i).init({});function d(e,t,r){var{context:r,useGlobalContext:n}=r||{},r=r?r.getOperator(e,t):null;return!r&&n?o.getOperator(e,t):r}r.useOperators=function(e,t){for(var[r,n]of Object.entries(t)){(0,c.assert)((0,c.isFunction)(n)&&(0,c.isOperator)(r),`'${r}' is not a valid operator`);var i=d(e,r,null);(0,c.assert)(!i||n===i,r+` already exists for '${e}' operators. Cannot change operator function once registered.`)}o.addOperators(e,t)},r.getOperator=d;const p={$$ROOT(e,t,r){return r.root},$$CURRENT(e,t,r){return e},$$REMOVE(e,t,r){},$$NOW(e,t,r){return new Date(r.timestamp)}},h={$$KEEP(e,t,r){return e},$$PRUNE(e,t,r){},$$DESCEND(t,r,n){if((0,c.has)(r,"$cond")){let e;for(var[i,o]of Object.entries(t))if((0,c.isObjectLike)(o)){if(o instanceof Array){var a,s=[];for(a of o)(0,c.isObject)(a)&&(a=u(a,r,n.update(a))),(0,c.isNil)(a)||s.push(a);e=s}else e=u(o,r,n.update(o));(0,c.isNil)(e)?delete t[i]:t[i]=e}}return t}};function y(t,r,n,i){const o=f.init(i,t);if(n=n||"",(0,c.isOperator)(n)){var a=d(l.EXPRESSION,n,i);if(a)return a(t,r,o);a=d(l.ACCUMULATOR,n,i);if(a)return t instanceof Array||(t=y(t,r,null,o),r=null),(0,c.assert)(t instanceof Array,`'${n}' target must be an array.`),a(t,r,o.update(null,o.local));throw new Error(`operator '${n}' is not registered`)}if((0,c.isString)(r)&&0<r.length&&"$"===r[0]){if((0,c.has)(h,r))return r;let e=o.root;a=r.split(".");return""===(r=(0,c.has)(p,a[0])?(e=p[a[0]](t,null,o),r.slice(a[0].length+1)):"$$"===a[0].slice(0,2)?(e=Object.assign({},o.variables,{this:t},null==(n=o.local)?void 0:n.variables),n=a[0].slice(2),(0,c.assert)((0,c.has)(e,n),"Use of undefined variable: "+n),r.slice(2)):r.slice(1))?e:(0,c.resolve)(e,r)}if((0,c.isArray)(r))return r.map(e=>y(t,e,null,o));if((0,c.isObject)(r)){var e={};for(const[s,u]of Object.entries(r))if(e[s]=y(t,u,s,o),[l.EXPRESSION,l.ACCUMULATOR].some(e=>!!d(e,s,i)))return(0,c.assert)(1===Object.keys(r).length,"Invalid aggregation expression '"+JSON.stringify(r)+"'"),e[s];return e}return r}function u(e,t,r){var n=y(e,t,null,r);return(0,c.has)(h,n)?h[n](e,t,r):n}r.computeValue=y,r.redact=u},{"./util":307}],70:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Cursor=void 0;const n=e("./aggregator"),i=e("./lazy"),o=e("./util");class a{constructor(e,t,r,n){this.source=e,this.predicate=t,this.projection=r,this.options=n,this.operators=[],this.result=null,this.buffer=[]}fetch(){return this.result||((0,o.isObject)(this.projection)&&this.operators.push({$project:this.projection}),this.result=(0,i.Lazy)(this.source).filter(this.predicate),0<this.operators.length&&(this.result=new n.Aggregator(this.operators,this.options).stream(this.result))),this.result}fetchAll(){var e=(0,i.Lazy)([...this.buffer]);return this.buffer=[],(0,i.compose)(e,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(e){return this.operators.push({$skip:e}),this}limit(e){return this.operators.push({$limit:e}),this}sort(e){return this.operators.push({$sort:e}),this}collation(e){return this.options=Object.assign(Object.assign({},this.options),{collation:e}),this}next(){var e;return 0<this.buffer.length?this.buffer.pop():(e=this.fetch().next()).done?void 0:e.value}hasNext(){if(!(0<this.buffer.length)){var e=this.fetch().next();if(e.done)return!1;this.buffer.push(e.value)}return!0}map(e){return this.all().map(e)}forEach(e){this.all().forEach(e)}[Symbol.iterator](){return this.fetchAll()}}r.Cursor=a},{"./aggregator":68,"./lazy":71,"./util":307}],71:[function(e,t,r){"use strict";function n(e){return e instanceof o?e:new o(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.Iterator=r.compose=r.Lazy=void 0,r.Lazy=n,r.compose=function(...t){let r=0;return n(()=>{for(;r<t.length;){var e=t[r].next();if(!e.done)return e;r++}return{done:!0}})};const y=new Error;var m,i;function a(c,l,f){let d=!1,p=-1,h=0;return function(n){try{e:for(;!d;){let e=c(),t=(p++,-1);var i=l.length;let r=!1;for(;++t<i;){var o=l[t];switch(o.action){case m.MAP:e=o.func(e,p);break;case m.FILTER:if(o.func(e,p))break;continue e;case m.TAKE:--o.count,o.count||(r=!0);break;case m.DROP:--o.count,o.count||(a=l,s=t,u=void 0,u=a.slice(s+1),a.splice(s),Array.prototype.push.apply(a,u));continue e;default:break e}}if(d=r,!n)return{value:e,done:!1};f[h++]=e}}catch(e){if(e!==y)throw e}var a,s,u;return{done:d=!0}}}(i=m=m||{})[i.MAP=0]="MAP",i[i.FILTER=1]="FILTER",i[i.TAKE=2]="TAKE",i[i.DROP=3]="DROP";class o{constructor(t){this.iteratees=[],this.yieldedValues=[],this.isDone=!1;let r;if(t instanceof Function&&(t={next:t}),(e=t)&&"object"==typeof e&&(null==e?void 0:e.next)instanceof Function){const n=t;r=()=>{var e=n.next();if(e.done)throw y;return e.value}}else if(t instanceof Array){const i=t,o=i.length;let e=0;r=()=>{if(e<o)return i[e++];throw y}}else if(!(t instanceof Function))throw new Error(`Source is of type '${typeof t}'. Must be Array, Function, or Generator`);var e;this.getNext=a(r,this.iteratees,this.yieldedValues)}push(e,t){return"function"==typeof t?this.iteratees.push({action:e,func:t}):"number"==typeof t&&this.iteratees.push({action:e,count:t}),this}next(){return this.getNext()}map(e){return this.push(m.MAP,e)}filter(e){return this.push(m.FILTER,e)}take(e){return 0<e?this.push(m.TAKE,e):this}drop(e){return 0<e?this.push(m.DROP,e):this}transform(e){const t=this;let r;return n(()=>(r=r||n(e(t.value()))).next())}value(){return this.isDone||(this.isDone=this.getNext(!0).done),this.yieldedValues}each(e){for(;;){var t=this.next();if(t.done)break;if(!1===e(t.value))return!1}return!0}reduce(e,t){let r=this.next();for(void 0!==t||r.done||(t=r.value,r=this.next());!r.done;)t=e(t,r.value),r=this.next();return t}size(){return this.reduce((e,t)=>++e,0)}[Symbol.iterator](){return this}}r.Iterator=o},{}],72:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$type=r.$elemMatch=r.$size=r.$all=r.$exists=r.$regex=r.$mod=r.$gte=r.$gt=r.$lte=r.$lt=r.$nin=r.$in=r.$ne=r.$eq=r.createExpressionOperator=r.createQueryOperator=void 0;const i=e("../core"),a=e("../query"),s=e("../util");function n(e,t,r){return!!(0,s.isEqual)(e,t)||!(!(0,s.isNil)(e)||!(0,s.isNil)(t))||e instanceof Array&&(t=s.isEqual.bind(null,t),e.some(t)||(0,s.flatten)(e,null==r?void 0:r.depth).some(t))}function o(e,t,r){return(0,s.isNil)(e)?t.some(e=>null===e):0<(0,s.intersection)([(0,s.ensureArray)(e),t],null==r?void 0:r.hashFunction).length}function u(e){return(0,s.isOperator)(e)&&-1===["$and","$or","$nor"].indexOf(e)}function c(n,t,i){if((0,s.isArray)(n)&&!(0,s.isEmpty)(n)){let r=e=>e,e=t;Object.keys(t).every(u)&&(e={temp:t},r=e=>({temp:e}));var o=new a.Query(e,i);for(let e=0,t=n.length;e<t;e++)if(o.test(r(n[e])))return!0}return!1}r.createQueryOperator=function(a){var e=(t,r,n)=>{const i={unwrapArray:!0},o=Math.max(1,t.split(".").length-1);return e=>{e=(0,s.resolve)(e,t,i);return a(e,r,Object.assign(Object.assign({},n),{depth:o}))}};return e.op="query",e},r.createExpressionOperator=function(n){return(e,t,r)=>{e=(0,i.computeValue)(e,t,null,r);return n(...e)}},r.$eq=n,r.$ne=function(e,t,r){return!n(e,t,r)},r.$in=o,r.$nin=function(e,t,r){return!o(e,t,r)},r.$lt=function(e,t,r){return h(e,t,(e,t)=>(0,s.compare)(e,t)<0)},r.$lte=function(e,t,r){return h(e,t,(e,t)=>(0,s.compare)(e,t)<=0)},r.$gt=function(e,t,r){return h(e,t,(e,t)=>0<(0,s.compare)(e,t))},r.$gte=function(e,t,r){return h(e,t,(e,t)=>0<=(0,s.compare)(e,t))},r.$mod=function(e,t,r){return(0,s.ensureArray)(e).some(e=>2===t.length&&e%t[0]===t[1])},r.$regex=function(e,t,r){var e=(0,s.ensureArray)(e),n=e=>(0,s.isString)(e)&&(0,s.truthy)(t.exec(e),null==r?void 0:r.useStrictMode);return e.some(n)||(0,s.flatten)(e,1).some(n)},r.$exists=function(e,t,r){return(!1===t||0===t)&&void 0===e||(!0===t||1===t)&&void 0!==e},r.$all=function(e,t,r){if(!((0,s.isArray)(e)&&(0,s.isArray)(t)&&e.length&&t.length))return!1;let n=!0;for(const i of t){if(!n)break;n=(0,s.isObject)(i)&&(0,s.inArray)(Object.keys(i),"$elemMatch")?c(e,i.$elemMatch,r):i instanceof RegExp?e.some(e=>"string"==typeof e&&i.test(e)):e.some(e=>(0,s.isEqual)(i,e))}return n},r.$size=function(e,t,r){return Array.isArray(e)&&e.length===t},r.$elemMatch=c;var e=e=>null===e,l=e=>(0,s.isNumber)(e)&&e>=s.MIN_INT&&e<=s.MAX_INT&&-1===e.toString().indexOf("."),f=e=>(0,s.isNumber)(e)&&e>=s.MIN_LONG&&e<=s.MAX_LONG&&-1===e.toString().indexOf(".");const d={array:s.isArray,bool:s.isBoolean,boolean:s.isBoolean,date:s.isDate,decimal:s.isNumber,double:s.isNumber,int:l,long:f,number:s.isNumber,null:e,object:s.isObject,regex:s.isRegExp,regexp:s.isRegExp,string:s.isString,undefined:s.isNil,function:e=>{throw new Error("unsupported type key `function`.")},1:s.isNumber,2:s.isString,3:s.isObject,4:s.isArray,6:s.isNil,8:s.isBoolean,9:s.isDate,10:e,11:s.isRegExp,16:l,18:f,19:s.isNumber};function p(e,t){t=d[t];return!!t&&t(e)}function h(e,t,r){return(0,s.ensureArray)(e).some(e=>(0,s.getType)(e)===(0,s.getType)(t)&&r(e,t))}r.$type=function(t,e,r){return Array.isArray(e)?0<=e.findIndex(e=>p(t,e)):p(t,e)}},{"../core":69,"../query":306,"../util":307}],73:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.covariance=r.stddev=void 0,r.stddev=function(e,t=!0){var r=e.reduce((e,t)=>e+t,0),n=e.length||1;const i=r/n;return Math.sqrt(e.reduce((e,t)=>e+Math.pow(t-i,2),0)/(n-Number(t)))},r.covariance=function(e,t=!0){if(!e)return null;if(e.length<2)return t?null:0;let r=0,n=0;for(var[i,o]of e)r+=i,n+=o;r/=e.length,n/=e.length;let a=0;for(var[s,u]of e)a+=(s-r)*(u-n);return a/(e.length-Number(t))}},{}],74:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$accumulator=void 0;const s=e("../../core"),u=e("../../util");r.$accumulator=(e,t,r)=>{if((0,u.assert)(!!r&&r.scriptEnabled,"$accumulator operator requires 'scriptEnabled' option to be true"),0==e.length)return t.initArgs;var n=s.ComputeOptions.init(r),r=(0,s.computeValue)({},t.initArgs||[],null,n.update((null==(r=null==n?void 0:n.local)?void 0:r.groupId)||{}));let i=t.init.call(null,...r);for(const a of e){var o=(0,s.computeValue)(a,t.accumulateArgs,null,n.update(a));i=t.accumulate.call(null,i,...o)}return t.finalize?t.finalize.call(null,i):i}},{"../../core":69,"../../util":307}],75:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$addToSet=void 0;const n=e("../../util"),i=e("./push");r.$addToSet=(e,t,r)=>(0,n.unique)((0,i.$push)(e,t,r),null==r?void 0:r.hashFunction)},{"../../util":307,"./push":92}],76:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$avg=void 0;const n=e("../../util"),i=e("./push");r.$avg=(e,t,r)=>{e=(0,i.$push)(e,t,r).filter(n.isNumber);return e.reduce((e,t)=>e+t,0)/(e.length||1)}},{"../../util":307,"./push":92}],77:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$bottom=void 0;const n=e("./bottomN");r.$bottom=(e,t,r)=>(0,n.$bottomN)(e,Object.assign(Object.assign({},t),{n:1}),r)},{"./bottomN":78}],78:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$bottomN=void 0;const o=e("../../aggregator"),a=e("../../core"),s=e("./push");r.$bottomN=(e,t,r)=>{var r=a.ComputeOptions.init(r),{n,sortBy:i}=(0,a.computeValue)(r.local.groupId,t,null,r),i=new o.Aggregator([{$sort:i}],r).run(e),e=i.length;return(0,s.$push)(e<=n?i:i.slice(e-n),t.output,r)}},{"../../aggregator":68,"../../core":69,"./push":92}],79:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$count=void 0;r.$count=(e,t,r)=>e.length},{}],80:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$covariancePop=void 0;const n=e("./_internal"),i=e("./push");r.$covariancePop=(e,t,r)=>(0,n.covariance)((0,i.$push)(e,t,r),!1)},{"./_internal":73,"./push":92}],81:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$covarianceSamp=void 0;const n=e("./_internal"),i=e("./push");r.$covarianceSamp=(e,t,r)=>(0,n.covariance)((0,i.$push)(e,t,r),!0)},{"./_internal":73,"./push":92}],82:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$first=void 0;const n=e("../../core");r.$first=(e,t,r)=>0<e.length?(0,n.computeValue)(e[0],t,null,r):void 0},{"../../core":69}],83:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$firstN=void 0;const a=e("../../core"),s=e("./push");r.$firstN=(e,t,r)=>{var n=a.ComputeOptions.init(r),i=e.length,o=(0,a.computeValue)(null==(o=null==n?void 0:n.local)?void 0:o.groupId,t.n,null,n);return(0,s.$push)(i<=o?e:e.slice(0,o),t.input,r)}},{"../../core":69,"./push":92}],84:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./accumulator"),r),i(e("./addToSet"),r),i(e("./avg"),r),i(e("./bottom"),r),i(e("./bottomN"),r),i(e("./count"),r),i(e("./covariancePop"),r),i(e("./covarianceSamp"),r),i(e("./first"),r),i(e("./firstN"),r),i(e("./last"),r),i(e("./lastN"),r),i(e("./max"),r),i(e("./maxN"),r),i(e("./mergeObjects"),r),i(e("./min"),r),i(e("./minN"),r),i(e("./push"),r),i(e("./stdDevPop"),r),i(e("./stdDevSamp"),r),i(e("./sum"),r),i(e("./top"),r),i(e("./topN"),r)},{"./accumulator":74,"./addToSet":75,"./avg":76,"./bottom":77,"./bottomN":78,"./count":79,"./covariancePop":80,"./covarianceSamp":81,"./first":82,"./firstN":83,"./last":85,"./lastN":86,"./max":87,"./maxN":88,"./mergeObjects":89,"./min":90,"./minN":91,"./push":92,"./stdDevPop":93,"./stdDevSamp":94,"./sum":95,"./top":96,"./topN":97}],85:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$last=void 0;const n=e("../../core");r.$last=(e,t,r)=>0<e.length?(0,n.computeValue)(e[e.length-1],t,null,r):void 0},{"../../core":69}],86:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$lastN=void 0;const a=e("../../core"),s=e("./push");r.$lastN=(e,t,r)=>{var n=a.ComputeOptions.init(r),i=e.length,o=(0,a.computeValue)(null==(o=null==n?void 0:n.local)?void 0:o.groupId,t.n,null,n);return(0,s.$push)(i<=o?e:e.slice(i-o),t.input,r)}},{"../../core":69,"./push":92}],87:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$max=void 0;const n=e("../../util"),i=e("./push");r.$max=(e,t,r)=>{e=(0,i.$push)(e,t,r).filter(n.isNotNaN).reduce((e,t)=>0<=(0,n.compare)(t,e)?t:e,-1/0);return e===-1/0?void 0:e}},{"../../util":307,"./push":92}],88:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$maxN=void 0;const a=e("../../core"),s=e("../../util"),u=e("./push");r.$maxN=(e,t,r)=>{var n=a.ComputeOptions.init(r),i=e.length,o=(0,a.computeValue)(null==(o=null==n?void 0:n.local)?void 0:o.groupId,t.n,null,n),n=(0,u.$push)(e,t.input,r).filter(e=>!(0,s.isNil)(e));return n.sort((e,t)=>-1*(0,s.compare)(e,t)),i<=o?n:n.slice(0,o)}},{"../../core":69,"../../util":307,"./push":92}],89:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$mergeObjects=void 0;const n=e("../expression/object/mergeObjects");r.$mergeObjects=(e,t,r)=>(0,n.$mergeObjects)({docs:e},"$docs",r)},{"../expression/object/mergeObjects":186}],90:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$min=void 0;const n=e("../../util"),i=e("./push");r.$min=(e,t,r)=>{e=(0,i.$push)(e,t,r).filter(n.isNotNaN).reduce((e,t)=>(0,n.compare)(t,e)<=0?t:e,1/0);return e===1/0?void 0:e}},{"../../util":307,"./push":92}],91:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$minN=void 0;const a=e("../../core"),s=e("../../util"),u=e("./push");r.$minN=(e,t,r)=>{var n=a.ComputeOptions.init(r),i=e.length,o=(0,a.computeValue)(null==(o=null==n?void 0:n.local)?void 0:o.groupId,t.n,null,n),n=(0,u.$push)(e,t.input,r).filter(e=>!(0,s.isNil)(e));return n.sort(s.compare),i<=o?n:n.slice(0,o)}},{"../../core":69,"../../util":307,"./push":92}],92:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$push=void 0;const i=e("../../core"),o=e("../../util");r.$push=(e,t,r)=>{if((0,o.isNil)(t))return e;const n=i.ComputeOptions.init(r);return e.map(e=>(0,i.computeValue)(e,t,null,n.update(e)))}},{"../../core":69,"../../util":307}],93:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$stdDevPop=void 0;const n=e("../../util"),i=e("./_internal"),o=e("./push");r.$stdDevPop=(e,t,r)=>(0,i.stddev)((0,o.$push)(e,t,r).filter(n.isNumber),!1)},{"../../util":307,"./_internal":73,"./push":92}],94:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$stdDevSamp=void 0;const n=e("../../util"),i=e("./_internal"),o=e("./push");r.$stdDevSamp=(e,t,r)=>(0,i.stddev)((0,o.$push)(e,t,r).filter(n.isNumber),!0)},{"../../util":307,"./_internal":73,"./push":92}],95:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$sum=void 0;const n=e("../../util"),i=e("./push");r.$sum=(e,t,r)=>{return(0,n.isArray)(e)?(0,n.isNumber)(t)?e.length*t:(0,i.$push)(e,t,r).filter(n.isNumber).reduce((e,t)=>e+t,0):0}},{"../../util":307,"./push":92}],96:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$top=void 0;const n=e("./topN");r.$top=(e,t,r)=>(0,n.$topN)(e,Object.assign(Object.assign({},t),{n:1}),r)},{"./topN":97}],97:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$topN=void 0;const o=e("../../aggregator"),a=e("../../core"),s=e("./push");r.$topN=(e,t,r)=>{var r=a.ComputeOptions.init(r),{n,sortBy:i}=(0,a.computeValue)(r.local.groupId,t,null,r),i=new o.Aggregator([{$sort:i},{$limit:n}],r).run(e);return(0,s.$push)(i,t.output,r)}},{"../../aggregator":68,"../../core":69,"./push":92}],98:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.truncate=void 0,r.truncate=function(t,r,n){var i=Math.abs(t)===t?1:-1;t=Math.abs(t);let o=Math.trunc(t);if(t=parseFloat((t-o).toFixed(r+1)),0===r){var a=Math.trunc(10*t);n&&(1==(1&o)&&5<=a||5<a)&&o++}else if(0<r){a=Math.pow(10,r);let e=Math.trunc(t*a);t=Math.trunc(t*a*10)%10;n&&5<t&&(e+=1),o=(o*a+e)/a}else if(r<0){t=Math.pow(10,-1*r);let e=o%t;if(o=Math.max(0,o-e),n&&-1==i){for(;10<e;)e-=e%10;0<o&&5<=e&&(o+=t)}}return o*i}},{}],99:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$abs=void 0;const n=e("../../../core"),i=e("../../../util");r.$abs=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.isNil)(e)?null:Math.abs(e)}},{"../../../core":69,"../../../util":307}],100:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$add=void 0;const i=e("../../../core"),o=e("../../../util");r.$add=(e,t,r)=>{e=(0,i.computeValue)(e,t,null,r);let n=!1;t=e.reduce((e,t)=>((0,o.isDate)(t)&&((0,o.assert)(!n,"'$add' can only have one date value"),n=!0,t=t.getTime()),e+=t),0);return n?new Date(t):t}},{"../../../core":69,"../../../util":307}],101:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$ceil=void 0;const n=e("../../../core"),i=e("../../../util");r.$ceil=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.isNil)(e)?null:((0,i.assert)((0,i.isNumber)(e)||isNaN(e),"$ceil expression must resolve to a number."),Math.ceil(e))}},{"../../../core":69,"../../../util":307}],102:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$divide=void 0;const n=e("../../../core");r.$divide=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return e[0]/e[1]}},{"../../../core":69}],103:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$exp=void 0;const n=e("../../../core"),i=e("../../../util");r.$exp=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.isNil)(e)?null:((0,i.assert)((0,i.isNumber)(e)||isNaN(e),"$exp expression must resolve to a number."),Math.exp(e))}},{"../../../core":69,"../../../util":307}],104:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$floor=void 0;const n=e("../../../core"),i=e("../../../util");r.$floor=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.isNil)(e)?null:((0,i.assert)((0,i.isNumber)(e)||isNaN(e),"$floor expression must resolve to a number."),Math.floor(e))}},{"../../../core":69,"../../../util":307}],105:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./abs"),r),i(e("./add"),r),i(e("./ceil"),r),i(e("./divide"),r),i(e("./exp"),r),i(e("./floor"),r),i(e("./ln"),r),i(e("./log"),r),i(e("./log10"),r),i(e("./mod"),r),i(e("./multiply"),r),i(e("./pow"),r),i(e("./round"),r),i(e("./sqrt"),r),i(e("./subtract"),r),i(e("./trunc"),r)},{"./abs":99,"./add":100,"./ceil":101,"./divide":102,"./exp":103,"./floor":104,"./ln":106,"./log":107,"./log10":108,"./mod":109,"./multiply":110,"./pow":111,"./round":112,"./sqrt":113,"./subtract":114,"./trunc":115}],106:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$ln=void 0;const n=e("../../../core"),i=e("../../../util");r.$ln=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.isNil)(e)?null:((0,i.assert)((0,i.isNumber)(e)||isNaN(e),"$ln expression must resolve to a number."),Math.log(e))}},{"../../../core":69,"../../../util":307}],107:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$log=void 0;const n=e("../../../core"),i=e("../../../util");r.$log=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r),t="$log expression must resolve to array(2) of numbers";return(0,i.assert)((0,i.isArray)(e)&&2===e.length,t),e.some(i.isNil)?null:((0,i.assert)(e.some(isNaN)||e.every(i.isNumber),t),Math.log10(e[0])/Math.log10(e[1]))}},{"../../../core":69,"../../../util":307}],108:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$log10=void 0;const n=e("../../../core"),i=e("../../../util");r.$log10=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.isNil)(e)?null:((0,i.assert)((0,i.isNumber)(e)||isNaN(e),"$log10 expression must resolve to a number."),Math.log10(e))}},{"../../../core":69,"../../../util":307}],109:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$mod=void 0;const n=e("../../../core");r.$mod=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return e[0]%e[1]}},{"../../../core":69}],110:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$multiply=void 0;const n=e("../../../core");r.$multiply=(e,t,r)=>{return(0,n.computeValue)(e,t,null,r).reduce((e,t)=>e*t,1)}},{"../../../core":69}],111:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$pow=void 0;const n=e("../../../core"),i=e("../../../util");r.$pow=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.assert)((0,i.isArray)(e)&&2===e.length&&e.every(i.isNumber),"$pow expression must resolve to array(2) of numbers"),(0,i.assert)(!(0===e[0]&&e[1]<0),"$pow cannot raise 0 to a negative exponent"),Math.pow(e[0],e[1])}},{"../../../core":69,"../../../util":307}],112:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$round=void 0;const n=e("../../../core"),i=e("../../../util"),o=e("./_internal");r.$round=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r),t=e[0],r=e[1];return(0,i.isNil)(t)||isNaN(t)||Math.abs(t)===1/0?t:((0,i.assert)((0,i.isNumber)(t),"$round expression must resolve to a number."),(0,o.truncate)(t,r,!0))}},{"../../../core":69,"../../../util":307,"./_internal":98}],113:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$sqrt=void 0;const n=e("../../../core"),i=e("../../../util");r.$sqrt=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.isNil)(e)?null:((0,i.assert)((0,i.isNumber)(e)&&0<e||isNaN(e),"$sqrt expression must resolve to non-negative number."),Math.sqrt(e))}},{"../../../core":69,"../../../util":307}],114:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$subtract=void 0;const n=e("../../../core");r.$subtract=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return e[0]-e[1]}},{"../../../core":69}],115:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$trunc=void 0;const n=e("../../../core"),i=e("../../../util"),o=e("./_internal");r.$trunc=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r),t=e[0],r=e[1];return(0,i.isNil)(t)||isNaN(t)||Math.abs(t)===1/0?t:((0,i.assert)((0,i.isNumber)(t),"$trunc expression must resolve to a number."),(0,i.assert)((0,i.isNil)(r)||(0,i.isNumber)(r)&&-20<r&&r<100,"$trunc expression has invalid place"),(0,o.truncate)(t,r,!1))}},{"../../../core":69,"../../../util":307,"./_internal":98}],116:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$arrayElemAt=void 0;const n=e("../../../core"),i=e("../../../util");r.$arrayElemAt=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.assert)(e instanceof Array&&2===e.length,"$arrayElemAt expression must resolve to array(2)"),e.some(i.isNil)?null:(t=e[1],r=e[0],t<0&&Math.abs(t)<=r.length?r[(t+r.length)%r.length]:0<=t&&t<r.length?r[t]:void 0)}},{"../../../core":69,"../../../util":307}],117:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$arrayToObject=void 0;const n=e("../../../core"),i=e("../../../util");r.$arrayToObject=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.assert)((0,i.isArray)(e),"$arrayToObject expression must resolve to an array"),e.reduce((e,t)=>{for(;(0,i.isArray)(t)&&1===t.length;)t=t[0];var r;return t instanceof Array&&2==t.length?e[t[0]]=t[1]:(r=t,(0,i.assert)((0,i.isObject)(r)&&(0,i.has)(r,"k")&&(0,i.has)(r,"v"),"$arrayToObject expression is invalid."),e[r.k]=r.v),e},{})}},{"../../../core":69,"../../../util":307}],118:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$concatArrays=void 0;const n=e("../../../core"),i=e("../../../util");r.$concatArrays=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.assert)((0,i.isArray)(e),"$concatArrays must resolve to an array"),e.some(i.isNil)?null:e.reduce((e,t)=>(0,i.into)(e,t),[])}},{"../../../core":69,"../../../util":307}],119:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$filter=void 0;const s=e("../../../core"),u=e("../../../util");r.$filter=(t,r,n)=>{var e=(0,s.computeValue)(t,r.input,null,n);(0,u.assert)((0,u.isArray)(e),"$filter 'input' expression must resolve to an array");const i=s.ComputeOptions.init(n,t),o=r.as||"this",a={variables:{[o]:null}};return e.filter(e=>{a.variables[o]=e;e=(0,s.computeValue)(t,r.cond,null,i.update(i.root,a));return(0,u.truthy)(e,n.useStrictMode)})}},{"../../../core":69,"../../../util":307}],120:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$first=void 0;const i=e("../../../core"),o=e("../../../util"),a=e("../../accumulator");r.$first=(e,t,r)=>{var n=i.ComputeOptions.init(r);return e instanceof Array?(0,a.$first)(e,t,n.update()):(n=(0,i.computeValue)(e,t,null,r),(0,o.isNil)(n)?null:((0,o.assert)((0,o.isArray)(n),"Must resolve to an array/null or missing"),(0,a.$first)(n,"$$this",r)))}},{"../../../core":69,"../../../util":307,"../../accumulator":84}],121:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$firstN=void 0;const n=e("../../../core"),i=e("../../../util"),o=e("../../accumulator/firstN");r.$firstN=(e,t,r)=>{return e instanceof Array?(0,o.$firstN)(e,t,r):({input:e,n:t}=(0,n.computeValue)(e,t,null,r),(0,i.isNil)(e)?null:((0,i.assert)((0,i.isArray)(e),"Must resolve to an array/null or missing"),(0,o.$firstN)(e,{n:t,input:"$$this"},r)))}},{"../../../core":69,"../../../util":307,"../../accumulator/firstN":83}],122:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$in=void 0;const n=e("../../../core"),i=e("../../../util");r.$in=(e,t,r)=>{var[e,t]=(0,n.computeValue)(e,t,null,r);return(0,i.assert)((0,i.isArray)(t),"$in second argument must be an array"),t.some(i.isEqual.bind(null,e))}},{"../../../core":69,"../../../util":307}],123:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./arrayElemAt"),r),i(e("./arrayToObject"),r),i(e("./concatArrays"),r),i(e("./filter"),r),i(e("./first"),r),i(e("./firstN"),r),i(e("./in"),r),i(e("./indexOfArray"),r),i(e("./isArray"),r),i(e("./last"),r),i(e("./lastN"),r),i(e("./map"),r),i(e("./maxN"),r),i(e("./minN"),r),i(e("./nin"),r),i(e("./range"),r),i(e("./reduce"),r),i(e("./reverseArray"),r),i(e("./size"),r),i(e("./slice"),r),i(e("./sortArray"),r),i(e("./zip"),r)},{"./arrayElemAt":116,"./arrayToObject":117,"./concatArrays":118,"./filter":119,"./first":120,"./firstN":121,"./in":122,"./indexOfArray":124,"./isArray":125,"./last":126,"./lastN":127,"./map":128,"./maxN":129,"./minN":130,"./nin":131,"./range":132,"./reduce":133,"./reverseArray":134,"./size":135,"./slice":136,"./sortArray":137,"./zip":138}],124:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$indexOfArray=void 0;const s=e("../../../core"),u=e("../../../util");r.$indexOfArray=(e,t,r)=>{e=(0,s.computeValue)(e,t,null,r);if((0,u.isNil)(e))return null;let n=e[0];const i=e[1];if((0,u.isNil)(n))return null;(0,u.assert)((0,u.isArray)(n),"$indexOfArray expression must resolve to an array.");t=e[2]||0;let o=e[3];if(t>(o=(0,u.isNil)(o)?n.length:o))return-1;(0,u.assert)(0<=t&&0<=o,"$indexOfArray expression is invalid"),(0<t||o<n.length)&&(n=n.slice(t,o));let a=-1;return n.some((e,t)=>{e=(0,u.isEqual)(e,i);return e&&(a=t),e}),a+t}},{"../../../core":69,"../../../util":307}],125:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$isArray=void 0;const n=e("../../../core");r.$isArray=(e,t,r)=>(0,n.computeValue)(e,t[0],null,r)instanceof Array},{"../../../core":69}],126:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$last=void 0;const i=e("../../../core"),o=e("../../../util"),a=e("../../accumulator");r.$last=(e,t,r)=>{var n=i.ComputeOptions.init(r);return e instanceof Array?(0,a.$last)(e,t,n.update()):(n=(0,i.computeValue)(e,t,null,r),(0,o.isNil)(n)?null:((0,o.assert)((0,o.isArray)(n),"Must resolve to an array/null or missing"),(0,a.$last)(n,"$$this",r)))}},{"../../../core":69,"../../../util":307,"../../accumulator":84}],127:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$lastN=void 0;const n=e("../../../core"),i=e("../../../util"),o=e("../../accumulator/lastN");r.$lastN=(e,t,r)=>{return e instanceof Array?(0,o.$lastN)(e,t,r):({input:e,n:t}=(0,n.computeValue)(e,t,null,r),(0,i.isNil)(e)?null:((0,i.assert)((0,i.isArray)(e),"Must resolve to an array/null or missing"),(0,o.$lastN)(e,{n:t,input:"$$this"},r)))}},{"../../../core":69,"../../../util":307,"../../accumulator/lastN":86}],128:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$map=void 0;const a=e("../../../core"),s=e("../../../util");r.$map=(t,r,e)=>{var n=(0,a.computeValue)(t,r.input,null,e);(0,s.assert)((0,s.isArray)(n),"$map 'input' expression must resolve to an array");const i=a.ComputeOptions.init(e),o=r.as||"this";return n.map(e=>(0,a.computeValue)(t,r.in,null,i.update(i.root,{variables:{[o]:e}})))}},{"../../../core":69,"../../../util":307}],129:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$maxN=void 0;const n=e("../../../core"),i=e("../../../util"),o=e("../../accumulator/maxN");r.$maxN=(e,t,r)=>{return e instanceof Array?(0,o.$maxN)(e,t,r):({input:e,n:t}=(0,n.computeValue)(e,t,null,r),(0,i.isNil)(e)?null:((0,i.assert)((0,i.isArray)(e),"Must resolve to an array/null or missing"),(0,o.$maxN)(e,{n:t,input:"$$this"},r)))}},{"../../../core":69,"../../../util":307,"../../accumulator/maxN":88}],130:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$minN=void 0;const n=e("../../../core"),i=e("../../../util"),o=e("../../accumulator/minN");r.$minN=(e,t,r)=>{return e instanceof Array?(0,o.$minN)(e,t,r):({input:e,n:t}=(0,n.computeValue)(e,t,null,r),(0,i.isNil)(e)?null:((0,i.assert)((0,i.isArray)(e),"Must resolve to an array/null or missing"),(0,o.$minN)(e,{n:t,input:"$$this"},r)))}},{"../../../core":69,"../../../util":307,"../../accumulator/minN":91}],131:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$nin=void 0;e=e("../../_predicates");r.$nin=(0,e.createExpressionOperator)(e.$nin)},{"../../_predicates":72}],132:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$range=void 0;const s=e("../../../core");r.$range=(e,t,r)=>{var e=(0,s.computeValue)(e,t,null,r),t=e[0],n=e[1],i=e[2]||1,o=new Array;let a=t;for(;a<n&&0<i||a>n&&i<0;)o.push(a),a+=i;return o}},{"../../../core":69}],133:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$reduce=void 0;const o=e("../../../core"),a=e("../../../util");r.$reduce=(e,t,r)=>{const n=o.ComputeOptions.init(r);r=(0,o.computeValue)(e,t.input,null,n),e=(0,o.computeValue)(e,t.initialValue,null,n);const i=t.in;return(0,a.isNil)(r)?null:((0,a.assert)((0,a.isArray)(r),"$reduce 'input' expression must resolve to an array"),r.reduce((e,t)=>(0,o.computeValue)(t,i,null,n.update(n.root,{variables:{value:e}})),e))}},{"../../../core":69,"../../../util":307}],134:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$reverseArray=void 0;const n=e("../../../core"),i=e("../../../util");r.$reverseArray=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);if((0,i.isNil)(e))return null;(0,i.assert)((0,i.isArray)(e),"$reverseArray expression must resolve to an array");t=e.slice(0);return t.reverse(),t}},{"../../../core":69,"../../../util":307}],135:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$size=void 0;const n=e("../../../core"),i=e("../../../util");r.$size=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.isArray)(e)?e.length:void 0}},{"../../../core":69,"../../../util":307}],136:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$slice=void 0;const o=e("../../../core"),a=e("../../../util");r.$slice=(e,t,r)=>{e=(0,o.computeValue)(e,t,null,r),t=e[0];let n=e[1],i=e[2];return(0,a.isNil)(i)?n<0?(n=Math.max(0,t.length+n),i=t.length-n+1):(i=n,n=0):(n<0&&(n=Math.max(0,t.length+n)),(0,a.assert)(0<i,"Invalid argument for $slice operator. Limit must be a positive number"),i+=n),t.slice(n,i)}},{"../../../core":69,"../../../util":307}],137:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$sortArray=void 0;const n=e("../../../aggregator"),i=e("../../../core"),o=e("../../../util");r.$sortArray=(e,t,r)=>{var{input:e,sortBy:t}=(0,i.computeValue)(e,t,null,r);return(0,o.isNil)(e)?null:((0,o.assert)((0,o.isArray)(e),"$sortArray expression must resolve to an array"),(0,o.isObject)(t)?new n.Aggregator([{$sort:t}]).run(e):((r=[...e]).sort(o.compare),-1===t&&r.reverse(),r))}},{"../../../aggregator":68,"../../../core":69,"../../../util":307}],138:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$zip=void 0;const l=e("../../../core"),f=e("../../../util");r.$zip=(e,t,r)=>{var n=(0,l.computeValue)(e,t.inputs,null,r),i=t.useLongestLength||!1;(0,f.assert)((0,f.isArray)(n),"'inputs' expression must resolve to an array"),(0,f.assert)((0,f.isBoolean)(i),"'useLongestLength' must be a boolean"),(0,f.isArray)(t.defaults)&&(0,f.assert)(i,"'useLongestLength' must be set to true to use 'defaults'");let o=0;for(let e=0,t=n.length;e<t;e++){var a=n[e];if((0,f.isNil)(a))return null;(0,f.assert)((0,f.isArray)(a),"'inputs' expression values must resolve to an array or null"),o=i?Math.max(o,a.length):Math.min(o||a.length,a.length)}var s=[];const u=t.defaults||[];for(let r=0;r<o;r++){var c=n.map((e,t)=>(0,f.isNil)(e[r])?u[t]||null:e[r]);s.push(c)}return s}},{"../../../core":69,"../../../util":307}],139:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$and=void 0;const n=e("../../../core"),i=e("../../../util");r.$and=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.truthy)(e,r.useStrictMode)&&e.every(e=>(0,i.truthy)(e,r.useStrictMode))}},{"../../../core":69,"../../../util":307}],140:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./and"),r),i(e("./not"),r),i(e("./or"),r)},{"./and":139,"./not":141,"./or":142}],141:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$not=void 0;const n=e("../../../core"),i=e("../../../util");r.$not=(e,t,r)=>{t=(0,i.ensureArray)(t);if(0==t.length)return!1;if(1==t.length)return!(0,n.computeValue)(e,t[0],null,r);throw"Expression $not takes exactly 1 argument"}},{"../../../core":69,"../../../util":307}],142:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$or=void 0;const i=e("../../../core"),o=e("../../../util");r.$or=(e,t,r)=>{e=(0,i.computeValue)(e,t,null,r);const n=r.useStrictMode;return(0,o.truthy)(e,n)&&e.some(e=>(0,o.truthy)(e,n))}},{"../../../core":69,"../../../util":307}],143:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$cmp=void 0;const n=e("../../../core");r.$cmp=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return e[0]>e[1]?1:e[0]<e[1]?-1:0}},{"../../../core":69}],144:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$eq=void 0;e=e("../../_predicates");r.$eq=(0,e.createExpressionOperator)(e.$eq)},{"../../_predicates":72}],145:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$gt=void 0;e=e("../../_predicates");r.$gt=(0,e.createExpressionOperator)(e.$gt)},{"../../_predicates":72}],146:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$gte=void 0;e=e("../../_predicates");r.$gte=(0,e.createExpressionOperator)(e.$gte)},{"../../_predicates":72}],147:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./cmp"),r),i(e("./eq"),r),i(e("./gt"),r),i(e("./gte"),r),i(e("./lt"),r),i(e("./lte"),r),i(e("./ne"),r)},{"./cmp":143,"./eq":144,"./gt":145,"./gte":146,"./lt":148,"./lte":149,"./ne":150}],148:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$lt=void 0;e=e("../../_predicates");r.$lt=(0,e.createExpressionOperator)(e.$lt)},{"../../_predicates":72}],149:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$lte=void 0;e=e("../../_predicates");r.$lte=(0,e.createExpressionOperator)(e.$lte)},{"../../_predicates":72}],150:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$ne=void 0;e=e("../../_predicates");r.$ne=(0,e.createExpressionOperator)(e.$ne)},{"../../_predicates":72}],151:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$cond=void 0;const s=e("../../../core"),u=e("../../../util");r.$cond=(e,t,r)=>{let n,i,o;var a="$cond: invalid arguments",a=(o=t instanceof Array?((0,u.assert)(3===t.length,a),n=t[0],i=t[1],t[2]):((0,u.assert)((0,u.isObject)(t),a),n=t.if,i=t.then,t.else),(0,u.truthy)((0,s.computeValue)(e,n,null,r),r.useStrictMode));return(0,s.computeValue)(e,a?i:o,null,r)}},{"../../../core":69,"../../../util":307}],152:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$ifNull=void 0;const n=e("../../../core"),i=e("../../../util");r.$ifNull=(e,t,r)=>{return(0,n.computeValue)(e,t,null,r).find(e=>!(0,i.isNil)(e))}},{"../../../core":69,"../../../util":307}],153:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./cond"),r),i(e("./ifNull"),r),i(e("./switch"),r)},{"./cond":151,"./ifNull":152,"./switch":154}],154:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$switch=void 0;const o=e("../../../core"),a=e("../../../util");r.$switch=(r,e,n)=>{let i=null;return e.branches.some(e=>{var t=(0,a.truthy)((0,o.computeValue)(r,e.case,null,n),n.useStrictMode);return t&&(i=e.then),t}),(0,o.computeValue)(r,null!==i?i:e.default,null,n)}},{"../../../core":69,"../../../util":307}],155:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$function=void 0;const n=e("../../../core"),i=e("../../../util");r.$function=(e,t,r)=>{(0,i.assert)(r.scriptEnabled,"$function operator requires 'scriptEnabled' option to be true");e=(0,n.computeValue)(e,t,null,r);return e.body.apply(null,e.args)}},{"../../../core":69,"../../../util":307}],156:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./function"),r)},{"./function":155}],157:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.regexStrip=n.regexQuote=n.padDigits=n.computeDate=n.adjustDate=n.formatTimezone=n.parseTimezone=n.DATE_SYM_TABLE=n.DATE_PART_INTERVAL=n.DATE_FORMAT=n.DURATION_IN_MILLIS=n.MILLIS_PER_DAY=n.MINUTES_PER_HOUR=n.isoWeekYear=n.isoWeek=n.getDayOfYear=n.isLeapYear=void 0;const i=e("../../../core"),o=e("../../../util"),r=[0,31,59,90,120,151,181,212,243,273,304,334],a=[0,31,60,91,121,152,182,213,244,274,305,335],s=e=>(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,u=e=>52+Number(4==s(e)||3==s(e-1));n.isLeapYear=e=>0==(3&e)&&(e%100!=0||e%400==0);function c(e){if((0,o.isNil)(e))return 0;var t,r=n.DATE_SYM_TABLE["%z"].re.exec(e);if(r)return t=parseInt(r[2])||0,r=parseInt(r[3])||0,(Math.abs(t*n.MINUTES_PER_HOUR)+r)*(t<0?-1:1);throw Error(`invalid or location-based timezone '${e}' not supported`)}function l(e,t){e.setUTCMinutes(e.getUTCMinutes()+t)}function f(e,t){return new Array(Math.max(t-String(e).length+1,0)).join("0")+e.toString()}n.getDayOfYear=e=>((0,n.isLeapYear)(e.getUTCFullYear())?a:r)[e.getUTCMonth()]+e.getUTCDate(),n.isoWeek=function(e){var t=Math.floor((10+(0,n.getDayOfYear)(e)-(e.getUTCDay()||7))/7);return t<1?u(e.getUTCFullYear()-1):t>u(e.getUTCFullYear())?1:t},n.isoWeekYear=function(e){return e.getUTCFullYear()-Number(0==e.getUTCMonth()&&1==e.getUTCDate()&&e.getUTCDay()<1)},n.MINUTES_PER_HOUR=60,n.MILLIS_PER_DAY=864e5,n.DURATION_IN_MILLIS={week:7*n.MILLIS_PER_DAY,day:n.MILLIS_PER_DAY,hour:36e5,minute:6e4,second:1e3,millisecond:1},n.DATE_FORMAT="%Y-%m-%dT%H:%M:%S.%LZ",n.DATE_PART_INTERVAL=[["year",0,9999],["month",1,12],["day",1,31],["hour",0,23],["minute",0,59],["second",0,59],["millisecond",0,999]],n.DATE_SYM_TABLE={"%Y":{name:"year",padding:4,re:/([0-9]{4})/},"%G":{name:"year",padding:4,re:/([0-9]{4})/},"%m":{name:"month",padding:2,re:/(0[1-9]|1[012])/},"%d":{name:"day",padding:2,re:/(0[1-9]|[12][0-9]|3[01])/},"%H":{name:"hour",padding:2,re:/([01][0-9]|2[0-3])/},"%M":{name:"minute",padding:2,re:/([0-5][0-9])/},"%S":{name:"second",padding:2,re:/([0-5][0-9]|60)/},"%L":{name:"millisecond",padding:3,re:/([0-9]{3})/},"%u":{name:"weekday",padding:1,re:/([1-7])/},"%U":{name:"week",padding:2,re:/([1-4][0-9]?|5[0-3]?)/},"%V":{name:"isoWeek",padding:2,re:/([1-4][0-9]?|5[0-3]?)/},"%z":{name:"timezone",padding:2,re:/(([+-][01][0-9]|2[0-3]):?([0-5][0-9])?)/},"%Z":{name:"minuteOffset",padding:3,re:/([+-][0-9]{3})/}},n.parseTimezone=c,n.formatTimezone=function(e){return(e<0?"-":"+")+f(Math.abs(Math.floor(e/n.MINUTES_PER_HOUR)),2)+f(Math.abs(e)%n.MINUTES_PER_HOUR,2)},n.adjustDate=l,n.computeDate=function(e,t,r){if(e=(0,i.computeValue)(e,t,null,r),(0,o.isDate)(e))return new Date(e);if((0,o.isNumber)(e))return new Date(1e3*e);if(e.date)return r=(0,o.isDate)(e.date)?new Date(e.date):new Date(1e3*e.date),e.timezone&&l(r,c(e.timezone)),r;throw Error(`cannot convert ${null==t?void 0:t.toString()} to date`)},n.padDigits=f,n.regexQuote=function(t){return"^.-*?$".split("").forEach(e=>{t=t.replace(e,"\\"+e)}),t},n.regexStrip=function(e){return e.replace(/^\//,"").replace(/\/$/,"")}},{"../../../core":69,"../../../util":307}],158:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$dateAdd=void 0;const o=e("../../../core"),a=e("./_internal");function s(e,t){var r,t=e.getUTCMonth()+t,n=Math.floor(t/12);t<0?(r=t%12+12,e.setUTCFullYear(e.getUTCFullYear()+n,r,e.getUTCDate())):e.setUTCFullYear(e.getUTCFullYear()+n,t%12,e.getUTCDate())}r.$dateAdd=(e,t,r)=>{var n=(0,o.computeValue)(e,t,null,r),i=(0,a.computeDate)(e,t.startDate,r);switch(n.unit){case"year":i.setUTCFullYear(i.getUTCFullYear()+n.amount);break;case"quarter":s(i,3*n.amount);break;case"month":s(i,n.amount);break;default:i.setTime(i.getTime()+a.DURATION_IN_MILLIS[n.unit]*n.amount)}return n.timezone&&(e=(0,a.parseTimezone)(n.timezone),(0,a.adjustDate)(i,e)),i}},{"../../../core":69,"./_internal":157}],159:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$dateDiff=void 0;const f=e("../../../core"),d=e("./_internal");r.$dateDiff=(e,t,r)=>{var n,i,o,a,s=(0,f.computeValue)(e,t,null,r),u=(0,d.computeDate)(e,t.startDate,r),c=(0,d.computeDate)(e,t.endDate,r);let l;switch(s.unit){case"year":case"quarter":case"month":l=(n=u,i=c,o=s.unit,a=12*(i.getUTCFullYear()-n.getUTCFullYear()),a=(a-=n.getUTCMonth())+i.getUTCMonth(),Math.trunc(a/p[o]));break;default:l=(c.getTime()-u.getTime())/d.DURATION_IN_MILLIS[s.unit]}return l};const p={year:12,quarter:3,month:1}},{"../../../core":69,"./_internal":157}],160:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$dateFromParts=void 0;const l=e("../../../core"),f=e("./_internal"),d=[31,28,31,30,31,30,31,31,30,31,30,31];r.$dateFromParts=(e,t,r)=>{var n=(0,l.computeValue)(e,t,null,r),i=(0,f.parseTimezone)(n.timezone);for(let t=f.DATE_PART_INTERVAL.length-1,r=0;0<=t;t--){var o=f.DATE_PART_INTERVAL[t],a=o[0],s=o[1],o=o[2];let e=(n[a]||0)+r;r=0;var u,c=o+1;"hour"==a&&(e+=-1*Math.floor(i/f.MINUTES_PER_HOUR)),"minute"==a&&(e+=i%f.MINUTES_PER_HOUR*-1),e<s?(u=s-e,r=-1*Math.ceil(u/c),e=c-u%c):e>o&&(e+=s,r=Math.trunc(e/c),e%=c),n[a]=e}return n.day=Math.min(n.day,2==(e=n).month&&(0,f.isLeapYear)(e.year)?29:d[e.month-1]),new Date(Date.UTC(n.year,n.month-1,n.day,n.hour,n.minute,n.second,n.millisecond))}},{"../../../core":69,"./_internal":157}],161:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$dateFromString=void 0;const f=e("../../../core"),d=e("../../../util"),p=e("./_internal");e=(e,r)=>{const n={};return e.split("").forEach((e,t)=>n[e]=r*(t+1)),n};const h=Object.assign(Object.assign(Object.assign({},e("ABCDEFGHIKLM",1)),e("NOPQRSTUVWXY",-1)),{Z:0});r.$dateFromString=(e,t,r)=>{e=(0,f.computeValue)(e,t,null,r);e.format=e.format||p.DATE_FORMAT,e.onNull=e.onNull||null;let n=e.dateString;if((0,d.isNil)(n))return e.onNull;var i=e.format.split(/%[YGmdHMSLuVzZ]/),o=(i.reverse(),e.format.match(/(%%|%Y|%G|%m|%d|%H|%M|%S|%L|%u|%V|%z|%Z)/g)),a={};let s="";for(let e=0,t=o.length;e<t;e++){var u=o[e],u=p.DATE_SYM_TABLE[u];if((0,d.isObject)(u)){const l=u.re.exec(n);var c=i.pop()||"";null!==l?(a[u.name]=/^\d+$/.exec(l[0])?parseInt(l[0]):l[0],n=n.substr(0,l.index)+n.substr(l.index+l[0].length),s+=(0,p.regexQuote)(c)+(0,p.regexStrip)(u.re.toString())):a[u.name]=null}}if((0,d.isNil)(a.year)||(0,d.isNil)(a.month)||(0,d.isNil)(a.day)||!new RegExp("^"+s+"[A-Z]?$").exec(e.dateString))return e.onError;const l=e.dateString.match(/([A-Z])$/);(0,d.assert)(!(l&&e.timezone),`$dateFromString: you cannot pass in a date/time string with time zone information ('${l&&l[0]}') together with a timezone argument`);t=l?h[l[0]]*p.MINUTES_PER_HOUR:(0,p.parseTimezone)(e.timezone),r=new Date(Date.UTC(a.year,a.month-1,a.day,0,0,0));return(0,d.isNil)(a.hour)||r.setUTCHours(a.hour),(0,d.isNil)(a.minute)||r.setUTCMinutes(a.minute),(0,d.isNil)(a.second)||r.setUTCSeconds(a.second),(0,d.isNil)(a.millisecond)||r.setUTCMilliseconds(a.millisecond),(0,p.adjustDate)(r,-t),r}},{"../../../core":69,"../../../util":307,"./_internal":157}],162:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$dateSubtract=void 0;const i=e("../../../core"),o=e("./dateAdd");r.$dateSubtract=(e,t,r)=>{var n=(0,i.computeValue)(e,null==t?void 0:t.amount,null,r);return(0,o.$dateAdd)(e,Object.assign(Object.assign({},t),{amount:-1*n}),r)}},{"../../../core":69,"./dateAdd":158}],163:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$dateToParts=void 0;const n=e("../../../core"),i=e("./_internal");r.$dateToParts=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r),t=new Date(e.date),r=(0,i.parseTimezone)(e.timezone),(0,i.adjustDate)(t,r),r={hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisecond:t.getUTCMilliseconds()};return 1==e.iso8601?Object.assign(r,{isoWeekYear:(0,i.isoWeekYear)(t),isoWeek:(0,i.isoWeek)(t),isoDayOfWeek:t.getUTCDay()||7}):Object.assign(r,{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,day:t.getUTCDate()})}},{"../../../core":69,"./_internal":157}],164:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$dateToString=void 0;const f=e("../../../core"),d=e("../../../util"),p=e("./_internal");var n=e("./dayOfMonth"),i=e("./hour"),o=e("./isoDayOfWeek"),a=e("./isoWeek"),s=e("./millisecond"),u=e("./minute"),c=e("./month"),l=e("./second"),h=e("./week"),e=e("./year");const y={"%Y":e.$year,"%G":e.$year,"%m":c.$month,"%d":n.$dayOfMonth,"%H":i.$hour,"%M":u.$minute,"%S":l.$second,"%L":s.$millisecond,"%u":o.$isoDayOfWeek,"%U":h.$week,"%V":a.$isoWeek};r.$dateToString=(r,e,n)=>{e=(0,f.computeValue)(r,e,null,n);if((0,d.isNil)(e.onNull)&&(e.onNull=null),(0,d.isNil)(e.date))return e.onNull;var i=(0,p.computeDate)(r,e.date,n);let o=e.format||p.DATE_FORMAT;var a=(0,p.parseTimezone)(e.timezone),s=o.match(/(%%|%Y|%G|%m|%d|%H|%M|%S|%L|%u|%U|%V|%z|%Z)/g);(0,p.adjustDate)(i,a);for(let t=0,e=s.length;t<e;t++){var u=s[t],c=p.DATE_SYM_TABLE[u],l=y[u];let e;(0,d.isObject)(c)&&(e="timezone"===c.name?(0,p.formatTimezone)(a):"minuteOffset"===c.name?a.toString():((0,d.assert)(!!l,`unsupported date format specifier '${u}'`),(0,p.padDigits)(l(r,i,n),c.padding))),o=o.replace(u,e)}return o}},{"../../../core":69,"../../../util":307,"./_internal":157,"./dayOfMonth":165,"./hour":168,"./isoDayOfWeek":170,"./isoWeek":171,"./millisecond":173,"./minute":174,"./month":175,"./second":176,"./week":177,"./year":178}],165:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$dayOfMonth=void 0;const n=e("./_internal");r.$dayOfMonth=(e,t,r)=>(0,n.computeDate)(e,t,r).getUTCDate()},{"./_internal":157}],166:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$dayOfWeek=void 0;const n=e("./_internal");r.$dayOfWeek=(e,t,r)=>(0,n.computeDate)(e,t,r).getUTCDay()+1},{"./_internal":157}],167:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$dayOfYear=void 0;const n=e("./_internal");r.$dayOfYear=(e,t,r)=>(0,n.getDayOfYear)((0,n.computeDate)(e,t,r))},{"./_internal":157}],168:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$hour=void 0;const n=e("./_internal");r.$hour=(e,t,r)=>(0,n.computeDate)(e,t,r).getUTCHours()},{"./_internal":157}],169:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./dateAdd"),r),i(e("./dateDiff"),r),i(e("./dateFromParts"),r),i(e("./dateFromString"),r),i(e("./dateSubtract"),r),i(e("./dateToParts"),r),i(e("./dateToString"),r),i(e("./dayOfMonth"),r),i(e("./dayOfWeek"),r),i(e("./dayOfYear"),r),i(e("./hour"),r),i(e("./isoDayOfWeek"),r),i(e("./isoWeek"),r),i(e("./isoWeekYear"),r),i(e("./millisecond"),r),i(e("./minute"),r),i(e("./month"),r),i(e("./second"),r),i(e("./week"),r),i(e("./year"),r)},{"./dateAdd":158,"./dateDiff":159,"./dateFromParts":160,"./dateFromString":161,"./dateSubtract":162,"./dateToParts":163,"./dateToString":164,"./dayOfMonth":165,"./dayOfWeek":166,"./dayOfYear":167,"./hour":168,"./isoDayOfWeek":170,"./isoWeek":171,"./isoWeekYear":172,"./millisecond":173,"./minute":174,"./month":175,"./second":176,"./week":177,"./year":178}],170:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$isoDayOfWeek=void 0;const n=e("./_internal");r.$isoDayOfWeek=(e,t,r)=>(0,n.computeDate)(e,t,r).getUTCDay()||7},{"./_internal":157}],171:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$isoWeek=void 0;const n=e("./_internal");r.$isoWeek=(e,t,r)=>(0,n.isoWeek)((0,n.computeDate)(e,t,r))},{"./_internal":157}],172:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$isoWeekYear=void 0;const n=e("./_internal");r.$isoWeekYear=(e,t,r)=>{e=(0,n.computeDate)(e,t,r);return e.getUTCFullYear()-Number(0==e.getUTCMonth()&&1==e.getUTCDate()&&e.getUTCDay()<1)}},{"./_internal":157}],173:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$millisecond=void 0;const n=e("./_internal");r.$millisecond=(e,t,r)=>(0,n.computeDate)(e,t,r).getUTCMilliseconds()},{"./_internal":157}],174:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$minute=void 0;const n=e("./_internal");r.$minute=(e,t,r)=>(0,n.computeDate)(e,t,r).getUTCMinutes()},{"./_internal":157}],175:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$month=void 0;const n=e("./_internal");r.$month=(e,t,r)=>(0,n.computeDate)(e,t,r).getUTCMonth()+1},{"./_internal":157}],176:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$second=void 0;const n=e("./_internal");r.$second=(e,t,r)=>(0,n.computeDate)(e,t,r).getUTCSeconds()},{"./_internal":157}],177:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$week=void 0;const n=e("./_internal");r.$week=(e,t,r)=>{e=(0,n.computeDate)(e,t,r),t=(0,n.isoWeek)(e);return 0<e.getUTCDay()&&1==e.getUTCDate()&&0==e.getUTCMonth()?0:0==e.getUTCDay()?t+1:t}},{"./_internal":157}],178:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$year=void 0;const n=e("./_internal");r.$year=(e,t,r)=>(0,n.computeDate)(e,t,r).getUTCFullYear()},{"./_internal":157}],179:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./arithmetic"),r),i(e("./array"),r),i(e("./boolean"),r),i(e("./comparison"),r),i(e("./conditional"),r),i(e("./custom"),r),i(e("./date"),r),i(e("./literal"),r),i(e("./misc"),r),i(e("./object"),r),i(e("./set"),r),i(e("./string"),r),i(e("./trignometry"),r),i(e("./type"),r),i(e("./variable"),r)},{"./arithmetic":105,"./array":123,"./boolean":140,"./comparison":147,"./conditional":153,"./custom":156,"./date":169,"./literal":180,"./misc":182,"./object":185,"./set":192,"./string":200,"./trignometry":230,"./type":237,"./variable":247}],180:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$literal=void 0;r.$literal=(e,t,r)=>t},{}],181:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$getField=void 0;const o=e("../../../core"),a=e("../../../util");r.$getField=(e,t,r)=>{t=(0,o.computeValue)(e,t,null,r);let n=e,i=t;return(0,a.isObject)(t)&&t.input&&t.field&&(n=t.input,i=t.field),(0,a.isNil)(n)?null:((0,a.assert)((0,a.isObject)(n),"$getField expression 'input' must evaluate to an object"),(0,a.assert)((0,a.isString)(i),"$getField expression 'field' must evaluate to a string"),n[i])}},{"../../../core":69,"../../../util":307}],182:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./getField"),r),i(e("./rand"),r),i(e("./sampleRate"),r)},{"./getField":181,"./rand":183,"./sampleRate":184}],183:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$rand=void 0;r.$rand=(e,t,r)=>Math.random()},{}],184:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$sampleRate=void 0;const n=e("../../../core");r.$sampleRate=(e,t,r)=>Math.random()<=(0,n.computeValue)(e,t,null,r)},{"../../../core":69}],185:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./mergeObjects"),r),i(e("./objectToArray"),r),i(e("./setField"),r),i(e("./unsetField"),r)},{"./mergeObjects":186,"./objectToArray":187,"./setField":188,"./unsetField":189}],186:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$mergeObjects=void 0;const n=e("../../../core"),i=e("../../../util");r.$mergeObjects=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return e instanceof Array?e.reduce((e,t)=>(0,i.into)(e,t),{}):{}}},{"../../../core":69,"../../../util":307}],187:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$objectToArray=void 0;const s=e("../../../core"),u=e("../../../util");r.$objectToArray=(e,t,r)=>{var n,i,e=(0,s.computeValue)(e,t,null,r),t=((0,u.assert)((0,u.isObject)(e),"$objectToArray expression must resolve to an object"),Object.entries(e)),o=new Array(t.length);let a=0;for([n,i]of t)o[a++]={k:n,v:i};return o}},{"../../../core":69,"../../../util":307}],188:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$setField=void 0;const n=e("../../../core"),i=e("../../../util");r.$setField=(e,t,r)=>{r=(0,n.computeValue)(e,t,null,r);return(0,i.isNil)(r.input)?null:((0,i.assert)((0,i.isObject)(r.input),"$setField expression 'input' must evaluate to an object"),(0,i.assert)((0,i.isString)(r.field),"$setField expression 'field' must evaluate to a string"),"$$REMOVE"==t.value?delete e[r.field]:e[r.field]=r.value,e)}},{"../../../core":69,"../../../util":307}],189:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$unsetField=void 0;const n=e("./setField");r.$unsetField=(e,t,r)=>(0,n.$setField)(e,Object.assign(Object.assign({},t),{value:"$$REMOVE"}),r)},{"./setField":188}],190:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$allElementsTrue=void 0;const n=e("../../../core"),i=e("../../../util");r.$allElementsTrue=(e,t,r)=>{return(0,n.computeValue)(e,t,null,r)[0].every(e=>(0,i.truthy)(e,r.useStrictMode))}},{"../../../core":69,"../../../util":307}],191:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$anyElementTrue=void 0;const n=e("../../../core"),i=e("../../../util");r.$anyElementTrue=(e,t,r)=>{return(0,n.computeValue)(e,t,null,r)[0].some(e=>(0,i.truthy)(e,r.useStrictMode))}},{"../../../core":69,"../../../util":307}],192:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./allElementsTrue"),r),i(e("./anyElementTrue"),r),i(e("./setDifference"),r),i(e("./setEquals"),r),i(e("./setIntersection"),r),i(e("./setIsSubset"),r),i(e("./setUnion"),r)},{"./allElementsTrue":190,"./anyElementTrue":191,"./setDifference":193,"./setEquals":194,"./setIntersection":195,"./setIsSubset":196,"./setUnion":197}],193:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$setDifference=void 0;const n=e("../../../core"),i=e("../../../util");r.$setDifference=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return e[0].filter(i.notInArray.bind(null,e[1]))}},{"../../../core":69,"../../../util":307}],194:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$setEquals=void 0;const n=e("../../../core"),i=e("../../../util");r.$setEquals=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r),t=(0,i.unique)(e[0],null==r?void 0:r.hashFunction),e=(0,i.unique)(e[1],null==r?void 0:r.hashFunction);return t.length===e.length&&t.length===(0,i.intersection)([t,e],null==r?void 0:r.hashFunction).length}},{"../../../core":69,"../../../util":307}],195:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$setIntersection=void 0;const n=e("../../../core"),i=e("../../../util");r.$setIntersection=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.assert)((0,i.isArray)(e)&&e.every(i.isArray),"$setIntersection: expresssion must resolve to array of arrays"),(0,i.intersection)(e,null==r?void 0:r.hashFunction)}},{"../../../core":69,"../../../util":307}],196:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$setIsSubset=void 0;const n=e("../../../core"),i=e("../../../util");r.$setIsSubset=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.intersection)(e,null==r?void 0:r.hashFunction).length===e[0].length}},{"../../../core":69,"../../../util":307}],197:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$setUnion=void 0;const n=e("../../../core"),i=e("../../../util");r.$setUnion=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.assert)((0,i.isArray)(e)&&2==e.length&&e.every(i.isArray),"$setUnion: arguments must be arrays"),(0,i.unique)(e[0].concat(e[1]),null==r?void 0:r.hashFunction)}},{"../../../core":69,"../../../util":307}],198:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.regexSearch=r.trimString=void 0;const l=e("../../../core"),f=e("../../../util"),u=[0,32,9,10,11,12,13,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202];r.trimString=function(e,t,r,n){var i=(e=(0,l.computeValue)(e,t,null,r)).input;if((0,f.isNil)(i))return null;var o=(0,f.isNil)(e.chars)?u:e.chars.split("").map(e=>e.codePointAt(0));let a=0,s=i.length-1;for(;n.left&&a<=s&&-1!==o.indexOf(i[a].codePointAt(0));)a++;for(;n.right&&a<=s&&-1!==o.indexOf(i[s].codePointAt(0));)s--;return i.substring(a,s+1)},r.regexSearch=function(e,t,r,n){if(e=(0,l.computeValue)(e,t,null,r),!(0,f.isString)(e.input))return[];(t=e.options)&&((0,f.assert)(-1===t.indexOf("x"),"extended capability option 'x' not supported"),(0,f.assert)(-1===t.indexOf("g"),"global option 'g' not supported"));let i=e.input;var o,a=new RegExp(e.regex,t),s=new Array;let u=0;for(;o=a.exec(i);){var c={match:o[0],idx:o.index+u,captures:[]};for(let e=1;e<o.length;e++)c.captures.push(o[e]||null);if(s.push(c),!n.global)break;u=o.index+o[0].length,i=i.substring(u)}return s}},{"../../../core":69,"../../../util":307}],199:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$concat=void 0;const n=e("../../../core"),i=e("../../../util");r.$concat=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return[null,void 0].some(i.inArray.bind(null,e))?null:e.join("")}},{"../../../core":69,"../../../util":307}],200:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./concat"),r),i(e("./indexOfBytes"),r),i(e("./ltrim"),r),i(e("./regexFind"),r),i(e("./regexFindAll"),r),i(e("./regexMatch"),r),i(e("./replaceAll"),r),i(e("./replaceOne"),r),i(e("./rtrim"),r),i(e("./split"),r),i(e("./strcasecmp"),r),i(e("./strLenBytes"),r),i(e("./strLenCP"),r),i(e("./substr"),r),i(e("./substrBytes"),r),i(e("./substrCP"),r),i(e("./toLower"),r),i(e("./toUpper"),r),i(e("./trim"),r)},{"./concat":199,"./indexOfBytes":201,"./ltrim":202,"./regexFind":203,"./regexFindAll":204,"./regexMatch":205,"./replaceAll":206,"./replaceOne":207,"./rtrim":208,"./split":209,"./strLenBytes":210,"./strLenCP":211,"./strcasecmp":212,"./substr":213,"./substrBytes":214,"./substrCP":215,"./toLower":216,"./toUpper":217,"./trim":218}],201:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$indexOfBytes=void 0;const a=e("../../../core"),s=e("../../../util");r.$indexOfBytes=(e,t,r)=>{e=(0,a.computeValue)(e,t,null,r),t="$indexOfBytes expression resolves to invalid an argument";if((0,s.isNil)(e[0]))return null;(0,s.assert)((0,s.isString)(e[0])&&(0,s.isString)(e[1]),t);var r=e[0],n=e[1],i=e[2],e=e[3],o=((0,s.isNil)(i)||(0,s.isNumber)(i)&&0<=i&&Math.round(i)===i)&&((0,s.isNil)(e)||(0,s.isNumber)(e)&&0<=e&&Math.round(e)===e);return(0,s.assert)(o,t),(e=e||r.length)<(i=i||0)?-1:-1<(o=r.substring(i,e).indexOf(n))?o+i:o}},{"../../../core":69,"../../../util":307}],202:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$ltrim=void 0;const n=e("./_internal");r.$ltrim=(e,t,r)=>(0,n.trimString)(e,t,r,{left:!0,right:!1})},{"./_internal":198}],203:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$regexFind=void 0;const n=e("./_internal");r.$regexFind=(e,t,r)=>{e=(0,n.regexSearch)(e,t,r,{global:!1});return e&&0<e.length?e[0]:null}},{"./_internal":198}],204:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$regexFindAll=void 0;const n=e("./_internal");r.$regexFindAll=(e,t,r)=>(0,n.regexSearch)(e,t,r,{global:!0})},{"./_internal":198}],205:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$regexMatch=void 0;const n=e("./_internal");r.$regexMatch=(e,t,r)=>0!=(0,n.regexSearch)(e,t,r,{global:!1}).length},{"./_internal":198}],206:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$replaceAll=void 0;const n=e("../../../core"),i=e("../../../util");r.$replaceAll=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r),t=[e.input,e.find,e.replacement];return t.some(i.isNil)?null:((0,i.assert)(t.every(i.isString),"$replaceAll expression fields must evaluate to string"),e.input.replace(new RegExp(e.find,"g"),e.replacement))}},{"../../../core":69,"../../../util":307}],207:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$replaceOne=void 0;const n=e("../../../core"),i=e("../../../util");r.$replaceOne=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r),t=[e.input,e.find,e.replacement];return t.some(i.isNil)?null:((0,i.assert)(t.every(i.isString),"$replaceOne expression fields must evaluate to string"),e.input.replace(e.find,e.replacement))}},{"../../../core":69,"../../../util":307}],208:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$rtrim=void 0;const n=e("./_internal");r.$rtrim=(e,t,r)=>(0,n.trimString)(e,t,r,{left:!1,right:!0})},{"./_internal":198}],209:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$split=void 0;const n=e("../../../core"),i=e("../../../util");r.$split=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.isNil)(e[0])?null:((0,i.assert)(e.every(i.isString),"$split expression must result to array(2) of strings"),e[0].split(e[1]))}},{"../../../core":69,"../../../util":307}],210:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$strLenBytes=void 0;const n=e("../../../core");r.$strLenBytes=(e,t,r)=>~-encodeURI((0,n.computeValue)(e,t,null,r)).split(/%..|./).length},{"../../../core":69}],211:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$strLenCP=void 0;const n=e("../../../core");r.$strLenCP=(e,t,r)=>(0,n.computeValue)(e,t,null,r).length},{"../../../core":69}],212:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$strcasecmp=void 0;const o=e("../../../core"),a=e("../../../util");r.$strcasecmp=(e,t,r)=>{e=(0,o.computeValue)(e,t,null,r);let n=e[0],i=e[1];return!(0,a.isEqual)(n,i)&&!e.every(a.isNil)&&((0,a.assert)(e.every(a.isString),"$strcasecmp must resolve to array(2) of strings"),n=n.toUpperCase(),i=i.toUpperCase(),n>i?1:n<i&&-1)||0}},{"../../../core":69,"../../../util":307}],213:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$substr=void 0;const n=e("../../../core"),i=e("../../../util");r.$substr=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r),t=e[0],r=e[1],e=e[2];return!(0,i.isString)(t)||r<0?"":e<0?t.substr(r):t.substr(r,e)}},{"../../../core":69,"../../../util":307}],214:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$substrBytes=void 0;const s=e("../../../core"),u=e("../../../util"),i=[192,224,240];function c(r){var n=[];for(let e=0,t=r.length;e<t;e++)n.push(function(e){if(e<128)return[e];let t=(e<2048?1:e<65536&&2)||3;for(var r=i[t-1],n=[(e>>6*t)+r];0<t;)n.push(128|e>>6*--t&63);return n}(r.codePointAt(e)));return n}r.$substrBytes=(e,t,r)=>{var e=(0,s.computeValue)(e,t,null,r),t=e[0],r=e[1],e=e[2],n=((0,u.assert)((0,u.isString)(t)&&(0,u.isNumber)(r)&&0<=r&&(0,u.isNumber)(e)&&0<=e,"$substrBytes: invalid arguments"),c(t)),i=[];let o=0;for(let e=0;e<n.length;e++)i.push(o),o+=n[e].length;var a=i.indexOf(r),r=i.indexOf(r+e);return(0,u.assert)(-1<a&&-1<r,"$substrBytes: invalid range, start or end index is a UTF-8 continuation byte."),t.substring(a,r)}},{"../../../core":69,"../../../util":307}],215:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$substrCP=void 0;const n=e("./substr");r.$substrCP=(e,t,r)=>(0,n.$substr)(e,t,r)},{"./substr":213}],216:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$toLower=void 0;const n=e("../../../core"),i=e("../../../util");r.$toLower=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.isEmpty)(e)?"":e.toLowerCase()}},{"../../../core":69,"../../../util":307}],217:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$toUpper=void 0;const n=e("../../../core"),i=e("../../../util");r.$toUpper=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.isEmpty)(e)?"":e.toUpperCase()}},{"../../../core":69,"../../../util":307}],218:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$trim=void 0;const n=e("./_internal");r.$trim=(e,t,r)=>(0,n.trimString)(e,t,r,{left:!0,right:!0})},{"./_internal":198}],219:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createTrignometryOperator=void 0;const a=e("../../../core"),s={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};r.createTrignometryOperator=function(n,e=s){const i=Object.assign({},s,e),o=new Set(Object.keys(i));return(e,t,r)=>{e=(0,a.computeValue)(e,t,null,r);if(o.has(""+e)){t=i[""+e];if(t instanceof Error)throw new Error(`cannot apply $${n.name} to -inf, value must in (-inf,inf)`);return t}return n(e)}}},{"../../../core":69}],220:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$acos=void 0;e=e("./_internal");r.$acos=(0,e.createTrignometryOperator)(Math.acos,{Infinity:1/0,0:new Error})},{"./_internal":219}],221:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$acosh=void 0;e=e("./_internal");r.$acosh=(0,e.createTrignometryOperator)(Math.acosh,{Infinity:1/0,0:new Error})},{"./_internal":219}],222:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$asin=void 0;e=e("./_internal");r.$asin=(0,e.createTrignometryOperator)(Math.asin)},{"./_internal":219}],223:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$asinh=void 0;e=e("./_internal");r.$asinh=(0,e.createTrignometryOperator)(Math.asinh,{Infinity:1/0,"-Infinity":-1/0})},{"./_internal":219}],224:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$atan=void 0;e=e("./_internal");r.$atan=(0,e.createTrignometryOperator)(Math.atan)},{"./_internal":219}],225:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$atan2=void 0;const n=e("../../../core"),i=e("../../../util");r.$atan2=(e,t,r)=>{var[e,t]=(0,n.computeValue)(e,t,null,r);return isNaN(e)||(0,i.isNil)(e)?e:isNaN(t)||(0,i.isNil)(t)?t:Math.atan2(e,t)}},{"../../../core":69,"../../../util":307}],226:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$atanh=void 0;e=e("./_internal");r.$atanh=(0,e.createTrignometryOperator)(Math.atanh,{1:1/0,"-1":-1/0})},{"./_internal":219}],227:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$cos=void 0;e=e("./_internal");r.$cos=(0,e.createTrignometryOperator)(Math.cos)},{"./_internal":219}],228:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$cosh=void 0;e=e("./_internal");r.$cosh=(0,e.createTrignometryOperator)(Math.cosh,{"-Infinity":1/0,Infinity:1/0})},{"./_internal":219}],229:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$degreesToRadians=void 0;e=e("./_internal");const n=Math.PI/180;r.$degreesToRadians=(0,e.createTrignometryOperator)(e=>e*n,{Infinity:1/0,"-Infinity":1/0})},{"./_internal":219}],230:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./acos"),r),i(e("./acosh"),r),i(e("./asin"),r),i(e("./asinh"),r),i(e("./atan"),r),i(e("./atan2"),r),i(e("./atanh"),r),i(e("./cos"),r),i(e("./cosh"),r),i(e("./degreesToRadians"),r),i(e("./radiansToDegrees"),r),i(e("./sin"),r),i(e("./sinh"),r),i(e("./tan"),r)},{"./acos":220,"./acosh":221,"./asin":222,"./asinh":223,"./atan":224,"./atan2":225,"./atanh":226,"./cos":227,"./cosh":228,"./degreesToRadians":229,"./radiansToDegrees":231,"./sin":232,"./sinh":233,"./tan":234}],231:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$radiansToDegrees=void 0;e=e("./_internal");const n=180/Math.PI;r.$radiansToDegrees=(0,e.createTrignometryOperator)(e=>e*n,{Infinity:1/0,"-Infinity":-1/0})},{"./_internal":219}],232:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$sin=void 0;e=e("./_internal");r.$sin=(0,e.createTrignometryOperator)(Math.sin)},{"./_internal":219}],233:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$sinh=void 0;e=e("./_internal");r.$sinh=(0,e.createTrignometryOperator)(Math.sinh,{"-Infinity":-1/0,Infinity:1/0})},{"./_internal":219}],234:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$tan=void 0;e=e("./_internal");r.$tan=(0,e.createTrignometryOperator)(Math.tan)},{"./_internal":219}],235:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.toInteger=r.TypeConvertError=void 0;const a=e("../../../core"),s=e("../../../util");class u extends Error{constructor(e){super(e)}}r.TypeConvertError=u,r.toInteger=function(e,t,r,n,i,o){if(e=(0,a.computeValue)(e,t,null,r),(0,s.isNil)(e))return null;if(e instanceof Date)return e.getTime();if(!0===e)return 1;if(!1===e)return 0;if(t=Number(e),(0,s.isNumber)(t)&&i<=t&&t<=n&&(!(0,s.isString)(e)||-1===t.toString().indexOf(".")))return Math.trunc(t);throw new u(`cannot convert '${e}' to `+o)}},{"../../../core":69,"../../../util":307}],236:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$convert=void 0;const i=e("../../../core"),o=e("../../../util"),a=e("./_internal"),s=e("./toBool"),u=e("./toDate"),c=e("./toDouble"),l=e("./toInt"),f=e("./toLong"),d=e("./toString");r.$convert=(e,t,r)=>{var n=(0,i.computeValue)(e,t,null,r);if(n.onNull=void 0===n.onNull?null:n.onNull,(0,o.isNil)(n.input))return n.onNull;try{switch(n.to){case 2:case"string":return(0,d.$toString)(e,n.input,r);case 8:case"boolean":case"bool":return(0,s.$toBool)(e,n.input,r);case 9:case"date":return(0,u.$toDate)(e,n.input,r);case 1:case 19:case"double":case"decimal":case"number":return(0,c.$toDouble)(e,n.input,r);case 16:case"int":return(0,l.$toInt)(e,n.input,r);case 18:case"long":return(0,f.$toLong)(e,n.input,r)}}catch(e){}if(void 0!==n.onError)return n.onError;throw new a.TypeConvertError(`could not convert to type ${n.to}.`)}},{"../../../core":69,"../../../util":307,"./_internal":235,"./toBool":239,"./toDate":240,"./toDouble":242,"./toInt":243,"./toLong":244,"./toString":245}],237:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./convert"),r),i(e("./isNumber"),r),i(e("./toBool"),r),i(e("./toDate"),r),i(e("./toDecimal"),r),i(e("./toDouble"),r),i(e("./toInt"),r),i(e("./toLong"),r),i(e("./toString"),r),i(e("./type"),r)},{"./convert":236,"./isNumber":238,"./toBool":239,"./toDate":240,"./toDecimal":241,"./toDouble":242,"./toInt":243,"./toLong":244,"./toString":245,"./type":246}],238:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$isNumber=void 0;const n=e("../../../core"),i=e("../../../util");r.$isNumber=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.isNumber)(e)}},{"../../../core":69,"../../../util":307}],239:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$toBool=void 0;const n=e("../../../core"),i=e("../../../util");r.$toBool=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);return(0,i.isNil)(e)?null:!!(0,i.isString)(e)||Boolean(e)}},{"../../../core":69,"../../../util":307}],240:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$toDate=void 0;const n=e("../../../core"),i=e("../../../util"),o=e("./_internal");r.$toDate=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);if(e instanceof Date)return e;if((0,i.isNil)(e))return null;t=new Date(e),r=t.getTime();if(isNaN(r))throw new o.TypeConvertError(`cannot convert '${e}' to date`);return t}},{"../../../core":69,"../../../util":307,"./_internal":235}],241:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$toDecimal=void 0;e=e("./toDouble");r.$toDecimal=e.$toDouble},{"./toDouble":242}],242:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$toDouble=void 0;const n=e("../../../core"),i=e("../../../util"),o=e("./_internal");r.$toDouble=(e,t,r)=>{e=(0,n.computeValue)(e,t,null,r);if((0,i.isNil)(e))return null;if(e instanceof Date)return e.getTime();if(!0===e)return 1;if(!1===e)return 0;t=Number(e);if((0,i.isNumber)(t))return t;throw new o.TypeConvertError(`cannot convert '${e}' to double/decimal`)}},{"../../../core":69,"../../../util":307,"./_internal":235}],243:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$toInt=void 0;const n=e("../../../util"),i=e("./_internal");r.$toInt=(e,t,r)=>(0,i.toInteger)(e,t,r,n.MAX_INT,n.MIN_INT,"int")},{"../../../util":307,"./_internal":235}],244:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$toLong=void 0;const n=e("../../../util"),i=e("./_internal");r.$toLong=(e,t,r)=>(0,i.toInteger)(e,t,r,n.MAX_LONG,n.MIN_LONG,"long")},{"../../../util":307,"./_internal":235}],245:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$toString=void 0;const i=e("../../../core"),o=e("../../../util"),a=e("../date/dateToString");r.$toString=(e,t,r)=>{var n=(0,i.computeValue)(e,t,null,r);return(0,o.isNil)(n)?null:n instanceof Date?(t={date:t,format:"%Y-%m-%dT%H:%M:%S.%LZ"},(0,a.$dateToString)(e,t,r)):n.toString()}},{"../../../core":69,"../../../util":307,"../date/dateToString":164}],246:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$type=void 0;const o=e("../../../core"),a=e("../../../util");r.$type=(e,t,r)=>{var n=(0,o.computeValue)(e,t,null,r),i=(0,a.getType)(n).toLowerCase();switch(i){case"boolean":return"bool";case"number":return 0<=n.toString().indexOf(".")?"double":n>=a.MIN_INT&&n<=a.MAX_INT?"int":"long";case"regexp":return"regex";default:return i}}},{"../../../core":69,"../../../util":307}],247:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./let"),r)},{"./let":248}],248:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$let=void 0;const a=e("../../../core");r.$let=(e,t,r)=>{var n,i,o={};for([n,i]of Object.entries(t.vars))o[n]=(0,a.computeValue)(e,i,null,r);return(0,a.computeValue)(e,t.in,null,a.ComputeOptions.init(r,e,{variables:o}))}},{"../../../core":69}],249:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isUnbounded=void 0;r.isUnbounded=e=>{e=(null==e?void 0:e.documents)||(null==e?void 0:e.range);return!e||"unbounded"===e[0]&&"unbounded"===e[1]}},{}],250:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$addFields=void 0;const s=e("../../core"),u=e("../../util");r.$addFields=(e,i,o)=>{const a=Object.keys(i);return 0===a.length?e:e.map(e=>{var t=Object.assign({},e);for(const n of a){var r=(0,s.computeValue)(e,i[n],null,o);void 0!==r?(0,u.setValue)(t,n,r):(0,u.removeValue)(t,n)}return t})}},{"../../core":69,"../../util":307}],251:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$bucket=void 0;const d=e("../../core"),p=e("../../lazy"),h=e("../../util");r.$bucket=(e,r,n)=>{const i=[...r.boundaries],o=r.default,a=i[0],s=i[i.length-1],u=r.output||{count:{$sum:1}};(0,h.assert)(2<r.boundaries.length,"$bucket 'boundaries' expression must have at least 3 elements");var c=(0,h.getType)(a);for(let e=0,t=i.length-1;e<t;e++)(0,h.assert)(c===(0,h.getType)(i[e+1]),"$bucket 'boundaries' must all be of the same type"),(0,h.assert)((0,h.compare)(i[e],i[e+1])<0,"$bucket 'boundaries' must be sorted in ascending order");(0,h.isNil)(o)||(0,h.getType)(r.default)!==(0,h.getType)(a)||(0,h.assert)(0<=(0,h.compare)(r.default,s)||(0,h.compare)(r.default,a)<0,"$bucket 'default' expression must be out of boundaries range");const l={};for(const f of i)l[f]=[];(0,h.isNil)(o)||(l[o]=[]);let t;return(0,p.Lazy)(()=>(t||(e.each(e=>{var t=(0,d.computeValue)(e,r.groupBy,null,n);((0,h.isNil)(t)||(0,h.compare)(t,a)<0||0<=(0,h.compare)(t,s)?((0,h.assert)(!(0,h.isNil)(o),"$bucket require a default for out of range values"),l[o]):((0,h.assert)(0<=(0,h.compare)(t,a)&&(0,h.compare)(t,s)<0,"$bucket 'groupBy' expression must resolve to a value in range of boundaries"),t=function(e,t){let r=0,n=e.length-1;for(;r<=n;){var i=Math.round(r+(n-r)/2);if((0,h.compare)(t,e[i])<0)n=i-1;else{if(!(0<(0,h.compare)(t,e[i])))return i;r=i+1}}return r}(i,t),t=i[Math.max(0,t-1)],l[t])).push(e)}),i.pop(),(0,h.isNil)(o)||i.push(o),t=(0,p.Lazy)(i).map(e=>{var t=(0,d.computeValue)(l[e],u,null,n);return(0,h.into)(t,{_id:e})})),t.next()))}},{"../../core":69,"../../lazy":71,"../../util":307}],252:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$bucketAuto=void 0;const m=e("../../core"),b=e("../../util");r.$bucketAuto=(e,t,d)=>{const p=t.output||{count:{$sum:1}},h=t.groupBy,y=t.buckets;(0,b.assert)(0<y,"The $bucketAuto 'buckets' field must be greater than 0, but found: "+y);return e.transform(e=>{var r=Math.max(1,Math.round(e.length/y));const n=(0,b.memoize)(m.computeValue,null==d?void 0:d.hashFunction),i=new Map,o=[];var a=(0,b.sortBy)(e,e=>{var t=n(e,h,null,d);return((0,b.isNil)(t)?o:(i.has(t)||i.set(t,[]),i.get(t))).push(e),t}),s=[];let u=0;for(let e=0,t=a.length;e<y&&u<t;e++){var c={},l=[];for(let e=0;e<r&&u<t;e++){let e=n(a[u],h,null,d);(0,b.isNil)(e)&&(e=null),(0,b.into)(l,(0,b.isNil)(e)?o:i.get(e)),u+=((0,b.isNil)(e)?o:i.get(e)).length,(0,b.has)(c,"min")||(c.min=e),0<s.length&&(s[s.length-1]._id.max=c.min)}e==y-1&&(0,b.into)(l,a.slice(u));var f=(0,m.computeValue)(l,p,null,d);s.push((0,b.into)(f,{_id:c}))}return 0<s.length&&(s[s.length-1]._id.max=n(a[a.length-1],h,null,d)),s})}},{"../../core":69,"../../util":307}],253:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$count=void 0;const n=e("../../lazy"),i=e("../../util");r.$count=(e,t,r)=>((0,i.assert)((0,i.isString)(t)&&""!==t.trim()&&-1===t.indexOf(".")&&"$"!==t.trim()[0],"Invalid expression value for $count"),(0,n.Lazy)([{[t]:e.size()}]))},{"../../lazy":71,"../../util":307}],254:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$facet=void 0;const a=e("../../aggregator"),s=e("../../core");r.$facet=(e,i,o)=>e.transform(e=>{var t,r,n={};for([t,r]of Object.entries(i))n[t]=new a.Aggregator(r,Object.assign(Object.assign({},o),{processingMode:s.ProcessingMode.CLONE_INPUT})).run(e);return[n]})},{"../../aggregator":68,"../../core":69}],255:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$fill=void 0;const c=e("../../core"),l=e("../../util"),f=e("../expression/conditional/ifNull"),d=e("../window/linearFill"),p=e("../window/locf"),h=e("./addFields"),y=e("./setWindowFields"),m={locf:"$locf",linear:"$linearFill"};r.$fill=(e,t,r)=>{(0,l.assert)(!t.sortBy||(0,l.isObject)(t.sortBy),"sortBy must be an object."),(0,l.assert)(!!t.sortBy||Object.values(t.output).every(e=>(0,l.has)(e,"value")),"sortBy required if any output field specifies a 'method'."),(0,l.assert)(!(t.partitionBy&&t.partitionByFields),"specify either partitionBy or partitionByFields."),(0,l.assert)(!t.partitionByFields||(null==(a=null==t?void 0:t.partitionByFields)?void 0:a.every(e=>"$"!==e[0])),"fields in partitionByFields cannot begin with '$'."),(r=(0,c.initOptions)(r)).context.addExpressionOps({$ifNull:f.$ifNull}),r.context.addWindowOps({$locf:p.$locf,$linearFill:d.$linearFill});var n,i,o,a=t.partitionBy||(null==(a=null==t?void 0:t.partitionByFields)?void 0:a.map(e=>"$"+e)),s={},u={};for([n,i]of Object.entries(t.output))(0,l.has)(i,"value")?s[n]={$ifNull:["$$CURRENT."+n,i.value]}:(o=m[i.method],(0,l.assert)(!!o,`invalid fill method '${i.method}'.`),u[n]={[o]:"$"+n});return 0<Object.keys(u).length&&(e=(0,y.$setWindowFields)(e,{sortBy:t.sortBy||{},partitionBy:a,output:u},r)),e=0<Object.keys(s).length?(0,h.$addFields)(e,s,r):e}},{"../../core":69,"../../util":307,"../expression/conditional/ifNull":152,"../window/linearFill":304,"../window/locf":305,"./addFields":250,"./setWindowFields":269}],256:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$group=void 0;const l=e("../../core"),n=e("../../util");r.$group=(e,u,t)=>{(0,n.assert)((0,n.has)(u,"_id"),"a group specification must include an _id");const r=u._id,c=l.ComputeOptions.init(t);return e.transform(e=>{const i=(0,n.groupBy)(e,e=>(0,l.computeValue)(e,r,null,t),t.hashFunction);delete(u=Object.assign({},u))._id;let o=-1;const a=Array.from(i.keys()),s=i.size;return()=>{if(++o===s)return{done:!0};var e,t,r=a[o],n={};void 0!==r&&(n._id=r);for([e,t]of Object.entries(u))n[e]=(0,l.computeValue)(i.get(r),t,e,c.update(null,{groupId:r}));return{value:n,done:!1}}})}},{"../../core":69,"../../util":307}],257:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./addFields"),r),i(e("./bucket"),r),i(e("./bucketAuto"),r),i(e("./count"),r),i(e("./facet"),r),i(e("./fill"),r),i(e("./group"),r),i(e("./limit"),r),i(e("./lookup"),r),i(e("./match"),r),i(e("./merge"),r),i(e("./out"),r),i(e("./project"),r),i(e("./redact"),r),i(e("./replaceRoot"),r),i(e("./replaceWith"),r),i(e("./sample"),r),i(e("./set"),r),i(e("./setWindowFields"),r),i(e("./skip"),r),i(e("./sort"),r),i(e("./sortByCount"),r),i(e("./unionWith"),r),i(e("./unset"),r),i(e("./unwind"),r)},{"./addFields":250,"./bucket":251,"./bucketAuto":252,"./count":253,"./facet":254,"./fill":255,"./group":256,"./limit":258,"./lookup":259,"./match":260,"./merge":261,"./out":262,"./project":263,"./redact":264,"./replaceRoot":265,"./replaceWith":266,"./sample":267,"./set":268,"./setWindowFields":269,"./skip":270,"./sort":271,"./sortByCount":272,"./unionWith":273,"./unset":274,"./unwind":275}],258:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$limit=void 0;r.$limit=(e,t,r)=>e.take(t)},{}],259:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$lookup=void 0;const s=e("../../util");r.$lookup=(e,r,n)=>{var t=(0,s.isString)(r.from)?null==n?void 0:n.collectionResolver(r.from):r.from;(0,s.assert)(t instanceof Array,"'from' field must resolve to an array");const i={};for(const a of t){var o=(0,s.hashCode)((0,s.resolve)(a,r.foreignField),null==n?void 0:n.hashFunction);i[o]=i[o]||[],i[o].push(a)}return e.map(e=>{var t=(0,s.hashCode)((0,s.resolve)(e,r.localField),null==n?void 0:n.hashFunction),e=(0,s.into)({},e);return e[r.as]=i[t]||[],e})}},{"../../util":307}],260:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$match=void 0;const i=e("../../query");r.$match=(e,t,r)=>{const n=new i.Query(t,r);return e.filter(e=>n.test(e))}},{"../../query":306}],261:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$merge=void 0;const f=e("../../aggregator"),d=e("../../core"),p=e("../../util"),h=e("../expression");r.$merge=(e,o,a)=>{const s=(0,p.isString)(o.into)?null==a?void 0:a.collectionResolver(o.into):o.into,r=((0,p.assert)(s instanceof Array,"$merge: option 'into' must resolve to an array"),o.on||a.idKey),u=t=>{var e=(0,p.isString)(r)?(0,p.resolve)(t,r):r.map(e=>(0,p.resolve)(t,e));return(0,p.hashCode)(e,a.hashFunction)},c={};for(let e=0;e<s.length;e++){var t=s[e],n=u(t);(0,p.assert)(!c[n],"$merge: 'into' collection must have unique entries for the 'on' field."),c[n]=[t,e]}const l=d.ComputeOptions.init(a);return e.map(e=>{var t=u(e);if(c[t]){var[r,n]=c[t],i=(0,d.computeValue)(r,o.let||{new:"$$ROOT"},null,l.update(e));if((0,p.isArray)(o.whenMatched)){t=new f.Aggregator(o.whenMatched,Object.assign(Object.assign({},a),{variables:i}));s[n]=t.run([r])[0]}else switch(o.whenMatched){case"replace":s[n]=e;break;case"fail":throw new Error("$merge: failed due to matching as specified by 'whenMatched' option.");case"keepExisting":break;default:s[n]=(0,h.$mergeObjects)(r,[r,e],l.update(e,{variables:i}))}}else switch(o.whenNotMatched){case"discard":break;case"fail":throw new Error("$merge: failed due to matching as specified by 'whenMatched' option.");default:s.push(e)}return e})}},{"../../aggregator":68,"../../core":69,"../../util":307,"../expression":179}],262:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$out=void 0;const i=e("../../util");r.$out=(e,t,r)=>{const n=(0,i.isString)(t)?null==r?void 0:r.collectionResolver(t):t;return(0,i.assert)(n instanceof Array,"expression must resolve to an array"),e.map(e=>(n.push((0,i.cloneDeep)(e)),e))}},{"../../util":307}],263:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$project=void 0;const v=e("../../core"),g=e("../../util");function O(e,t){var r,n,i=[!1,!1];for([r,n]of Object.entries(e)){if(r===(null==t?void 0:t.idKey))return;0===n||!1===n?i[0]=!0:1!==n&&!0!==n||(i[1]=!0),(0,g.assert)(!(i[0]&&i[1]),"Projection cannot have a mix of inclusion and exclusion.")}}r.$project=(e,t,r)=>{if((0,g.isEmpty)(t))return e;let n=Object.keys(t),i=!1;O(t,r);var o,a=r.idKey;(0,g.inArray)(n,a)?0!==(o=t[a])&&!1!==o||(n=n.filter(g.notInArray.bind(null,[a])),i=0==n.length):n.push(a);const s=v.ComputeOptions.init(r);return e.map(e=>function r(n,e,i,t,o){let a={};let s=!1;let u=!1;const c=[];o&&c.push(i.idKey);for(const l of t){let t=void 0;const f=e[l];if(l!==i.idKey&&(0,g.inArray)([0,!1],f)&&(u=!0),l===i.idKey&&(0,g.isEmpty)(f))t=n[l];else if((0,g.isString)(f))t=(0,v.computeValue)(n,f,l,i);else if(!(0,g.inArray)([1,!0],f))if(f instanceof Array)t=f.map(e=>{const t=(0,v.computeValue)(n,e,null,i);return(0,g.isNil)(t)?null:t});else{if(!(0,g.isObject)(f)){c.push(l);continue}{const p=f,h=Object.keys(f),y=1==h.length?h[0]:"",m=(0,v.getOperator)(v.OperatorType.PROJECTION,y,i);if(m)"$slice"===y?(0,g.ensureArray)(p[y]).every(g.isNumber)?(t=m(n,p[y],l,i),s=!0):t=(0,v.computeValue)(n,p,l,i):t=m(n,p[y],l,i);else if((0,g.isOperator)(y))t=(0,v.computeValue)(n,p[y],y,i);else if((0,g.has)(n,l)){O(p,i);let e=n[l];t=e instanceof Array?e.map(e=>r(e,p,i,h,!1)):(e=(0,g.isObject)(e)?e:n,r(e,p,i,h,!1))}else t=(0,v.computeValue)(n,f,null,i)}}const d=(0,g.resolveGraph)(n,l,{preserveMissing:!0});void 0!==d&&(0,g.merge)(a,d,{flatten:!0}),(0,g.notInArray)([0,1,!1,!0],f)&&(void 0===t?(0,g.removeValue)(a,l,{descendArray:!0}):(0,g.setValue)(a,l,t))}(0,g.filterMissing)(a);if((s||u||o)&&(a=(0,g.into)({},n,a),0<c.length))for(const b of c)(0,g.removeValue)(a,b,{descendArray:!0});return a}(e,t,s.update(e),n,i))}},{"../../core":69,"../../util":307}],264:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$redact=void 0;const i=e("../../core");r.$redact=(e,t,r)=>{const n=i.ComputeOptions.init(r);return e.map(e=>(0,i.redact)(e,t,n.update(e)))}},{"../../core":69}],265:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$replaceRoot=void 0;const n=e("../../core"),i=e("../../util");r.$replaceRoot=(e,t,r)=>e.map(e=>(e=(0,n.computeValue)(e,t.newRoot,null,r),(0,i.assert)((0,i.isObject)(e),"$replaceRoot expression must return an object"),e))},{"../../core":69,"../../util":307}],266:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$replaceWith=void 0;e=e("./replaceRoot");r.$replaceWith=e.$replaceRoot},{"./replaceRoot":265}],267:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$sample=void 0;r.$sample=(e,i,t)=>e.transform(t=>{const r=t.length;let n=-1;return()=>{var e;return++n===i.size?{done:!0}:(e=Math.floor(Math.random()*r),{value:t[e],done:!1})}})},{}],268:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$set=void 0;e=e("./addFields");r.$set=e.$addFields},{"./addFields":250}],269:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$setWindowFields=void 0;const i=e("../../core"),w=e("../../lazy"),S=e("../../util"),o=e("../expression"),x=e("../expression/date/dateAdd"),j=e("./_internal"),P=e("./addFields"),a=e("./group"),s=e("./sort"),u=new Set(["$denseRank","$documentNumber","$first","$last","$linearFill","$rank","$shift"]),c=new Set(["$denseRank","$expMovingAvg","$linearFill","$locf","$rank","$shift"]);r.$setWindowFields=(e,O,_)=>{(_=(0,i.initOptions)(_)).context.addExpressionOps({$function:o.$function});for(const n of Object.values(O.output)){var t=Object.keys(n),r=t.find(S.isOperator);(0,S.assert)(!!(0,i.getOperator)(i.OperatorType.WINDOW,r,_)||!!(0,i.getOperator)(i.OperatorType.ACCUMULATOR,r,_),`'${r}' is not a valid window operator`),(0,S.assert)(0<t.length&&t.length<=2&&(1==t.length||t.includes("window")),"'output' option should have a single window operator."),null!==n&&void 0!==n&&n.window&&({documents:r,range:t}=n.window,(0,S.assert)(!!r&&!t||!r&&!!t||!r&&!t,"'window' option supports only one of 'documents' or 'range'."))}return O.sortBy&&(e=(0,s.$sort)(e,O.sortBy,_)),(e=(0,a.$group)(e,{_id:O.partitionBy,items:{$push:"$$CURRENT"}},_)).transform(e=>{const v=[],g=[];for(var[t,r]of Object.entries(O.output)){var n=Object.keys(r).find(S.isOperator),t={operatorName:n,func:{left:(0,i.getOperator)(i.OperatorType.ACCUMULATOR,n,_),right:(0,i.getOperator)(i.OperatorType.WINDOW,n,_)},args:r[n],field:t,window:r.window};(0,S.assert)(!!O.sortBy||!(u.has(n)||!t.window),`${u.has(n)?`'${n}'`:"bounded window operation"} requires a sortBy.`),(0,S.assert)(!t.window||!c.has(n),n+" does not accept a 'window' field."),g.push(t)}return e.forEach(e=>{const s=e.items;let t=(0,w.Lazy)(s);const r={};for(const i of g){const{func:o,args:a,field:u,window:c}=i;var n=t=>{let r=-1;return e=>(++r,o.left?o.left(t(e,r),a,_):o.right?o.right(e,t(e,r),{parentExpr:O,inputExpr:a,documentNumber:r+1,field:u},_):void 0)};if(c){const{documents:l,range:f,unit:d}=c,p=l||f;if(!(0,j.isUnbounded)(c)){const[h,y]=p,m=e=>"current"==h?e:"unbounded"==h?0:Math.max(h+e,0),b=e=>"current"==y?e+1:"unbounded"==y?s.length:y+e+1;r[u]=n((t,e)=>{if(l||p.every(S.isString))return s.slice(m(e),b(e));const r=Object.keys(O.sortBy)[0];let n,i;var o;i=d?(o=e=>(0,x.$dateAdd)(t,{startDate:new Date(t[r]),unit:d,amount:e},_).getTime(),n=(0,S.isNumber)(h)?o(h):-1/0,(0,S.isNumber)(y)?o(y):1/0):(o=t[r],n=(0,S.isNumber)(h)?o+h:-1/0,(0,S.isNumber)(y)?o+y:1/0);let a=s;return"current"==h&&(a=s.slice(e)),(a="current"==y?s.slice(0,e+1):a).filter(e=>{e=+e[r];return e>=n&&e<=i})})}}r[u]||(r[u]=n(e=>s)),t=(0,P.$addFields)(t,{[u]:{$function:{body:e=>r[u](e),args:["$$CURRENT"]}}},_)}v.push(t)}),(0,w.compose)(...v)})}},{"../../core":69,"../../lazy":71,"../../util":307,"../expression":179,"../expression/date/dateAdd":158,"./_internal":249,"./addFields":250,"./group":256,"./sort":271}],270:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$skip=void 0;r.$skip=(e,t,r)=>e.drop(t)},{}],271:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$sort=void 0;const s=e("../../util");r.$sort=(e,i,o)=>{if((0,s.isEmpty)(i)||!(0,s.isObject)(i))return e;let a=s.compare;var t=o.collation;return(0,s.isObject)(t)&&(0,s.isString)(t.locale)&&(a=function(e){var t={sensitivity:u[e.strength||3],caseFirst:"off"!==e.caseFirst&&e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:"shifted"===e.alternate};!0===(e.caseLevel||!1)&&("base"===t.sensitivity&&(t.sensitivity="case"),"accent"===t.sensitivity)&&(t.sensitivity="variant");const n=new Intl.Collator(e.locale,t);return(e,t)=>{var r;return(0,s.isString)(e)&&(0,s.isString)(t)?(r=n.compare(e,t))<0?-1:0<r?1:0:(0,s.compare)(e,t)}}(t)),e.transform(e=>{for(const r of Object.keys(i).reverse()){const n=(0,s.groupBy)(e,e=>(0,s.resolve)(e,r),o.hashFunction);var t=Array.from(n.keys()).sort(a);-1===i[r]&&t.reverse(),t.reduce((e,t)=>(0,s.into)(e,n.get(t)),e=[])}return e})};const u={1:"base",2:"accent",3:"variant"}},{"../../util":307}],272:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$sortByCount=void 0;const i=e("./group"),o=e("./sort");r.$sortByCount=(e,t,r)=>{var n={count:{$sum:1}};return n._id=t,(0,o.$sort)((0,i.$group)(e,n,r),{count:-1},r)}},{"./group":256,"./sort":271}],273:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$unionWith=void 0;const i=e("../../aggregator"),o=e("../../lazy"),a=e("../../util");r.$unionWith=(e,t,r)=>{var n=(0,a.isString)(t.coll)?r.collectionResolver(t.coll):t.coll,e=[e];return e.push(t.pipeline?new i.Aggregator(t.pipeline,r).stream(n):(0,o.Lazy)(n)),(0,o.compose)(...e)}},{"../../aggregator":68,"../../lazy":71,"../../util":307}],274:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$unset=void 0;const o=e("../../util"),a=e("./project");r.$unset=(e,t,r)=>{var n={};for(const i of t=(0,o.ensureArray)(t))n[i]=0;return(0,a.$project)(e,n,r)}},{"../../util":307,"./project":263}],275:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$unwind=void 0;const u=e("../../lazy"),c=e("../../util");r.$unwind=(t,e,r)=>{const i=(e=(0,c.isString)(e)?{path:e}:e).path.substring(1),n=(null==e?void 0:e.includeArrayIndex)||!1,o=e.preserveNullAndEmptyArrays||!1,a=(e,t)=>(!1!==n&&(e[n]=t),e);let s;return(0,u.Lazy)(()=>{for(;;){if(s instanceof u.Iterator){var e=s.next();if(!e.done)return e}e=t.next();if(e.done)return e;const n=e.value;if((s=(0,c.resolve)(n,i))instanceof Array){if(0===s.length&&!0===o)return(s=null,c.removeValue)(n,i),{value:a(n,null),done:!1};s=(0,u.Lazy)(s).map((e,t)=>{var r=(0,c.resolveGraph)(n,i,{preserveKeys:!0});return(0,c.setValue)(r,i,e),a(r,t)})}else if(!(0,c.isEmpty)(s)||!0===o)return{value:a(n,null),done:!1}}})}},{"../../lazy":71,"../../util":307}],276:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$all=void 0;e=e("../../_predicates");r.$all=(0,e.createQueryOperator)(e.$all)},{"../../_predicates":72}],277:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$elemMatch=void 0;e=e("../../_predicates");r.$elemMatch=(0,e.createQueryOperator)(e.$elemMatch)},{"../../_predicates":72}],278:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./all"),r),i(e("./elemMatch"),r),i(e("./size"),r)},{"./all":276,"./elemMatch":277,"./size":279}],279:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$size=void 0;e=e("../../_predicates");r.$size=(0,e.createQueryOperator)(e.$size)},{"../../_predicates":72}],280:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$eq=void 0;e=e("../../_predicates");r.$eq=(0,e.createQueryOperator)(e.$eq)},{"../../_predicates":72}],281:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$gt=void 0;e=e("../../_predicates");r.$gt=(0,e.createQueryOperator)(e.$gt)},{"../../_predicates":72}],282:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$gte=void 0;e=e("../../_predicates");r.$gte=(0,e.createQueryOperator)(e.$gte)},{"../../_predicates":72}],283:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$in=void 0;e=e("../../_predicates");r.$in=(0,e.createQueryOperator)(e.$in)},{"../../_predicates":72}],284:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$nin=r.$ne=r.$lte=r.$lt=r.$in=r.$gte=r.$gt=r.$eq=void 0;var n=e("./eq"),i=(Object.defineProperty(r,"$eq",{enumerable:!0,get:function(){return n.$eq}}),e("./gt")),o=(Object.defineProperty(r,"$gt",{enumerable:!0,get:function(){return i.$gt}}),e("./gte")),a=(Object.defineProperty(r,"$gte",{enumerable:!0,get:function(){return o.$gte}}),e("./in")),s=(Object.defineProperty(r,"$in",{enumerable:!0,get:function(){return a.$in}}),e("./lt")),u=(Object.defineProperty(r,"$lt",{enumerable:!0,get:function(){return s.$lt}}),e("./lte")),c=(Object.defineProperty(r,"$lte",{enumerable:!0,get:function(){return u.$lte}}),e("./ne")),l=(Object.defineProperty(r,"$ne",{enumerable:!0,get:function(){return c.$ne}}),e("./nin"));Object.defineProperty(r,"$nin",{enumerable:!0,get:function(){return l.$nin}})},{"./eq":280,"./gt":281,"./gte":282,"./in":283,"./lt":285,"./lte":286,"./ne":287,"./nin":288}],285:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$lt=void 0;e=e("../../_predicates");r.$lt=(0,e.createQueryOperator)(e.$lt)},{"../../_predicates":72}],286:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$lte=void 0;e=e("../../_predicates");r.$lte=(0,e.createQueryOperator)(e.$lte)},{"../../_predicates":72}],287:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$ne=void 0;e=e("../../_predicates");r.$ne=(0,e.createQueryOperator)(e.$ne)},{"../../_predicates":72}],288:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$nin=void 0;e=e("../../_predicates");r.$nin=(0,e.createQueryOperator)(e.$nin)},{"../../_predicates":72}],289:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$exists=void 0;e=e("../../_predicates");r.$exists=(0,e.createQueryOperator)(e.$exists)},{"../../_predicates":72}],290:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./exists"),r),i(e("./type"),r)},{"./exists":289,"./type":291}],291:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$type=void 0;e=e("../../_predicates");r.$type=(0,e.createQueryOperator)(e.$type)},{"../../_predicates":72}],292:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$expr=void 0;const n=e("../../../core");r.$expr=function(e,t,r){return e=>(0,n.computeValue)(e,t,null,r)}},{"../../../core":69}],293:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./expr"),r),i(e("./jsonSchema"),r),i(e("./mod"),r),i(e("./regex"),r),i(e("./where"),r)},{"./expr":292,"./jsonSchema":294,"./mod":295,"./regex":296,"./where":297}],294:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$jsonSchema=void 0,r.$jsonSchema=function(e,t,r){if(null==r||!r.jsonSchemaValidator)throw new Error("Missing option 'jsonSchemaValidator'. Configure to use '$jsonSchema' operator.");const n=null==r?void 0:r.jsonSchemaValidator(t);return e=>n(e)}},{}],295:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$mod=void 0;e=e("../../_predicates");r.$mod=(0,e.createQueryOperator)(e.$mod)},{"../../_predicates":72}],296:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$regex=void 0;e=e("../../_predicates");r.$regex=(0,e.createQueryOperator)(e.$regex)},{"../../_predicates":72}],297:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$where=void 0;const i=e("../../../util");r.$where=function(e,t,r){(0,i.assert)(r.scriptEnabled,"$where operator requires 'scriptEnabled' option to be true");const n=t;return(0,i.assert)((0,i.isFunction)(n),"$where only accepts a Function object"),e=>(0,i.truthy)(n.call(e),null==r?void 0:r.useStrictMode)}},{"../../../util":307}],298:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$and=void 0;const i=e("../../../query"),o=e("../../../util");r.$and=(e,t,r)=>{(0,o.assert)((0,o.isArray)(t),"Invalid expression: $and expects value to be an Array.");const n=t.map(e=>new i.Query(e,r));return t=>n.every(e=>e.test(t))}},{"../../../query":306,"../../../util":307}],299:[function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e("./and"),r),i(e("./nor"),r),i(e("./not"),r),i(e("./or"),r)},{"./and":298,"./nor":300,"./not":301,"./or":302}],300:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$nor=void 0;const i=e("../../../util"),o=e("./or");r.$nor=(e,t,r)=>{(0,i.assert)((0,i.isArray)(t),"Invalid expression. $nor expects value to be an array.");const n=(0,o.$or)("$or",t,r);return e=>!n(e)}},{"../../../util":307,"./or":302}],301:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$not=void 0;const o=e("../../../query"),a=e("../../../util");r.$not=(e,t,r)=>{var n={};n[e]=(0,a.normalize)(t);const i=new o.Query(n,r);return e=>!i.test(e)}},{"../../../query":306,"../../../util":307}],302:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$or=void 0;const i=e("../../../query"),o=e("../../../util");r.$or=(e,t,r)=>{(0,o.assert)((0,o.isArray)(t),"Invalid expression. $or expects value to be an Array");const n=t.map(e=>new i.Query(e,r));return t=>n.some(e=>e.test(t))}},{"../../../query":306,"../../../util":307}],303:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.rank=r.withMemo=r.MILLIS_PER_UNIT=void 0;const c=e("../../util"),n=e("../accumulator");var i=e("../expression/date/_internal");const a=e("../pipeline/_internal"),s=(r.MILLIS_PER_UNIT={week:7*i.MILLIS_PER_DAY,day:i.MILLIS_PER_DAY,hour:i.MILLIS_PER_DAY/24,minute:6e4,second:1e3,millisecond:1},new WeakMap);function o(e,t,r,n){if(!(0,a.isUnbounded)(t.parentExpr.output[t.field].window))return n(r());s.has(e)||s.set(e,{[t.field]:r()});var i=s.get(e);void 0===i[t.field]&&(i[t.field]=r());let o=!1;try{return n(i[t.field])}catch(e){o=!0}finally{!o&&t.documentNumber!==e.length||(delete i[t.field],0!==Object.keys(i).length)||s.delete(e)}}r.withMemo=o,r.rank=function(e,a,s,t,u){return o(a,s,()=>{var e="$"+Object.keys(s.parentExpr.sortBy)[0];const r=(0,n.$push)(a,e,t);e=(0,c.groupBy)(r,(e,t)=>r[t],t.hashFunction);return{values:r,groups:e}},e=>{var{values:e,groups:t}=e;if(t.size==a.length)return s.documentNumber;var r=e[s.documentNumber-1];let n=0,i=0;for(const o of t.keys()){if((0,c.isEqual)(r,o))return u?n+1:i+1;n++,i+=t.get(o).length}throw new Error("rank: invalid return value. please submit a bug report.")})}},{"../../util":307,"../accumulator":84,"../expression/date/_internal":157,"../pipeline/_internal":249}],304:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$linearFill=void 0;const d=e("../../util"),p=e("../accumulator"),n=e("./_internal");r.$linearFill=function(e,c,l,f){return(0,n.withMemo)(c,l,()=>{var e,t,r,n,i,o="$"+Object.keys(l.parentExpr.sortBy)[0],a=(0,p.$push)(c,[o,l.inputExpr],f).filter(([e])=>(0,d.isNumber)(+e));if(a.length!==c.length)return null;let s=-1,u=0;for(;u<a.length;){for(;s+1<a.length&&(0,d.isNumber)(a[s+1][1]);)s++,u=s;for(;u+1<a.length&&!(0,d.isNumber)(a[u+1][1]);)u++;if(u+1>=a.length)break;for(u++;s+1<u;)a[s+1][1]=(e=a[s][0],t=a[s][1],r=a[u][0],n=a[u][1],i=a[s+1][0],t+(n-t)/(r-e)*(i-e)),s++;s=u}return a.map(([,e])=>e)},e=>e[l.documentNumber-1])}},{"../../util":307,"../accumulator":84,"./_internal":303}],305:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$locf=void 0;const o=e("../../util"),a=e("../accumulator/push"),s=e("./_internal");r.$locf=function(e,r,n,i){return(0,s.withMemo)(r,n,()=>{var t=(0,a.$push)(r,n.inputExpr,i);for(let e=1;e<t.length;e++)(0,o.isNil)(t[e])&&(t[e]=t[e-1]);return t},e=>e[n.documentNumber-1])}},{"../../util":307,"../accumulator/push":92,"./_internal":303}],306:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Query=void 0;const i=e("./core"),n=e("./cursor"),o=e("./util");r.Query=class{constructor(e,t){this.condition=e,this.options=(0,i.initOptions)(t),this.compiled=[],this.compile()}compile(){(0,o.assert)((0,o.isObject)(this.condition),"query criteria must be an object");var e,t,r={};for([e,t]of Object.entries(this.condition)){if("$where"===e)Object.assign(r,{field:e,expr:t});else if((0,o.inArray)(["$and","$or","$nor","$expr","$jsonSchema"],e))this.processOperator(e,e,t);else{(0,o.assert)(!(0,o.isOperator)(e),"unknown top level operator: "+e);for(var[n,i]of Object.entries((0,o.normalize)(t)))this.processOperator(e,n,i)}r.field&&this.processOperator(r.field,r.field,r.expr)}}processOperator(e,t,r){var n=(0,i.getOperator)(i.OperatorType.QUERY,t,this.options);if(!n)throw new Error("unknown operator "+t);t=n(e,r,this.options);this.compiled.push(t)}test(r){for(let e=0,t=this.compiled.length;e<t;e++)if(!this.compiled[e](r))return!1;return!0}find(e,t){return new n.Cursor(e,e=>this.test(e),t||{},this.options)}remove(e){return e.reduce((e,t)=>(this.test(t)||e.push(t),e),[])}}},{"./core":69,"./cursor":70,"./util":307}],307:[function(e,t,l){"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.normalize=l.isOperator=l.removeValue=l.setValue=l.walk=l.filterMissing=l.resolveGraph=l.resolve=l.memoize=l.into=l.groupBy=l.sortBy=l.hashCode=l.stringify=l.unique=l.isEqual=l.flatten=l.intersection=l.merge=l.has=l.ensureArray=l.isMissing=l.isEmpty=l.truthy=l.notInArray=l.inArray=l.isNil=l.isFunction=l.isRegExp=l.isDate=l.isObjectLike=l.isObject=l.isArray=l.isNotNaN=l.isNumber=l.isString=l.isBoolean=l.getType=l.cloneDeep=l.assert=l.compare=l.MIN_LONG=l.MAX_LONG=l.MIN_INT=l.MAX_INT=void 0,l.MAX_INT=2147483647,l.MIN_INT=-2147483648,l.MAX_LONG=Number.MAX_SAFE_INTEGER,l.MIN_LONG=Number.MIN_SAFE_INTEGER;const h=Symbol("missing"),r=Object.getPrototypeOf({}),n=/^\[object ([a-zA-Z0-9]+)\]$/,y=e=>{var t=c(e);let r=0,n=t.length;for(;n;)r=(r<<5)-r^t.charCodeAt(--n);return r>>>0},o=new Set(["null","undefined","boolean","number","string","date","regexp"]),i={null:0,undefined:0,number:1,string:2,object:3,array:4,boolean:5,date:6,regexp:7,function:8};l.compare=(e,t)=>{var[r,n]=[e=e===h?void 0:e,t=t===h?void 0:t].map(e=>i[(0,l.getType)(e).toLowerCase()]);return r!==n?r-n:1!==r&&2!==r&&6!==r&&b(e,t)?0:e<t?-1:t<e?1:0},l.assert=function(e,t){if(!e)throw new Error(t)};l.cloneDeep=e=>{const t=new Map,o=e=>{if(t.has(e))throw new Error("cycle detected during clone operation.");t.set(e,!0)},a=t=>{if(t instanceof Date)return new Date(t);if((0,l.isArray)(t)){o(t);var r=new Array(t.length),n=t.length;for(let e=0;e<n;e++)r[e]=a(t[e]);return r}if((0,l.isObject)(t)){o(t);var e={};for(const i in t)e[i]=a(t[i]);return e}return t};return a(e)},l.getType=e=>n.exec(Object.prototype.toString.call(e))[1],l.isBoolean=e=>"boolean"==typeof e,l.isString=e=>"string"==typeof e,l.isNumber=e=>!isNaN(e)&&"number"==typeof e,l.isNotNaN=e=>!(isNaN(e)&&"number"==typeof e),l.isArray=Array.isArray,l.isObject=e=>{var t;return!!e&&((t=Object.getPrototypeOf(e))===r||null===t)&&"[object Object]"===Object.prototype.toString.call(e)},l.isObjectLike=e=>e===Object(e),l.isDate=e=>e instanceof Date,l.isRegExp=e=>e instanceof RegExp,l.isFunction=e=>"function"==typeof e,l.isNil=e=>null==e,l.inArray=(e,t)=>e.includes(t),l.notInArray=(e,t)=>!(0,l.inArray)(e,t),l.truthy=(e,t=!0)=>!!e||t&&""===e,l.isEmpty=e=>(0,l.isNil)(e)||(0,l.isString)(e)&&!e||e instanceof Array&&0===e.length||(0,l.isObject)(e)&&0===Object.keys(e).length,l.isMissing=e=>e===h,l.ensureArray=e=>e instanceof Array?e:[e];l.has=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t);function m(n,i=y){const o=new Map;return n.forEach((t,e)=>{var r=f(t,i);o.has(r)?o.get(r).some(e=>b(n[e],t))||o.get(r).push(e):o.set(r,[e])}),o}function b(r,n){for(var i=[r],o=[n];0<i.length;)if((r=i.pop())!==(n=o.pop())){var e=(0,l.getType)(r).toLowerCase();if(e!==(0,l.getType)(n).toLowerCase()||"function"===e)return!1;if("array"===e){var t=r,a=n;if(t.length!==a.length)return!1;t.length===a.length&&0===t.length||(v(i,t),v(o,a))}else if("object"===e){var s=Object.keys(r),t=Object.keys(n);if(s.length!==t.length)return!1;for(let e=0,t=s.length;e<t;e++){var u=s[e];if(!(0,l.has)(n,u))return!1;i.push(r[u]),o.push(n[u])}}else if(c(r)!==c(n))return!1}return 0===i.length}function c(t){var e=(0,l.getType)(t).toLowerCase();switch(e){case"boolean":case"number":case"regexp":return t.toString();case"string":return JSON.stringify(t);case"date":return t.toISOString();case"null":case"undefined":return e;case"array":return"["+t.map(c).join(",")+"]"}var r="object"===e?"":""+(0,l.getType)(t),n=Object.keys(t);return n.sort(),r+"{"+n.map(e=>c(e)+":"+c(t[e])).join(",")+"}"}function f(e,t){return t=t||y,(0,l.isNil)(e)?null:t(e).toString()}function a(t,r,n=l.compare){if((0,l.isEmpty)(t))return t;var i=new Array,o=new Array;for(let e=0;e<t.length;e++){var a=t[e],s=r(a,e);(0,l.isNil)(s)?o.push(a):i.push([s,a])}return i.sort((e,t)=>n(e[0],t[0])),v(o,i.map(e=>e[1]))}l.merge=function r(e,n,i){if(i=i||{flatten:!1},(0,l.isMissing)(e)||(0,l.isNil)(e))return n;if(!(0,l.isMissing)(n)&&!(0,l.isNil)(n)){if(t=e,o=n,!((0,l.isObject)(t)&&(0,l.isObject)(o)||(0,l.isArray)(t)&&(0,l.isArray)(o))){if(i.skipValidation)return n||e;throw Error("mismatched types. must both be array or object")}var t,o;if(i.skipValidation=!0,(0,l.isArray)(e)){var a=e,s=n;if(i.flatten){let e=0,t=0;for(;e<a.length&&t<s.length;)a[e]=r(a[e++],s[t++],i);for(;t<s.length;)a.push(n[t++])}else v(a,s)}else for(const u in n)e[u]=r(e[u],n[u],i)}return e},l.intersection=function(i,e=y){if(i.some(e=>0==e.length))return[];if(1===i.length)return Array.from(i);const f=a(i.map((e,t)=>[t,e.length]),e=>e[1]),o=i[f[0][0]],d=(e=m(o,e),new Map),p=new Array;return e.forEach((e,a)=>{const r=e.map(e=>o[e]),s=r.map(e=>0),u=r.map(e=>[f[0][0],0]);let t=!1;for(let o=1;o<i.length;o++){const[c,,]=f[o],n=i[c];if(d.has(o)||d.set(o,m(n)),d.get(o).has(a)){const l=d.get(o).get(a).map(e=>n[e]);t=r.map((n,i)=>l.some((e,t)=>{var r=s[i];return b(n,e)&&(s[i]++,c<u[i][0])&&(u[i]=[c,d.get(o).get(a)[t]]),r<s[i]})).some(Boolean)}if(!t)return}t&&v(p,s.map((e,t)=>e===i.length-1?[r[t],u[t]]:h).filter(e=>e!==h))}),p.sort((e,t)=>{var[,[e,r]]=e,[,[t,n]]=t,e=(0,l.compare)(e,t);return 0!==e?e:(0,l.compare)(r,n)}).map(e=>e[0])},l.flatten=function(e,t=0){const o=new Array;return function r(n,i){for(let e=0,t=n.length;e<t;e++)(0,l.isArray)(n[e])&&(0<i||i<0)?r(n[e],Math.max(-1,i-1)):o.push(n[e])}(e,t),o},l.isEqual=b,l.unique=function(r,e=y){const n=r.map(e=>h);return m(r,e).forEach((e,t)=>{e.forEach(e=>n[e]=r[e])}),n.filter(e=>e!==h)},l.stringify=c,l.hashCode=f,l.sortBy=a,l.groupBy=function(t,r,n=y){if(t.length<1)return new Map;var i=new Map,o=new Map;for(let e=0;e<t.length;e++){var a=t[e];const c=r(a,e);var s,u=f(c,n);null===u?o.has(null)?o.get(null).push(a):o.set(null,[a]):(s=i.has(u)?i.get(u).find(e=>b(e,c)):null,(0,l.isNil)(s)?(o.set(c,[a]),i.has(u)?i.get(u).push(c):i.set(u,[c])):o.get(s).push(a))}return o};const s=5e4;function v(e,...t){return e instanceof Array?t.reduce((e,t)=>{let r=Math.ceil(t.length/s),n=0;for(;0<r--;)Array.prototype.push.apply(e,t.slice(n,n+s)),n+=s;return e},e):t.filter(l.isObjectLike).reduce((e,t)=>(Object.assign(e,t),e),e)}function d(e,t){return(0,l.isObjectLike)(e)?e[t]:void 0}l.into=v,l.memoize=function(r,n=y){return i={},(...e)=>{var t=f(e,n)||"";return(0,l.has)(i,t)||(i[t]=r.apply(this,e)),i[t]};var i},l.resolve=function(e,t,r){let a=0;if((e=o.has((0,l.getType)(e).toLowerCase())?e:function r(e,t){let n=e;for(let e=0;e<t.length;e++){var i=t[e];if(null===/^\d+$/.exec(i)&&n instanceof Array){if(0===e&&0<a)break;a+=1;const o=t.slice(e);n=n.reduce((e,t)=>(void 0!==(t=r(t,o))&&e.push(t),e),[]);break}if(void 0===(n=d(n,i)))break}return n}(e,t.split(".")))instanceof Array&&null!=r&&r.unwrapArray){var n=e,i=a;if(!(i<1))for(;i--&&1===n.length;)n=n[0];return n}return e},l.resolveGraph=function e(t,r,n){var i=r.split("."),o=i[0],a=i.slice(1).join("."),s=null!==/^\d+$/.exec(o),i=1<i.length;let u,c;if(t instanceof Array)if(s)u=d(t,Number(o)),u=[u=i?e(u,a,n):u];else{u=[];for(const l of t)c=e(l,r,n),null!=n&&n.preserveMissing?(void 0===c&&(c=h),u.push(c)):void 0!==c&&u.push(c)}else{if(c=d(t,o),void 0===(c=i?e(c,a,n):c))return;(u=null!=n&&n.preserveKeys?Object.assign({},t):{})[o]=c}return u},l.filterMissing=function t(r){if(r instanceof Array)for(let e=r.length-1;0<=e;e--)r[e]===h?r.splice(e,1):t(r[e]);else if((0,l.isObject)(r))for(const e in r)(0,l.has)(r,e)&&t(r[e])};const u=/^\d+$/;function p(e,t,r,n){var t=t.split("."),i=t[0];const o=t.slice(1).join(".");1===t.length?((0,l.isObject)(e)||(0,l.isArray)(e)&&u.test(i))&&r(e,i):(null!=n&&n.buildGraph&&(0,l.isNil)(e[i])&&(e[i]={}),(e=e[i])&&(i=!!(1<t.length&&u.test(t[1])),e instanceof Array&&null!=n&&n.descendArray&&!i?e.forEach(e=>p(e,o,r,n)):p(e,o,r,n)))}l.walk=p,l.setValue=function(e,t,r){p(e,t,(e,t)=>{e[t]=r},{buildGraph:!0})},l.removeValue=function(e,t,n){p(e,t,(e,t)=>{if(e instanceof Array){if(/^\d+$/.test(t))e.splice(parseInt(t),1);else if(n&&n.descendArray)for(const r of e)(0,l.isObject)(r)&&delete r[t]}else(0,l.isObject)(e)&&delete e[t]},n)};const g=/^\$[a-zA-Z0-9_]+$/;function O(e){return g.test(e)}l.isOperator=O,l.normalize=function(e){if(o.has((0,l.getType)(e).toLowerCase()))return(0,l.isRegExp)(e)?{$regex:e}:{$eq:e};if((0,l.isObjectLike)(e)){var t;if(!Object.keys(e).some(O))return{$eq:e};if((0,l.has)(e,"$regex"))return(t=Object.assign({},e)).$regex=new RegExp(e.$regex,e.$options),delete t.$options,t}return e}},{}],308:[function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function i(t,r){Object.keys(t).forEach(function(e){r(t[e],e)})}function o(r,e,a){if(a=a||{},!y(e))throw m("Modifier must be an object");var s;if(e=u(e),h(e)?(s=u(r),b.each(e,function(e,i){var o=O[i];if(!o)throw m("Invalid modifier specified "+i);b.each(e,function(e,t){if(""===t)throw m("An empty update path is not valid.");var r=t.split(".");if(!b.all(r))throw m("The update path '"+t+"' contains an empty field name, which is not allowed.");var n=v(s,r,{noCreate:g[i],forbidArray:"$rename"===i,arrayIndices:a.arrayIndices}),r=r.pop();o(n,r,e,t,s)})})):s=e,a.returnInsteadOfReplacing)return s;b.each(b.keys(r),function(e){"_id"!==e&&delete r[e]}),b.each(s,function(e,t){r[t]=e})}var u=n(e("clone")),c=n(e("deep-equal")),l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(e){return!!("undefined"!=typeof Uint8Array&&e instanceof Uint8Array||e&&e.$Uint8ArrayPolyfill)},f=function(e){return Array.isArray(e)},d=i,p=function(e){return f(e)&&!s(e)},h=function(r,n){var i;return!!y(r)&&(i=void 0,d(r,function(e,t){t="$"===t.substr(0,1);if(void 0===i)i=t;else if(i!==t){if(!n)throw new Error("Inconsistent operator: "+JSON.stringify(r));i=!1}}),!!i)},y=function(e){return!!e&&"number"!=typeof e&&"string"!=typeof e&&"boolean"!=typeof e&&!p(e)&&null!==e&&!(e instanceof RegExp||"function"==typeof e||e instanceof Date||s(e))},m=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=("string"==typeof e&&t.field&&(e+=" for field '"+t.field+"'"),new Error(e));return t.name="ModifyJsError",t},b={all:function(e,t){return e.every(function(e){return t&&t(e)||e})},each:i,keys:function(e){return Object.keys(e)},has:function(e,t){return e.hasOwnProperty(t)},isObject:function(e){return"object"===(void 0===e?"undefined":l(e))&&null!==e}},v=function(e,t,r){r=r||{};for(var n=!1,i=0;i<t.length;i++){var o=i===t.length-1,a=t[i];if(!(p(s=e)||y(s))){if(r.noCreate)return;var s=m("cannot use the part '"+a+"' to traverse "+e);throw s.setPropertyError=!0,s}if(e instanceof Array){if(r.forbidArray)return null;if("$"===a){if(n)throw m("Too many positional (i.e. '$') elements");if(!r.arrayIndices||!r.arrayIndices.length)throw m("The positional operator did not find the match needed from the query");a=r.arrayIndices[0],n=!0}else{if(s=a,!/^[0-9]+$/.test(s)){if(r.noCreate)return;throw m("can't append to array using string field name ["+a+"]")}a=parseInt(a)}if(o&&(t[i]=a),r.noCreate&&a>=e.length)return;for(;e.length<a;)e.push(null);if(!o)if(e.length===a)e.push({});else if("object"!==l(e[a]))throw m("can't modify field '"+t[i+1]+"' of list value "+JSON.stringify(e[a]))}else if(!(a in e)){if(r.noCreate)return;o||(e[a]={})}if(o)return e;e=e[a]}},g={$unset:!0,$pop:!0,$rename:!0,$pull:!0,$pullAll:!0},O={$currentDate:function(e,t,r){if("object"===(void 0===r?"undefined":l(r))&&r.hasOwnProperty("$type")){if("date"!==r.$type)throw m("Minimongo does currently only support the date type in $currentDate modifiers",{field:t})}else if(!0!==r)throw m("Invalid $currentDate modifier",{field:t});e[t]=new Date},$min:function(e,t,r){if("number"!=typeof r)throw m("Modifier $min allowed for numbers only",{field:t});if(t in e){if("number"!=typeof e[t])throw m("Cannot apply $min modifier to non-number",{field:t});e[t]>r&&(e[t]=r)}else e[t]=r},$max:function(e,t,r){if("number"!=typeof r)throw m("Modifier $max allowed for numbers only",{field:t});if(t in e){if("number"!=typeof e[t])throw m("Cannot apply $max modifier to non-number",{field:t});e[t]<r&&(e[t]=r)}else e[t]=r},$inc:function(e,t,r){if("number"!=typeof r)throw m("Modifier $inc allowed for numbers only",{field:t});if(t in e){if("number"!=typeof e[t])throw m("Cannot apply $inc modifier to non-number",{field:t});e[t]+=r}else e[t]=r},$set:function(e,t,r){var n;if(!b.isObject(e))throw(n=m("Cannot set property on non-object field",{field:t})).setPropertyError=!0,n;if(null===e)throw(n=m("Cannot set property on null",{field:t})).setPropertyError=!0,n;e[t]=r},$setOnInsert:function(e,t,r){},$unset:function(e,t,r){void 0!==e&&(e instanceof Array?t in e&&(e[t]=null):delete e[t])},$push:function(e,t,r){if(void 0===e[t]&&(e[t]=[]),!(e[t]instanceof Array))throw m("Cannot apply $push modifier to non-array",{field:t});if(r&&r.$each){var n=r.$each;if(!(n instanceof Array))throw m("$each must be an array",{field:t});var i=void 0;if("$position"in r){if("number"!=typeof r.$position)throw m("$position must be a numeric value",{field:t});if(r.$position<0)throw m("$position in $push must be zero or positive",{field:t});i=r.$position}var o=void 0;if("$slice"in r){if("number"!=typeof r.$slice)throw m("$slice must be a numeric value",{field:t});if(0<r.$slice)throw m("$slice in $push must be zero or negative",{field:t});o=r.$slice}if(r.$sort)throw m("$sort in $push not implemented yet");if(void 0===i)for(var a=0;a<n.length;a++)e[t].push(n[a]);else{for(var s=[i,0],a=0;a<n.length;a++)s.push(n[a]);Array.prototype.splice.apply(e[t],s)}void 0!==o&&(e[t]=0===o?[]:e[t].slice(o))}else e[t].push(r)},$pushAll:function(e,t,r){if(!("object"===(void 0===r?"undefined":l(r))&&r instanceof Array))throw m("Modifier $pushAll/pullAll allowed for arrays only");var n=e[t];if(void 0===n)e[t]=r;else{if(!(n instanceof Array))throw m("Cannot apply $pushAll modifier to non-array",{field:t});for(var i=0;i<r.length;i++)n.push(r[i])}},$addToSet:function(e,t,r){var n=!1,n=(n="object"===(void 0===r?"undefined":l(r))&&"$each"===Object.keys(r)[0]?!0:n)?r.$each:[r],i=e[t];if(void 0===i)e[t]=n;else{if(!(i instanceof Array))throw m("Cannot apply $addToSet modifier to non-array",{field:t});b.each(n,function(e){for(var t=0;t<i.length;t++)if(c(e,i[t]))return;i.push(e)})}},$pop:function(e,t,r){if(void 0!==e){e=e[t];if(void 0!==e){if(!(e instanceof Array))throw m("Cannot apply $pop modifier to non-array",{field:t});"number"==typeof r&&r<0?e.splice(0,1):e.pop()}}},$pull:function(e,t,r){if(void 0!==e){e=e[t];if(void 0!==e)throw e instanceof Array?m("$pull not implemented yet"):m("Cannot apply $pull/pullAll modifier to non-array",{field:t})}},$pullAll:function(e,t,r){if(!("object"===(void 0===r?"undefined":l(r))&&r instanceof Array))throw m("Modifier $pushAll/pullAll allowed for arrays only",{field:t});if(void 0!==e){var n=e[t];if(void 0!==n){if(!(n instanceof Array))throw m("Cannot apply $pull/pullAll modifier to non-array",{field:t});for(var i=[],o=0;o<n.length;o++){for(var a=!1,s=0;s<r.length;s++)if(c(n[o],r[s])){a=!0;break}a||i.push(n[o])}e[t]=i}}},$rename:function(e,t,r,n,i){if(n===r)throw m("$rename source must differ from target",{field:t});if(null===e)throw m("$rename source field invalid",{field:t});if("string"!=typeof r)throw m("$rename target must be a string",{field:t});if(-1<r.indexOf("\0"))throw m("The 'to' field for $rename cannot contain an embedded null byte",{field:t});if(void 0!==e){n=e[t],e=(delete e[t],r.split(".")),r=v(i,e,{forbidArray:!0});if(null===r)throw m("$rename target field invalid",{field:t});r[e.pop()]=n}},$bit:function(e,t,r){throw m("$bit is not supported",{field:t})}};t.exports=function(e,t,r){if(!r||!r.each)return o(e,t,a({},r,{returnInsteadOfReplacing:!0}))}},{clone:37,"deep-equal":40}],309:[function(e,t,r){"use strict";function n(e){return e!=e}t.exports=function(e,t){return 0===e&&0===t?1/e==1/t:e===t||!(!n(e)||!n(t))}},{}],310:[function(e,t,r){"use strict";var n=e("define-properties"),i=e("call-bind"),o=e("./implementation"),a=e("./polyfill"),e=e("./shim"),i=i(a(),Object);n(i,{getPolyfill:a,implementation:o,shim:e}),t.exports=i},{"./implementation":309,"./polyfill":311,"./shim":312,"call-bind":36,"define-properties":42}],311:[function(e,t,r){"use strict";var n=e("./implementation");t.exports=function(){return"function"==typeof Object.is?Object.is:n}},{"./implementation":309}],312:[function(e,t,r){"use strict";var n=e("./polyfill"),i=e("define-properties");t.exports=function(){var e=n();return i(Object,{is:e},{is:function(){return Object.is!==e}}),e}},{"./polyfill":311,"define-properties":42}],313:[function(e,t,r){"use strict";var d,p,h,y,m,b,v,n,g,i;Object.keys||(d=Object.prototype.hasOwnProperty,p=Object.prototype.toString,h=e("./isArguments"),e=Object.prototype.propertyIsEnumerable,y=!e.call({toString:null},"toString"),m=e.call(function(){},"prototype"),b=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],v=function(e){var t=e.constructor;return t&&t.prototype===e},n={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},g=function(){if("undefined"!=typeof window)for(var e in window)try{if(!n["$"+e]&&d.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{v(window[e])}catch(e){return!0}}catch(e){return!0}return!1}(),i=function(e){var t=null!==e&&"object"==typeof e,r="[object Function]"===p.call(e),n=h(e),i=t&&"[object String]"===p.call(e),o=[];if(!t&&!r&&!n)throw new TypeError("Object.keys called on a non-object");var a=m&&r;if(i&&0<e.length&&!d.call(e,0))for(var s=0;s<e.length;++s)o.push(String(s));if(n&&0<e.length)for(var u=0;u<e.length;++u)o.push(String(u));else for(var c in e)a&&"prototype"===c||!d.call(e,c)||o.push(String(c));if(y)for(var l=function(e){if("undefined"==typeof window||!g)return v(e);try{return v(e)}catch(e){return!1}}(e),f=0;f<b.length;++f)l&&"constructor"===b[f]||!d.call(e,b[f])||o.push(b[f]);return o}),t.exports=i},{"./isArguments":315}],314:[function(e,t,r){"use strict";var n=Array.prototype.slice,i=e("./isArguments"),o=Object.keys,a=o?function(e){return o(e)}:e("./implementation"),s=Object.keys;a.shim=function(){return Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return i(e)?s(n.call(e)):s(e)}):Object.keys=a,Object.keys||a},t.exports=a},{"./implementation":313,"./isArguments":315}],315:[function(e,t,r){"use strict";var n=Object.prototype.toString;t.exports=function(e){var t=n.call(e);return"[object Arguments]"===t||"[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&0<=e.length&&"[object Function]"===n.call(e.callee)}},{}],316:[function(e,t,r){"use strict";function n(e){this.ttl=e,this.map=new Map,this._to=!1}function i(e){for(var t=o()-e.ttl,r=e.map[Symbol.iterator]();;){var n=r.next().value;if(!n)return;var i=n[0];if(!(n[1]<t))return;e.map.delete(i)}}function o(){return(new Date).getTime()}Object.defineProperty(r,"__esModule",{value:!0}),r.now=r.removeTooOldValues=r.ObliviousSet=void 0,n.prototype.has=function(e){return this.map.has(e)},n.prototype.add=function(e){var t=this;this.map.set(e,o()),this._to||(this._to=!0,setTimeout(function(){t._to=!1,i(t)},0))},n.prototype.clear=function(){this.map.clear()},r.ObliviousSet=n,r.removeTooOldValues=i,r.now=o},{}],317:[function(e,t,O){!function(g){!function(){"use strict";const r=Object.freeze({ignoreUnknown:!1,respectType:!1,respectFunctionNames:!1,respectFunctionProperties:!1,unorderedObjects:!0,unorderedArrays:!1,unorderedSets:!1,excludeKeys:void 0,excludeValues:void 0,replacer:void 0});function a(e,t){t=function o(u){let t="";let c=new Map;const l=e=>{t+=e};return{toString(){return t},getContext(){return c},dispatch(e){const t=null===(e=u.replacer?u.replacer(e):e)?"null":typeof e;return this[t](e)},object(r){if(r&&"function"==typeof r.toJSON)return this.object(r.toJSON());const e=Object.prototype.toString.call(r);let t="";const n=e.length;t=(t=n<10?"unknown:["+e+"]":e.slice(8,n-1)).toLowerCase();let i=null;if(void 0!==(i=c.get(r)))return this.dispatch("[CIRCULAR:"+i+"]");if(c.set(r,c.size),void 0!==g&&g.isBuffer&&g.isBuffer(r))return l("buffer:"),l(r.toString("utf8"));if("object"!==t&&"function"!==t&&"asyncfunction"!==t)this[t]?this[t](r):u.ignoreUnknown||this.unkown(r,t);else{let e=Object.keys(r),t=(u.unorderedObjects&&(e=e.sort()),[]);!1===u.respectType||d(r)||(t=f),u.excludeKeys&&(e=e.filter(e=>!u.excludeKeys(e)),t=t.filter(e=>!u.excludeKeys(e))),l("object:"+(e.length+t.length)+":");const o=e=>{this.dispatch(e),l(":"),u.excludeValues||this.dispatch(r[e]),l(",")};for(const a of e)o(a);for(const s of t)o(s)}},array(e,t){if(t=void 0===t?!1!==u.unorderedArrays:t,l("array:"+e.length+":"),t&&!(e.length<=1)){const i=new Map,r=e.map(e=>{const t=o(u);t.dispatch(e);for(var[r,n]of t.getContext())i.set(r,n);return t.toString()});return c=i,r.sort(),this.array(r,!1)}for(const n of e)this.dispatch(n)},date(e){return l("date:"+e.toJSON())},symbol(e){return l("symbol:"+e.toString())},unkown(e,t){if(l(t),e)return l(":"),e&&"function"==typeof e.entries?this.array(Array.from(e.entries()),!0):void 0},error(e){return l("error:"+e.toString())},boolean(e){return l("bool:"+e)},string(e){l("string:"+e.length+":"),l(e)},function(e){l("fn:"),d(e)?this.dispatch("[native]"):this.dispatch(e.toString()),!1!==u.respectFunctionNames&&this.dispatch("function-name:"+String(e.name)),u.respectFunctionProperties&&this.object(e)},number(e){return l("number:"+e)},xml(e){return l("xml:"+e.toString())},null(){return l("Null")},undefined(){return l("Undefined")},regexp(e){return l("regex:"+e.toString())},uint8array(e){return l("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},uint8clampedarray(e){return l("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(e))},int8array(e){return l("int8array:"),this.dispatch(Array.prototype.slice.call(e))},uint16array(e){return l("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},int16array(e){return l("int16array:"),this.dispatch(Array.prototype.slice.call(e))},uint32array(e){return l("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},int32array(e){return l("int32array:"),this.dispatch(Array.prototype.slice.call(e))},float32array(e){return l("float32array:"),this.dispatch(Array.prototype.slice.call(e))},float64array(e){return l("float64array:"),this.dispatch(Array.prototype.slice.call(e))},arraybuffer(e){return l("arraybuffer:"),this.dispatch(new Uint8Array(e))},url(e){return l("url:"+e.toString())},map(e){l("map:");const t=[...e];return this.array(t,!1!==u.unorderedSets)},set(e){l("set:");const t=[...e];return this.array(t,!1!==u.unorderedSets)},file(e){return l("file:"),this.dispatch([e.name,e.size,e.type,e.lastModfied])},blob(){if(u.ignoreUnknown)return l("[blob]");throw new Error('Hashing Blob objects is currently not supported\nUse "options.replacer" or "options.ignoreUnknown"\n')},domwindow(){return l("domwindow")},bigint(e){return l("bigint:"+e.toString())},process(){return l("process")},timer(){return l("timer")},pipe(){return l("pipe")},tcp(){return l("tcp")},udp(){return l("udp")},tty(){return l("tty")},statwatcher(){return l("statwatcher")},securecontext(){return l("securecontext")},connection(){return l("connection")},zlib(){return l("zlib")},context(){return l("context")},nodescript(){return l("nodescript")},httpparser(){return l("httpparser")},dataview(){return l("dataview")},signal(){return l("signal")},fsevent(){return l("fsevent")},tlswrap(){return l("tlswrap")}}}(t=t?{...r,...t}:r);return t.dispatch(e),t.toString()}const f=Object.freeze(["prototype","__proto__","constructor"]);const t="[native code] }",n=t.length;function d(e){return"function"==typeof e&&Function.prototype.toString.call(e).slice(-n)===t}class i{constructor(e,t){e=this.words=e||[],this.sigBytes=void 0===t?4*e.length:t}toString(e){return(e||o).stringify(this)}concat(t){if(this.clamp(),this.sigBytes%4)for(let e=0;e<t.sigBytes;e++){var r=t.words[e>>>2]>>>24-e%4*8&255;this.words[this.sigBytes+e>>>2]|=r<<24-(this.sigBytes+e)%4*8}else for(let e=0;e<t.sigBytes;e+=4)this.words[this.sigBytes+e>>>2]=t.words[e>>>2];return this.sigBytes+=t.sigBytes,this}clamp(){this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4)}clone(){return new i([...this.words])}}const o={stringify(t){var r=[];for(let e=0;e<t.sigBytes;e++){var n=t.words[e>>>2]>>>24-e%4*8&255;r.push((n>>>4).toString(16),(15&n).toString(16))}return r.join("")}},s={stringify(r){var n=[];for(let t=0;t<r.sigBytes;t+=3){var i=(r.words[t>>>2]>>>24-t%4*8&255)<<16|(r.words[t+1>>>2]>>>24-(t+1)%4*8&255)<<8|r.words[t+2>>>2]>>>24-(t+2)%4*8&255;for(let e=0;e<4&&8*t+6*e<8*r.sigBytes;e++)n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i>>>6*(3-e)&63))}return n.join("")}},u={parse(t){var r=t.length,n=[];for(let e=0;e<r;e++)n[e>>>2]|=(255&t.charCodeAt(e))<<24-e%4*8;return new i(n,r)}},c={parse(e){return u.parse(unescape(encodeURIComponent(e)))}};const e=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],y=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],m=[];class l extends class extends class{constructor(){this._data=new i,this._nDataBytes=0,this._minBufferSize=0,this.blockSize=16}reset(){this._data=new i,this._nDataBytes=0}_append(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes}_doProcessBlock(e,t){}_process(e){let t,r=this._data.sigBytes/(4*this.blockSize);var n=(r=e?Math.ceil(r):Math.max((0|r)-this._minBufferSize,0))*this.blockSize,e=Math.min(4*n,this._data.sigBytes);if(n){for(let e=0;e<n;e+=this.blockSize)this._doProcessBlock(this._data.words,e);t=this._data.words.splice(0,n),this._data.sigBytes-=e}return new i(t,e)}}{update(e){return this._append(e),this._process(),this}finalize(e){e&&this._append(e)}}{constructor(){super(...arguments),this._hash=new i([...e])}reset(){super.reset(),this._hash=new i([...e])}_doProcessBlock(t,r){var e=this._hash.words;let n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7];for(let e=0;e<64;e++){e<16?m[e]=0|t[r+e]:(f=((f=m[e-15])<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,d=((d=m[e-2])<<15|d>>>17)^(d<<13|d>>>19)^d>>>10,m[e]=f+m[e-7]+d+m[e-16]);var f=s&u^~s&c,d=n&i^n&o^i&o,p=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),h=(s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25),h=l+h+f+y[e]+m[e];l=c,c=u,u=s,s=a+h|0,a=o,o=i,i=n,n=h+(p+d)|0}e[0]=e[0]+n|0,e[1]=e[1]+i|0,e[2]=e[2]+o|0,e[3]=e[3]+a|0,e[4]=e[4]+s|0,e[5]=e[5]+u|0,e[6]=e[6]+c|0,e[7]=e[7]+l|0}finalize(e){super.finalize(e);var e=8*this._nDataBytes,t=8*this._data.sigBytes;return this._data.words[t>>>5]|=128<<24-t%32,this._data.words[14+(64+t>>>9<<4)]=Math.floor(e/4294967296),this._data.words[15+(64+t>>>9<<4)]=e,this._data.sigBytes=4*this._data.words.length,this._process(),this._hash}}function p(e){return(new l).finalize(e).toString(s)}function h(e,t,r=""){if(e&&"object"!=typeof e)return new v(r,e,a(e,t));var n={},i=[];for(const o in e)n[o]=h(e[o],t,r?r+"."+o:o),i.push(n[o].hash);return new v(r,e,`{${i.join(":")}}`,n)}class b{constructor(e,t,r,n){this.key=e,this.type=t,this.newValue=r,this.oldValue=n}toString(){return this.toJSON()}toJSON(){switch(this.type){case"added":return`Added   \`${this.key}\``;case"removed":return`Removed \`${this.key}\``;case"changed":return`Changed \`${this.key}\` from \`${this.oldValue?.toString()||"-"}\` to \`${this.newValue.toString()}\``}}}class v{constructor(e,t,r,n){this.key=e,this.value=t,this.hash=r,this.props=n}toString(){return this.props?`{${Object.keys(this.props).join(",")}}`:JSON.stringify(this.value)}toJSON(){var e=this.key||".";return this.props?`${e}({${Object.keys(this.props).join(",")}})`:`${e}(${this.value})`}}O.diff=function(e,t,r={}){return function e(t,r,n={}){const i=[];const o=new Set([...Object.keys(t.props||{}),...Object.keys(r.props||{})]);if(t.props&&r.props)for(const a of o){const s=t.props[a],u=r.props[a];s&&u?i.push(...e(t.props?.[a],r.props?.[a],n)):(s||u)&&i.push(new b((u||s).key,s?"removed":"added",u,s))}0===o.size&&t.hash!==r.hash&&i.push(new b((r||t).key,"changed",r,t));return i}(h(e,r),h(t,r),r)},O.hash=function(e,t={}){return p("string"==typeof e?e:a(e,t)).slice(0,10)},O.isEqual=function(e,t,r={}){return e===t||a(e,r)===a(t,r)},O.murmurHash=function(e,t=0){var r;"string"==typeof e&&(a=e,e=(new TextEncoder).encode(a));let n=0,i=t,o;for(var a=3&e.length,s=e.length-a,u=3432918353,c=461845907;n<s;)o=255&e[n]|(255&e[++n])<<8|(255&e[++n])<<16|(255&e[++n])<<24,++n,o=(65535&(o=(o=(65535&o)*u+(((o>>>16)*u&65535)<<16)&4294967295)<<15|o>>>17))*c+(((o>>>16)*c&65535)<<16)&4294967295,r=5*(65535&(i=(i^=o)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295,i=27492+(65535&r)+((58964+(r>>>16)&65535)<<16);switch(o=0,a){case 3:o^=(255&e[n+2])<<16;break;case 2:o^=(255&e[n+1])<<8;break;case 1:o=(65535&(o=(o=(65535&(o^=255&e[n]))*u+(((o>>>16)*u&65535)<<16)&4294967295)<<15|o>>>17))*c+(((o>>>16)*c&65535)<<16)&4294967295,i^=o}return i=2246822507*(65535&(i=(i^=e.length)^i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0},O.objectHash=a,O.sha256=function(e){return(new l).finalize(e).toString()},O.sha256base64=p}.call(this)}.call(this,e("buffer").Buffer)},{buffer:649}],318:[function(e,t,r){"use strict";var e=e("set-function-name"),n=Object,i=TypeError;t.exports=e(function(){if(null!=this&&this!==n(this))throw new i("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},"get flags",!0)},{"set-function-name":642}],319:[function(e,t,r){"use strict";var n=e("define-properties"),i=e("call-bind"),o=e("./implementation"),a=e("./polyfill"),e=e("./shim"),i=i(a());n(i,{getPolyfill:a,implementation:o,shim:e}),t.exports=i},{"./implementation":318,"./polyfill":320,"./shim":321,"call-bind":36,"define-properties":42}],320:[function(e,t,r){"use strict";var n=e("./implementation"),i=e("define-properties").supportsDescriptors,o=Object.getOwnPropertyDescriptor;t.exports=function(){if(i&&"gim"===/a/gim.flags){var e=o(RegExp.prototype,"flags");if(e&&"function"==typeof e.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var t="",r={};if(Object.defineProperty(r,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(r,"sticky",{get:function(){t+="y"}}),"dy"===t)return e.get}}return n}},{"./implementation":318,"define-properties":42}],321:[function(e,t,r){"use strict";var n=e("define-properties").supportsDescriptors,i=e("./polyfill"),o=Object.getOwnPropertyDescriptor,a=Object.defineProperty,s=TypeError,u=Object.getPrototypeOf,c=/a/;t.exports=function(){var e,t,r;if(n&&u)return e=i(),t=u(c),(r=o(t,"flags"))&&r.get===e||a(t,"flags",{configurable:!0,enumerable:!1,get:e}),e;throw new s("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors")}},{"./polyfill":320,"define-properties":42}],322:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ChangeEventBuffer=void 0,r.createChangeEventBuffer=function(e){return new i(e)};var n=e("rxjs/operators"),i=function(){function e(e){this.subs=[],this.limit=100,this.counter=0,this.eventCounterMap=new WeakMap,this.buffer=[],this.collection=e,this.subs.push(this.collection.$.pipe((0,n.filter)(e=>!e.isLocal)).subscribe(e=>this._handleChangeEvent(e)))}var t=e.prototype;return t._handleChangeEvent=function(e){for(this.counter++,this.buffer.push(e),this.eventCounterMap.set(e,this.counter);this.buffer.length>this.limit;)this.buffer.shift()},t.getArrayIndexByPointer=function(e){var t=this.buffer[0],t=this.eventCounterMap.get(t);return e<t?null:e-t},t.getFrom=function(e){var t=[],r=this.getArrayIndexByPointer(e);if(null===r)return null;for(;;){var n=this.buffer[r];if(r++,!n)return t;t.push(n)}},t.runFrom=function(e,t){e=this.getFrom(e);if(null===e)throw new Error("out of bounds");e.forEach(e=>t(e))},t.reduceByLastOfDoc=function(e){return e.slice(0)},t.destroy=function(){this.subs.forEach(e=>e.unsubscribe())},e}();r.ChangeEventBuffer=i},{"rxjs/operators":640}],323:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getIndexMeta=o,r.getIndexStringLength=function(e,t){var e=o(e,t),n=0;return e.forEach(e=>{var t=e.schemaPart,r=t.type;"string"===r?n+=t.maxLength:"boolean"===r?n+=1:(t=e.parsedLengths,n=n+t.nonDecimals+t.decimals)}),n},r.getIndexableStringMonad=function(e,t){var e=o(e,t),n=e.length,i=e.map(e=>e.getIndexStringPart);return function(e){for(var t="",r=0;r<n;++r)t+=i[r](e);return t}},r.getNumberIndexString=y,r.getPrimaryKeyFromIndexableString=function(e,t){return e.slice(-1*t).trim()},r.getStartIndexStringFromLowerBound=function(s,e,u,c){var l="";return e.forEach((e,t)=>{var r=(0,f.getSchemaByObjectPath)(s,e),n=u[t],i=r.type;switch(i){case"string":var o=(0,d.ensureNotFalsy)(r.maxLength);l+=("string"==typeof n?n:"").padEnd(o," ");break;case"boolean":l+=null===n?c?"0":p.INDEX_MAX:n?"1":"0";break;case"number":case"integer":var a,o=h(r);null===n||n===p.INDEX_MIN?(a=c?"0":p.INDEX_MAX,l+=a.repeat(o.nonDecimals+o.decimals)):l+=y(o,n);break;default:throw new Error("unknown index type "+i)}}),l},r.getStartIndexStringFromUpperBound=function(a,e,s,u){var c="";return e.forEach((e,t)=>{var r=(0,f.getSchemaByObjectPath)(a,e),n=s[t],i=r.type;switch(i){case"string":var o=(0,d.ensureNotFalsy)(r.maxLength);"string"==typeof n&&n!==p.INDEX_MAX?c+=n.padEnd(o," "):c+="".padEnd(o,u?p.INDEX_MAX:" ");break;case"boolean":c+=null===n?u?"0":"1":n?"1":"0";break;case"number":case"integer":o=h(r);null===n||n===p.INDEX_MAX?c+=(u?"9":"0").repeat(o.nonDecimals+o.decimals):c+=y(o,n);break;default:throw new Error("unknown index type "+i)}}),c},r.getStringLengthOfIndexNumber=h;var f=e("./rx-schema-helper"),d=e("./plugins/utils"),p=e("./query-planner");function o(a,e){return e.map(e=>{var t,r,n,i,o=(0,f.getSchemaByObjectPath)(a,e);if(o)return"number"!==(t=o.type)&&"integer"!==t||(r=h(o)),n=(0,d.objectPathMonad)(e),i=o.maxLength||0,{fieldName:e,schemaPart:o,parsedLengths:r,getValue:n,getIndexStringPart:"string"===t?e=>{return(n(e)||"").padEnd(i," ")}:"boolean"===t?e=>{return n(e)?"1":"0"}:e=>{e=n(e);return y(r,e)}};throw new Error("not in schema: "+e)})}function h(e){var t=Math.floor(e.minimum),r=Math.ceil(e.maximum),e=e.multipleOf,n=(r-t).toString().length,e=e.toString().split("."),i=0;return{minimum:t,maximum:r,nonDecimals:n,decimals:i=1<e.length?e[1].length:i,roundedMinimum:t}}function y(e,t){(t=(t=void 0===t?0:t)<e.minimum?e.minimum:t)>e.maximum&&(t=e.maximum);var r=(Math.floor(t)-e.roundedMinimum).toString().padStart(e.nonDecimals,"0");return 0<e.decimals&&(r+=(1<(t=t.toString().split(".")).length?t[1]:"0").padEnd(e.decimals,"0")),r}},{"./plugins/utils":360,"./query-planner":379,"./rx-schema-helper":398}],324:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.DocumentCache=void 0;var a=e("./plugins/utils"),s=e("./overwritable"),n=e("./rx-change-event");r.DocumentCache=function(){function e(e,t,r){this.cacheItemByDocId=new Map,this.registry="function"==typeof FinalizationRegistry?new FinalizationRegistry(e=>{var t=e.docId,r=this.cacheItemByDocId.get(t);r&&(r.documentByRevisionHeight.delete(e.revisionHeight),0===r.documentByRevisionHeight.size)&&this.cacheItemByDocId.delete(t)}):void 0,this.primaryPath=e,this.changes$=t,this.documentCreator=r,t.subscribe(e=>{var t=e.documentId,t=this.cacheItemByDocId.get(t);t&&(e=(0,n.getDocumentDataOfRxChangeEvent)(e),t.latestDoc=e)})}var t=e.prototype;return t.getCachedRxDocument=function(t){var e,r=t[this.primaryPath],n=(0,a.getHeightOfRevision)(t._rev),i=(0,a.getFromMapOrCreate)(this.cacheItemByDocId,r,()=>{return e=t,{documentByRevisionHeight:new Map,latestDoc:e};var e}),o=i.documentByRevisionHeight.get(n),o=o?o.deref():void 0;return o||(t=s.overwritable.deepFreezeWhenDevMode(t),o=this.documentCreator(t),i.documentByRevisionHeight.set(n,(e=o,u?new WeakRef(e):{deref(){return e}})),this.registry&&this.registry.register(o,{docId:r,revisionHeight:n})),o},t.getLatestDocumentData=function(e){return(0,a.getFromMapOrThrow)(this.cacheItemByDocId,e).latestDoc},t.getLatestDocumentDataIfExists=function(e){e=this.cacheItemByDocId.get(e);if(e)return e.latestDoc},e}();var u="function"==typeof WeakRef},{"./overwritable":329,"./plugins/utils":360,"./rx-change-event":387}],325:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RXQUERY_QUERY_PARAMS_CACHE=void 0,r.calculateNewResults=function(e,t){if(!e.collection.database.eventReduce)return{runFullQueryAgain:!0};var r=f(e),n=(0,u.ensureNotFalsy)(e._result).docsData.slice(0),i=(0,u.ensureNotFalsy)(e._result).docsDataMap,o=!1;return t.map(e=>(0,s.rxChangeEventToEventReduceChangeEvent)(e)).filter(u.arrayFilterNotEmpty).find(e=>{var t=(0,a.calculateActionName)({queryParams:r,changeEvent:e,previousResults:n,keyDocumentMap:i});return"runFullQueryAgain"===t||("doNothing"!==t?(o=!0,(0,a.runAction)(t,r,e,n,i),!1):void 0)})?{runFullQueryAgain:!0}:{runFullQueryAgain:!1,changed:o,newResults:n}},r.getQueryParams=f,r.getSortFieldsOfQuery=l;var a=e("event-reduce-js"),s=e("./rx-change-event"),u=e("./plugins/utils"),c=e("./rx-query-helper");function l(e,t){return t.sort&&0!==t.sort.length?t.sort.map(e=>Object.keys(e)[0]):[e]}var n=new WeakMap;function f(o){return(0,u.getFromMapOrCreate)(n,o,()=>{var e=o.collection,t=(0,c.normalizeMangoQuery)(e.storageInstance.schema,(0,u.clone)(o.mangoQuery)),r=e.schema.primaryPath,n=(0,c.getSortComparator)(e.schema.jsonSchema,t),i=(0,c.getQueryMatcher)(e.schema.jsonSchema,t);return{primaryKey:o.collection.schema.primaryPath,skip:t.skip,limit:t.limit,sortFields:l(r,t),sortComparator:(e,t)=>{e={docA:e,docB:t,rxQuery:o};return n(e.docA,e.docB)},queryMatcher:e=>{return i({doc:e,rxQuery:o}.doc)}}})}r.RXQUERY_QUERY_PARAMS_CACHE=n},{"./plugins/utils":360,"./rx-change-event":387,"./rx-query-helper":395,"event-reduce-js":47}],326:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.HOOKS=void 0,r._clearHook=function(e,t){n[e]=n[e].filter(e=>e!==t)},r.runAsyncPluginHooks=function(e,t){return Promise.all(n[e].map(e=>e(t)))},r.runPluginHooks=function(e,t){n[e]&&n[e].forEach(e=>e(t))};var n={preAddRxPlugin:[],preCreateRxDatabase:[],createRxDatabase:[],preCreateRxCollection:[],createRxCollection:[],postDestroyRxCollection:[],postRemoveRxCollection:[],preCreateRxSchema:[],createRxSchema:[],preCreateRxQuery:[],prePrepareQuery:[],createRxDocument:[],postCreateRxDocument:[],preCreateRxStorageInstance:[],preMigrateDocument:[],postMigrateDocument:[],preDestroyRxDatabase:[],postRemoveRxDatabase:[],preReplicationMasterWrite:[],preReplicationMasterWriteDocumentsHandle:[]};r.HOOKS=n},{}],327:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.IncrementalWriteQueue=void 0,r.findNewestOfDocumentStates=o,r.modifierFromPublicToInternal=function(r){return async e=>{var t=(0,u.stripMetaDataFromDocument)(e),t=(t._deleted=e._deleted,await r(t)),t=Object.assign({},t,{_meta:e._meta,_attachments:e._attachments,_rev:e._rev,_deleted:(void 0!==t._deleted?t:e)._deleted});return void 0===t._deleted&&(t._deleted=!1),t}};var s=e("./rx-error"),u=e("./plugins/utils");function o(e){var r=e[0],n=(0,u.parseRevision)(r._rev).height;return e.forEach(e=>{var t=(0,u.parseRevision)(e._rev).height;n<t&&(r=e,n=t)}),r}r.IncrementalWriteQueue=function(){function e(e,t,r,n){this.queueByDocId=new Map,this.isRunning=!1,this.storageInstance=e,this.primaryPath=t,this.preWrite=r,this.postWrite=n}var t=e.prototype;return t.addWrite=function(r,n){var e=r[this.primaryPath],i=(0,u.getFromMapOrCreate)(this.queueByDocId,e,()=>[]);return new Promise((e,t)=>{e={lastKnownDocumentState:r,modifier:n,resolve:e,reject:t};(0,u.ensureNotFalsy)(i).push(e),this.triggerRun()})},t.triggerRun=async function(){var i,a,e;if(!0!==this.isRunning&&0!==this.queueByDocId.size)return this.isRunning=!0,i=[],a=this.queueByDocId,this.queueByDocId=new Map,await Promise.all(Array.from(a.entries()).map(async([,e])=>{var t,r=o(e.map(e=>e.lastKnownDocumentState)),n=r;for(t of e)try{n=await t.modifier((0,u.clone)(n))}catch(e){t.reject(e),t.reject=()=>{},t.resolve=()=>{}}try{await this.preWrite(n,r)}catch(t){return void e.forEach(e=>e.reject(t))}i.push({previous:r,document:n})})),e=0<i.length?await this.storageInstance.bulkWrite(i,"incremental-write"):{error:{},success:{}},await Promise.all(Array.from(Object.entries(e.success)).map(([e,t])=>{this.postWrite(t),(0,u.getFromMapOrThrow)(a,e).forEach(e=>e.resolve(t))})),Array.from(Object.entries(e.error)).forEach(([e,t])=>{var r,n,i=(0,u.getFromMapOrThrow)(a,e),o=(0,s.isBulkWriteConflictError)(t);o?(r=(0,u.getFromMapOrCreate)(this.queueByDocId,e,()=>[]),i.reverse().forEach(e=>{e.lastKnownDocumentState=(0,u.ensureNotFalsy)(o.documentInDb),(0,u.ensureNotFalsy)(r).unshift(e)})):(n=(0,s.rxStorageWriteErrorToRxError)(t),i.forEach(e=>e.reject(n)))}),this.isRunning=!1,this.triggerRun()},e}()},{"./plugins/utils":360,"./rx-error":394}],328:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={addRxPlugin:!0},i=(Object.defineProperty(r,"addRxPlugin",{enumerable:!0,get:function(){return i.addRxPlugin}}),e("./plugin")),o=e("./rx-database"),a=(Object.keys(o).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===o[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})}),e("./rx-error")),s=(Object.keys(a).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===a[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})}),e("./rx-database-internal-store")),u=(Object.keys(s).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===s[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return s[e]}})}),e("./overwritable")),c=(Object.keys(u).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===u[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return u[e]}})}),e("./rx-collection")),l=(Object.keys(c).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===c[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return c[e]}})}),e("./rx-collection-helper")),f=(Object.keys(l).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===l[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return l[e]}})}),e("./rx-document")),d=(Object.keys(f).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===f[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return f[e]}})}),e("./rx-change-event")),p=(Object.keys(d).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===d[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return d[e]}})}),e("./rx-document-prototype-merge")),h=(Object.keys(p).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===p[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return p[e]}})}),e("./rx-query")),y=(Object.keys(h).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===h[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return h[e]}})}),e("./rx-query-helper")),m=(Object.keys(y).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===y[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return y[e]}})}),e("./rx-schema")),b=(Object.keys(m).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===m[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return m[e]}})}),e("./rx-schema-helper")),v=(Object.keys(b).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===b[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return b[e]}})}),e("./rx-storage-helper")),g=(Object.keys(v).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===v[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return v[e]}})}),e("./rx-storage-statics")),O=(Object.keys(g).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===g[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return g[e]}})}),e("./replication-protocol/index")),_=(Object.keys(O).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===O[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return O[e]}})}),e("./rx-storage-multiinstance")),w=(Object.keys(_).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===_[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return _[e]}})}),e("./custom-index")),S=(Object.keys(w).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===w[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return w[e]}})}),e("./query-planner")),x=(Object.keys(S).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===S[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return S[e]}})}),e("./plugin-helpers")),j=(Object.keys(x).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===x[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return x[e]}})}),e("./plugins/utils")),P=(Object.keys(j).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===j[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return j[e]}})}),e("./hooks")),E=(Object.keys(P).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===P[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return P[e]}})}),e("./query-cache"));Object.keys(E).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===E[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return E[e]}})})},{"./custom-index":323,"./hooks":326,"./overwritable":329,"./plugin":331,"./plugin-helpers":330,"./plugins/utils":360,"./query-cache":378,"./query-planner":379,"./replication-protocol/index":384,"./rx-change-event":387,"./rx-collection":389,"./rx-collection-helper":388,"./rx-database":391,"./rx-database-internal-store":390,"./rx-document":393,"./rx-document-prototype-merge":392,"./rx-error":394,"./rx-query":397,"./rx-query-helper":395,"./rx-schema":399,"./rx-schema-helper":398,"./rx-storage-helper":400,"./rx-storage-multiinstance":401,"./rx-storage-statics":402}],329:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.overwritable=void 0;r.overwritable={isDevMode(){return!1},deepFreezeWhenDevMode(e){return e},tunnelErrorMessage(e){return"RxDB Error-Code "+e+".\n        Error messages are not included in RxDB core to reduce build size.\n        - To find out what this error means, either use the dev-mode-plugin https://rxdb.info/dev-mode.html\n        - or search for the error code here: https://github.com/pubkey/rxdb/search?q="+e+"\n        "}}},{}],330:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.wrapRxStorageInstance=function(o,t,r,n=e=>e){async function a(e){return e&&t(e)}async function s(e){return e&&r(e)}var u=new f.BehaviorSubject(0);return{databaseName:o.databaseName,internals:o.internals,cleanup:o.cleanup.bind(o),options:o.options,close:o.close.bind(o),schema:o.schema,collectionName:o.collectionName,count:o.count.bind(o),remove:o.remove.bind(o),originalStorageInstance:o,bulkWrite:async(e,t)=>{var r=[],e=(await Promise.all(e.map(async e=>{var[e,t]=await Promise.all([e.previous?a(e.previous):void 0,a(e.document)]);r.push({previous:e,document:t})})),await o.bulkWrite(r,t)),n={success:{},error:{}},i=[];return Object.entries(e.success).forEach(([t,e])=>{i.push(s(e).then(e=>n.success[t]=e))}),Object.entries(e.error).forEach(([t,e])=>{i.push(async function(e){return(e=(0,l.flatClone)(e)).writeRow=(0,l.flatClone)(e.writeRow),e.documentInDb&&(e.documentInDb=await s(e.documentInDb)),e.writeRow.previous&&(e.writeRow.previous=await s(e.writeRow.previous)),e.writeRow.document=await s(e.writeRow.document),e}(e).then(e=>n.error[t]=e))}),await Promise.all(i),await(0,f.firstValueFrom)(u.pipe((0,c.filter)(e=>0===e))),n},query:e=>o.query(e).then(e=>Promise.all(e.documents.map(e=>s(e)))).then(e=>({documents:e})),getAttachmentData:async(e,t,r)=>{e=await o.getAttachmentData(e,t,r);return await n(e)},findDocumentsById:(e,t)=>o.findDocumentsById(e,t).then(async e=>{var r={};return await Promise.all(Object.entries(e).map(async([e,t])=>{r[e]=await s(t)})),r}),getChangedDocumentsSince:(e,t)=>o.getChangedDocumentsSince(e,t).then(async e=>({checkpoint:e.checkpoint,documents:await Promise.all(e.documents.map(e=>s(e)))})),changeStream:()=>o.changeStream().pipe((0,c.tap)(()=>u.next(u.getValue()+1)),(0,c.mergeMap)(async e=>{var t=await Promise.all(e.events.map(async e=>{var[t,r]=await Promise.all([s(e.documentData),s(e.previousDocumentData)]);return{operation:e.operation,eventId:e.eventId,documentId:e.documentId,endTime:e.endTime,startTime:e.startTime,documentData:t,previousDocumentData:r,isLocal:!1}}));return{id:e.id,events:t,checkpoint:e.checkpoint,context:e.context}}),(0,c.tap)(()=>u.next(u.getValue()-1))),conflictResultionTasks:()=>o.conflictResultionTasks().pipe((0,c.mergeMap)(async e=>{var t=await s(e.input.assumedMasterState),r=await s(e.input.newDocumentState),n=await s(e.input.realMasterState);return{id:e.id,context:e.context,input:{assumedMasterState:t,realMasterState:n,newDocumentState:r}}})),resolveConflictResultionTask:e=>{return e.output.isEqual||(e={id:e.id,output:{isEqual:!1,documentData:e.output.documentData}}),o.resolveConflictResultionTask(e)}}},r.wrappedValidateStorageFactory=function(r,e){var n=(0,l.getFromMapOrCreate)(o,e,()=>new Map);function u(e){var t=(0,l.defaultHashSha256)(JSON.stringify(e));return(0,l.getFromMapOrCreate)(n,t,()=>r(e))}return t=>Object.assign({},t.storage,{async createStorageInstance(r){var o,e=await t.storage.createStorageInstance(r),a=(0,i.getPrimaryFieldOfPrimaryKey)(r.schema.primaryKey),s=((0,l.requestIdleCallbackIfAvailable)(()=>o=u(r.schema)),e.bulkWrite.bind(e));return e.bulkWrite=(e,t)=>{o=o||u(r.schema);var n=[],i=[];return e.forEach(e=>{var t=e.document[a],r=o(e.document);0<r.length?n.push({status:422,isError:!0,documentId:t,writeRow:e,validationErrors:r}):i.push(e)}),(0<i.length?s(i,t):Promise.resolve({error:{},success:{}})).then(t=>(n.forEach(e=>{t.error[e.documentId]=e}),t))},e}})};var c=e("rxjs/operators"),i=e("./rx-schema-helper"),l=e("./plugins/utils"),f=e("rxjs"),o=new Map},{"./plugins/utils":360,"./rx-schema-helper":398,rxjs:415,"rxjs/operators":640}],331:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addRxPlugin=function(e){if((0,u.runPluginHooks)("preAddRxPlugin",{plugin:e,plugins:f}),!f.has(e)){if(d.has(e.name))throw(0,c.newRxError)("PL3",{name:e.name,plugin:e});if(f.add(e),d.add(e.name),!e.rxdb)throw(0,c.newRxTypeError)("PL1",{plugin:e});e.init&&e.init(),e.prototypes&&Object.entries(e.prototypes).forEach(([e,t])=>t(l[e])),e.overwritable&&Object.assign(s.overwritable,e.overwritable),e.hooks&&Object.entries(e.hooks).forEach(([e,t])=>{t.after&&u.HOOKS[e].push(t.after),t.before&&u.HOOKS[e].unshift(t.before)})}};var r=e("./rx-schema"),n=e("./rx-document"),i=e("./rx-query"),o=e("./rx-collection"),a=e("./rx-database"),s=e("./overwritable"),u=e("./hooks"),c=e("./rx-error"),l={RxSchema:r.RxSchema.prototype,RxDocument:n.basePrototype,RxQuery:i.RxQueryBase.prototype,RxCollection:o.RxCollectionBase.prototype,RxDatabase:a.RxDatabaseBase.prototype},f=new Set,d=new Set},{"./hooks":326,"./overwritable":329,"./rx-collection":389,"./rx-database":391,"./rx-document":393,"./rx-error":394,"./rx-query":397,"./rx-schema":399}],332:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ensurePrimaryKeyValid=function(e,t){if(!e)throw(0,n.newRxError)("DOC20",{primaryKey:e,document:t});if(e!==e.trim())throw(0,n.newRxError)("DOC21",{primaryKey:e,document:t});if(e.includes("\r")||e.includes("\n"))throw(0,n.newRxError)("DOC22",{primaryKey:e,document:t});if(e.includes('"'))throw(0,n.newRxError)("DOC23",{primaryKey:e,document:t})};var n=e("../../rx-error")},{"../../rx-error":394}],333:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.checkMigrationStrategies=function(t,r){if("object"!=typeof r||Array.isArray(r))throw(0,n.newRxTypeError)("COL11",{schema:t});var e=(0,i.getPreviousVersions)(t);if(e.length===Object.keys(r).length)return e.map(e=>({v:e,s:r[e+1]})).filter(e=>"function"!=typeof e.s).forEach(e=>{throw(0,n.newRxTypeError)("COL13",{version:e.v,type:typeof e,schema:t})}),!0;throw(0,n.newRxError)("COL12",{have:Object.keys(r),should:e})};var n=e("../../rx-error"),i=e("../../rx-schema")},{"../../rx-error":394,"../../rx-schema":399}],334:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.checkOrmDocumentMethods=function(e,t){var r=Object.keys(e.properties);t&&Object.keys(t).filter(e=>r.includes(e)).forEach(e=>{throw(0,n.newRxError)("COL18",{funName:e})})},r.checkOrmMethods=function(e){e&&Object.entries(e).forEach(([e,t])=>{if("string"!=typeof e)throw(0,n.newRxTypeError)("COL14",{name:e});if(e.startsWith("_"))throw(0,n.newRxTypeError)("COL15",{name:e});if("function"!=typeof t)throw(0,n.newRxTypeError)("COL16",{name:e,type:typeof e});if((0,i.rxCollectionProperties)().includes(e)||(0,i.rxDocumentProperties)().includes(e))throw(0,n.newRxError)("COL17",{name:e})})};var n=e("../../rx-error"),i=e("./entity-properties")},{"../../rx-error":394,"./entity-properties":337}],335:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.areSelectorsSatisfiedByIndex=s,r.checkMangoQuery=function(t){var r=t.rxQuery.collection.schema.jsonSchema,e=t.mangoQuery.selector,n=Object.keys(r.properties),e=(Object.keys(e).filter(e=>!e.startsWith("$")).filter(e=>!e.includes(".")).forEach(e=>{if(!n.includes(e))throw(0,o.newRxError)("QU13",{schema:r,field:e,query:t.mangoQuery})}),r.indexes||[]),i=t.mangoQuery.index;if(i)if(!e.find(e=>(0,a.deepEqual)(e,i)))throw(0,o.newRxError)("QU12",{collection:t.rxQuery.collection.name,query:t.mangoQuery,schema:r});if("count"===t.rxQuery.op&&!s(t.rxQuery.collection.schema.jsonSchema,t.mangoQuery)&&!t.rxQuery.collection.database.allowSlowCount)throw(0,o.newRxError)("QU14",{collection:t.rxQuery.collection,query:t.mangoQuery});t.mangoQuery.sort&&t.mangoQuery.sort.map(e=>Object.keys(e)[0]).filter(e=>!e.includes(".")).forEach(e=>{if(!n.includes(e))throw(0,o.newRxError)("QU13",{schema:r,field:e,query:t.mangoQuery})})},r.checkQuery=function(t){if("[object Object]"!==Object.prototype.toString.call(t.queryObj))throw(0,o.newRxTypeError)("QU11",{op:t.op,collection:t.collection.name,queryObj:t.queryObj});var r=["selector","limit","skip","sort","index"];if(Object.keys(t.queryObj).forEach(e=>{if(!r.includes(e))throw(0,o.newRxTypeError)("QU11",{op:t.op,collection:t.collection.name,queryObj:t.queryObj,key:e,args:{validKeys:r}})}),"count"===t.op&&(t.queryObj.limit||t.queryObj.skip))throw(0,o.newRxError)("QU15",{collection:t.collection.name,query:t.queryObj})};var o=e("../../rx-error"),n=e("../storage-dexie"),a=e("../utils");function s(e,t){return n.RxStorageDexieStatics.prepareQuery(e,t).queryPlan.selectorSatisfiedByIndex}},{"../../rx-error":394,"../storage-dexie":345,"../utils":360}],336:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.checkFieldNameRegex=f,r.checkPrimaryKey=u,r.checkSchema=function(a){if(!a.primaryKey)throw(0,l.newRxError)("SC30",{schema:a});if(!a.hasOwnProperty("properties"))throw(0,l.newRxError)("SC29",{schema:a});if(a.properties._rev)throw(0,l.newRxError)("SC10",{schema:a});if(!a.hasOwnProperty("version")||"number"!=typeof a.version||a.version<0)throw(0,l.newRxError)("SC11",{version:a.version});if(o(a),u(a),Object.keys(a.properties).forEach(e=>{var t=a.properties[e];if(e===a.primaryKey){if(a.indexes&&a.indexes.includes(e))throw(0,l.newRxError)("SC13",{value:t,schema:a});if(t.unique)throw(0,l.newRxError)("SC14",{value:t,schema:a});if(a.encrypted&&a.encrypted.includes(e))throw(0,l.newRxError)("SC15",{value:t,schema:a});if("string"!==t.type)throw(0,l.newRxError)("SC16",{value:t,schema:a})}if((0,n.rxDocumentProperties)().includes(e))throw(0,l.newRxError)("SC17",{key:e,schema:a})}),a.indexes){if(!(0,i.isMaybeReadonlyArray)(a.indexes))throw(0,l.newRxError)("SC18",{indexes:a.indexes,schema:a});a.indexes.forEach(o=>{if("string"!=typeof o&&!Array.isArray(o))throw(0,l.newRxError)("SC19",{index:o,schema:a});if(Array.isArray(o))for(var e=0;e<o.length;e+=1)if("string"!=typeof o[e])throw(0,l.newRxError)("SC20",{index:o,schema:a});((0,i.isMaybeReadonlyArray)(o)?o:[o]).forEach(e=>{var t=(0,s.getSchemaByObjectPath)(a,e);switch(t.type){case"string":if(t.maxLength)break;throw(0,l.newRxError)("SC34",{index:o,field:e,schema:a});case"number":case"integer":if(!t.multipleOf)throw(0,l.newRxError)("SC35",{index:o,field:e,schema:a});var r=t.maximum,n=t.minimum;if(void 0===r||void 0===n)throw(0,l.newRxError)("SC37",{index:o,field:e,schema:a});break;case"boolean":var r="",n=e,i=(e.includes(".")&&(n=(i=e.split(".")).pop(),r=i.join(".")),""===r?a:(0,s.getSchemaByObjectPath)(a,r));if(i.required&&i.required.includes(n))break;throw(0,l.newRxError)("SC38",{index:o,field:e,schema:a});default:throw(0,l.newRxError)("SC36",{fieldName:e,type:t.type,schema:a})}})})}Object.keys((0,i.flattenObject)(a)).map(e=>{e=e.split(".");return e.pop(),e.join(".")}).filter(e=>""!==e).filter((e,t,r)=>r.indexOf(e)===t).filter(e=>{e=(0,i.getProperty)(a,e);return e&&!!e.index}).forEach(e=>{throw e=(e=e.replace("properties.","")).replace(/\.properties\./g,"."),(0,l.newRxError)("SC26",{index:(0,i.trimDots)(e),schema:a})}),(a.indexes||[]).reduce((e,t)=>((0,i.isMaybeReadonlyArray)(t)?(0,i.appendToArray)(e,t):e.push(t),e),[]).filter((e,t,r)=>r.indexOf(e)===t).map(e=>{var t=c(e),t=(0,i.getProperty)(a,t);if(t&&"object"==typeof t)return{indexPath:e,schemaObj:t};throw(0,l.newRxError)("SC21",{index:e,schema:a})}).filter(e=>"string"!==e.schemaObj.type&&"integer"!==e.schemaObj.type&&"number"!==e.schemaObj.type&&"boolean"!==e.schemaObj.type).forEach(e=>{throw(0,l.newRxError)("SC22",{key:e.indexPath,type:e.schemaObj.type,schema:a})}),Object.keys((0,i.flattenObject)(a)).map(e=>{e=e.split(".");return e.pop(),e.join(".")}).filter(e=>""!==e&&"attachments"!==e).filter((e,t,r)=>r.indexOf(e)===t).filter(e=>{e=(0,i.getProperty)(a,e);return e&&!!e.encrypted}).forEach(e=>{throw e=(e=e.replace("properties.","")).replace(/\.properties\./g,"."),(0,l.newRxError)("SC27",{index:(0,i.trimDots)(e),schema:a})}),a.encrypted&&a.encrypted.forEach(e=>{var t=c(e),t=(0,i.getProperty)(a,t);if(!t||"object"!=typeof t)throw(0,l.newRxError)("SC28",{field:e,schema:a})})},r.validateFieldsDeep=o;var l=e("../../rx-error"),s=e("../../rx-schema-helper"),i=e("../../plugins/utils"),n=e("./entity-properties");function f(e){if("_deleted"!==e){if(["properties"].includes(e))throw(0,l.newRxError)("SC23",{fieldName:e});var t="^[a-zA-Z](?:[[a-zA-Z0-9_]*]?[a-zA-Z0-9])?$",r=new RegExp(t);if("_id"!==e&&!e.match(r))throw(0,l.newRxError)("SC1",{regex:t,fieldName:e})}}function o(e){var c=(0,s.getPrimaryFieldOfPrimaryKey)(e.primaryKey);return function a(s,u){s&&"object"==typeof s&&Object.keys(s).forEach(e=>{var t=s[e];if(!s.properties&&t&&"object"==typeof t&&!Array.isArray(s)){var r=e,n=t,i=u;if("string"!=typeof r||"object"!=typeof n||Array.isArray(n)||f(r),n.hasOwnProperty("item")&&"array"!==n.type)throw(0,l.newRxError)("SC2",{fieldName:r});if(n.hasOwnProperty("required")&&"boolean"==typeof n.required)throw(0,l.newRxError)("SC24",{fieldName:r});if(n.hasOwnProperty("ref"))if(Array.isArray(n.type)){if(2<n.type.length||!n.type.includes("string")||!n.type.includes("null"))throw(0,l.newRxError)("SC4",{fieldName:r})}else switch(n.type){case"string":break;case"array":if(n.items&&n.items.type&&"string"===n.items.type)break;throw(0,l.newRxError)("SC3",{fieldName:r});default:throw(0,l.newRxError)("SC4",{fieldName:r})}var o=2<=i.split(".").length;if(o){if(n.primary)throw(0,l.newRxError)("SC6",{path:i,primary:n.primary});if(n.default)throw(0,l.newRxError)("SC7",{path:i})}if(!o){if("_id"===r&&"_id"!==c)throw(0,l.newRxError)("COL2",{fieldName:r});if("_"===r.charAt(0)&&"_id"!==r&&"_deleted"!==r)throw(0,l.newRxError)("SC8",{fieldName:r})}}a(t,"properties"!==e?u+"."+e:u)})}(e,""),!0}function u(r){if(!r.primaryKey)throw(0,l.newRxError)("SC30",{schema:r});function t(e){if(!e)throw(0,l.newRxError)("SC33",{schema:r});var t=e.type;if(!t||!["string","number","integer"].includes(t))throw(0,l.newRxError)("SC32",{schema:r,args:{schemaPart:e}})}"string"==typeof r.primaryKey?(e=r.primaryKey,t(r.properties[e])):(e=r.primaryKey,t((0,s.getSchemaByObjectPath)(r,e.key)),e.fields.forEach(e=>{t((0,s.getSchemaByObjectPath)(r,e))}));var e=(0,s.getPrimaryFieldOfPrimaryKey)(r.primaryKey),e=r.properties[e];if(!e.maxLength)throw(0,l.newRxError)("SC39",{schema:r,args:{primaryPathSchemaPart:e}})}function c(e){for(var t=e.split("."),r="",n=0;n<t.length;n+=1)r="[]"!==t[n]?r.concat(".properties.".concat(t[n])):r.concat(".items");return(0,i.trimDots)(r)}},{"../../plugins/utils":360,"../../rx-error":394,"../../rx-schema-helper":398,"./entity-properties":337}],337:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.rxCollectionProperties=function(){{var e,t;n||(t=new o.RxCollectionBase,e=Object.getOwnPropertyNames(t),t=Object.getOwnPropertyNames(Object.getPrototypeOf(t)),n=[...e,...t])}return n},r.rxDatabaseProperties=function(){{var e,t,r;i||(e=new a.RxDatabaseBase("pseudoInstance","memory"),t=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(Object.getPrototypeOf(e)),i=[...t,...r],e.destroy())}return i},r.rxDocumentProperties=function(){{var e,t;u||(e=Object.getOwnPropertyNames(c),t=Object.getOwnPropertyNames(s.basePrototype),u=[...e,...t,"deleted","synced"])}return u};var n,i,o=e("../../rx-collection"),a=e("../../rx-database"),s=e("../../rx-document");var u,c=new((0,s.createRxDocumentConstructor)(s.basePrototype))},{"../../rx-collection":389,"../../rx-database":391,"../../rx-document":393}],338:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ERROR_MESSAGES=void 0;r.ERROR_MESSAGES={UT1:"given name is no string or empty",UT2:"collection- and database-names must match the regex to be compatible with couchdb databases.\n    See https://neighbourhood.ie/blog/2020/10/13/everything-you-need-to-know-about-couchdb-database-names/\n    info: if your database-name specifies a folder, the name must contain the slash-char '/' or '\\'",UT3:"replication-direction must either be push or pull or both. But not none",UT4:"given leveldown is no valid adapter",UT5:"keyCompression is set to true in the schema but no key-compression handler is used in the storage",UT6:"schema contains encrypted fields but no encryption handler is used in the storage",UT7:"attachments.compression is enabled but no attachment-compression plugin is used",PL1:"Given plugin is not RxDB plugin.",PL3:"A plugin with the same name was already added but it was not the exact same JavaScript object",P2:"bulkWrite() cannot be called with an empty array",QU1:"RxQuery._execOverDatabase(): op not known",QU4:"RxQuery.regex(): You cannot use .regex() on the primary field",QU5:"RxQuery.sort(): does not work because key is not defined in the schema",QU6:"RxQuery.limit(): cannot be called on .findOne()",QU9:"throwIfMissing can only be used in findOne queries",QU10:"result empty and throwIfMissing: true",QU11:"RxQuery: no valid query params given",QU12:"Given index is not in schema",QU13:"A top level field of the query is not included in the schema",QU14:"Running a count() query in slow mode is now allowed. Either run a count() query with a selector that fully matches an index or set allowSlowCount=true when calling the createRxDatabase",QU15:"For count queries it is not allowed to use skip or limit",MQ1:"path must be a string or object",MQ2:"Invalid argument",MQ3:"Invalid sort() argument. Must be a string, object, or array",MQ4:"Invalid argument. Expected instanceof mquery or plain object",MQ5:"method must be used after where() when called with these arguments",MQ6:"Can't mix sort syntaxes. Use either array or object | .sort([['field', 1], ['test', -1]]) | .sort({ field: 1, test: -1 })",MQ7:"Invalid sort value",MQ8:"Can't mix sort syntaxes. Use either array or object",DB1:"RxDocument.prepare(): another instance on this adapter has a different password",DB2:"RxDatabase.addCollections(): collection-names cannot start with underscore _",DB3:"RxDatabase.addCollections(): collection already exists. use myDatabase.[collectionName] to get it",DB4:"RxDatabase.addCollections(): schema is missing",DB5:"RxDatabase.addCollections(): collection-name not allowed",DB6:"RxDatabase.addCollections(): another instance created this collection with a different schema. Read this https://pubkey.github.io/rxdb/questions-answers.html#cant-change-the-schema",DB8:"RxDatabase.create(): A RxDatabase with the same name and adapter already exists.\nMake sure to use this combination only once or set ignoreDuplicate to true if you do this intentional",DB11:"createRxDatabase(): Invalid db-name, folder-paths must not have an ending slash",DB12:"RxDatabase.addCollections(): could not write to internal store",DB13:"createRxDatabase(): Invalid db-name or collection name, name contains the dollar sign",COL1:"RxDocument.insert() You cannot insert an existing document",COL2:"RxCollection.insert() fieldName ._id can only be used as primaryKey",COL3:"RxCollection.upsert() does not work without primary",COL4:"RxCollection.incrementalUpsert() does not work without primary",COL5:"RxCollection.find() if you want to search by _id, use .findOne(_id)",COL6:"RxCollection.findOne() needs a queryObject or string",COL7:"hook must be a function",COL8:"hooks-when not known",COL9:"RxCollection.addHook() hook-name not known",COL10:"RxCollection .postCreate-hooks cannot be async",COL11:"migrationStrategies must be an object",COL12:"A migrationStrategy is missing or too much",COL13:"migrationStrategy must be a function",COL14:"given static method-name is not a string",COL15:"static method-names cannot start with underscore _",COL16:"given static method is not a function",COL17:"RxCollection.ORM: statics-name not allowed",COL18:"collection-method not allowed because fieldname is in the schema",COL20:"Storage write error",CONFLICT:"Document update conflict. When changing a document you must work on the previous revision",DOC1:"RxDocument.get$ cannot get observable of in-array fields because order cannot be guessed",DOC2:"cannot observe primary path",DOC3:"final fields cannot be observed",DOC4:"RxDocument.get$ cannot observe a non-existed field",DOC5:"RxDocument.populate() cannot populate a non-existed field",DOC6:"RxDocument.populate() cannot populate because path has no ref",DOC7:"RxDocument.populate() ref-collection not in database",DOC8:"RxDocument.set(): primary-key cannot be modified",DOC9:"final fields cannot be modified",DOC10:"RxDocument.set(): cannot set childpath when rootPath not selected",DOC11:"RxDocument.save(): can't save deleted document",DOC13:"RxDocument.remove(): Document is already deleted",DOC14:"RxDocument.destroy() does not exist",DOC15:"query cannot be an array",DOC16:"Since version 8.0.0 RxDocument.set() can only be called on temporary RxDocuments",DOC17:"Since version 8.0.0 RxDocument.save() can only be called on non-temporary documents",DOC18:"Document property for composed primary key is missing",DOC19:"Value of primary key(s) cannot be changed",DOC20:"PrimaryKey missing",DOC21:"PrimaryKey must be equal to PrimaryKey.trim(). It cannot start or end with a whitespace",DOC22:"PrimaryKey must not contain a linebreak",DOC23:'PrimaryKey must not contain a double-quote ["]',DM1:"migrate() Migration has already run",DM2:"migration of document failed final document does not match final schema",DM3:"migration already running",AT1:"to use attachments, please define this in your schema",EN1:"password is not valid",EN2:"validatePassword: min-length of password not complied",EN3:"Schema contains encrypted properties but no password is given",EN4:"Password not valid",JD1:"You must create the collections before you can import their data",JD2:"RxCollection.importJSON(): the imported json relies on a different schema",JD3:"RxCollection.importJSON(): json.passwordHash does not match the own",LD1:"RxDocument.allAttachments$ can't use attachments on local documents",LD2:"RxDocument.get(): objPath must be a string",LD3:"RxDocument.get$ cannot get observable of in-array fields because order cannot be guessed",LD4:"cannot observe primary path",LD5:"RxDocument.set() id cannot be modified",LD6:"LocalDocument: Function is not usable on local documents",LD7:"Local document already exists",LD8:"localDocuments not activated. Set localDocuments=true on creation, when you want to store local documents on the RxDatabase or RxCollection.",RC1:"Replication: already added",RC2:"replicateCouchDB() query must be from the same RxCollection",RC4:"RxCouchDBReplicationState.awaitInitialReplication() cannot await initial replication when live: true",RC5:"RxCouchDBReplicationState.awaitInitialReplication() cannot await initial replication if multiInstance because the replication might run on another instance",RC6:"syncFirestore() serverTimestampField MUST NOT be part of the collections schema and MUST NOT be nested.",RC_PULL:"RxReplication pull handler threw an error - see .errors for more details",RC_STREAM:"RxReplication pull stream$ threw an error - see .errors for more details",RC_PUSH:"RxReplication push handler threw an error - see .errors for more details",RC_PUSH_NO_AR:"RxReplication push handler did not return an array with the conflicts",RC_P2P_PEER:"RxReplication P2P Peer has error",RC_COUCHDB_1:"replicateCouchDB() url must end with a slash like 'https://example.com/mydatabase/'",RC_COUCHDB_2:"replicateCouchDB() did not get valid result with rows.",SC1:"fieldnames do not match the regex",SC2:"SchemaCheck: name 'item' reserved for array-fields",SC3:"SchemaCheck: fieldname has a ref-array but items-type is not string",SC4:"SchemaCheck: fieldname has a ref but is not type string, [string,null] or array<string>",SC6:"SchemaCheck: primary can only be defined at top-level",SC7:"SchemaCheck: default-values can only be defined at top-level",SC8:"SchemaCheck: first level-fields cannot start with underscore _",SC10:"SchemaCheck: schema defines ._rev, this will be done automatically",SC11:"SchemaCheck: schema needs a number >=0 as version",SC13:"SchemaCheck: primary is always index, do not declare it as index",SC14:"SchemaCheck: primary is always unique, do not declare it as index",SC15:"SchemaCheck: primary cannot be encrypted",SC16:"SchemaCheck: primary must have type: string",SC17:"SchemaCheck: top-level fieldname is not allowed",SC18:"SchemaCheck: indexes must be an array",SC19:"SchemaCheck: indexes must contain strings or arrays of strings",SC20:"SchemaCheck: indexes.array must contain strings",SC21:"SchemaCheck: given index is not defined in schema",SC22:"SchemaCheck: given indexKey is not type:string",SC23:"SchemaCheck: fieldname is not allowed",SC24:"SchemaCheck: required fields must be set via array. See https://spacetelescope.github.io/understanding-json-schema/reference/object.html#required",SC25:"SchemaCheck: compoundIndexes needs to be specified in the indexes field",SC26:"SchemaCheck: indexes needs to be specified at collection schema level",SC27:"SchemaCheck: encrypted fields need to be specified at collection schema level",SC28:"SchemaCheck: encrypted fields is not defined in the schema",SC29:"SchemaCheck: missing object key 'properties'",SC30:"SchemaCheck: primaryKey is required",SC32:"SchemaCheck: primary field must have the type string/number/integer",SC33:"SchemaCheck: used primary key is not a property in the schema",SC34:"Fields of type string that are used in an index, must have set the maxLength attribute in the schema",SC35:"Fields of type number/integer that are used in an index, must have set the multipleOf attribute in the schema",SC36:"A field of this type cannot be used as index",SC37:"Fields of type number that are used in an index, must have set the minimum and maximum attribute in the schema",SC38:"Fields of type boolean that are used in an index, must be required in the schema",SC39:"The primary key must have the maxLength attribute set",VD1:"Sub-schema not found, does the schemaPath exists in your schema?",VD2:"object does not match schema",S1:"You cannot create collections after calling RxDatabase.server()",GQL1:"GraphQL replication: cannot find sub schema by key",GQL3:"GraphQL replication: pull returns more documents then batchSize",CRDT1:"CRDT operations cannot be used because the crdt options are not set in the schema.",CRDT2:"RxDocument.incrementalModify() cannot be used when CRDTs are activated.",CRDT3:"To use CRDTs you MUST NOT set a conflictHandler because the default CRDT conflict handler must be used",DXE1:"The dexie.js RxStorage does not support boolean indexes, see https://rxdb.info/rx-storage-dexie.html#boolean-index",SNH:"This should never happen"}},{}],339:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={deepFreezeWhenDevMode:!0,DEV_MODE_PLUGIN_NAME:!0,RxDBDevModePlugin:!0},i=(r.RxDBDevModePlugin=r.DEV_MODE_PLUGIN_NAME=void 0,r.deepFreezeWhenDevMode=p,e("./error-messages")),o=e("./check-schema"),a=(Object.keys(o).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===o[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})}),e("./check-orm")),s=e("./check-migration-strategies"),u=e("./unallowed-properties"),c=(Object.keys(u).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===u[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return u[e]}})}),e("./check-query")),l=(Object.keys(c).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===c[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return c[e]}})}),e("../../rx-error")),f=e("../../plugins/utils"),d=e("./check-document");function p(e){return e&&"string"!=typeof e&&"number"!=typeof e?(0,f.deepFreeze)(e):e}e={name:r.DEV_MODE_PLUGIN_NAME="dev-mode",rxdb:!0,init:()=>{console.warn(["-------------- RxDB dev-mode warning -------------------------------","you are seeing this because you use the RxDB dev-mode plugin https://rxdb.info/dev-mode.html","This is great in development mode, because it will run many checks to ensure","that you use RxDB correct. If you see this in production mode,","you did something wrong because the dev-mode plugin will decrease the performance.","","🤗 Hint: To get the most out of RxDB, check out the Premium Plugins","to get access to faster storages and more professional features: https://rxdb.info/premium.html","","Also take part in the RxDB User Survey: https://rxdb.info/survey.html","---------------------------------------------------------------------"].join("\n"))},overwritable:{isDevMode(){return!0},deepFreezeWhenDevMode:p,tunnelErrorMessage(e){if(i.ERROR_MESSAGES[e])return i.ERROR_MESSAGES[e];throw console.error("RxDB: Error-Code not known: "+e),new Error("Error-Code "+e+" not known, contact the maintainer")}},hooks:{preCreateRxSchema:{after:o.checkSchema},preCreateRxDatabase:{after:function(e){(0,u.ensureDatabaseNameIsValid)(e)}},preCreateRxCollection:{after:function(e){if((0,u.ensureCollectionNameValid)(e),(0,a.checkOrmDocumentMethods)(e.schema,e.methods),"_"===e.name.charAt(0))throw(0,l.newRxError)("DB2",{name:e.name});if(!e.schema)throw(0,l.newRxError)("DB4",{name:e.name,args:e})}},createRxDocument:{before:function(e){(0,d.ensurePrimaryKeyValid)(e.primary,e.toJSON(!0))}},preCreateRxQuery:{after:function(e){(0,c.checkQuery)(e)}},prePrepareQuery:{after:e=>{(0,c.checkMangoQuery)(e)}},createRxCollection:{after:e=>{(0,a.checkOrmMethods)(e.creator.statics),(0,a.checkOrmMethods)(e.creator.methods),(0,a.checkOrmMethods)(e.creator.attachments),e.creator.schema&&e.creator.migrationStrategies&&(0,s.checkMigrationStrategies)(e.creator.schema,e.creator.migrationStrategies)}}}};r.RxDBDevModePlugin=e},{"../../plugins/utils":360,"../../rx-error":394,"./check-document":332,"./check-migration-strategies":333,"./check-orm":334,"./check-query":335,"./check-schema":336,"./error-messages":338,"./unallowed-properties":340}],340:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ensureCollectionNameValid=function(e){if((0,i.rxDatabaseProperties)().includes(e.name))throw(0,n.newRxError)("DB5",{name:e.name});u(e.name)},r.ensureDatabaseNameIsValid=function(e){if(u(e.name),e.name.includes("$"))throw(0,n.newRxError)("DB13",{name:e.name});if((0,o.isFolderPath)(e.name)&&(e.name.endsWith("/")||e.name.endsWith("\\")))throw(0,n.newRxError)("DB11",{name:e.name})},r.validateDatabaseName=u;var n=e("../../rx-error"),i=e("./entity-properties"),o=e("../../plugins/utils");var a="^[a-z][_$a-z0-9\\-]*$",s=new RegExp(a);function u(e){if("string"!=typeof e||0===e.length)throw(0,n.newRxTypeError)("UT1",{name:e});if((0,o.isFolderPath)(e))return!0;if(e.match(s)||":memory:"===e)return!0;throw(0,n.newRxError)("UT2",{regex:a,givenName:e})}},{"../../plugins/utils":360,"../../rx-error":394,"./entity-properties":337}],341:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RxDBJsonDumpPlugin=void 0;var n=e("../../rx-query"),i=e("../../rx-error"),o=e("../../plugins/utils");function a(t){var r={name:this.name,instanceToken:this.token,collections:[]},e=Object.keys(this.collections).filter(e=>!t||t.includes(e)).filter(e=>"_"!==e.charAt(0)).map(e=>this.collections[e]);return Promise.all(e.map(e=>e.exportJSON())).then(e=>(r.collections=e,r))}function s(e){var t=e.collections.filter(e=>!this.collections[e.name]).map(e=>e.name);if(0<t.length)throw(0,i.newRxError)("JD1",{missingCollections:t});return Promise.all(e.collections.map(e=>this.collections[e.name].importJSON(e)))}function u(){var t={name:this.name,schemaHash:this.schema.hash,docs:[]},e=(0,n.createRxQuery)("find",(0,n._getDefaultQuery)(),this);return(0,n.queryCollection)(e).then(e=>(t.docs=e.map(e=>(delete(e=(0,o.flatClone)(e))._rev,delete e._attachments,e)),t))}function c(e){if(e.schemaHash!==this.schema.hash)throw(0,i.newRxError)("JD2",{schemaHash:e.schemaHash,own:this.schema.hash});e=e.docs;return this.storageInstance.bulkWrite(e.map(e=>{return{document:Object.assign({},e,{_meta:{lwt:(0,o.now)()},_rev:(0,o.getDefaultRevision)(),_attachments:{},_deleted:!1})}}),"json-dump-import")}r.RxDBJsonDumpPlugin={name:"json-dump",rxdb:!0,prototypes:{RxDatabase:e=>{e.exportJSON=a,e.importJSON=s},RxCollection:e=>{e.exportJSON=u,e.importJSON=c}},overwritable:{}}},{"../../plugins/utils":360,"../../rx-error":394,"../../rx-query":397}],342:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RxDBLeaderElectionPlugin=void 0,r.getForDatabase=c,r.getLeaderElectorByBroadcastChannel=u,r.isLeader=l,r.onDestroy=d,r.rxdb=r.prototypes=void 0,r.waitForLeadership=f;var n=e("broadcast-channel"),i=e("../../rx-storage-multiinstance"),o=e("../utils"),a=new WeakMap,s=new WeakMap;function u(e){return(0,o.getFromMapOrCreate)(s,e,()=>(0,n.createLeaderElection)(e))}function c(){var e=(0,i.getBroadcastChannelReference)(this.token,this.name,this),t=this.destroy.bind(this),r=(this.destroy=function(){return(0,i.removeBroadcastChannelReference)(this.token,this),t()},u(e));return r||(r=u(e),a.set(this,r)),this.leaderElector=()=>r,r}function l(){return!this.multiInstance||this.leaderElector().isLeader}function f(){return this.multiInstance?this.leaderElector().awaitLeadership().then(()=>!0):o.PROMISE_RESOLVE_TRUE}function d(e){e=a.get(e);e&&e.die()}e={RxDatabase:e=>{e.leaderElector=c,e.isLeader=l,e.waitForLeadership=f}},e={name:"leader-election",rxdb:r.rxdb=!0,prototypes:r.prototypes=e,hooks:{preDestroyRxDatabase:{after:d}}};r.RxDBLeaderElectionPlugin=e},{"../../rx-storage-multiinstance":401,"../utils":360,"broadcast-channel":22}],343:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RxStorageDexieStatics=r.RX_STORAGE_NAME_DEXIE=r.DEXIE_PIPE_SUBSTITUTE=r.DEXIE_DOCS_TABLE_NAME=r.DEXIE_DELETED_DOCS_TABLE_NAME=r.DEXIE_CHANGES_TABLE_NAME=void 0,r.closeDexieDb=async function(e){var t=await e,r=h.get(e)-1;0==r?(t.dexieDb.close(),h.delete(e)):h.set(e,r)},r.dexieReplaceIfStartsWithPipe=o,r.dexieReplaceIfStartsWithPipeRevert=a,r.ensureNoBooleanIndex=function(r){var n;r.indexes&&(n=new Set,r.indexes.forEach(t=>{(0,u.toArray)(t).forEach(e=>{if(!n.has(e)&&(n.add(e),"boolean"===(0,c.getSchemaByObjectPath)(r,e).type))throw(0,i.newRxError)("DXE1",{schema:r,index:t,field:e})})}))},r.fromDexieToStorage=function r(n){{var i;return n&&"string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n?Array.isArray(n)?n.map(e=>r(e)):"object"==typeof n?(i={},Object.entries(n).forEach(([e,t])=>{"object"!=typeof t&&!Array.isArray(n)||(t=r(t)),i[a(e)]=t}),i):void 0:n}},r.fromStorageToDexie=function r(e){{var n;return e&&"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e?Array.isArray(e)?e.map(e=>r(e)):"object"==typeof e?(n={},Object.entries(e).forEach(([e,t])=>{"object"==typeof t&&(t=r(t)),n[o(e)]=t}),n):void 0:e}},r.getDexieDbWithTables=function(e,t,r,n){var i=(0,c.getPrimaryFieldOfPrimaryKey)(n.primaryKey),o="rxdb-dexie-"+e+"--"+n.version+"--"+t,a=(0,u.getFromMapOrCreate)(p,o,()=>{var e=(async()=>{var e=(0,u.flatClone)(r),e=(e.autoOpen=!1,new s.Dexie(o,e)),t={[l]:y(n),[d]:"++sequence, id",[f]:i+",_meta.lwt,[_meta.lwt+"+i+"]"};return e.version(1).stores(t),await e.open(),{dexieDb:e,dexieTable:e[l],dexieDeletedTable:e[f]}})();return p.set(o,a),h.set(a,0),e});return a},r.getDexieStoreSchema=y,r.getDocsInDb=async function(e,t){var e=await e,[e,t]=await Promise.all([e.dexieTable.bulkGet(t),e.dexieDeletedTable.bulkGet(t)]),r=t.slice(0);return e.forEach((e,t)=>{e&&(r[t]=e)}),r};var s=e("dexie"),u=e("../utils"),i=e("../../rx-error"),c=e("../../rx-schema-helper"),e=e("../../rx-storage-statics"),l="docs",f=(r.DEXIE_DOCS_TABLE_NAME=l,"deleted-docs"),d=(r.DEXIE_DELETED_DOCS_TABLE_NAME=f,"changes"),e=(r.DEXIE_CHANGES_TABLE_NAME=d,r.RX_STORAGE_NAME_DEXIE="dexie",e.RxStorageDefaultStatics),p=(r.RxStorageDexieStatics=e,new Map),h=new Map;var n="__";function o(e){var t=e.split(".");return 1<t.length?t.map(e=>o(e)).join("."):e.startsWith("|")?(t=e.substring(1),n+t):e}function a(e){var t=e.split(".");return 1<t.length?t.map(e=>a(e)).join("."):e.startsWith(n)?"|"+e.substring(n.length):e}function y(e){var t=[],r=(0,c.getPrimaryFieldOfPrimaryKey)(e.primaryKey);return t.push([r]),e.indexes&&e.indexes.forEach(e=>{e=(0,u.toArray)(e);t.push(e)}),t.push(["_meta.lwt",r]),(t=t.map(e=>e.map(e=>o(e)))).map(e=>1===e.length?e[0]:"["+e.join("+")+"]").join(", ")}r.DEXIE_PIPE_SUBSTITUTE=n},{"../../rx-error":394,"../../rx-schema-helper":398,"../../rx-storage-statics":402,"../utils":360,dexie:43}],344:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.dexieCount=async function(n,e){var t=await n.internals,e=e.queryPlan,i=e.index,o=p(e,t.dexieDb._options.IDBKeyRange),a=-1;return await t.dexieDb.transaction("r",t.dexieTable,async e=>{var t,e=e.idbtrans.objectStore(d.DEXIE_DOCS_TABLE_NAME),r=(1===i.length&&i[0]===n.primaryPath?e:(t=1===i.length?(0,d.dexieReplaceIfStartsWithPipe)(i[0]):"["+i.map(e=>(0,d.dexieReplaceIfStartsWithPipe)(e)).join("+")+"]",e.index(t))).count(o);a=await new Promise((e,t)=>{r.onsuccess=function(){e(r.result)},r.onerror=e=>t(e)})}),a},r.dexieQuery=async function(r,e){var t=await r.internals,n=e.query,i=n.skip||0,n=n.limit||1/0,o=i+n,a=e.queryPlan,s=!1;a.selectorSatisfiedByIndex||(s=(0,f.getQueryMatcher)(r.schema,e.query));var u=p(a,t.dexieDb._options.IDBKeyRange),c=a.index,l=[];await t.dexieDb.transaction("r",t.dexieTable,async e=>{var t,e=e.idbtrans.objectStore(d.DEXIE_DOCS_TABLE_NAME),n=(1===c.length&&c[0]===r.primaryPath?e:(t=1===c.length?(0,d.dexieReplaceIfStartsWithPipe)(c[0]):"["+c.map(e=>(0,d.dexieReplaceIfStartsWithPipe)(e)).join("+")+"]",e.index(t))).openCursor(u);await new Promise(r=>{n.onsuccess=function(e){var t,e=e.target.result;!e||((t=(0,d.fromDexieToStorage)(e.value))._deleted||s&&!s(t)||l.push(t),a.sortFieldsSameAsIndexFields&&l.length===o)?r():e.continue()}})}),a.sortFieldsSameAsIndexFields||(n=(0,f.getSortComparator)(r.schema,e.query),l=l.sort(n));return{documents:l=l.slice(i,o)}},r.getKeyRangeByQueryPlan=p,r.mapKeyForKeyRange=o;var n=e("../../query-planner"),f=e("../../rx-query-helper"),d=e("./dexie-helper");function o(e){return e===n.INDEX_MIN?-1/0:e}function p(e,t){if(!t){if("undefined"==typeof window)throw new Error("IDBKeyRange missing");t=window.IDBKeyRange}var r,n=e.startKeys.map(o),i=e.endKeys.map(o);return 1===e.index.length?(r=n[0]===i[0],t.bound(n[0],i[0],!r&&!e.inclusiveStart,!r&&!e.inclusiveEnd)):t.bound(n,i,!e.inclusiveStart,!e.inclusiveEnd)}},{"../../query-planner":379,"../../rx-query-helper":395,"./dexie-helper":343}],345:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./rx-storage-dexie"),i=(Object.keys(n).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}})}),e("./rx-storage-instance-dexie")),o=(Object.keys(i).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===i[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})}),e("./dexie-helper")),a=(Object.keys(o).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===o[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})}),e("./dexie-query"));Object.keys(a).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===a[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})})},{"./dexie-helper":343,"./dexie-query":344,"./rx-storage-dexie":346,"./rx-storage-instance-dexie":347}],346:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RxStorageDexie=void 0,r.getRxStorageDexie=function(e={}){return new a(e)};var n=e("./dexie-helper"),i=e("./rx-storage-instance-dexie"),o=e("../../rx-storage-helper"),a=function(){function e(e){this.name=n.RX_STORAGE_NAME_DEXIE,this.statics=n.RxStorageDexieStatics,this.settings=e}return e.prototype.createStorageInstance=function(e){return(0,o.ensureRxStorageInstanceParamsAreCorrect)(e),(0,n.ensureNoBooleanIndex)(e.schema),(0,i.createDexieStorageInstance)(this,e,this.settings)},e}();r.RxStorageDexie=a},{"../../rx-storage-helper":400,"./dexie-helper":343,"./rx-storage-instance-dexie":347}],347:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RxStorageInstanceDexie=void 0,r.createDexieStorageInstance=function(e,t,r){var n=(0,d.getDexieDbWithTables)(t.databaseName,t.collectionName,r,t.schema),e=new o(e,t.databaseName,t.collectionName,t.schema,n,t.options,r);return(0,i.addRxStorageMultiInstanceSupport)(d.RX_STORAGE_NAME_DEXIE,t,e),Promise.resolve(e)};var s=e("rxjs"),f=e("../utils"),d=e("./dexie-helper"),n=e("./dexie-query"),u=e("../../rx-schema-helper"),p=e("../../rx-storage-helper"),i=e("../../rx-storage-multiinstance"),h=e("../../rx-error"),c=(0,f.now)(),o=function(){function e(e,t,r,n,i,o,a){this.changes$=new s.Subject,this.instanceId=c++,this.closed=!1,this.storage=e,this.databaseName=t,this.collectionName=r,this.schema=n,this.internals=i,this.options=o,this.settings=a,this.primaryPath=(0,u.getPrimaryFieldOfPrimaryKey)(this.schema.primaryKey)}var t=e.prototype;return t.bulkWrite=async function(o,a){y(this),o.forEach(e=>{if(!e.document._rev||e.previous&&!e.previous._rev)throw(0,h.newRxError)("SNH",{args:{row:e}})});var s,e,t,u=await this.internals,c={success:{},error:{}},l=o.map(e=>e.document[this.primaryPath]);return await u.dexieDb.transaction("rw",u.dexieTable,u.dexieDeletedTable,async()=>{var t=new Map,r=((await(0,d.getDocsInDb)(this.internals,l)).forEach(e=>{e=e&&(0,d.fromDexieToStorage)(e);return e&&t.set(e[this.primaryPath],e),e}),s=(0,p.categorizeBulkWriteRows)(this,this.primaryPath,t,o,a),c.error=s.errors,[]),n=[],i=[],e=[];s.bulkInsertDocs.forEach(e=>{var t=e.document[this.primaryPath];c.success[t]=e.document,r.push(e.document)}),s.bulkUpdateDocs.forEach(e=>{var t=e.document[this.primaryPath];if(c.success[t]=e.document,e.document._deleted&&e.previous&&!e.previous._deleted)n.push(t),i.push(e.document);else if(e.document._deleted&&e.previous&&e.previous._deleted)i.push(e.document);else{if(e.document._deleted)throw(0,h.newRxError)("SNH",{args:{row:e}});r.push(e.document)}}),await Promise.all([0<r.length?u.dexieTable.bulkPut(r.map(e=>(0,d.fromStorageToDexie)(e))):f.PROMISE_RESOLVE_VOID,0<n.length?u.dexieTable.bulkDelete(n):f.PROMISE_RESOLVE_VOID,0<i.length?u.dexieDeletedTable.bulkPut(i.map(e=>(0,d.fromStorageToDexie)(e))):f.PROMISE_RESOLVE_VOID,0<e.length?u.dexieDeletedTable.bulkDelete(e):f.PROMISE_RESOLVE_VOID])}),0<(s=(0,f.ensureNotFalsy)(s)).eventBulk.events.length&&(e=(0,f.ensureNotFalsy)(s.newestRow).document,s.eventBulk.checkpoint={id:e[this.primaryPath],lwt:e._meta.lwt},t=(0,f.now)(),s.eventBulk.events.forEach(e=>e.endTime=t),this.changes$.next(s.eventBulk)),c},t.findDocumentsById=async function(e,n){y(this);var t=await this.internals,i={};return await t.dexieDb.transaction("r",t.dexieTable,t.dexieDeletedTable,async()=>{var r=n?await(0,d.getDocsInDb)(this.internals,e):await t.dexieTable.bulkGet(e);e.forEach((e,t)=>{t=r[t];!t||t._deleted&&!n||(i[e]=(0,d.fromDexieToStorage)(t))})}),i},t.query=function(e){return y(this),(0,n.dexieQuery)(this,e)},t.count=async function(e){return e.queryPlan.selectorSatisfiedByIndex?{count:await(0,n.dexieCount)(this,e),mode:"fast"}:{count:(await(0,n.dexieQuery)(this,e)).documents.length,mode:"slow"}},t.getChangedDocumentsSince=async function(t,e){y(this);var r=e?e.lwt:f.RX_META_LWT_MINIMUM,n=e?e.id:"",i=await this.internals,[i,o]=await Promise.all([i.dexieTable,i.dexieDeletedTable].map(async e=>{return(await e.where("[_meta.lwt+"+this.primaryPath+"]").above([r,n]).limit(t).toArray()).map(e=>(0,d.fromDexieToStorage)(e))})),i=i.slice(0),o=((0,f.appendToArray)(i,o),i=(i=(0,f.sortDocumentsByLastWriteTime)(this.primaryPath,i)).slice(0,t),(0,f.lastOfArray)(i));return{documents:i,checkpoint:o?{id:o[this.primaryPath],lwt:o._meta.lwt}:e||{id:"",lwt:0}}},t.remove=async function(){y(this);var e=await this.internals;return await Promise.all([e.dexieDeletedTable.clear(),e.dexieTable.clear()]),this.close()},t.changeStream=function(){return y(this),this.changes$.asObservable()},t.cleanup=async function(t){y(this);var r=await this.internals;return await r.dexieDb.transaction("rw",r.dexieDeletedTable,async()=>{var e=(0,f.now)()-t,e=(await r.dexieDeletedTable.where("_meta.lwt").below(e).toArray()).map(e=>e[this.primaryPath]);await r.dexieDeletedTable.bulkDelete(e)}),!0},t.getAttachmentData=function(e,t,r){throw y(this),new Error("Attachments are not implemented in the dexie RxStorage. Make a pull request.")},t.close=function(){return y(this),this.closed=!0,this.changes$.complete(),(0,d.closeDexieDb)(this.internals),f.PROMISE_RESOLVE_VOID},t.conflictResultionTasks=function(){return new s.Subject},t.resolveConflictResultionTask=async function(e){},e}();function y(e){if(e.closed)throw new Error("RxStorageInstanceDexie is closed "+e.databaseName+"-"+e.collectionName)}r.RxStorageInstanceDexie=o},{"../../rx-error":394,"../../rx-schema-helper":398,"../../rx-storage-helper":400,"../../rx-storage-multiinstance":401,"../utils":360,"./dexie-helper":343,"./dexie-query":344,rxjs:415}],348:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./rx-storage-lokijs"),i=(Object.keys(n).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}})}),e("./lokijs-helper")),o=(Object.keys(i).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===i[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})}),e("./rx-storage-instance-loki"));Object.keys(o).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===o[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})})},{"./lokijs-helper":350,"./rx-storage-instance-loki":351,"./rx-storage-lokijs":352}],349:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.LokiSaveQueue=void 0;var i=e("../utils"),e=function(){function e(e,t){this.writesSinceLastRun=0,this.saveQueue=i.PROMISE_RESOLVE_VOID,this.saveQueueC=0,this.lokiDatabase=e,this.databaseSettings=t}var t=e.prototype;return t.addWrite=function(){this.writesSinceLastRun=this.writesSinceLastRun+1,this.run()},t.run=function(){return!this.databaseSettings.adapter||2<this.saveQueueC||(this.saveQueueC=this.saveQueueC+1,this.saveQueue=this.saveQueue.then(async()=>{var n;if((await(0,i.requestIdlePromise)(),0!==this.writesSinceLastRun)&&(await(0,i.requestIdlePromise)().then(()=>(0,i.requestIdlePromise)()),0!==this.writesSinceLastRun))return n=this.writesSinceLastRun,this.writesSinceLastRun=0,new Promise((t,r)=>{this.lokiDatabase.saveDatabase(e=>{e?(this.writesSinceLastRun=this.writesSinceLastRun+n,r(e)):(this.databaseSettings.autosaveCallback&&this.databaseSettings.autosaveCallback(),t())})})}).catch(()=>{}).then(()=>{this.saveQueueC=this.saveQueueC-1})),this.saveQueue},e}();r.LokiSaveQueue=e},{"../utils":360}],350:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.RX_STORAGE_NAME_LOKIJS=r.OPEN_LOKIJS_STORAGE_INSTANCES=r.LOKI_KEY_OBJECT_BROADCAST_CHANNEL_MESSAGE_TYPE=r.LOKI_BROADCAST_CHANNEL_MESSAGE_TYPE=r.LOKIJS_COLLECTION_DEFAULT_OPTIONS=r.CHANGES_COLLECTION_SUFFIX=void 0,r.closeLokiCollections=async function(e,t){var n=await y.get(e);n&&(await n.saveQueue.run(),t.forEach(e=>{e=e.name;delete n.collections[e]}),0===Object.keys(n.collections).length)&&(y.delete(e),n.unloads.forEach(e=>e.remove()),await new Promise((t,r)=>{n.database.close(e=>{e?r(e):t()})}))},r.getLokiDatabase=function(a,s){return(0,l.getFromMapOrCreate)(y,a,()=>{var o=!!s.adapter;return(async()=>{var e,t=o?"adapter":"memory",n=(s.persistenceMethod&&(t=s.persistenceMethod),Object.assign({autoload:o,persistenceMethod:t,verbose:!0},s,{autoload:!1,autosave:!1,throttledSaves:!1})),i=new u.default(a+".db",(0,l.flatClone)(n)),r=new f.LokiSaveQueue(i,n),t=(o&&(e=new Promise((t,r)=>{try{i.loadDatabase({recursiveWait:!1},e=>{n.autoloadCallback&&n.autoloadCallback(e),e?r(e):t()})}catch(e){r(e)}}),r.saveQueue=r.saveQueue.then(()=>e),await e),[]);return o&&t.push((0,c.add)(()=>r.run())),{database:i,databaseSettings:n,saveQueue:r,collections:{},unloads:t}})()})},r.getLokiLeaderElector=function(e,t,r){e=(0,o.getBroadcastChannelReference)(e,r,t);return(0,s.getLeaderElectorByBroadcastChannel)(e)},r.getLokiSortComparator=function(e,t){var r;if(t.sort)return r=t.sort,(n,i)=>{var o=0;if(r.find(e=>{var t=Object.keys(e)[0],e="asc"===Object.values(e)[0]?1:-1,r=(0,l.getProperty)(n,t),t=(0,l.getProperty)(i,t);return r!==t&&(o=t<r?e:-1*e,!0)}),o)return o;throw(0,a.newRxError)("SNH",{args:{query:t,a:n,b:i}})};throw(0,a.newRxError)("SNH",{query:t})},r.handleRemoteRequest=async function(e,t){if(t.type===p&&t.requestId&&t.databaseName===e.databaseName&&t.collectionName===e.collectionName&&!t.response){var r,n=t.operation,i=t.params,o=!1;try{r=await e[n](...i)}catch(e){console.dir(e),o=!0,r=e}n={response:!0,requestId:t.requestId,databaseName:e.databaseName,collectionName:e.collectionName,result:r,isError:o,type:t.type};(0,l.ensureNotFalsy)(e.internals.leaderElector).broadcastChannel.postMessage(n)}},r.mustUseLocalState=async function(e){if(e.closed)throw(0,a.newRxError)("SNH",{args:{instanceClosed:e.closed,databaseName:e.databaseName,collectionName:e.collectionName}});if(e.internals.localState)return e.internals.localState;var t=(0,l.ensureNotFalsy)(e.internals.leaderElector);if(await m(t),e.internals.localState)return e.internals.localState;return!(!t.isLeader||e.internals.localState)&&(e.internals.localState=(0,i.createLokiLocalState)({databaseInstanceToken:e.databaseInstanceToken,databaseName:e.databaseName,collectionName:e.collectionName,options:e.options,schema:e.schema,multiInstance:!!e.internals.leaderElector,devMode:d.overwritable.isDevMode()},e.databaseSettings),(0,l.ensureNotFalsy)(e.internals.localState))},r.requestRemoteInstance=async function(t,r,n){var i,o,a="function"==typeof t.query?p:h,e=(0,l.ensureNotFalsy)(t.internals.leaderElector),s=(await m(e),e.broadcastChannel),e=new Promise(t=>{i=e=>{"leader"===e.context&&"death"===e.action&&t({retry:!0})},s.addEventListener("internal",i)}),u=(0,l.randomCouchString)(12),c=new Promise((t,e)=>{o=e=>{e.type===a&&!0===e.response&&e.requestId===u&&(e.isError?t({retry:!1,error:e.result}):t({retry:!1,result:e.result}))},s.addEventListener("message",o)});return s.postMessage({response:!1,type:a,operation:r,params:n,requestId:u,databaseName:t.databaseName,collectionName:t.collectionName}),Promise.race([e,c]).then(e=>{if(s.removeEventListener("message",o),s.removeEventListener("internal",i),e.retry)return t[r](...n);if(e.error)throw e.error;return e.result})},r.stripLokiKey=function(e){if(!e.$loki)return e;e=(0,l.flatClone)(e);e.$lastWriteAt&&(e._meta={lwt:e.$lastWriteAt},delete e.$lastWriteAt);return delete e.$loki,e},r.transformRegexToRegExp=function n(i){if("object"!=typeof i||null===i)return i;var e=Object.keys(i);var o={};e.forEach(e=>{var t,r=i[e];"$options"!==e&&("$regex"!==e||r instanceof RegExp?Array.isArray(r)?o[e]=r.map(e=>n(e)):o[e]=n(r):(t=i.$options,o[e]=new RegExp(r,t)))});return o},r.waitUntilHasLeader=m,e("./rx-storage-instance-loki")),u=n(e("lokijs")),c=e("unload"),l=e("../utils"),f=e("./loki-save-queue"),a=e("../../rx-error"),o=e("../../rx-storage-multiinstance"),s=e("../leader-election"),d=e("../../overwritable"),p=(r.CHANGES_COLLECTION_SUFFIX="-rxdb-changes","rxdb-lokijs-remote-request"),h=(r.LOKI_BROADCAST_CHANNEL_MESSAGE_TYPE=p,"rxdb-lokijs-remote-request-key-object");r.LOKI_KEY_OBJECT_BROADCAST_CHANNEL_MESSAGE_TYPE=h;r.RX_STORAGE_NAME_LOKIJS="lokijs";var n=new Set,y=(r.OPEN_LOKIJS_STORAGE_INSTANCES=n,r.LOKIJS_COLLECTION_DEFAULT_OPTIONS={disableChangesApi:!0,disableMeta:!0,disableDeltaChangesApi:!0,disableFreeze:!0,cloneMethod:"shallow-assign",clone:!1,transactional:!1,autoupdate:!1},new Map);async function m(e){for(e.awaitLeadership().catch(()=>{}),await(0,l.promiseWait)(0);;){if(await e.hasLeader()||e.broadcastChannel.isClosed||e.isDead)return;e.applyOnce?await e.applyOnce():e.awaitLeadership().catch(()=>{}),await(0,l.promiseWait)(20)}}},{"../../overwritable":329,"../../rx-error":394,"../../rx-storage-multiinstance":401,"../leader-election":342,"../utils":360,"./loki-save-queue":349,"./rx-storage-instance-loki":351,"@babel/runtime/helpers/interopRequireDefault":407,lokijs:67,unload:644}],351:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RxStorageInstanceLoki=void 0,r.createLokiLocalState=m,r.createLokiStorageInstance=async function(e,t,r){var n={},i={};{var o;t.multiInstance?(o=(0,f.getLokiLeaderElector)(t.databaseInstanceToken,i,t.databaseName),n.leaderElector=o):(n.localState=m(t,r),await n.localState)}var a=new y(t.databaseInstanceToken,e,t.databaseName,t.collectionName,t.schema,n,t.options,r);{var s,u;(0,p.addRxStorageMultiInstanceSupport)(f.RX_STORAGE_NAME_LOKIJS,t,a,n.leaderElector?n.leaderElector.broadcastChannel:void 0),t.multiInstance&&(s=a.close.bind(a),a.close=function(){return(0,p.removeBroadcastChannelReference)(t.databaseInstanceToken,i),s()},u=a.remove.bind(a),a.remove=function(){return(0,p.removeBroadcastChannelReference)(t.databaseInstanceToken,i),u()},(0,l.ensureNotFalsy)(n.leaderElector).awaitLeadership().then(()=>{a.closed||(0,f.mustUseLocalState)(a)}))}return a};var c=e("rxjs"),l=e("../utils"),s=e("../../rx-error"),f=e("./lokijs-helper"),d=e("../../rx-schema-helper"),u=e("../../rx-storage-helper"),p=e("../../rx-storage-multiinstance"),h=(0,l.now)(),y=function(){function e(e,t,r,n,i,o,a,s){var u;this.changes$=new c.Subject,this.instanceId=h++,this.closed=!1,this.databaseInstanceToken=e,this.storage=t,this.databaseName=r,this.collectionName=n,this.schema=i,this.internals=o,this.options=a,this.databaseSettings=s,this.primaryPath=(0,d.getPrimaryFieldOfPrimaryKey)(this.schema.primaryKey),f.OPEN_LOKIJS_STORAGE_INSTANCES.add(this),this.internals.leaderElector&&(u={bulkWrite:this.bulkWrite.bind(this),changeStream:this.changeStream.bind(this),cleanup:this.cleanup.bind(this),close:this.close.bind(this),query:this.query.bind(this),count:this.count.bind(this),findDocumentsById:this.findDocumentsById.bind(this),collectionName:this.collectionName,databaseName:this.databaseName,conflictResultionTasks:this.conflictResultionTasks.bind(this),getAttachmentData:this.getAttachmentData.bind(this),getChangedDocumentsSince:this.getChangedDocumentsSince.bind(this),internals:this.internals,options:this.options,remove:this.remove.bind(this),resolveConflictResultionTask:this.resolveConflictResultionTask.bind(this),schema:this.schema},this.internals.leaderElector.awaitLeadership().then(()=>{(0,l.ensureNotFalsy)(this.internals.leaderElector).broadcastChannel.addEventListener("message",e=>(0,f.handleRemoteRequest)(u,e))}).catch(()=>{}))}var t=e.prototype;return t.bulkWrite=async function(e,t){if(0===e.length)throw(0,s.newRxError)("P2",{args:{documentWrites:e}});var n,r,i,o,a=await(0,f.mustUseLocalState)(this);return a?(n={success:{},error:{}},r=new Map,i=new Map,e.forEach(e=>{var e=e.document[this.primaryPath],t=a.collection.by(this.primaryPath,e);t&&(i.set(e,t),r.set(e,(0,f.stripLokiKey)(t)))}),t=(0,u.categorizeBulkWriteRows)(this,this.primaryPath,r,e,t),n.error=t.errors,t.bulkInsertDocs.forEach(e=>{var t=e.document[this.primaryPath];a.collection.insert((0,l.flatClone)(e.document)),n.success[t]=e.document}),t.bulkUpdateDocs.forEach(e=>{var t=e.document[this.primaryPath],r=(0,l.getFromMapOrThrow)(i,t),r=Object.assign({},e.document,{$loki:r.$loki});a.collection.update(r),n.success[t]=e.document}),a.databaseState.saveQueue.addWrite(),0<t.eventBulk.events.length&&(o=(0,l.ensureNotFalsy)(t.newestRow).document,t.eventBulk.checkpoint={id:o[this.primaryPath],lwt:o._meta.lwt},this.changes$.next(t.eventBulk)),n):(0,f.requestRemoteInstance)(this,"bulkWrite",[e])},t.findDocumentsById=async function(e,r){var n,i=await(0,f.mustUseLocalState)(this);return i?(n={},e.forEach(e=>{var t=i.collection.by(this.primaryPath,e);!t||t._deleted&&!r||(n[e]=(0,f.stripLokiKey)(t))}),n):(0,f.requestRemoteInstance)(this,"findDocumentsById",[e,r])},t.query=async function(e){var t=await(0,f.mustUseLocalState)(this);if(!t)return(0,f.requestRemoteInstance)(this,"query",[e]);e.selector&&((e=(0,l.flatClone)(e)).selector=(0,f.transformRegexToRegExp)(e.selector));t=t.collection.chain().find(e.selector);return e.sort&&(t=t.sort((0,f.getLokiSortComparator)(this.schema,e))),e.skip&&(t=t.offset(e.skip)),{documents:(t=e.limit?t.limit(e.limit):t).data().map(e=>(0,f.stripLokiKey)(e))}},t.count=async function(e){return{count:(await this.query(e)).documents.length,mode:"fast"}},t.getAttachmentData=function(e,t,r){throw new Error("Attachments are not implemented in the lokijs RxStorage. Make a pull request.")},t.getChangedDocumentsSince=async function(e,t){var r,n=await(0,f.mustUseLocalState)(this);return n?(r=t?t.lwt:l.RX_META_LWT_MINIMUM,r=(n=n.collection.chain().find({"_meta.lwt":{$gte:r}}).sort((0,l.getSortDocumentsByLastWriteTimeComparator)(this.primaryPath)).data())[0],t&&r&&r[this.primaryPath]===t.id&&r._meta.lwt===t.lwt&&n.shift(),n=n.slice(0,e),r=(0,l.lastOfArray)(n),{documents:n.map(e=>(0,f.stripLokiKey)(e)),checkpoint:r?{id:r[this.primaryPath],lwt:r._meta.lwt}:t||{id:"",lwt:0}}):(0,f.requestRemoteInstance)(this,"getChangedDocumentsSince",[e,t])},t.changeStream=function(){return this.changes$.asObservable()},t.cleanup=async function(e){var t,r=await(0,f.mustUseLocalState)(this);return r?(t=(0,l.now)()-e,0<(t=r.collection.chain().find({_deleted:!0,"_meta.lwt":{$lt:t}}).limit(10).data()).length&&(r.collection.remove(t),r.databaseState.saveQueue.addWrite()),10!==t.length):(0,f.requestRemoteInstance)(this,"cleanup",[e])},t.close=async function(){if(this.closed)return Promise.reject(new Error("already closed"));var e;this.closed=!0,this.changes$.complete(),f.OPEN_LOKIJS_STORAGE_INSTANCES.delete(this),this.internals.localState&&(e=await this.internals.localState,await(await(0,f.getLokiDatabase)(this.databaseName,this.databaseSettings)).saveQueue.run(),await(0,f.closeLokiCollections)(this.databaseName,[e.collection]))},t.remove=async function(){var e=await(0,f.mustUseLocalState)(this);return e?(e.databaseState.database.removeCollection(e.collection.name),await e.databaseState.saveQueue.run(),this.close()):(0,f.requestRemoteInstance)(this,"remove",[])},t.conflictResultionTasks=function(){return new c.Subject},t.resolveConflictResultionTask=async function(e){},e}();async function m(e,t){e.options||(e.options={});var t=await(0,f.getLokiDatabase)(e.databaseName,t),r=[],n=(e.schema.indexes&&e.schema.indexes.forEach(e=>{(0,l.isMaybeReadonlyArray)(e)||r.push(e)}),(0,d.getPrimaryFieldOfPrimaryKey)(e.schema.primaryKey)),i=(r.push(n),e.collectionName+"-"+e.schema.version),n=Object.assign({},i,{indices:r,unique:[n]},f.LOKIJS_COLLECTION_DEFAULT_OPTIONS),i=t.database.addCollection(i,n);return t.collections[e.collectionName]=i,{databaseState:t,collection:i}}r.RxStorageInstanceLoki=y},{"../../rx-error":394,"../../rx-schema-helper":398,"../../rx-storage-helper":400,"../../rx-storage-multiinstance":401,"../utils":360,"./lokijs-helper":350,rxjs:415}],352:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RxStorageLokiStatics=r.RxStorageLoki=void 0,r.getRxStorageLoki=function(e={}){return new u(e)};var n=e("../utils"),i=e("./rx-storage-instance-loki"),o=e("./lokijs-helper"),a=e("../../rx-storage-helper"),s={prepareQuery(e,t){return t=(0,n.flatClone)(t),0<Object.keys((0,n.ensureNotFalsy)(t.selector)).length?t.selector={$and:[{_deleted:!1},t.selector]}:t.selector={_deleted:!1},t},checkpointSchema:e("../../rx-schema-helper").DEFAULT_CHECKPOINT_SCHEMA},u=(r.RxStorageLokiStatics=s,function(){function e(e){this.name=o.RX_STORAGE_NAME_LOKIJS,this.statics=s,this.leaderElectorByLokiDbName=new Map,this.databaseSettings=e}return e.prototype.createStorageInstance=function(e){return(0,a.ensureRxStorageInstanceParamsAreCorrect)(e),(0,i.createLokiStorageInstance)(this,e,this.databaseSettings)},e}());r.RxStorageLoki=u},{"../../rx-schema-helper":398,"../../rx-storage-helper":400,"../utils":360,"./lokijs-helper":350,"./rx-storage-instance-loki":351}],353:[function(e,t,r){"use strict";function o(e,t,r,n,i){for(var o=i+1;n<=i;){var a=n+i>>>1,s=e[a];0<=(void 0!==r?r(s,t):s-t)?i=(o=a)-1:n=1+a}return o}function a(e,t,r,n,i){for(var o=i+1;n<=i;){var a=n+i>>>1,s=e[a];0<(void 0!==r?r(s,t):s-t)?i=(o=a)-1:n=1+a}return o}function s(e,t,r,n,i){for(var o=n-1;n<=i;){var a=n+i>>>1,s=e[a];(void 0!==r?r(s,t):s-t)<0?n=1+(o=a):i=a-1}return o}function u(e,t,r,n,i){for(var o=n-1;n<=i;){var a=n+i>>>1,s=e[a];(void 0!==r?r(s,t):s-t)<=0?n=1+(o=a):i=a-1}return o}function c(e,t,r,n,i){for(;n<=i;){var o=n+i>>>1,a=e[o],a=void 0!==r?r(a,t):a-t;if(0===a)return o;a<=0?n=1+o:i=o-1}return-1}function l(e,t,r,n,i,o){return"function"==typeof r?o(e,t,r,void 0===n?0:0|n,void 0===i?e.length-1:0|i):o(e,t,void 0,void 0===r?0:0|r,void 0===n?e.length-1:0|n)}Object.defineProperty(r,"__esModule",{value:!0}),r.boundEQ=function(e,t,r,n,i){return l(e,t,r,n,i,c)},r.boundGE=function(e,t,r,n,i){return l(e,t,r,n,i,o)},r.boundGT=function(e,t,r,n,i){return l(e,t,r,n,i,a)},r.boundLE=function(e,t,r,n,i){return l(e,t,r,n,i,u)},r.boundLT=function(e,t,r,n,i){return l(e,t,r,n,i,s)}},{}],354:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={getRxStorageMemory:!0},i=(r.getRxStorageMemory=function(r={}){return{name:"memory",statics:a.RxStorageDefaultStatics,collectionStates:f,createStorageInstance(e){(0,i.ensureRxStorageInstanceParamsAreCorrect)(e);var t=Object.assign({},r,e.options);return(0,o.createMemoryStorageInstance)(this,e,t)}}},e("../../rx-storage-helper")),o=e("./rx-storage-instance-memory"),a=(Object.keys(o).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===o[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})}),e("../../rx-storage-statics")),s=e("./memory-helper"),u=(Object.keys(s).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===s[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return s[e]}})}),e("./binary-search-bounds")),c=(Object.keys(u).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===u[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return u[e]}})}),e("./memory-types")),l=(Object.keys(c).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===c[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return c[e]}})}),e("./memory-indexes")),f=(Object.keys(l).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===l[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return l[e]}})}),new Map)},{"../../rx-storage-helper":400,"../../rx-storage-statics":402,"./binary-search-bounds":353,"./memory-helper":355,"./memory-indexes":356,"./memory-types":357,"./rx-storage-instance-memory":358}],355:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.attachmentMapKey=function(e,t){return e+"||"+t},r.compareDocsWithIndex=y,r.ensureNotRemoved=function(e){if(e.internals.removed)throw new Error("removed")},r.getMemoryCollectionKey=function(e,t,r){return[e,t,r].join("--memory--")},r.putWriteRowToState=function(e,t,r,n,i){t.documents.set(e,n.document);for(var o=0;o<r.length;++o){var a=r[o],s=a.docsWithIndex,u=a.getIndexableString(n.document),c=(0,f.pushAtSortPosition)(s,{id:e,doc:n.document,indexString:u},h,0);if(i){var l=a.getIndexableString(i);if(l===u){u=s[c-1];if(u&&u.id===e)s.splice(c-1,1);else{if(s[c+1].id!==e)throw(0,d.newRxError)("SNH",{args:{row:n,byIndex:a}});s.splice(c+1,1)}}else{u=(0,p.boundEQ)(s,{indexString:l},y);s.splice(u,1)}}}},r.removeDocFromState=function(e,t,r,n){e=n[e];r.documents.delete(e),Object.values(r.byIndex).forEach(e=>{var t=e.docsWithIndex,e=e.getIndexableString(n),e=(0,p.boundEQ)(t,{indexString:e},y);t.splice(e,1)})};var f=e("array-push-at-sort-position"),d=e("../../rx-error"),p=e("./binary-search-bounds");function h(e,t){return e.indexString<t.indexString?-1:1}function y(e,t){return e.indexString<t.indexString?-1:e.indexString===t.indexString?0:1}},{"../../rx-error":394,"./binary-search-bounds":353,"array-push-at-sort-position":1}],356:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addIndexesToInternalsState=function(t,r){var e=(0,o.getPrimaryFieldOfPrimaryKey)(r.primaryKey),n=r.indexes?r.indexes.map(e=>(0,a.toArray)(e)):[],n=(n.push([e]),n.push(["_meta.lwt",e]),n.forEach(e=>{e.unshift("_deleted"),t.byIndex[s(e)]={index:e,docsWithIndex:[],getIndexableString:(0,i.getIndexableStringMonad)(r,e)}}),["_meta.lwt",e]),e=s(n);t.byIndex[e]={index:n,docsWithIndex:[],getIndexableString:(0,i.getIndexableStringMonad)(r,n)}},r.getMemoryIndexName=s;var i=e("../../custom-index"),o=e("../../rx-schema-helper"),a=e("../../plugins/utils");function s(e){return e.join(",")}},{"../../custom-index":323,"../../plugins/utils":360,"../../rx-schema-helper":398}],357:[function(e,t,r){},{}],358:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RxStorageInstanceMemory=void 0,r.createMemoryStorageInstance=function(e,t,r){var n=(0,g.getMemoryCollectionKey)(t.databaseName,t.collectionName,t.schema.version),i=e.collectionStates.get(n);i?i.refCount=i.refCount+1:(i={removed:!1,refCount:1,documents:new Map,attachments:t.schema.attachments?new Map:void 0,byIndex:{},conflictResultionTasks$:new o.Subject,changes$:new o.Subject},(0,O.addIndexesToInternalsState)(i,t.schema),e.collectionStates.set(n,i));n=new a(e,t.databaseName,t.collectionName,t.schema,i,t.options,r);return Promise.resolve(n)};var o=e("rxjs"),y=e("../../custom-index"),s=e("../../rx-schema-helper"),b=e("../../rx-storage-helper"),v=e("../../plugins/utils"),m=e("./binary-search-bounds"),g=e("./memory-helper"),O=e("./memory-indexes"),_=e("../../rx-query-helper"),a=function(){function e(e,t,r,n,i,o,a){this.closed=!1,this.storage=e,this.databaseName=t,this.collectionName=r,this.schema=n,this.internals=i,this.options=o,this.settings=a,this.primaryPath=(0,s.getPrimaryFieldOfPrimaryKey)(this.schema.primaryKey)}var t=e.prototype;return t.bulkWrite=function(e,t){(0,g.ensureNotRemoved)(this);for(var r=this.internals,n=this.internals.documents,i=this.primaryPath,o={},e=(0,b.categorizeBulkWriteRows)(this,i,n,e,t),t=e.errors,a=Object.values(this.internals.byIndex),s=e.bulkInsertDocs,u=0;u<s.length;++u){var c=s[u],l=c.document[i];(0,g.putWriteRowToState)(l,r,a,c,void 0),o[l]=c.document}for(var f,d,p=e.bulkUpdateDocs,h=0;h<p.length;++h){var y=p[h],m=y.document[i];(0,g.putWriteRowToState)(m,r,a,y,n.get(m)),o[m]=y.document}return this.schema.attachments&&(f=r.attachments,e.attachmentsAdd.forEach(e=>{f.set((0,g.attachmentMapKey)(e.documentId,e.attachmentId),{writeData:e.attachmentData,digest:e.digest})}),this.schema.attachments)&&(e.attachmentsUpdate.forEach(e=>{f.set((0,g.attachmentMapKey)(e.documentId,e.attachmentId),{writeData:e.attachmentData,digest:e.digest})}),e.attachmentsRemove.forEach(e=>{f.delete((0,g.attachmentMapKey)(e.documentId,e.attachmentId))})),0<e.eventBulk.events.length&&(d=(0,v.ensureNotFalsy)(e.newestRow).document,e.eventBulk.checkpoint={id:d[i],lwt:d._meta.lwt},r.changes$.next(e.eventBulk)),Promise.resolve({success:o,error:t})},t.findDocumentsById=function(e,t){for(var r=this.internals.documents,n={},i=0;i<e.length;++i){var o=e[i],a=r.get(o);!a||a._deleted&&!t||(n[o]=a)}return Promise.resolve(n)},t.query=function(e){for(var t=e.queryPlan,r=(o=e.query).skip||0,n=r+(o.limit||1/0),i=!1,o=(t.selectorSatisfiedByIndex||(i=(0,_.getQueryMatcher)(this.schema,e.query)),t.index),a=!t.sortFieldsSameAsIndexFields,o=["_deleted"].concat(o),s=t.startKeys,s=[!1].concat(s),s=(0,y.getStartIndexStringFromLowerBound)(this.schema,o,s,t.inclusiveStart),u=t.endKeys,u=[!1].concat(u),u=(0,y.getStartIndexStringFromUpperBound)(this.schema,o,u,t.inclusiveEnd),o=(0,O.getMemoryIndexName)(o),c=this.internals.byIndex[o].docsWithIndex,l=(t.inclusiveStart?m.boundGE:m.boundGT)(c,{indexString:s},g.compareDocsWithIndex),f=(t.inclusiveEnd?m.boundLE:m.boundLT)(c,{indexString:u},g.compareDocsWithIndex),d=[],p=!1;!p;){var h=c[l];if(!h||f<l)break;h=h.doc;i&&!i(h)||d.push(h),(d.length>=n&&!a||l>=c.length)&&(p=!0),l++}return a&&(o=(0,_.getSortComparator)(this.schema,e.query),d=d.sort(o)),d=d.slice(r,n),Promise.resolve({documents:d})},t.count=async function(e){return{count:(await this.query(e)).documents.length,mode:"fast"}},t.getChangedDocumentsSince=function(e,t){for(var r=t?t.lwt:v.RX_META_LWT_MINIMUM,n=t?t.id:"",i=["_meta.lwt",this.primaryPath],i=(0,O.getMemoryIndexName)(i),r=(0,y.getStartIndexStringFromLowerBound)(this.schema,["_meta.lwt",this.primaryPath],[r,n],!1),o=this.internals.byIndex[i].docsWithIndex,a=(0,m.boundGT)(o,{indexString:r},g.compareDocsWithIndex),s=[];s.length<e&&a<o.length;){var u=o[a];s.push(u.doc),a++}n=(0,v.lastOfArray)(s);return Promise.resolve({documents:s,checkpoint:n?{id:n[this.primaryPath],lwt:n._meta.lwt}:t||{id:"",lwt:0}})},t.cleanup=function(e){for(var t=(0,v.now)()-e,e=["_deleted","_meta.lwt",this.primaryPath],r=(0,O.getMemoryIndexName)(e),n=this.internals.byIndex[r].docsWithIndex,r=(0,y.getStartIndexStringFromLowerBound)(this.schema,e,[!0,0,""],!1),i=(0,m.boundGT)(n,{indexString:r},g.compareDocsWithIndex),o=!1;!o;){var a=n[i];!a||a.doc._meta.lwt>t?o=!0:((0,g.removeDocFromState)(this.primaryPath,this.schema,this.internals,a.doc),i++)}return v.PROMISE_RESOLVE_TRUE},t.getAttachmentData=function(e,t,r){(0,g.ensureNotRemoved)(this);e=(0,v.getFromMapOrThrow)(this.internals.attachments,(0,g.attachmentMapKey)(e,t));if(r&&e.digest===r)return Promise.resolve(e.writeData.data);throw new Error("attachment does not exist")},t.changeStream=function(){return(0,g.ensureNotRemoved)(this),this.internals.changes$.asObservable()},t.remove=async function(){(0,g.ensureNotRemoved)(this),this.internals.removed=!0,this.storage.collectionStates.delete((0,g.getMemoryCollectionKey)(this.databaseName,this.collectionName,this.schema.version)),await this.close()},t.close=function(){return this.closed?Promise.reject(new Error("already closed")):(this.closed=!0,this.internals.refCount=this.internals.refCount-1,v.PROMISE_RESOLVE_VOID)},t.conflictResultionTasks=function(){return this.internals.conflictResultionTasks$.asObservable()},t.resolveConflictResultionTask=function(e){return v.PROMISE_RESOLVE_VOID},e}();r.RxStorageInstanceMemory=a},{"../../custom-index":323,"../../plugins/utils":360,"../../rx-query-helper":395,"../../rx-schema-helper":398,"../../rx-storage-helper":400,"./binary-search-bounds":353,"./memory-helper":355,"./memory-indexes":356,rxjs:415}],359:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.RxDBUpdatePlugin=void 0,r.RxQueryUpdate=s,r.incrementalUpdate=o,r.update=a,n(e("modifyjs")));function o(t){return this.incrementalModify(e=>{return(0,i.default)(e,t)})}function a(e){var t=this._data,e=(0,i.default)(t,e);return this._saveData(e,t)}function s(t){return this.exec().then(e=>e?(Array.isArray(e)?Promise.all(e.map(e=>e.update(t))):e.update(t)).then(()=>e):null)}r.RxDBUpdatePlugin={name:"update",rxdb:!0,prototypes:{RxDocument:e=>{e.update=a,e.incrementalUpdate=o},RxQuery:e=>{e.update=s}}}},{"@babel/runtime/helpers/interopRequireDefault":407,modifyjs:308}],360:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./utils-array"),i=(Object.keys(n).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}})}),e("./utils-blob")),o=(Object.keys(i).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===i[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})}),e("./utils-base64")),a=(Object.keys(o).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===o[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})}),e("./utils-revision")),s=(Object.keys(a).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===a[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})}),e("./utils-document")),u=(Object.keys(s).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===s[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return s[e]}})}),e("./utils-hash")),c=(Object.keys(u).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===u[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return u[e]}})}),e("./utils-promise")),l=(Object.keys(c).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===c[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return c[e]}})}),e("./utils-string")),f=(Object.keys(l).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===l[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return l[e]}})}),e("./utils-object-deep-equal")),d=(Object.keys(f).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===f[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return f[e]}})}),e("./utils-object-dot-prop")),p=(Object.keys(d).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===d[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return d[e]}})}),e("./utils-object")),h=(Object.keys(p).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===p[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return p[e]}})}),e("./utils-map")),y=(Object.keys(h).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===h[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return h[e]}})}),e("./utils-error")),m=(Object.keys(y).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===y[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return y[e]}})}),e("./utils-time")),b=(Object.keys(m).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===m[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return m[e]}})}),e("./utils-regex")),v=(Object.keys(b).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===b[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return b[e]}})}),e("./utils-other")),g=(Object.keys(v).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===v[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return v[e]}})}),e("./utils-rxdb-version"));Object.keys(g).forEach(function(e){"default"===e||"__esModule"===e||e in r&&r[e]===g[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return g[e]}})})},{"./utils-array":361,"./utils-base64":362,"./utils-blob":363,"./utils-document":364,"./utils-error":365,"./utils-hash":366,"./utils-map":367,"./utils-object":370,"./utils-object-deep-equal":368,"./utils-object-dot-prop":369,"./utils-other":371,"./utils-promise":372,"./utils-regex":373,"./utils-revision":374,"./utils-rxdb-version":375,"./utils-string":376,"./utils-time":377}],361:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.appendToArray=function(e,t){for(var r=t.length,n=0;n<r;++n){var i=t[n];e.push(i)}},r.arrayFilterNotEmpty=function(e){return null!=e},r.asyncFilter=async function(e,t){var r=await Promise.all(e.map(t));return e.filter((...[,e])=>r[e])},r.batchArray=function(e,t){e=e.slice(0);var r=[];for(;e.length;){var n=e.splice(0,t);r.push(n)}return r},r.countUntilNotMatching=function(e,t){var r,n=0,i=-1;for(r of e){if(!t(r,i+=1))break;n+=1}return n},r.isMaybeReadonlyArray=function(e){return Array.isArray(e)},r.lastOfArray=function(e){return e[e.length-1]},r.maxOfNumbers=function(e){return Math.max(...e)},r.removeOneFromArrayIfMatches=function(e,t){var r=(e=e.slice()).length,n=!1;for(;r--&&!n;)t(e[r])&&(n=!0,e.splice(r,1));return e},r.shuffleArray=function(e){return e.slice(0).sort(()=>Math.random()-.5)},r.sumNumberArray=function(e){for(var t=0,r=e.length;r--;)t+=e[r];return t},r.toArray=function(e){return Array.isArray(e)?e.slice(0):[e]}},{}],362:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.arrayBufferToBase64=function(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return btoa(t)},r.b64DecodeUnicode=function(e){return(0,n.decode)(e)},r.b64EncodeUnicode=function(e){return(0,n.encode)(e)},r.base64ToArrayBuffer=function(e){for(var t=atob(e),r=t.length,n=new Uint8Array(r),i=0;i<r;i++)n[i]=t.charCodeAt(i);return n.buffer};var n=e("js-base64")},{"js-base64":65}],363:[function(e,t,n){!function(r){!function(){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.blobToBase64String=async function(e){if("string"==typeof e)return e;"[object Uint8Array]"===Object.prototype.toString.call(e)&&(e=new Blob([e]));e=URL.createObjectURL(e),e=await fetch(e).then(e=>e.arrayBuffer());return(0,t.arrayBufferToBase64)(e)},n.blobToString=function(e){"[object Uint8Array]"===Object.prototype.toString.call(e)&&(e=new Blob([e]));return"string"!=typeof e?e.text():Promise.resolve(e)},n.createBlob=function(e,t){return new Blob([e],{type:t})},n.createBlobFromBase64=async function(e,t){return(await fetch("data:"+t+";base64,"+e)).blob()},n.getBlobSize=function(e){return e.size},n.isBlob=function(e){return!!(e instanceof Blob||void 0!==r&&r.isBuffer(e))};var t=e("./utils-base64")}.call(this)}.call(this,e("buffer").Buffer)},{"./utils-base64":362,buffer:649}],364:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RX_META_LWT_MINIMUM=void 0,r.areRxDocumentArraysEqual=function(e,t,r){if(t.length!==r.length)return!1;var n=0,i=t.length;for(;n<i;){var o=t[n],a=r[n];if(n++,o._rev!==a._rev||o[e]!==a[e])return!1}return!0},r.getDefaultRevision=function(){return""},r.getDefaultRxDocumentMeta=function(){return{lwt:n}},r.getSortDocumentsByLastWriteTimeComparator=i,r.sortDocumentsByLastWriteTime=function(e,t){return t.sort(i(e))},r.stripMetaDataFromDocument=function(e){return Object.assign({},e,{_meta:void 0,_deleted:void 0,_rev:void 0})};var n=1;function i(r){return(e,t)=>e._meta.lwt===t._meta.lwt?t[r]<e[r]?1:-1:e._meta.lwt-t._meta.lwt}r.RX_META_LWT_MINIMUM=n},{}],365:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.errorToPlainJson=function(e){return{name:e.name,message:e.message,rxdb:e.rxdb,parameters:e.parameters,code:e.code,stack:e.stack?e.stack.replaceAll("\n"," \n "):void 0}},r.pluginMissing=function(e){var t=e.split("-"),r="RxDB";return t.forEach(e=>{r+=(0,n.ucfirst)(e)}),r+="Plugin",new Error("You are using a function which must be overwritten by a plugin.\n        You should either prevent the usage of this function or add the plugin via:\n            import { "+r+" } from 'rxdb/plugins/"+e+"';\n            addRxPlugin("+r+");\n        ")};var n=e("./utils-string")},{"./utils-string":376}],366:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defaultHashSha256=function(e){return(0,n.sha256)(e)};var n=e("ohash")},{ohash:317}],367:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getFromMapOrCreate=function(e,t,r,n){var i=e.get(t);void 0===i?(i=r(),e.set(t,i)):n&&n(i);return i},r.getFromMapOrThrow=function(e,t){e=e.get(t);if(void 0!==e)return e;throw new Error("missing value from map "+t)}},{}],368:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.deepEqual=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,i;if(Array.isArray(t)){if((n=t.length)!==r.length)return!1;for(i=n;0!=i--;)if(!e(t[i],r[i]))return!1}else{if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();var o=Object.keys(t);if((n=o.length)!==Object.keys(r).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,o[i]))return!1;for(i=n;0!=i--;){var a=o[i];if(!e(t[a],r[a]))return!1}}return!0}return t!=t&&r!=r}},{}],369:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.deepKeys=function(e){return[...function*e(t,r=[]){if(!s(t))return void(0<r.length&&(yield d(r)));for(var[n,i]of o(t))yield*e(i,[...r,n])}(e)]},r.deleteProperty=function(e,t){if(!s(e)||"string"!=typeof t)return!1;for(var r=c(t),n=0;n<r.length;n++){var i=r[n];if(f(e,i),n===r.length-1)return delete e[i],!0;if(e=e[i],!s(e))return!1}},r.getProperty=function(e,t,r){Array.isArray(t)&&(t=t.join("."));if(!s(e)||"string"!=typeof t)return void 0===r?e:r;var n=c(t);if(0===n.length)return r;for(var i=0;i<n.length;i++){var o=n[i];if(null==(e=l(e,o)?i===n.length-1?void 0:null:e[o])){if(i!==n.length-1)return r;break}}return void 0===e?r:e},r.hasProperty=function(e,t){if(!s(e)||"string"!=typeof t)return!1;var r,t=c(t);if(0===t.length)return!1;for(r of t){if(!s(e)||!(r in e)||l(e,r))return!1;e=e[r]}return!0},r.setProperty=function(e,t,r){Array.isArray(t)&&(t=t.join("."));if(!s(e)||"string"!=typeof t)return e;for(var n=e,i=c(t),o=0;o<i.length;o++){var a=i[o];f(e,a),o===i.length-1?e[a]=r:s(e[a])||(e[a]="number"==typeof i[o+1]?[]:{}),e=e[a]}return n};var s=e=>{var t=typeof e;return null!==e&&("object"==t||"function"==t)},a=new Set(["__proto__","prototype","constructor"]),u=new Set("0123456789");function c(e){var t,r=[],n="",i="start",o=!1;for(t of e)switch(t){case"\\":if("index"===i)throw new Error("Invalid character in an index");if("indexEnd"===i)throw new Error("Invalid character after an index");o&&(n+=t),i="property",o=!o;break;case".":if("index"===i)throw new Error("Invalid character in an index");if("indexEnd"===i)i="property";else if(o)o=!1,n+=t;else{if(a.has(n))return[];r.push(n),n="",i="property"}break;case"[":if("index"===i)throw new Error("Invalid character in an index");if("indexEnd"===i)i="index";else if(o)o=!1,n+=t;else{if("property"===i){if(a.has(n))return[];r.push(n),n=""}i="index"}break;case"]":if("index"===i){r.push(Number.parseInt(n,10)),n="",i="indexEnd";break}if("indexEnd"===i)throw new Error("Invalid character after an index");default:if("index"===i&&!u.has(t))throw new Error("Invalid character in an index");if("indexEnd"===i)throw new Error("Invalid character after an index");"start"===i&&(i="property"),o&&(o=!1,n+="\\"),n+=t}switch(o&&(n+="\\"),i){case"property":if(a.has(n))return[];r.push(n);break;case"index":throw new Error("Index was not closed");case"start":r.push("")}return r}function l(e,t){var r;if("number"!=typeof t&&Array.isArray(e))return r=Number.parseInt(t,10),Number.isInteger(r)&&e[r]===e[t]}function f(e,t){if(l(e,t))throw new Error("Cannot use string index")}function o(e){return Array.isArray(e)?e.map((e,t)=>[t,e]):Object.entries(e)}function d(e){var t,r,n="";for([t,r]of o(e))"number"==typeof r?n+="["+r+"]":(r=function(e){if("string"!=typeof e)throw new TypeError("Expected a string");return e.replace(/[\\.[]/g,"\\$&")}(r),n+=0===t?r:"."+r);return n}},{}],370:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.clone=void 0,r.deepFreeze=function t(r){Object.freeze(r);Object.getOwnPropertyNames(r).forEach(function(e){!r.hasOwnProperty(e)||null===r[e]||"object"!=typeof r[e]&&"function"!=typeof r[e]||Object.isFrozen(r[e])||t(r[e])});return r},r.firstPropertyNameOfObject=function(e){return Object.keys(e)[0]},r.firstPropertyValueOfObject=function(e){var t=Object.keys(e)[0];return e[t]},r.flatClone=function(e){return Object.assign({},e)},r.flattenObject=function e(t){var r={};for(var n in t)if(t.hasOwnProperty(n))if("object"==typeof t[n]){var i,o=e(t[n]);for(i in o)o.hasOwnProperty(i)&&(r[n+"."+i]=o[i])}else r[n]=t[n];return r},r.getFromObjectOrThrow=function(e,t){e=e[t];if(e)return e;throw new Error("missing value from object "+t)},r.objectPathMonad=function(t){var n=t.split("."),i=n.length;return 1!==i?e=>{for(var t=e,r=0;r<i;++r)if(void 0===(t=t[n[r]]))return t;return t}:e=>e[t]},r.overwriteGetterForCaching=function(e,t,r){return Object.defineProperty(e,t,{get:function(){return r}}),r},r.sortObject=function t(r,n=!1){if(!r)return r;if(!n&&Array.isArray(r))return r.sort((e,t)=>"string"==typeof e&&"string"==typeof t?e.localeCompare(t):"object"==typeof e?1:-1).map(e=>t(e,n));{var i;if("object"==typeof r&&!Array.isArray(r))return r instanceof RegExp?r:(i={},Object.keys(r).sort((e,t)=>e.localeCompare(t)).forEach(e=>{i[e]=t(r[e],n)}),i)}return r},r.stringifyFilter=function(e,t){if(t instanceof RegExp)return t.toString();return t},r.clone=function e(t){if(!t)return t;if(null===t||"object"!=typeof t)return t;if(Array.isArray(t)){for(var r=new Array(t.length),n=r.length;n--;)r[n]=e(t[n]);return r}var i,o={};for(i in t)o[i]=e(t[i]);return o}},{}],371:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RXJS_SHARE_REPLAY_DEFAULTS=void 0,r.ensureInteger=function(e){if(Number.isInteger(e))return e;throw new Error("ensureInteger() is falsy")},r.ensureNotFalsy=function(e){if(e)return e;throw new Error("ensureNotFalsy() is falsy")},r.runXTimes=function(e,r){new Array(e).fill(0).forEach((e,t)=>r(t))};r.RXJS_SHARE_REPLAY_DEFAULTS={bufferSize:1,refCount:!0}},{}],372:[function(e,t,r){"use strict";function n(t=0){return new Promise(e=>setTimeout(e,t))}Object.defineProperty(r,"__esModule",{value:!0}),r.PROMISE_RESOLVE_VOID=r.PROMISE_RESOLVE_TRUE=r.PROMISE_RESOLVE_NULL=r.PROMISE_RESOLVE_FALSE=void 0,r.nextTick=function(){return new Promise(e=>setTimeout(e,0))},r.promiseSeries=function(e,t){return e.reduce((e,t)=>e.then(t),Promise.resolve(t))},r.promiseWait=n,r.requestIdleCallbackIfAvailable=function(e){"function"==typeof requestIdleCallback&&requestIdleCallback(()=>{e()})},r.requestIdlePromise=function(t=void 0){return o=o.then(()=>"function"==typeof requestIdleCallback?new Promise(e=>{requestIdleCallback(()=>e(),{timeout:t})}):n(0))},r.toPromise=function(e){return e&&"function"==typeof e.then?e:Promise.resolve(e)};var i=Promise.resolve(!0),i=(r.PROMISE_RESOLVE_TRUE=i,Promise.resolve(!1)),i=(r.PROMISE_RESOLVE_FALSE=i,Promise.resolve(null)),i=(r.PROMISE_RESOLVE_NULL=i,Promise.resolve()),o=r.PROMISE_RESOLVE_VOID=i},{}],373:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.REGEX_PARSE_REGEX_EXPRESSION=r.REGEX_ALL_PIPES=r.REGEX_ALL_DOTS=void 0,r.parseRegex=function(e){e=(0,n.ensureNotFalsy)(e.toString().match(i));return{pattern:e[2],flags:e[3]}};var n=e("./utils-other"),i=(r.REGEX_ALL_DOTS=/\./g,r.REGEX_ALL_PIPES=/\|/g,/(\/?)(.+)\1([a-z]*)/i);r.REGEX_PARSE_REGEX_EXPRESSION=i},{"./utils-other":371}],374:[function(e,t,r){"use strict";function n(e){var t=e.split("-");if(2!==t.length)throw new Error("malformatted revision: "+e);return{height:parseInt(t[0],10),hash:t[1]}}Object.defineProperty(r,"__esModule",{value:!0}),r.createRevision=function(e,t){t=t?t._rev:null;return(t?n(t).height:0)+1+"-"+e},r.getHeightOfRevision=function(e){return parseInt(e.split("-")[0],10)},r.parseRevision=n},{}],375:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RXDB_VERSION=void 0;r.RXDB_VERSION="14.17.1"},{}],376:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RANDOM_STRING=void 0,r.arrayBufferToString=function(e){return String.fromCharCode.apply(null,new Uint16Array(e))},r.isFolderPath=function(e){return!(!e.includes("/")&&!e.includes("\\"))},r.randomCouchString=function(e=10){for(var t="",r="abcdefghijklmnopqrstuvwxyz",n=0;n<e;n++)t+=r.charAt(Math.floor(Math.random()*r.length));return t},r.stringToArrayBuffer=function(e){for(var t=new ArrayBuffer(2*e.length),r=new Uint16Array(t),n=0,i=e.length;n<i;n++)r[n]=e.charCodeAt(n);return t},r.trimDots=function(e){for(;"."===e.charAt(0);)e=e.substr(1);for(;"."===e.slice(-1);)e=e.slice(0,-1);return e},r.ucfirst=function(e){return(e+="").charAt(0).toUpperCase()+e.substr(1)};r.RANDOM_STRING="Fz7SZXPmYJujkzjY1rpXWvlWBqoGAfAX"},{}],377:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.now=function(){var e=(new Date).getTime();(e+=.01)<=n&&(e=n+.01);e=parseFloat(e.toFixed(2));return n=e};var n=0},{}],378:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.QueryCache=r.DEFAULT_UNEXECUTED_LIFETIME=r.DEFAULT_TRY_TO_KEEP_MAX=r.COLLECTIONS_WITH_RUNNING_CLEANUP=void 0,r.countRxQuerySubscribers=l,r.createQueryCache=function(){return new n},r.defaultCacheReplacementPolicyMonad=r.defaultCacheReplacementPolicy=void 0,r.triggerCacheReplacement=function(e){i.has(e)||(i.add(e),(0,u.nextTick)().then(()=>(0,u.requestIdlePromise)(200)).then(()=>{e.destroyed||e.cacheReplacementPolicy(e,e._queryCache),i.delete(e)}))},r.uncacheRxQuery=c;var u=e("./plugins/utils"),n=function(){function e(){this._map=new Map}return e.prototype.getByQuery=function(e){var t=e.toString();return(0,u.getFromMapOrCreate)(this._map,t,()=>e)},e}();function c(e,t){t.uncached=!0;t=t.toString();e._map.delete(t)}function l(e){return e.refCount$.observers.length}r.QueryCache=n;r.DEFAULT_TRY_TO_KEEP_MAX=100;r.DEFAULT_UNEXECUTED_LIFETIME=3e4;var e=(a,s)=>(e,t)=>{if(!(t._map.size<a)){var r,n=(0,u.now)()-s,i=[];for(r of Array.from(t._map.values()))0<l(r)||(0===r._lastEnsureEqual&&r._creationTime<n?c(t,r):i.push(r));var o=i.length-a;o<=0||i.sort((e,t)=>e._lastEnsureEqual-t._lastEnsureEqual).slice(0,o).forEach(e=>c(t,e))}},e=(r.defaultCacheReplacementPolicyMonad=e)(100,3e4),i=(r.defaultCacheReplacementPolicy=e,new WeakSet);r.COLLECTIONS_WITH_RUNNING_CLEANUP=i},{"./plugins/utils":360}],379:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.UPPER_BOUND_LOGICAL_OPERATORS=r.LOWER_BOUND_LOGICAL_OPERATORS=r.LOGICAL_OPERATORS=r.INDEX_MIN=r.INDEX_MAX=void 0,r.getMatcherQueryOpts=h,r.getQueryPlan=function(e,r){var t=(0,i.getPrimaryFieldOfPrimaryKey)(e.primaryKey),o=r.selector,n=e.indexes?e.indexes.slice(0):[];r.index?n=[r.index]:n.push([t]);var a,s=r.sort.map(e=>Object.keys(e)[0]).join(","),u=!!r.sort.find(e=>"desc"===Object.values(e)[0]),c=-1;n.forEach(e=>{var n=!0,i=!0,t=e.map(e=>{var t=o[e],e=t?Object.keys(t):[],r={};return t&&e.length?e.forEach(e=>{d.has(e)&&(e=h(e,t[e]),r=Object.assign(r,e))}):r={startKey:i?f:l,endKey:n?l:f,inclusiveStart:!0,inclusiveEnd:!0},void 0===r.startKey&&(r.startKey=f),void 0===r.endKey&&(r.endKey=l),void 0===r.inclusiveStart&&(r.inclusiveStart=!0),void 0===r.inclusiveEnd&&(r.inclusiveEnd=!0),i&&!r.inclusiveStart&&(i=!1),n&&!r.inclusiveEnd&&(n=!1),r}),t={index:e,startKeys:t.map(e=>e.startKey),endKeys:t.map(e=>e.endKey),inclusiveEnd:n,inclusiveStart:i,sortFieldsSameAsIndexFields:!u&&s===e.join(","),selectorSatisfiedByIndex:p(e,r.selector)},e=y(0,0,t);(0<e&&c<e||r.index)&&(c=e,a=t)}),a=a||{index:[t],startKeys:[f],endKeys:[l],inclusiveEnd:!0,inclusiveStart:!0,sortFieldsSameAsIndexFields:!u&&s===t,selectorSatisfiedByIndex:p([t],r.selector)};return a},r.isSelectorSatisfiedByIndex=p,r.rateQueryPlan=y;var o=e("./plugins/utils"),i=e("./rx-schema-helper"),l=String.fromCharCode(65535),f=(r.INDEX_MAX=l,Number.MIN_VALUE);r.INDEX_MIN=f;var d=new Set(["$eq","$gt","$gte","$lt","$lte"]),a=(r.LOGICAL_OPERATORS=d,new Set(["$eq","$gt","$gte"])),s=(r.LOWER_BOUND_LOGICAL_OPERATORS=a,new Set(["$eq","$lt","$lte"]));function p(r,t){var n,i;return!Object.entries(t).find(([e,t])=>{return!r.includes(e)||Object.entries(t).find(([e])=>!d.has(e))})&&!r.find(e=>{e=t[e];if(e){e=Object.keys(e).find(e=>a.has(e));if(n&&e)return!0;"$eq"!==e&&(n=e)}return!1})&&!r.find(e=>{e=t[e];if(e){e=Object.keys(e).find(e=>s.has(e));if(i&&e)return!0;"$eq"!==e&&(i=e)}return!1})}function h(e,t){switch(e){case"$eq":return{startKey:t,endKey:t};case"$lte":return{endKey:t};case"$gte":return{startKey:t};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}function y(e,t,r){var n=0,i=e=>{0<e&&(n+=e)};return i(10*(0,o.countUntilNotMatching)(r.startKeys,e=>e!==f&&e!==l)),i(10*(0,o.countUntilNotMatching)(r.startKeys,e=>e!==l&&e!==f)),i(10*(0,o.countUntilNotMatching)(r.startKeys,(e,t)=>e===r.endKeys[t])*1.5),i(r.sortFieldsSameAsIndexFields?5:0),n}r.UPPER_BOUND_LOGICAL_OPERATORS=s},{"./plugins/utils":360,"./rx-schema-helper":398}],380:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getCheckpointKey=function(e){return"rx-storage-replication-"+e.hashFunction([e.identifier,e.forkInstance.databaseName,e.forkInstance.collectionName].join("||"))},r.getLastCheckpointDoc=async function(e,t){var r=(0,a.getComposedPrimaryKeyOfDocumentData)(e.input.metaInstance.schema,{isCheckpoint:"1",itemId:t}),r=(await e.input.metaInstance.findDocumentsById([r],!1))[r];if(e.lastCheckpointDoc[t]=r)return r.data},r.setCheckpoint=async function(e,t,r){var n=e.lastCheckpointDoc[t];if(r&&!e.events.canceled.getValue()&&(!n||JSON.stringify(n.data)!==JSON.stringify(r))){var i={id:"",isCheckpoint:"1",itemId:t,_deleted:!1,_attachments:{},data:r,_meta:(0,u.getDefaultRxDocumentMeta)(),_rev:(0,u.getDefaultRevision)()};for(i.id=(0,a.getComposedPrimaryKeyOfDocumentData)(e.input.metaInstance.schema,i);!e.events.canceled.getValue();){n&&(i.data=(0,s.stackCheckpoints)([n.data,i.data])),i._meta.lwt=(0,u.now)(),i._rev=(0,u.createRevision)(e.input.identifier,n);var o=await e.input.metaInstance.bulkWrite([{previous:n,document:i}],"replication-set-checkpoint");if(o.success[i.id])return void(e.lastCheckpointDoc[t]=(0,u.getFromObjectOrThrow)(o.success,i.id));o=(0,u.getFromObjectOrThrow)(o.error,i.id);if(409!==o.status)throw o;n=(0,u.ensureNotFalsy)(o.documentInDb),i._rev=(0,u.createRevision)(e.input.identifier,n)}}};var a=e("../rx-schema-helper"),s=e("../rx-storage-helper"),u=e("../plugins/utils")},{"../plugins/utils":360,"../rx-schema-helper":398,"../rx-storage-helper":400}],381:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defaultConflictHandler=void 0,r.resolveConflictError=async function(e,t,r){t=await(0,e.input.conflictHandler)(t,"replication-resolve-conflict");{var n;if(!t.isEqual)return(n=Object.assign({},t.documentData,{_meta:(0,i.flatClone)(r._meta),_rev:(0,i.getDefaultRevision)(),_attachments:(0,i.flatClone)(r._attachments)}))._meta.lwt=(0,i.now)(),n._rev=(0,i.createRevision)(e.input.identifier,r),{resolvedDoc:n,output:t}}};var i=e("../plugins/utils");r.defaultConflictHandler=function(e,t){return(0,i.deepEqual)(e.newDocumentState,e.realMasterState)?Promise.resolve({isEqual:!0}):Promise.resolve({isEqual:!1,documentData:e.realMasterState})}},{"../plugins/utils":360}],382:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.startReplicationDownstream=async function(h){h.input.initialCheckpoint&&h.input.initialCheckpoint.downstream&&(await(0,v.getLastCheckpointDoc)(h,"down")||await(0,v.setCheckpoint)(h,"down",h.input.initialCheckpoint.downstream));var y=h.input.hashFunction(h.input.identifier),o=h.input.replicationHandler,a=0,s=[];function t(e){h.stats.down.addNewTask=h.stats.down.addNewTask+1;e={time:a++,task:e};s.push(e),h.streamQueue.down=h.streamQueue.down.then(()=>{for(var e,t,r,n=[];0<s.length;){h.events.active.down.next(!0);var i=(0,b.ensureNotFalsy)(s.shift());if(!(i.time<u)){if("RESYNC"===i.task){if(0!==n.length)break;n.push(i.task);break}n.push(i.task)}}if(0!==n.length)return"RESYNC"===n[0]?async function(){if(h.stats.down.downstreamResyncOnce=h.stats.down.downstreamResyncOnce+1,!h.events.canceled.getValue()){h.checkpointQueue=h.checkpointQueue.then(()=>(0,v.getLastCheckpointDoc)(h,"down"));for(var e=await h.checkpointQueue,t=[];!h.events.canceled.getValue();){u=a++;var r=await o.masterChangesSince(e,h.input.pullBatchSize);if(0===r.documents.length)break;if(e=(0,l.stackCheckpoints)([e,r.checkpoint]),t.push(c(r.documents,e)),r.documents.length<h.input.pullBatchSize)break}await Promise.all(t)}}():(e=n,h.stats.down.downstreamProcessChanges=h.stats.down.downstreamProcessChanges+1,t=[],r=null,e.forEach(e=>{if("RESYNC"===e)throw new Error("SNH");(0,b.appendToArray)(t,e.documents),r=(0,l.stackCheckpoints)([r,e.checkpoint])}),c(t,(0,b.ensureNotFalsy)(r)))}).then(()=>{h.events.active.down.next(!1),h.firstSyncDone.down.getValue()||h.events.canceled.getValue()||h.firstSyncDone.down.next(!0)})}t("RESYNC");var e=o.masterChangeStream$.subscribe(e=>{h.stats.down.masterChangeStreamEmit=h.stats.down.masterChangeStreamEmit+1,t(e)}),u=((0,i.firstValueFrom)(h.events.canceled.pipe((0,i.filter)(e=>!!e))).then(()=>e.unsubscribe()),-1);var r=b.PROMISE_RESOLVE_VOID,n={docs:{}};function c(e,t){return h.stats.down.persistFromMaster=h.stats.down.persistFromMaster+1,e.forEach(e=>{var t=e[h.primaryPath];n.docs[t]=e}),n.checkpoint=t,r=r.then(()=>{var c,l,f,d,p=n.docs,e=(n.docs={},n.checkpoint),t=Object.keys(p);return h.events.canceled.getValue()||0===t.length?b.PROMISE_RESOLVE_VOID:(c=[],l={},f={},d=[],Promise.all([h.input.forkInstance.findDocumentsById(t,!0),(0,O.getAssumedMasterState)(h,t)]).then(([s,u])=>Promise.all(t.map(async e=>{var t,r,n=s[e],i=n?(0,g.writeDocToDocState)(n):void 0,o=p[e],a=u[e];return a&&a.metaDocument.isResolvedConflict===n._rev||(!(r=await(a&&i?h.input.conflictHandler({realMasterState:a.docData,newDocumentState:i},"downstream-check-if-equal-0").then(e=>e.isEqual):b.PROMISE_RESOLVE_FALSE))&&a&&a.docData._rev&&n._meta[h.input.identifier]&&(0,b.parseRevision)(n._rev).height===n._meta[h.input.identifier]&&(r=!0),n&&a&&!1===r)||n&&!a?b.PROMISE_RESOLVE_VOID:(t=await(i?h.input.conflictHandler({realMasterState:o,newDocumentState:i},"downstream-check-if-equal-1").then(e=>e.isEqual):b.PROMISE_RESOLVE_FALSE),i&&t?(a&&!1!==r||d.push((0,O.getMetaWriteRow)(h,i,a?a.metaDocument:void 0)),b.PROMISE_RESOLVE_VOID):(t=Object.assign({},o,n?{_meta:(0,b.flatClone)(n._meta),_attachments:{},_rev:(0,b.getDefaultRevision)()}:{_meta:(0,b.getDefaultRxDocumentMeta)(),_rev:(0,b.getDefaultRevision)(),_attachments:{}}),o._rev&&(r=n?(0,b.parseRevision)(n._rev).height+1:1,t._meta[h.input.identifier]=r),(i={previous:n,document:t}).document._rev=(0,b.createRevision)(y,i.previous),c.push(i),l[e]=i,void(f[e]=(0,O.getMetaWriteRow)(h,o,a?a.metaDocument:void 0))))}))).then(()=>{if(0<c.length)return h.input.forkInstance.bulkWrite(c,h.downstreamBulkWriteFlag).then(e=>{Object.keys(e.success).forEach(e=>{h.events.processed.down.next(l[e]),d.push(f[e])}),Object.values(e.error).forEach(e=>{409!==e.status&&h.events.error.next((0,m.newRxError)("RC_PULL",{writeError:e}))})})}).then(()=>{if(0<d.length)return h.input.metaInstance.bulkWrite(d,"replication-down-write-meta").then(e=>{Object.entries(e.error).forEach(([e,t])=>{h.events.error.next((0,m.newRxError)("RC_PULL",{id:e,writeError:t}))})})}).then(()=>{h.checkpointQueue=h.checkpointQueue.then(()=>(0,v.setCheckpoint)(h,"down",e))}))}).catch(e=>h.events.error.next(e))}};var i=e("rxjs"),m=e("../rx-error"),l=e("../rx-storage-helper"),b=e("../plugins/utils"),v=e("./checkpoint"),g=e("./helper"),O=e("./meta-instance")},{"../plugins/utils":360,"../rx-error":394,"../rx-storage-helper":400,"./checkpoint":380,"./helper":383,"./meta-instance":385,rxjs:415}],383:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.docStateToWriteDoc=function(e,t,r){t=Object.assign({},t,{_attachments:{},_meta:{lwt:(0,n.now)()},_rev:(0,n.getDefaultRevision)()});return t._rev=(0,n.createRevision)(e,r),t},r.writeDocToDocState=function(e){e=(0,n.flatClone)(e);return delete e._attachments,delete e._meta,delete e._rev,e};var n=e("../plugins/utils")},{"../plugins/utils":360}],384:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={replicateRxStorageInstance:!0,awaitRxStorageReplicationFirstInSync:!0,awaitRxStorageReplicationInSync:!0,awaitRxStorageReplicationIdle:!0,rxStorageInstanceToReplicationHandler:!0,cancelRxStorageReplication:!0},i=(r.awaitRxStorageReplicationFirstInSync=p,r.awaitRxStorageReplicationIdle=async function(e){await p(e);for(;;){var{down:t,up:r}=e.streamQueue;if(await Promise.all([r,t]),t===e.streamQueue.down&&r===e.streamQueue.up)return}},r.awaitRxStorageReplicationInSync=function(e){return Promise.all([e.streamQueue.up,e.streamQueue.down,e.checkpointQueue])},r.cancelRxStorageReplication=function(e){e.events.canceled.next(!0),e.events.active.up.complete(),e.events.active.down.complete(),e.events.processed.up.complete(),e.events.processed.down.complete(),e.events.resolvedConflicts.complete(),e.events.canceled.complete()},r.replicateRxStorageInstance=function(e){var t=(0,a.getCheckpointKey)(e),e={primaryPath:(0,o.getPrimaryFieldOfPrimaryKey)(e.forkInstance.schema.primaryKey),input:e,checkpointKey:t,downstreamBulkWriteFlag:"replication-downstream-"+t,events:{canceled:new i.BehaviorSubject(!1),active:{down:new i.BehaviorSubject(!0),up:new i.BehaviorSubject(!0)},processed:{down:new i.Subject,up:new i.Subject},resolvedConflicts:new i.Subject,error:new i.Subject},stats:{down:{addNewTask:0,downstreamProcessChanges:0,downstreamResyncOnce:0,masterChangeStreamEmit:0,persistFromMaster:0},up:{forkChangeStreamEmit:0,persistToMaster:0,persistToMasterConflictWrites:0,persistToMasterHadConflicts:0,processTasks:0,upstreamInitialSync:0}},firstSyncDone:{down:new i.BehaviorSubject(!1),up:new i.BehaviorSubject(!1)},streamQueue:{down:l.PROMISE_RESOLVE_VOID,up:l.PROMISE_RESOLVE_VOID},checkpointQueue:l.PROMISE_RESOLVE_VOID,lastCheckpointDoc:{}};return(0,s.startReplicationDownstream)(e),(0,u.startReplicationUpstream)(e),e},r.rxStorageInstanceToReplicationHandler=function(a,s,u){var c=(0,o.getPrimaryFieldOfPrimaryKey)(a.schema.primaryKey);return{masterChangeStream$:a.changeStream().pipe((0,i.map)(e=>{return{checkpoint:e.checkpoint,documents:e.events.map(e=>(0,f.writeDocToDocState)((0,l.ensureNotFalsy)(e.documentData)))}})),masterChangesSince(t,e){return a.getChangedDocumentsSince(e,t).then(e=>({checkpoint:0<e.documents.length?e.checkpoint:t,documents:e.documents.map(e=>(0,f.writeDocToDocState)(e))}))},async masterWrite(e){var r={},e=(e.forEach(e=>{var t=e.newDocumentState[c];r[t]=e}),Object.keys(r)),n=await a.findDocumentsById(e,!0),i=[],o=[];return await Promise.all(Object.entries(r).map(async([e,t])=>{e=n[e];e?t.assumedMasterState&&!0===(await s({realMasterState:(0,f.writeDocToDocState)(e),newDocumentState:(0,l.ensureNotFalsy)(t.assumedMasterState)},"rxStorageInstanceToReplicationHandler-masterWrite")).isEqual?o.push({previous:e,document:(0,f.docStateToWriteDoc)(u,t.newDocumentState,e)}):i.push((0,f.writeDocToDocState)(e)):o.push({document:(0,f.docStateToWriteDoc)(u,t.newDocumentState)})})),0<o.length&&(e=await a.bulkWrite(o,"replication-master-write"),Object.values(e.error).forEach(e=>{if(409!==e.status)throw new Error("non conflict error");i.push((0,f.writeDocToDocState)((0,l.ensureNotFalsy)(e.documentInDb)))})),i}}},e("rxjs")),o=e("../rx-schema-helper"),l=e("../plugins/utils"),a=e("./checkpoint"),s=(Object.keys(a).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===a[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return a[e]}})}),e("./downstream")),f=(Object.keys(s).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===s[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return s[e]}})}),e("./helper")),u=(Object.keys(f).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===f[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return f[e]}})}),e("./upstream")),c=(Object.keys(u).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===u[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return u[e]}})}),e("./meta-instance")),d=(Object.keys(c).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===c[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return c[e]}})}),e("./conflicts"));function p(e){return(0,i.firstValueFrom)((0,i.combineLatest)([e.firstSyncDone.down.pipe((0,i.filter)(e=>!!e)),e.firstSyncDone.up.pipe((0,i.filter)(e=>!!e))])).then(()=>{})}Object.keys(d).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e)||e in r&&r[e]===d[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return d[e]}})})},{"../plugins/utils":360,"../rx-schema-helper":398,"./checkpoint":380,"./conflicts":381,"./downstream":382,"./helper":383,"./meta-instance":385,"./upstream":386,rxjs:415}],385:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getAssumedMasterState=function(t,e){return t.input.metaInstance.findDocumentsById(e.map(e=>{return(0,o.getComposedPrimaryKeyOfDocumentData)(t.input.metaInstance.schema,{itemId:e,isCheckpoint:"0"})}),!0).then(e=>{var t={};return Object.values(e).forEach(e=>{t[e.itemId]={docData:e.data,metaDocument:e}}),t})},r.getMetaWriteRow=function(e,t,r,n){var i=t[e.primaryPath],i=r?(0,a.flatCloneDocWithMeta)(r):{id:"",isCheckpoint:"0",itemId:i,data:t,_attachments:{},_deleted:!1,_rev:(0,s.getDefaultRevision)(),_meta:{lwt:0}};return i.data=t,i.isResolvedConflict=n,i._meta.lwt=(0,s.now)(),i.id=(0,o.getComposedPrimaryKeyOfDocumentData)(e.input.metaInstance.schema,i),i._rev=(0,s.createRevision)(e.input.identifier,r),{previous:r,document:i}},r.getRxReplicationMetaInstanceSchema=function(e,t){e=(0,o.getLengthOfPrimaryKey)(e),e={primaryKey:{key:"id",fields:["itemId","isCheckpoint"],separator:"|"},type:"object",version:0,additionalProperties:!1,properties:{id:{type:"string",minLength:1,maxLength:e+2},isCheckpoint:{type:"string",enum:["0","1"],minLength:1,maxLength:1},itemId:{type:"string",maxLength:e},data:{type:"object",additionalProperties:!0},isResolvedConflict:{type:"string"}},required:["id","isCheckpoint","itemId","data"]};t&&(e.encrypted=["data"]);return(0,o.fillWithDefaultSettings)(e)};var o=e("../rx-schema-helper"),a=e("../rx-storage-helper"),s=e("../plugins/utils")},{"../plugins/utils":360,"../rx-schema-helper":398,"../rx-storage-helper":400}],386:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.startReplicationUpstream=async function(y){y.input.initialCheckpoint&&y.input.initialCheckpoint.upstream&&(await(0,g.getLastCheckpointDoc)(y,"up")||await(0,g.setCheckpoint)(y,"up",y.input.initialCheckpoint.upstream));var m=y.input.replicationHandler,o=(y.streamQueue.up=y.streamQueue.up.then(()=>async function e(){y.stats.up.upstreamInitialSync=y.stats.up.upstreamInitialSync+1;if(y.events.canceled.getValue())return;y.checkpointQueue=y.checkpointQueue.then(()=>(0,g.getLastCheckpointDoc)(y,"up"));var t=await y.checkpointQueue;var r=[];for(;!y.events.canceled.getValue();){a=o++;var n=await y.input.forkInstance.getChangedDocumentsSince(y.input.pushBatchSize,t);if(0===n.documents.length)break;t=(0,c.stackCheckpoints)([t,n.checkpoint]),r.push(s(n.documents,(0,v.ensureNotFalsy)(t)))}var i=await Promise.all(r);i=i.find(e=>!!e);i?await e():y.firstSyncDone.up.getValue()||y.events.canceled.getValue()||y.firstSyncDone.up.next(!0)}().then(()=>{i()})),0),a=-1,n=[],e=y.input.forkInstance.changeStream().pipe((0,u.filter)(e=>e.context!==y.downstreamBulkWriteFlag)).subscribe(e=>(y.stats.up.forkChangeStreamEmit=y.stats.up.forkChangeStreamEmit+1,n.push({task:e,time:o++}),y.input.waitBeforePersist?y.input.waitBeforePersist().then(()=>i()):i()));function i(){y.events.canceled.getValue()||0===n.length?y.events.active.up.next(!1):(y.stats.up.processTasks=y.stats.up.processTasks+1,y.events.active.up.next(!0),y.streamQueue.up=y.streamQueue.up.then(()=>{for(var e=[],t={};0<n.length;){var r=(0,v.ensureNotFalsy)(n.shift());r.time<a||((0,v.appendToArray)(e,r.task.events.map(e=>e.documentData)),t=(0,c.stackCheckpoints)([t,r.task.checkpoint]))}return(0===e.length?v.PROMISE_RESOLVE_FALSE:s(e,t)).then(()=>{0===n.length?y.events.active.up.next(!1):i()})}))}(0,u.firstValueFrom)(y.events.canceled.pipe((0,u.filter)(e=>!!e))).then(()=>e.unsubscribe());var r=v.PROMISE_RESOLVE_FALSE,b={docs:{}};function s(e,t){return y.stats.up.persistToMaster=y.stats.up.persistToMaster+1,e.forEach(e=>{var t=e[y.primaryPath];b.docs[t]=e}),b.checkpoint=t,r=r.then(async()=>{var i,e,o,a,s,u,c,r,n,t,l,f,d,p,h;return!y.events.canceled.getValue()&&(i=b.docs,b.docs={},e=b.checkpoint,0!==(l=Object.keys(i)).length)&&(o=await(0,w.getAssumedMasterState)(y,l),a={},s=[],u={},c={},await Promise.all(l.map(async e=>{var t=i[e],r=(c[e]=t,(0,_.writeDocToDocState)(t)),n=o[e];n&&n.metaDocument.isResolvedConflict!==t._rev&&(await y.input.conflictHandler({realMasterState:n.docData,newDocumentState:r},"upstream-check-if-equal")).isEqual||n&&n.docData._rev&&(0,v.parseRevision)(t._rev).height===t._meta[y.input.identifier]||(s.push(e),a[e]={assumedMasterState:n?n.docData:void 0,newDocumentState:r},u[e]=(0,w.getMetaWriteRow)(y,r,n?n.metaDocument:void 0))})),0!==s.length)&&(l=Object.values(a),r=new Set,n={},l=(0,v.batchArray)(l,y.input.pushBatchSize),await Promise.all(l.map(async e=>{(await m.masterWrite(e)).forEach(e=>{var t=e[y.primaryPath];r.add(t),n[t]=e})})),t=[],s.forEach(e=>{r.has(e)||(y.events.processed.up.next(a[e]),t.push(u[e]))}),0<t.length&&await y.input.metaInstance.bulkWrite(t,"replication-up-write-meta"),l=!1,0<r.size&&(y.stats.up.persistToMasterHadConflicts=y.stats.up.persistToMasterHadConflicts+1,f=[],d={},await Promise.all(Object.entries(n).map(([r,n])=>{var e=a[r],i={newDocumentState:e.newDocumentState,assumedMasterState:e.assumedMasterState,realMasterState:n};return(0,O.resolveConflictError)(y,i,c[r]).then(e=>{var t;e&&(y.events.resolvedConflicts.next({input:i,output:e.output}),f.push({previous:c[r],document:e.resolvedDoc}),t=o[r],d[r]=(0,w.getMetaWriteRow)(y,(0,v.ensureNotFalsy)(n),t?t.metaDocument:void 0,e.resolvedDoc._rev))})})),0<f.length)&&(l=!0,y.stats.up.persistToMasterConflictWrites=y.stats.up.persistToMasterConflictWrites+1,p=await y.input.forkInstance.bulkWrite(f,"replication-up-write-conflict"),h=[],Object.keys(p.success).forEach(e=>{h.push(d[e])}),0<h.length)&&await y.input.metaInstance.bulkWrite(h,"replication-up-write-conflict-meta"),y.checkpointQueue=y.checkpointQueue.then(()=>(0,g.setCheckpoint)(y,"up",e)),l)}).catch(e=>(y.events.error.next(e),!1))}};var u=e("rxjs"),c=e("../rx-storage-helper"),v=e("../plugins/utils"),g=e("./checkpoint"),O=e("./conflicts"),_=e("./helper"),w=e("./meta-instance")},{"../plugins/utils":360,"../rx-storage-helper":400,"./checkpoint":380,"./conflicts":381,"./helper":383,"./meta-instance":385,rxjs:415}],387:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.flattenEvents=function t(e){var r=[];Array.isArray(e)?e.forEach(e=>{e=t(e);(0,o.appendToArray)(r,e)}):e.id&&e.events?e.events.forEach(e=>r.push(e)):r.push(e);var n=new Set;var i=[];r.forEach(e=>{n.has(e.eventId)||(n.add(e.eventId),i.push(e))});return i},r.getDocumentDataOfRxChangeEvent=function(e){return e.documentData||e.previousDocumentData},r.rxChangeEventToEventReduceChangeEvent=function(e){switch(e.operation){case"INSERT":return{operation:e.operation,id:e.documentId,doc:e.documentData,previous:null};case"UPDATE":return{operation:e.operation,id:e.documentId,doc:n.overwritable.deepFreezeWhenDevMode(e.documentData),previous:e.previousDocumentData||"UNKNOWN"};case"DELETE":return{operation:e.operation,id:e.documentId,doc:null,previous:e.previousDocumentData}}};var n=e("./overwritable"),o=e("./plugins/utils")},{"./overwritable":329,"./plugins/utils":360}],388:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createRxCollectionStorageInstance=async function(e,t){return t.multiInstance=e.multiInstance,e.storage.createStorageInstance(t)},r.fillObjectDataBeforeInsert=function(e,t){t=(0,c.flatClone)(t),t=(0,n.fillObjectWithDefaults)(e,t),(t=(0,n.fillPrimaryKey)(e.primaryPath,e.jsonSchema,t))._meta=(0,c.getDefaultRxDocumentMeta)(),t.hasOwnProperty("_deleted")||(t._deleted=!1);t.hasOwnProperty("_attachments")||(t._attachments={});t.hasOwnProperty("_rev")||(t._rev=(0,c.getDefaultRevision)());return t},r.removeCollectionStorages=async function(t,e,r,n,i,o){var a=(await(0,f.getAllCollectionDocuments)(t.statics,e)).filter(e=>e.data.name===i),s=[],u=(a.forEach(e=>{s.push({collectionName:e.data.name,schema:e.data.schema,isCollection:!0}),e.data.connectedStorages.forEach(e=>s.push({collectionName:e.collectionName,isCollection:!1,schema:e.schema}))}),new Set);s=s.filter(e=>{e=e.collectionName+"||"+e.schema.version;return!u.has(e)&&(u.add(e),!0)}),await Promise.all(s.map(async e=>{await(await t.createStorageInstance({collectionName:e.collectionName,databaseInstanceToken:r,databaseName:n,multiInstance:!1,options:{},schema:e.schema,devMode:p.overwritable.isDevMode()})).remove(),e.isCollection&&await(0,l.runAsyncPluginHooks)("postRemoveRxCollection",{storage:t,databaseName:n,collectionName:i})})),o&&(o=a.map(e=>{var t=(0,d.flatCloneDocWithMeta)(e);return t._deleted=!0,t._meta.lwt=(0,c.now)(),t._rev=(0,c.createRevision)(r,e),{previous:e,document:t}}),await e.bulkWrite(o,"rx-database-remove-collection-all"))};var c=e("./plugins/utils"),n=e("./rx-schema-helper"),l=e("./hooks"),f=e("./rx-database-internal-store"),d=e("./rx-storage-helper"),p=e("./overwritable")},{"./hooks":326,"./overwritable":329,"./plugins/utils":360,"./rx-database-internal-store":390,"./rx-schema-helper":398,"./rx-storage-helper":400}],389:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.RxCollectionBase=void 0,r.createRxCollection=function({database:e,name:n,schema:i,instanceCreationOptions:o={},migrationStrategies:a={},autoMigrate:s=!0,statics:u={},methods:c={},attachments:l={},options:f={},localDocuments:d=!1,cacheReplacementPolicy:p=b.defaultCacheReplacementPolicy,conflictHandler:h=g.defaultConflictHandler}){var t={databaseInstanceToken:e.token,databaseName:e.name,collectionName:n,schema:i.jsonSchema,options:o,multiInstance:e.multiInstance,password:e.password,devMode:O.overwritable.isDevMode()};return(0,v.runPluginHooks)("preCreateRxStorageInstance",t),(0,m.createRxCollectionStorageInstance)(e,t).then(t=>{var r=new S(e,n,i,t,o,a,c,l,f,p,u,h);return r.prepare().then(()=>{Object.entries(u).forEach(([e,t])=>{Object.defineProperty(r,e,{get:()=>t.bind(r)})});var e=y.PROMISE_RESOLVE_VOID;return e=s&&0!==r.schema.version?r.migratePromise():e}).then(()=>((0,v.runPluginHooks)("createRxCollection",{collection:r,creator:{name:n,schema:i,storageInstance:t,instanceCreationOptions:o,migrationStrategies:a,methods:c,attachments:l,options:f,cacheReplacementPolicy:p,localDocuments:d,statics:u}}),r)).catch(e=>t.close().then(()=>Promise.reject(e)))})},r.isRxCollection=function(e){return e instanceof S},n(e("@babel/runtime/helpers/createClass"))),o=e("rxjs/operators"),y=e("./plugins/utils"),m=e("./rx-collection-helper"),a=e("./rx-query"),s=e("./rx-error"),u=e("./doc-cache"),b=e("./query-cache"),c=e("./change-event-buffer"),v=e("./hooks"),l=e("./rx-document-prototype-merge"),f=e("./rx-storage-helper"),g=e("./replication-protocol"),d=e("./incremental-write"),p=e("./rx-document"),O=e("./overwritable"),h=["pre","post"],_=["insert","save","remove","create"],w=!1,S=function(){function e(e,t,r,n,i={},o={},a={},s={},u={},c=b.defaultCacheReplacementPolicy,l={},f=g.defaultConflictHandler){var d;this.storageInstance={},this.timeouts=new Set,this.incrementalWriteQueue={},this._incrementalUpsertQueues=new Map,this.synced=!1,this.hooks={},this._subs=[],this._docCache={},this._queryCache=(0,b.createQueryCache)(),this.$={},this.checkpoint$={},this._changeEventBuffer={},this.onDestroy=[],this.destroyed=!1,this.database=e,this.name=t,this.schema=r,this.internalStorageInstance=n,this.instanceCreationOptions=i,this.migrationStrategies=o,this.methods=a,this.attachments=s,this.options=u,this.cacheReplacementPolicy=c,this.statics=l,this.conflictHandler=f,e=this.asRxCollection,w||(w=!0,d=Object.getPrototypeOf(e),_.forEach(n=>{h.map(r=>{var e=r+(0,y.ucfirst)(n);d[e]=function(e,t){return this.addHook(r,n,e,t)}})}))}var t=e.prototype;return t.prepare=async function(){this.storageInstance=(0,f.getWrappedStorageInstance)(this.database,this.internalStorageInstance,this.schema.jsonSchema),this.incrementalWriteQueue=new d.IncrementalWriteQueue(this.storageInstance,this.schema.primaryPath,(e,t)=>(0,p.beforeDocumentUpdateWrite)(this,e,t),e=>this._runHooks("post","save",e));var e=this.database.eventBulks$.pipe((0,o.filter)(e=>e.collectionName===this.name)),t=(this.$=e.pipe((0,o.mergeMap)(e=>e.events)),this.checkpoint$=e.pipe((0,o.map)(e=>e.checkpoint)),this._changeEventBuffer=(0,c.createChangeEventBuffer)(this.asRxCollection),this._docCache=new u.DocumentCache(this.schema.primaryPath,this.$.pipe((0,o.filter)(e=>!e.isLocal)),e=>(0,l.createNewRxDocument)(this.asRxCollection,e)),await this.database.storageToken),e=this.storageInstance.changeStream().subscribe(e=>{e={id:e.id,internal:!1,collectionName:this.name,storageToken:t,events:e.events.map(e=>(0,f.storageChangeEventToRxChangeEvent)(!1,e,this)),databaseToken:this.database.token,checkpoint:e.checkpoint,context:e.context};this.database.$emit(e)});return this._subs.push(e),this._subs.push(this.storageInstance.conflictResultionTasks().subscribe(t=>{this.conflictHandler(t.input,t.context).then(e=>{this.storageInstance.resolveConflictResultionTask({id:t.id,output:e})})})),y.PROMISE_RESOLVE_VOID},t.migrationNeeded=function(){throw(0,y.pluginMissing)("migration")},t.getDataMigrator=function(){throw(0,y.pluginMissing)("migration")},t.migrate=function(e=10){return this.getDataMigrator().migrate(e)},t.migratePromise=function(e=10){return this.getDataMigrator().migratePromise(e)},t.insert=async function(e){var t=await this.bulkInsert([e]),r=t.error[0];return(0,f.throwIfIsStorageWriteError)(this,e[this.schema.primaryPath],e,r),(0,y.ensureNotFalsy)(t.success[0])},t.bulkInsert=async function(e){var t,r,n;return 0===e.length?{success:[],error:[]}:(t=this.schema.primaryPath,e=e.map(e=>{return(0,m.fillObjectDataBeforeInsert)(this.schema,e)}),e=this.hasHooks("pre","insert")?await Promise.all(e.map(e=>this._runHooks("pre","insert",e).then(()=>e))):e,r=new Map,e=e.map(e=>{return r.set(e[t],e),{document:e}}),e=await this.storageInstance.bulkWrite(e,"rx-collection-bulk-insert"),n=Object.values(e.success).map(e=>this._docCache.getCachedRxDocument(e)),this.hasHooks("post","insert")&&await Promise.all(n.map(e=>this._runHooks("post","insert",r.get(e.primary),e))),{success:n,error:Object.values(e.error)})},t.bulkRemove=async function(e){var r,n,i,t;return 0===e.length?{success:[],error:[]}:(r=await this.findByIds(e).exec(),n=[],i=new Map,Array.from(r.values()).forEach(e=>{var t=e.toMutableJSON(!0);n.push(t),i.set(e.primary,t)}),await Promise.all(n.map(e=>{var t=e[this.schema.primaryPath];return this._runHooks("pre","remove",e,r.get(t))})),e=n.map(e=>{var t=(0,y.flatClone)(e);return t._deleted=!0,{previous:e,document:t}}),e=await this.storageInstance.bulkWrite(e,"rx-collection-bulk-remove"),t=Object.keys(e.success),await Promise.all(t.map(e=>this._runHooks("post","remove",i.get(e),r.get(e)))),{success:t.map(e=>(0,y.getFromMapOrThrow)(r,e)),error:Object.values(e.error)})},t.bulkUpsert=async function(e){var r=[],n=new Map,e=(e.forEach(e=>{var e=(0,m.fillObjectDataBeforeInsert)(this.schema,e),t=e[this.schema.primaryPath];if(!t)throw(0,s.newRxError)("COL3",{primaryPath:this.schema.primaryPath,data:e,schema:this.schema.jsonSchema});n.set(t,e),r.push(e)}),await this.bulkInsert(r)),t=e.success.slice(0),e=await Promise.all(e.error.map(async e=>{if(409!==e.status)throw(0,s.newRxError)("VD2",{collection:this.name,writeError:e});var t=e.documentId,r=(0,y.getFromMapOrThrow)(n,t),t=(0,y.ensureNotFalsy)(e.documentInDb);return await this._docCache.getCachedRxDocument(t).incrementalModify(()=>r)}));return(0,y.appendToArray)(t,e),t},t.upsert=function(e){return this.bulkUpsert([e]).then(e=>e[0])},t.incrementalUpsert=function(e){var t,i=(0,m.fillObjectDataBeforeInsert)(this.schema,e),o=i[this.schema.primaryPath];if(o)return t=(t=(t=this._incrementalUpsertQueues.get(o))||y.PROMISE_RESOLVE_VOID).then(()=>{var t=this,e=o,r=i,n=t._docCache.getLatestDocumentDataIfExists(e);return n?Promise.resolve({doc:t._docCache.getCachedRxDocument(n),inserted:!1}):t.findOne(e).exec().then(e=>e?{doc:e,inserted:!1}:t.insert(r).then(e=>({doc:e,inserted:!0})))}).then(e=>{return e.inserted?e.doc:(e=e.doc,t=i,e.incrementalModify(e=>t));var t}),this._incrementalUpsertQueues.set(o,t),t;throw(0,s.newRxError)("COL4",{data:e})},t.find=function(e){if("string"==typeof e)throw(0,s.newRxError)("COL5",{queryObj:e});return e=e||(0,a._getDefaultQuery)(),(0,a.createRxQuery)("find",e,this)},t.findOne=function(e){var t;if("string"==typeof e)t=(0,a.createRxQuery)("findOne",{selector:{[this.schema.primaryPath]:e},limit:1},this);else{if((e=e||(0,a._getDefaultQuery)()).limit)throw(0,s.newRxError)("QU6");e.limit=1,t=(0,a.createRxQuery)("findOne",e,this)}if("number"==typeof e||Array.isArray(e))throw(0,s.newRxTypeError)("COL6",{queryObj:e});return t},t.count=function(e){return e=e||(0,a._getDefaultQuery)(),(0,a.createRxQuery)("count",e,this)},t.findByIds=function(e){e={selector:{[this.schema.primaryPath]:{$in:e.slice(0)}}};return(0,a.createRxQuery)("findByIds",e,this)},t.exportJSON=function(){throw(0,y.pluginMissing)("json-dump")},t.importJSON=function(e){throw(0,y.pluginMissing)("json-dump")},t.insertCRDT=function(e){throw(0,y.pluginMissing)("crdt")},t.addHook=function(e,t,r,n=!1){if("function"!=typeof r)throw(0,s.newRxTypeError)("COL7",{key:t,when:e});if(!h.includes(e))throw(0,s.newRxTypeError)("COL8",{key:t,when:e});if(!_.includes(t))throw(0,s.newRxError)("COL9",{key:t});if("post"===e&&"create"===t&&!0===n)throw(0,s.newRxError)("COL10",{when:e,key:t,parallel:n});r=r.bind(this),n=n?"parallel":"series";this.hooks[t]=this.hooks[t]||{},this.hooks[t][e]=this.hooks[t][e]||{series:[],parallel:[]},this.hooks[t][e][n].push(r)},t.getHooks=function(e,t){return this.hooks[t]&&this.hooks[t][e]?this.hooks[t][e]:{series:[],parallel:[]}},t.hasHooks=function(e,t){e=this.getHooks(e,t);return!!e&&(0<e.series.length||0<e.parallel.length)},t._runHooks=function(e,t,r,n){var i=this.getHooks(e,t);return i?(e=i.series.map(e=>()=>e(r,n)),(0,y.promiseSeries)(e).then(()=>Promise.all(i.parallel.map(e=>e(r,n))))):y.PROMISE_RESOLVE_VOID},t._runHooksSync=function(e,t,r,n){e=this.getHooks(e,t);e&&e.series.forEach(e=>e(r,n))},t.promiseWait=function(r){return new Promise(e=>{var t=setTimeout(()=>{this.timeouts.delete(t),e()},r);this.timeouts.add(t)})},t.destroy=function(){return this.destroyed?y.PROMISE_RESOLVE_FALSE:(this.destroyed=!0,Array.from(this.timeouts).forEach(e=>clearTimeout(e)),this._changeEventBuffer&&this._changeEventBuffer.destroy(),this.database.requestIdlePromise().then(()=>Promise.all(this.onDestroy.map(e=>e()))).then(()=>this.storageInstance.close()).then(()=>(this._subs.forEach(e=>e.unsubscribe()),delete this.database.collections[this.name],(0,v.runAsyncPluginHooks)("postDestroyRxCollection",this).then(()=>!0))))},t.remove=async function(){await this.destroy(),await(0,m.removeCollectionStorages)(this.database.storage,this.database.internalStore,this.database.token,this.database.name,this.name,this.database.hashFunction)},(0,i.default)(e,[{key:"insert$",get:function(){return this.$.pipe((0,o.filter)(e=>"INSERT"===e.operation))}},{key:"update$",get:function(){return this.$.pipe((0,o.filter)(e=>"UPDATE"===e.operation))}},{key:"remove$",get:function(){return this.$.pipe((0,o.filter)(e=>"DELETE"===e.operation))}},{key:"asRxCollection",get:function(){return this}}]),e}();r.RxCollectionBase=S},{"./change-event-buffer":322,"./doc-cache":324,"./hooks":326,"./incremental-write":327,"./overwritable":329,"./plugins/utils":360,"./query-cache":378,"./replication-protocol":384,"./rx-collection-helper":388,"./rx-document":393,"./rx-document-prototype-merge":392,"./rx-error":394,"./rx-query":397,"./rx-storage-helper":400,"@babel/runtime/helpers/createClass":404,"@babel/runtime/helpers/interopRequireDefault":407,"rxjs/operators":640}],390:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.STORAGE_TOKEN_DOCUMENT_KEY=r.STORAGE_TOKEN_DOCUMENT_ID=r.INTERNAL_STORE_SCHEMA_TITLE=r.INTERNAL_STORE_SCHEMA=r.INTERNAL_CONTEXT_STORAGE_TOKEN=r.INTERNAL_CONTEXT_COLLECTION=void 0,r._collectionNamePrimary=p,r.addConnectedStorageToCollection=async function(e,t,r){var n=l(p(e.name,e.schema.jsonSchema),c);for(;;){var i=await(0,s.getSingleDocument)(e.database.internalStore,n),o=(0,u.clone)((0,u.ensureNotFalsy)(i));if(o.data.connectedStorages||(o.data.connectedStorages=[]),o.data.connectedStorages.find(e=>e.collectionName===t&&e.schema.version===r.version))return;o.data.connectedStorages.push({collectionName:t,schema:r});try{await(0,s.writeSingle)(e.database.internalStore,{previous:(0,u.ensureNotFalsy)(i),document:o},"add-connected-storage-to-collection")}catch(e){if(!(0,a.isBulkWriteConflictError)(e))throw e}}},r.ensureStorageTokenDocumentExists=async function(e){var t=(0,u.randomCouchString)(10),r=e.password?e.hashFunction(JSON.stringify(e.password)):void 0,t={id:d,context:i,key:f,data:{token:t,instanceToken:e.token,passwordHash:r},_deleted:!1,_meta:(0,u.getDefaultRxDocumentMeta)(),_rev:(0,u.getDefaultRevision)(),_attachments:{}},e=await e.internalStore.bulkWrite([{document:t}],"internal-add-storage-token");if(e.success[d])return e.success[d];t=(0,u.ensureNotFalsy)(e.error[d]);if(t.isError&&409===t.status){e=t;if(r&&r!==e.documentInDb.data.passwordHash)throw(0,a.newRxError)("DB1",{passwordHash:r,existingPasswordHash:e.documentInDb.data.passwordHash});r=e.documentInDb;return(0,u.ensureNotFalsy)(r)}throw t},r.getAllCollectionDocuments=async function(e,t){e=e.prepareQuery(t.schema,{selector:{context:c},sort:[{id:"asc"}],skip:0});return(await t.query(e)).documents},r.getPrimaryKeyOfInternalDocument=l;var a=e("./rx-error"),n=e("./rx-schema-helper"),s=e("./rx-storage-helper"),u=e("./plugins/utils"),c="collection",i=(r.INTERNAL_CONTEXT_COLLECTION=c,"storage-token"),e=(r.INTERNAL_CONTEXT_STORAGE_TOKEN=i,"RxInternalDocument"),o=(r.INTERNAL_STORE_SCHEMA_TITLE=e,(0,n.fillWithDefaultSettings)({version:0,title:e,primaryKey:{key:"id",fields:["context","key"],separator:"|"},type:"object",properties:{id:{type:"string",maxLength:200},key:{type:"string"},context:{type:"string",enum:[c,i,"OTHER"]},data:{type:"object",additionalProperties:!0}},indexes:[],required:["key","context","data"],additionalProperties:!1,sharding:{shards:1,mode:"collection"}}));function l(e,t){return(0,n.getComposedPrimaryKeyOfDocumentData)(o,{key:e,context:t})}r.INTERNAL_STORE_SCHEMA=o;var f="storageToken",d=l(r.STORAGE_TOKEN_DOCUMENT_KEY=f,i);function p(e,t){return e+"-"+t.version}r.STORAGE_TOKEN_DOCUMENT_ID=d},{"./plugins/utils":360,"./rx-error":394,"./rx-schema-helper":398,"./rx-storage-helper":400}],391:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.RxDatabaseBase=void 0,r.createRxDatabase=function({storage:r,instanceCreationOptions:n,name:i,password:o,multiInstance:a=!0,eventReduce:s=!1,ignoreDuplicate:u=!1,options:c={},cleanupPolicy:l,allowSlowCount:f=!1,localDocuments:d=!1,hashFunction:p=y.defaultHashSha256}){(0,b.runPluginHooks)("preCreateRxDatabase",{storage:r,instanceCreationOptions:n,name:i,password:o,multiInstance:a,eventReduce:s,ignoreDuplicate:u,options:c,localDocuments:d}),u||function(e){if(_.has(e))throw(0,m.newRxError)("DB8",{name:e,link:"https://pubkey.github.io/rxdb/rx-database.html#ignoreduplicate"})}(i);_.add(i);var h=(0,y.randomCouchString)(10);return x(h,r,i,n,a,o).catch(e=>{throw _.delete(i),e}).then(e=>{var t=new S(i,h,r,n,o,a,s,c,e,p,l,f);return(0,b.runAsyncPluginHooks)("createRxDatabase",{database:t,creator:{storage:r,instanceCreationOptions:n,name:i,password:o,multiInstance:a,eventReduce:s,ignoreDuplicate:u,options:c,localDocuments:d}}).then(()=>t)})},r.createRxDatabaseStorageInstance=x,r.dbCount=function(){return w},r.ensureNoStartupErrors=f,r.isRxDatabase=function(e){return e instanceof S},r.isRxDatabaseFirstTimeInstantiated=async function(e){return(await e.storageTokenDocument).data.instanceToken===e.token},r.removeRxDatabase=o,n(e("@babel/runtime/helpers/createClass"))),d=e("custom-idle-queue"),y=e("./plugins/utils"),m=e("./rx-error"),c=e("./rx-schema"),b=e("./hooks"),p=e("rxjs"),h=e("rxjs/operators"),l=e("./rx-collection"),v=e("./rx-storage-helper"),g=e("oblivious-set"),O=e("./rx-database-internal-store"),a=e("./rx-collection-helper"),s=e("./overwritable"),_=new Set,w=0,S=function(){function e(e,t,r,n,i,o,a=!1,s={},u,c,l,f){this.idleQueue=new d.IdleQueue,this.storageInstances=new Set,this._subs=[],this.startupErrors=[],this.onDestroy=[],this.destroyed=!1,this.collections={},this.eventBulks$=new p.Subject,this.observable$=this.eventBulks$.pipe((0,h.mergeMap)(e=>e.events)),this.storageToken=y.PROMISE_RESOLVE_FALSE,this.storageTokenDocument=y.PROMISE_RESOLVE_FALSE,this.emittedEventBulkIds=new g.ObliviousSet(6e4),this.name=e,this.token=t,this.storage=r,this.instanceCreationOptions=n,this.password=i,this.multiInstance=o,this.eventReduce=a,this.options=s,this.internalStore=u,this.hashFunction=c,this.cleanupPolicy=l,this.allowSlowCount=f,w++,"pseudoInstance"!==this.name&&(this.internalStore=(0,v.getWrappedStorageInstance)(this.asRxDatabase,u,O.INTERNAL_STORE_SCHEMA),this.storageTokenDocument=(0,O.ensureStorageTokenDocumentExists)(this.asRxDatabase).catch(e=>this.startupErrors.push(e)),this.storageToken=this.storageTokenDocument.then(e=>e.data.token).catch(e=>this.startupErrors.push(e)))}var t=e.prototype;return t.$emit=function(e){this.emittedEventBulkIds.has(e.id)||(this.emittedEventBulkIds.add(e.id),this.eventBulks$.next(e))},t.removeCollectionDoc=async function(e,t){var r=await(0,v.getSingleDocument)(this.internalStore,(0,O.getPrimaryKeyOfInternalDocument)((0,O._collectionNamePrimary)(e,t),O.INTERNAL_CONTEXT_COLLECTION));if(!r)throw(0,m.newRxError)("SNH",{name:e,schema:t});e=(0,v.flatCloneDocWithMeta)(r);e._deleted=!0,await this.internalStore.bulkWrite([{document:e,previous:r}],"rx-database-remove-collection")},t.addCollections=async function(e){var o={},a={},s=[],u={},t=(Object.entries(e).forEach(([e,t])=>{var r=e,n=t.schema,i=(o[r]=n,(0,c.createRxSchema)(n,this.hashFunction));if(a[r]=i,this.collections[e])throw(0,m.newRxError)("DB3",{name:e});n=(0,O._collectionNamePrimary)(e,n),n={id:(0,O.getPrimaryKeyOfInternalDocument)(n,O.INTERNAL_CONTEXT_COLLECTION),key:n,context:O.INTERNAL_CONTEXT_COLLECTION,data:{name:r,schemaHash:i.hash,schema:i.jsonSchema,version:i.version,connectedStorages:[]},_deleted:!1,_meta:(0,y.getDefaultRxDocumentMeta)(),_rev:(0,y.getDefaultRevision)(),_attachments:{}},s.push({document:n}),n=Object.assign({},t,{name:r,schema:i,database:this}),i=(0,y.flatClone)(t);i.database=this,i.name=e,(0,b.runPluginHooks)("preCreateRxCollection",i),n.conflictHandler=i.conflictHandler,u[r]=n}),await this.internalStore.bulkWrite(s,"rx-database-add-collection")),r=(await f(this),Object.entries(t.error).forEach(([,e])=>{if(409!==e.status)throw(0,m.newRxError)("DB12",{database:this.name,writeError:e});var e=(0,y.ensureNotFalsy)(e.documentInDb),t=e.data.name,r=a[t];if(e.data.schemaHash!==r.hash)throw(0,m.newRxError)("DB6",{database:this.name,collection:t,previousSchemaHash:e.data.schemaHash,schemaHash:r.hash,previousSchema:e.data.schema,schema:(0,y.ensureNotFalsy)(o[t])})}),{});return await Promise.all(Object.keys(e).map(async e=>{var t=await(0,l.createRxCollection)(u[e]);r[e]=t,this.collections[e]=t,this[e]||Object.defineProperty(this,e,{get:()=>this.collections[e]})})),r},t.lockedRun=function(e){return this.idleQueue.wrapCall(e)},t.requestIdlePromise=function(){return this.idleQueue.requestIdlePromise()},t.exportJSON=function(e){throw(0,y.pluginMissing)("json-dump")},t.importJSON=function(e){throw(0,y.pluginMissing)("json-dump")},t.backup=function(e){throw(0,y.pluginMissing)("backup")},t.leaderElector=function(){throw(0,y.pluginMissing)("leader-election")},t.isLeader=function(){throw(0,y.pluginMissing)("leader-election")},t.waitForLeadership=function(){throw(0,y.pluginMissing)("leader-election")},t.migrationStates=function(){throw(0,y.pluginMissing)("migration")},t.destroy=async function(){return this.destroyed||(this.destroyed=!0,await(0,b.runAsyncPluginHooks)("preDestroyRxDatabase",this),this.eventBulks$.complete(),w--,this._subs.map(e=>e.unsubscribe()),"pseudoInstance"===this.name)?y.PROMISE_RESOLVE_FALSE:this.requestIdlePromise().then(()=>Promise.all(this.onDestroy.map(e=>e()))).then(()=>Promise.all(Object.keys(this.collections).map(e=>this.collections[e]).map(e=>e.destroy()))).then(()=>this.internalStore.close()).then(()=>_.delete(this.name)).then(()=>!0)},t.remove=function(){return this.destroy().then(()=>o(this.name,this.storage))},(0,i.default)(e,[{key:"$",get:function(){return this.observable$}},{key:"asRxDatabase",get:function(){return this}}]),e}();async function x(e,t,r,n,i,o){return await t.createStorageInstance({databaseInstanceToken:e,databaseName:r,collectionName:v.INTERNAL_STORAGE_NAME,schema:O.INTERNAL_STORE_SCHEMA,options:n,multiInstance:i,password:o,devMode:s.overwritable.isDevMode()})}async function o(t,r){var n=(0,y.randomCouchString)(10),i=await x(n,r,t,{},!1),e=await(0,O.getAllCollectionDocuments)(r.statics,i),o=new Set,e=(e.forEach(e=>o.add(e.data.name)),Array.from(o));return await Promise.all(e.map(e=>(0,a.removeCollectionStorages)(r,i,n,t,e))),await(0,b.runAsyncPluginHooks)("postRemoveRxDatabase",{databaseName:t,storage:r}),await i.remove(),e}async function f(e){if(await e.storageToken,e.startupErrors[0])throw e.startupErrors[0]}r.RxDatabaseBase=S},{"./hooks":326,"./overwritable":329,"./plugins/utils":360,"./rx-collection":389,"./rx-collection-helper":388,"./rx-database-internal-store":390,"./rx-error":394,"./rx-schema":399,"./rx-storage-helper":400,"@babel/runtime/helpers/createClass":404,"@babel/runtime/helpers/interopRequireDefault":407,"custom-idle-queue":38,"oblivious-set":316,rxjs:415,"rxjs/operators":640}],392:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createNewRxDocument=function(e,t){var r=(0,n.createWithConstructor)(c(e),e,o.overwritable.deepFreezeWhenDevMode(t));return e._runHooksSync("post","create",t,r),(0,i.runPluginHooks)("postCreateRxDocument",r),r},r.getDocumentOrmPrototype=l,r.getDocumentPrototype=u,r.getRxDocumentConstructor=c;var n=e("./rx-document"),i=e("./hooks"),o=e("./overwritable"),a=e("./plugins/utils"),s=new WeakMap;function u(e){var t=e.schema.getDocumentPrototype(),e=l(e),r=n.basePrototype,i={};return[t,e,r].forEach(n=>{Object.getOwnPropertyNames(n).forEach(e=>{var t=Object.getOwnPropertyDescriptor(n,e),r=!0;(e.startsWith("_")||e.endsWith("_")||e.startsWith("$")||e.endsWith("$"))&&(r=!1),"function"==typeof t.value?Object.defineProperty(i,e,{get(){return t.value.bind(this)},enumerable:r,configurable:!1}):(t.enumerable=r,t.configurable=!1,t.writable&&(t.writable=!1),Object.defineProperty(i,e,t))})}),i}function c(e){return(0,a.getFromMapOrCreate)(s,e,()=>(0,n.createRxDocumentConstructor)(u(e)))}function l(e){var r={};return Object.entries(e.methods).forEach(([e,t])=>{r[e]=t}),r}},{"./hooks":326,"./overwritable":329,"./plugins/utils":360,"./rx-document":393}],393:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.basePrototype=void 0,r.beforeDocumentUpdateWrite=h,r.createRxDocumentConstructor=function(e=d){function t(e,t){this.collection=e,this._data=t,this._propertyCache=new Map,this.isInstanceOfRxDocument=!0}return t.prototype=e,t},r.createWithConstructor=function(e,t,r){e=new e(t,r);return(0,a.runPluginHooks)("createRxDocument",e),e},r.defineGetterSetter=p,r.isRxDocument=function(e){return"object"==typeof e&&null!==e&&"isInstanceOfRxDocument"in e};var n=e("rxjs/operators"),o=e("./plugins/utils"),i=e("./rx-error"),a=e("./hooks"),s=e("./rx-change-event"),u=e("./overwritable"),c=e("./rx-schema-helper"),l=e("./rx-storage-helper"),f=e("./incremental-write"),d={get primaryPath(){if(this.isInstanceOfRxDocument)return this.collection.schema.primaryPath},get primary(){if(this.isInstanceOfRxDocument)return this._data[this.primaryPath]},get revision(){if(this.isInstanceOfRxDocument)return this._data._rev},get deleted$(){if(this.isInstanceOfRxDocument)return this.$.pipe((0,n.map)(e=>e._deleted))},get deleted(){if(this.isInstanceOfRxDocument)return this._data._deleted},getLatest(){var e=this.collection._docCache.getLatestDocumentData(this.primary);return this.collection._docCache.getCachedRxDocument(e)},get $(){return this.collection.$.pipe((0,n.filter)(e=>!e.isLocal),(0,n.filter)(e=>e.documentId===this.primary),(0,n.map)(e=>(0,s.getDocumentDataOfRxChangeEvent)(e)),(0,n.startWith)(this.collection._docCache.getLatestDocumentData(this.primary)),(0,n.distinctUntilChanged)((e,t)=>e._rev===t._rev),(0,n.map)(e=>this.collection._docCache.getCachedRxDocument(e)),(0,n.shareReplay)(o.RXJS_SHARE_REPLAY_DEFAULTS))},get$(t){if(u.overwritable.isDevMode()){if(t.includes(".item."))throw(0,i.newRxError)("DOC1",{path:t});if(t===this.primaryPath)throw(0,i.newRxError)("DOC2");if(this.collection.schema.finalFields.includes(t))throw(0,i.newRxError)("DOC3",{path:t});if(!(0,c.getSchemaByObjectPath)(this.collection.schema.jsonSchema,t))throw(0,i.newRxError)("DOC4",{path:t})}return this.$.pipe((0,n.map)(e=>(0,o.getProperty)(e,t)),(0,n.distinctUntilChanged)())},populate(e){var t=(0,c.getSchemaByObjectPath)(this.collection.schema.jsonSchema,e),r=this.get(e);if(!r)return o.PROMISE_RESOLVE_NULL;if(!t)throw(0,i.newRxError)("DOC5",{path:e});if(!t.ref)throw(0,i.newRxError)("DOC6",{path:e,schemaObj:t});var n=this.collection.database.collections[t.ref];if(n)return"array"===t.type?n.findByIds(r).exec().then(e=>{e=e.values();return Array.from(e)}):n.findOne(r).exec();throw(0,i.newRxError)("DOC7",{ref:t.ref,path:e,schemaObj:t})},get(e){var t;if(this._data)return this._propertyCache.get(e)||("object"!=typeof(t=(0,o.getProperty)(this._data,e))||Array.isArray(t)?u.overwritable.deepFreezeWhenDevMode(t):(t=(0,o.clone)(t),p(this.collection.schema,t,e,this),this._propertyCache.set(e,t),t))},toJSON(e=!1){return e?u.overwritable.deepFreezeWhenDevMode(this._data):(delete(e=(0,o.flatClone)(this._data))._rev,delete e._attachments,delete e._deleted,delete e._meta,u.overwritable.deepFreezeWhenDevMode(e))},toMutableJSON(e=!1){return(0,o.clone)(this.toJSON(e))},update(e){throw(0,o.pluginMissing)("update")},incrementalUpdate(e){throw(0,o.pluginMissing)("update")},updateCRDT(e){throw(0,o.pluginMissing)("crdt")},putAttachment(){throw(0,o.pluginMissing)("attachments")},getAttachment(){throw(0,o.pluginMissing)("attachments")},allAttachments(){throw(0,o.pluginMissing)("attachments")},get allAttachments$(){throw(0,o.pluginMissing)("attachments")},async modify(e,t){var r=this._data,e=await(0,f.modifierFromPublicToInternal)(e)(r);return this._saveData(e,r)},incrementalModify(e,t){return this.collection.incrementalWriteQueue.addWrite(this._data,(0,f.modifierFromPublicToInternal)(e)).then(e=>this.collection._docCache.getCachedRxDocument(e))},patch(e){var t=this._data,r=(0,o.clone)(t);return Object.entries(e).forEach(([e,t])=>{r[e]=t}),this._saveData(r,t)},incrementalPatch(e){return this.incrementalModify(r=>(Object.entries(e).forEach(([e,t])=>{r[e]=t}),r))},async _saveData(e,t){if(e=(0,o.flatClone)(e),this._data._deleted)throw(0,i.newRxError)("DOC11",{id:this.primary,document:this});await h(this.collection,e,t);var t=await this.collection.storageInstance.bulkWrite([{previous:t,document:e}],"rx-document-save-data"),r=t.error[this.primary];return(0,l.throwIfIsStorageWriteError)(this.collection,this.primary,e,r),await this.collection._runHooks("post","save",e,this),this.collection._docCache.getCachedRxDocument((0,o.getFromObjectOrThrow)(t.success,this.primary))},remove(){var r,t,n=this.collection;return this.deleted?Promise.reject((0,i.newRxError)("DOC13",{document:this,id:this.primary})):(r=(0,o.flatClone)(this._data),n._runHooks("pre","remove",r,this).then(async()=>{r._deleted=!0;var e=await n.storageInstance.bulkWrite([{previous:this._data,document:r}],"rx-document-remove"),t=e.error[this.primary];return(0,l.throwIfIsStorageWriteError)(n,this.primary,r,t),(0,o.getFromObjectOrThrow)(e.success,this.primary)}).then(e=>(t=e,this.collection._runHooks("post","remove",r,this))).then(()=>this.collection._docCache.getCachedRxDocument(t)))},incrementalRemove(){return this.incrementalModify(async e=>(await this.collection._runHooks("pre","remove",e,this),e._deleted=!0,e)).then(async e=>(await this.collection._runHooks("post","remove",e._data,e),e))},destroy(){throw(0,i.newRxError)("DOC14")}};function p(e,r,n="",i=!1){null!==r&&void 0!==(e=(0,c.getSchemaByObjectPath)(e.jsonSchema,n))&&(e.properties&&(e=e.properties),Object.keys(e).forEach(e=>{var t=(0,o.trimDots)(n+"."+e);r.__defineGetter__(e,function(){var e=i||this;if(e.get&&"function"==typeof e.get)return e.get(t)}),Object.defineProperty(r,e+"$",{get:function(){return(i||this).get$(t)},enumerable:!1,configurable:!1}),Object.defineProperty(r,e+"_",{get:function(){return(i||this).populate(t)},enumerable:!1,configurable:!1}),r.__defineSetter__(e,function(e){return(i||this).set(t,e)})}))}function h(e,t,r){return t._meta=Object.assign({},r._meta,t._meta),u.overwritable.isDevMode()&&e.schema.validateChange(r,t),e._runHooks("pre","save",t,r)}r.basePrototype=d},{"./hooks":326,"./incremental-write":327,"./overwritable":329,"./plugins/utils":360,"./rx-change-event":387,"./rx-error":394,"./rx-schema-helper":398,"./rx-storage-helper":400,"rxjs/operators":640}],394:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),o=(Object.defineProperty(r,"__esModule",{value:!0}),r.RxTypeError=r.RxError=void 0,r.isBulkWriteConflictError=function(e){return!(!e||409!==e.status)&&e},r.newRxError=l,r.newRxTypeError=function(e,t){return new c(e,i.overwritable.tunnelErrorMessage(e),t)},r.rxStorageWriteErrorToRxError=function(e){return l("COL20",{name:f[e.status],document:e.documentId,writeError:e})},n(e("@babel/runtime/helpers/createClass"))),a=n(e("@babel/runtime/helpers/inheritsLoose")),n=n(e("@babel/runtime/helpers/wrapNativeSuper")),i=e("./overwritable");function s(e,t,r){return"RxError ("+t+"):\n"+e+"\n"+(n=r,t="",0===Object.keys(n).length?"":(t+="Given parameters: {\n")+Object.keys(n).map(e=>{var t="[object Object]";try{t="errors"===e?n[e].map(e=>JSON.stringify(e,Object.getOwnPropertyNames(e))):JSON.stringify(n[e],function(e,t){return void 0===t?null:t},2)}catch(e){}return e+":"+t}).join("\n")+"}");var n}var u=function(i){function e(e,t,r={}){var t=s(t,e,r),n=i.call(this,t)||this;return n.code=e,n.message=t,n.parameters=r,n.rxdb=!0,n}return(0,a.default)(e,i),e.prototype.toString=function(){return this.message},(0,o.default)(e,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}]),e}((0,n.default)(Error)),c=(r.RxError=u,function(i){function e(e,t,r={}){var t=s(t,e,r),n=i.call(this,t)||this;return n.code=e,n.message=t,n.parameters=r,n.rxdb=!0,n}return(0,a.default)(e,i),e.prototype.toString=function(){return this.message},(0,o.default)(e,[{key:"name",get:function(){return"RxTypeError ("+this.code+")"}},{key:"typeError",get:function(){return!0}}]),e}((0,n.default)(TypeError)));function l(e,t){return new u(e,i.overwritable.tunnelErrorMessage(e),t)}r.RxTypeError=c;var f={409:"document write conflict",422:"schema validation error",510:"attachment data missing"}},{"./overwritable":329,"@babel/runtime/helpers/createClass":404,"@babel/runtime/helpers/inheritsLoose":406,"@babel/runtime/helpers/interopRequireDefault":407,"@babel/runtime/helpers/wrapNativeSuper":414}],395:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getQueryMatcher=function(e,t){var r;if(t.sort)return r=(0,i.getMingoQuery)(t.selector),e=>{return!e._deleted&&!!r.find([e]).next()};throw(0,n.newRxError)("SNH",{query:t})},r.getSortComparator=function(e,t){var a;if(t.sort)return a=[],t.sort.forEach(e=>{var t=Object.keys(e)[0],e=Object.values(e)[0];a.push({key:t,direction:e,getValueFn:(0,c.objectPathMonad)(t)})}),(e,t)=>{for(var r=0;r<a.length;++r){var n=a[r],i=n.getValueFn(e),o=n.getValueFn(t);if(i!==o)return"asc"===n.direction?(0,l.compare)(i,o):(0,l.compare)(o,i)}};throw(0,n.newRxError)("SNH",{query:t})},r.normalizeMangoQuery=function(e,t){var r=(0,u.getPrimaryFieldOfPrimaryKey)(e.primaryKey);(t=(0,c.flatClone)(t)).selector&&(t.selector=f(t.selector));var n,i=(0,c.clone)(t);"number"!=typeof i.skip&&(i.skip=0);i.selector?(i.selector=i.selector,Object.entries(i.selector).forEach(([e,t])=>{"object"==typeof t&&null!==t||(i.selector[e]={$eq:t})})):i.selector={};i.index&&((t=(0,c.toArray)(i.index)).includes(r)||t.push(r),i.index=t);{var o,a;i.sort?i.sort.find(e=>(0,c.firstPropertyNameOfObject)(e)===r)||(i.sort=i.sort.slice(0),i.sort.push({[r]:"asc"})):i.index?i.sort=i.index.map(e=>({[e]:"asc"})):(e.indexes&&(o=new Set,Object.entries(i.selector).forEach(([e,t])=>{"object"==typeof t&&null!==t&&!Object.keys(t).find(e=>s.LOGICAL_OPERATORS.has(e))||o.add(e)}),a=-1,e.indexes.forEach(e=>{var e=(0,c.isMaybeReadonlyArray)(e)?e:[e],t=e.findIndex(e=>!o.has(e));0<t&&a<t&&(a=t,n=e)}),n)&&(i.sort=n.map(e=>({[e]:"asc"}))),i.sort||(i.sort=[{[r]:"asc"}]))}return i},r.normalizeQueryRegex=f;var s=e("./query-planner"),u=e("./rx-schema-helper"),c=e("./plugins/utils"),l=e("mingo/util"),n=e("./rx-error"),i=e("./rx-query-mingo");function f(n){var e,i;return"object"!=typeof n||null===n?n:(e=Object.keys(n),i={},e.forEach(e=>{var t,r=n[e];"$regex"===e&&r instanceof RegExp?(t=(0,c.parseRegex)(r),i.$regex=t.pattern,i.$options=t.flags):Array.isArray(r)?i[e]=r.map(e=>f(e)):i[e]=f(r)}),i)}},{"./plugins/utils":360,"./query-planner":379,"./rx-error":394,"./rx-query-mingo":396,"./rx-schema-helper":398,"mingo/util":307}],396:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getMingoQuery=function(e){f||((0,n.useOperators)(n.OperatorType.PIPELINE,{$sort:o.$sort,$project:o.$project}),(0,n.useOperators)(n.OperatorType.QUERY,{$and:a.$and,$eq:s.$eq,$elemMatch:c.$elemMatch,$exists:l.$exists,$gt:s.$gt,$gte:s.$gte,$in:s.$in,$lt:s.$lt,$lte:s.$lte,$ne:s.$ne,$nin:s.$nin,$mod:u.$mod,$nor:a.$nor,$not:a.$not,$or:a.$or,$regex:u.$regex,$size:c.$size,$type:l.$type}),f=!0);return new i.Query(e)};var n=e("mingo/core"),i=e("mingo/query"),o=e("mingo/operators/pipeline"),a=e("mingo/operators/query/logical"),s=e("mingo/operators/query/comparison"),u=e("mingo/operators/query/evaluation"),c=e("mingo/operators/query/array"),l=e("mingo/operators/query/element"),f=!1},{"mingo/core":69,"mingo/operators/pipeline":257,"mingo/operators/query/array":278,"mingo/operators/query/comparison":284,"mingo/operators/query/element":290,"mingo/operators/query/evaluation":293,"mingo/operators/query/logical":299,"mingo/query":306}],397:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.RxQueryBase=void 0,r._getDefaultQuery=y,r.createRxQuery=function(e,t,r,n){return(0,c.runPluginHooks)("preCreateRxQuery",{op:e,queryObj:t,collection:r,other:n}),e=m(e=new h(e,t,r,n)),(0,f.triggerCacheReplacement)(r),e},r.isFindOneByIdQuery=O,r.isRxQuery=function(e){return e instanceof h},r.queryCollection=g,r.tunnelQueryCache=m,n(e("@babel/runtime/helpers/createClass"))),o=e("rxjs"),a=e("rxjs/operators"),u=e("./plugins/utils"),s=e("./rx-error"),c=e("./hooks"),l=e("./event-reduce"),f=e("./query-cache"),d=e("./rx-query-helper"),p=0,h=function(){function e(e,t,r,n={}){this.id=++p,this._execOverDatabaseCount=0,this._creationTime=(0,u.now)(),this._lastEnsureEqual=0,this.uncached=!1,this.refCount$=new o.BehaviorSubject(null),this._result=null,this._latestChangeEvent=-1,this._lastExecStart=0,this._lastExecEnd=0,this._ensureEqualQueue=u.PROMISE_RESOLVE_FALSE,this.op=e,this.mangoQuery=t,this.collection=r,this.other=n,t||(this.mangoQuery=y()),this.isFindOneByIdQuery=O(this.collection.schema.primaryPath,t)}var t=e.prototype;return t._setResultData=function(e){var t,r,n;"number"==typeof e?this._result={docsData:[],docsMap:new Map,docsDataMap:new Map,count:e,docs:[],time:(0,u.now)()}:(e instanceof Map&&(e=Array.from(e.values())),t=new Map,r=new Map,n=(e=e.map(e=>this.collection._docCache.getCachedRxDocument(e))).map(e=>(t.set(e.primary,e._data),r.set(e.primary,e),e._data)),this._result={docsData:n,docsMap:r,docsDataMap:t,count:n.length,docs:e,time:(0,u.now)()})},t._execOverDatabase=async function(){if(this._execOverDatabaseCount=this._execOverDatabaseCount+1,this._lastExecStart=(0,u.now)(),"count"===this.op){var e=this.getPreparedQuery(),e=await this.collection.storageInstance.count(e);if("slow"!==e.mode||this.collection.database.allowSlowCount)return e.count;throw(0,s.newRxError)("QU14",{collection:this.collection,queryObj:this.mangoQuery})}var r,n;return"findByIds"===this.op?(e=(0,u.ensureNotFalsy)(this.mangoQuery.selector)[this.collection.schema.primaryPath].$in,r=new Map,n=[],e.forEach(e=>{var t=this.collection._docCache.getLatestDocumentDataIfExists(e);t?t._deleted||(t=this.collection._docCache.getCachedRxDocument(t),r.set(e,t)):n.push(e)}),0<n.length&&(e=await this.collection.storageInstance.findDocumentsById(n,!1),Object.values(e).forEach(e=>{e=this.collection._docCache.getCachedRxDocument(e);r.set(e.primary,e)})),r):g(this).then(e=>(this._lastExecEnd=(0,u.now)(),e))},t.exec=function(t){if(t&&"findOne"!==this.op)throw(0,s.newRxError)("QU9",{collection:this.collection.name,query:this.mangoQuery,op:this.op});return v(this).then(()=>(0,o.firstValueFrom)(this.$)).then(e=>{if(!e&&t)throw(0,s.newRxError)("QU10",{collection:this.collection.name,query:this.mangoQuery,op:this.op});return e})},t.toString=function(){var e=(0,u.sortObject)({op:this.op,query:this.mangoQuery,other:this.other},!0),t=JSON.stringify(e,u.stringifyFilter);return this.toString=()=>t,t},t.getPreparedQuery=function(){var e={rxQuery:this,mangoQuery:(0,d.normalizeMangoQuery)(this.collection.schema.jsonSchema,this.mangoQuery)},t=((0,c.runPluginHooks)("prePrepareQuery",e),this.collection.database.storage.statics.prepareQuery(this.collection.schema.jsonSchema,e.mangoQuery));return this.getPreparedQuery=()=>t,t},t.doesDocumentDataMatch=function(e){return!e._deleted&&this.queryMatcher(e)},t.remove=function(){return this.exec().then(e=>Array.isArray(e)?Promise.all(e.map(e=>e.remove())):e.remove())},t.update=function(e){throw(0,u.pluginMissing)("update")},t.where=function(e){throw(0,u.pluginMissing)("query-builder")},t.sort=function(e){throw(0,u.pluginMissing)("query-builder")},t.skip=function(e){throw(0,u.pluginMissing)("query-builder")},t.limit=function(e){throw(0,u.pluginMissing)("query-builder")},(0,i.default)(e,[{key:"$",get:function(){var e;return this._$||(e=this.collection.$.pipe((0,a.filter)(e=>!e.isLocal),(0,a.startWith)(null),(0,a.mergeMap)(()=>v(this)),(0,a.map)(()=>this._result),(0,a.shareReplay)(u.RXJS_SHARE_REPLAY_DEFAULTS),(0,a.distinctUntilChanged)((e,t)=>!(!e||e.time!==(0,u.ensureNotFalsy)(t).time)),(0,a.filter)(e=>!!e),(0,a.map)(e=>{e=(0,u.ensureNotFalsy)(e);return"count"===this.op?e.count:"findOne"===this.op?0===e.docs.length?null:e.docs[0]:"findByIds"===this.op?e.docsMap:e.docs.slice(0)})),this._$=(0,o.merge)(e,this.refCount$.pipe((0,a.filter)(()=>!1)))),this._$}},{key:"queryMatcher",get:function(){var e=this.collection.schema.jsonSchema,t=(0,d.normalizeMangoQuery)(this.collection.schema.jsonSchema,this.mangoQuery);return(0,u.overwriteGetterForCaching)(this,"queryMatcher",(0,d.getQueryMatcher)(e,t))}},{key:"asRxQuery",get:function(){return this}}]),e}();function y(){return{selector:{}}}function m(e){return e.collection._queryCache.getByQuery(e)}function b(e){var t=e.asRxQuery.collection._changeEventBuffer.counter;return e._latestChangeEvent>=t}function v(s){return s.collection.database.destroyed||b(s)?u.PROMISE_RESOLVE_FALSE:(s._ensureEqualQueue=s._ensureEqualQueue.then(()=>{var t,e,r,n,i,o,a=s;return a._lastEnsureEqual=(0,u.now)(),a.collection.database.destroyed||b(a)?u.PROMISE_RESOLVE_FALSE:(e=t=!1,(e=-1===a._latestChangeEvent?!0:e)||(null===(r=a.asRxQuery.collection._changeEventBuffer.getFrom(a._latestChangeEvent+1))?e=!0:(a._latestChangeEvent=a.asRxQuery.collection._changeEventBuffer.counter,r=a.asRxQuery.collection._changeEventBuffer.reduceByLastOfDoc(r),"count"===a.op?(i=(0,u.ensureNotFalsy)(a._result).count,n=i,r.forEach(e=>{var t=e.previousDocumentData&&a.doesDocumentDataMatch(e.previousDocumentData),e=a.doesDocumentDataMatch(e.documentData);!t&&e&&n++,t&&!e&&n--}),n!==i&&(t=!0,a._setResultData(n))):(i=(0,l.calculateNewResults)(a,r)).runFullQueryAgain?e=!0:i.changed&&(t=!0,a._setResultData(i.newResults)))),e?(o=a.collection._changeEventBuffer.counter,a._execOverDatabase().then(e=>(a._latestChangeEvent=o,"number"==typeof e?a._result&&e===a._result.count||(t=!0,a._setResultData(e)):a._result&&(0,u.areRxDocumentArraysEqual)(a.collection.schema.primaryPath,e,a._result.docsData)||(t=!0,a._setResultData(e)),t))):Promise.resolve(t))}),s._ensureEqualQueue)}async function g(t){var e,r,n,i=[],o=t.collection;return t.isFindOneByIdQuery?Array.isArray(t.isFindOneByIdQuery)?0<(e=(e=t.isFindOneByIdQuery).filter(e=>{e=t.collection._docCache.getLatestDocumentDataIfExists(e);return!e||(e._deleted||i.push(e),!1)})).length&&(e=await o.storageInstance.findDocumentsById(e,!1),Object.values(e).forEach(e=>{i.push(e)})):(e=t.isFindOneByIdQuery,(r=t.collection._docCache.getLatestDocumentDataIfExists(e))||(n=await o.storageInstance.findDocumentsById([e],!1)).hasOwnProperty(e)&&(r=n[e]),r&&!r._deleted&&i.push(r)):(n=t.getPreparedQuery(),i=(await o.storageInstance.query(n)).documents),i}function O(e,t){if(!t.skip&&t.selector&&1===Object.keys(t.selector).length&&t.selector[e]){t=t.selector[e];if("string"==typeof t)return t;if(1===Object.keys(t).length&&"string"==typeof t.$eq)return t.$eq;if(1===Object.keys(t).length&&Array.isArray(t.$eq)&&!t.$eq.find(e=>"string"!=typeof e))return t.$eq}return!1}r.RxQueryBase=h},{"./event-reduce":325,"./hooks":326,"./plugins/utils":360,"./query-cache":378,"./rx-error":394,"./rx-query-helper":395,"@babel/runtime/helpers/createClass":404,"@babel/runtime/helpers/interopRequireDefault":407,rxjs:415,"rxjs/operators":640}],398:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RX_META_SCHEMA=r.DEFAULT_CHECKPOINT_SCHEMA=void 0,r.fillObjectWithDefaults=function(e,t){for(var r=Object.keys(e.defaultValues),n=0;n<r.length;++n){var i=r[n];t.hasOwnProperty(i)&&void 0!==t[i]||(t[i]=e.defaultValues[i])}return t},r.fillPrimaryKey=function(e,t,r){if("string"!=typeof t.primaryKey){var n=s(t,r),i=r[e];if(i&&i!==n)throw(0,o.newRxError)("DOC19",{args:{documentData:r,existingPrimary:i,newPrimary:n},schema:t});r[e]=n}return r},r.fillWithDefaultSettings=u,r.getComposedPrimaryKeyOfDocumentData=s,r.getFinalFields=l,r.getLengthOfPrimaryKey=function(e){var t=a(e.primaryKey),e=i(e,t);return(0,n.ensureNotFalsy)(e.maxLength)},r.getPrimaryFieldOfPrimaryKey=a,r.getPseudoSchemaForVersion=function(e,t){return u({version:e,type:"object",primaryKey:t,properties:{[t]:{type:"string",maxLength:100}},required:[t]})},r.getSchemaByObjectPath=i,r.normalizeRxJsonSchema=function(e){return(0,n.sortObject)(e,!0)};var o=e("./rx-error"),n=e("./plugins/utils");function i(e,t){t=(t=t).replace(n.REGEX_ALL_DOTS,".properties.");return t=(0,n.trimDots)(t="properties."+t),(0,n.getProperty)(e,t)}function a(e){return"string"==typeof e?e:e.key}function s(e,r){return"string"==typeof e.primaryKey?r[e.primaryKey]:(e=e.primaryKey).fields.map(e=>{var t=(0,n.getProperty)(r,e);if(void 0===t)throw(0,o.newRxError)("DOC18",{args:{field:e,documentData:r}});return t}).join(e.separator)}function u(e){var t=a((e=(0,n.flatClone)(e)).primaryKey),r=(e.properties=(0,n.flatClone)(e.properties),e.additionalProperties=!1,e.hasOwnProperty("keyCompression")||(e.keyCompression=!1),e.indexes=e.indexes?e.indexes.slice(0):[],e.required=e.required?e.required.slice(0):[],e.encrypted=e.encrypted?e.encrypted.slice(0):[],e.properties._rev={type:"string",minLength:1},e.properties._attachments={type:"object"},e.properties._deleted={type:"boolean"},e.properties._meta=c,e.required=e.required?e.required.slice(0):[],e.required.push("_deleted"),e.required.push("_rev"),e.required.push("_meta"),e.required.push("_attachments"),l(e));return(0,n.appendToArray)(e.required,r),e.required=e.required.filter(e=>!e.includes(".")).filter((e,t,r)=>r.indexOf(e)===t),e.version=e.version||0,e.indexes&&(e.indexes=e.indexes.map(e=>{var e=(0,n.isMaybeReadonlyArray)(e)?e.slice(0):[e];return e.includes(t)||(e=e.slice(0)).push(t),e})),e}var c={type:"object",properties:{lwt:{type:"number",minimum:n.RX_META_LWT_MINIMUM,maximum:1e15,multipleOf:.01}},additionalProperties:!0,required:["lwt"]};function l(t){var r=Object.keys(t.properties).filter(e=>t.properties[e].final),e=a(t.primaryKey);return r.push(e),"string"!=typeof t.primaryKey&&t.primaryKey.fields.forEach(e=>r.push(e)),r}r.RX_META_SCHEMA=c;r.DEFAULT_CHECKPOINT_SCHEMA={type:"object",properties:{id:{type:"string"},lwt:{type:"number"}},required:["id","lwt"],additionalProperties:!1}},{"./plugins/utils":360,"./rx-error":394}],399:[function(e,t,r){"use strict";var n=e("@babel/runtime/helpers/interopRequireDefault"),i=(Object.defineProperty(r,"__esModule",{value:!0}),r.RxSchema=void 0,r.createRxSchema=function(e,t,r=!0){r&&(0,s.runPluginHooks)("preCreateRxSchema",e);r=(0,c.fillWithDefaultSettings)(e),r=(0,c.normalizeRxJsonSchema)(r),l.overwritable.deepFreezeWhenDevMode(r),e=new f(r,t);return(0,s.runPluginHooks)("createRxSchema",e),e},r.getIndexes=d,r.getPreviousVersions=function(e){var e=e.version||0,t=0;return new Array(e).fill(0).map(()=>t++)},r.isRxSchema=function(e){return e instanceof f},r.toTypedRxJsonSchema=function(e){return e},n(e("@babel/runtime/helpers/createClass"))),o=e("./plugins/utils"),a=e("./rx-error"),s=e("./hooks"),u=e("./rx-document"),c=e("./rx-schema-helper"),l=e("./overwritable"),f=function(){function e(e,t){this.jsonSchema=e,this.hashFunction=t,this.indexes=d(this.jsonSchema),this.primaryPath=(0,c.getPrimaryFieldOfPrimaryKey)(this.jsonSchema.primaryKey),this.finalFields=(0,c.getFinalFields)(this.jsonSchema)}var t=e.prototype;return t.validateChange=function(t,r){this.finalFields.forEach(e=>{if(!(0,o.deepEqual)(t[e],r[e]))throw(0,a.newRxError)("DOC9",{dataBefore:t,dataAfter:r,fieldName:e,schema:this.jsonSchema})})},t.getDocumentPrototype=function(){var e={};return(0,u.defineGetterSetter)(this,e,""),(0,o.overwriteGetterForCaching)(this,"getDocumentPrototype",()=>e),e},t.getPrimaryOfDocumentData=function(e){return(0,c.getComposedPrimaryKeyOfDocumentData)(this.jsonSchema,e)},(0,i.default)(e,[{key:"version",get:function(){return this.jsonSchema.version}},{key:"defaultValues",get:function(){var r={};return Object.entries(this.jsonSchema.properties).filter(([,e])=>e.hasOwnProperty("default")).forEach(([e,t])=>r[e]=t.default),(0,o.overwriteGetterForCaching)(this,"defaultValues",r)}},{key:"hash",get:function(){return(0,o.overwriteGetterForCaching)(this,"hash",this.hashFunction(JSON.stringify(this.jsonSchema)))}}]),e}();function d(e){return(e.indexes||[]).map(e=>(0,o.isMaybeReadonlyArray)(e)?e:[e])}r.RxSchema=f},{"./hooks":326,"./overwritable":329,"./plugins/utils":360,"./rx-document":393,"./rx-error":394,"./rx-schema-helper":398,"@babel/runtime/helpers/createClass":404,"@babel/runtime/helpers/interopRequireDefault":407}],400:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RX_DATABASE_LOCAL_DOCS_STORAGE_NAME=r.INTERNAL_STORAGE_NAME=void 0,r.attachmentWriteDataToNormalData=i,r.categorizeBulkWriteRows=function(e,c,l,f,t){for(var d,p=!!e.schema.attachments,h=[],y=[],m={},b=new Map,v=(0,M.randomCouchString)(10),e={id:v,events:[],checkpoint:null,context:t},g=e.events,O=[],_=[],w=[],S=(0,M.now)(),x="function"==typeof l.get,j=x?0<l.size:0<Object.keys(l).length,r=f.length,P=0;P<r;P++)!function(){var r,i=f[P],o=i.document[c],n=!1;if(n=j?x?l.get(o):l[o]:n){var e=n._rev;if(!i.previous||i.previous&&e!==i.previous._rev)return e={isError:!0,status:409,documentId:o,writeRow:i,documentInDb:n},m[o]=e;var a=p?A(i):i,e=(p&&(i.document._deleted?i.previous&&Object.keys(i.previous._attachments).forEach(e=>{_.push({documentId:o,attachmentId:e,digest:(0,M.ensureNotFalsy)(i.previous)._attachments[e].digest})}):(Object.entries(i.document._attachments).find(([e,t])=>{return(i.previous?i.previous._attachments[e]:void 0)||t.data||(r={documentId:o,documentInDb:n,isError:!0,status:510,writeRow:i,attachmentId:e}),!0}),r||Object.entries(i.document._attachments).forEach(([e,t])=>{var r,n=i.previous?i.previous._attachments[e]:void 0;n?(r=a.document._attachments[e].digest,t.data&&n.digest!==r&&w.push({documentId:o,attachmentId:e,attachmentData:t,digest:(0,M.defaultHashSha256)(t.data)})):O.push({documentId:o,attachmentId:e,attachmentData:t,digest:(0,M.defaultHashSha256)(t.data)})}))),r?m[o]=r:(y.push(a),(!d||d.document._meta.lwt<a.document._meta.lwt)&&(d=a)),i.document),t=null,s=null,u=null;if(i.previous&&i.previous._deleted&&!e._deleted)u="INSERT",t=p?I(e):e;else{if(!i.previous||i.previous._deleted||e._deleted){if(!e._deleted)throw(0,E.newRxError)("SNH",{args:{writeRow:i}});u="DELETE",t=(0,M.ensureNotFalsy)(i.document)}else u="UPDATE",t=p?I(e):e;s=i.previous}e={eventId:k(v,P,o,i),documentId:o,documentData:t,previousDocumentData:s,operation:u,startTime:S,endTime:(0,M.now)()};b.set(o,e),g.push(e)}else{t=!!i.document._deleted;p&&Object.entries(i.document._attachments).forEach(([e,t])=>{t.data?O.push({documentId:o,attachmentId:e,attachmentData:t,digest:(0,M.defaultHashSha256)(t.data)}):(r={documentId:o,isError:!0,status:510,writeRow:i,attachmentId:e},m[o]=r)}),!r&&(h.push(p?A(i):i),!d||d.document._meta.lwt<i.document._meta.lwt)&&(d=i),t||(s={eventId:k(v,P,o,i),documentId:o,operation:"INSERT",documentData:p?I(i.document):i.document,previousDocumentData:p&&i.previous?I(i.previous):i.previous,startTime:S,endTime:(0,M.now)()},b.set(o,s),g.push(s))}}();return{bulkInsertDocs:h,bulkUpdateDocs:y,newestRow:d,errors:m,changeByDocId:b,eventBulk:e,attachmentsAdd:O,attachmentsRemove:_,attachmentsUpdate:w}},r.ensureRxStorageInstanceParamsAreCorrect=function(e){if(e.schema.keyCompression)throw(0,E.newRxError)("UT5",{args:{params:e}});if(o(e.schema))throw(0,E.newRxError)("UT6",{args:{params:e}});if(e.schema.attachments&&e.schema.attachments.compression)throw(0,E.newRxError)("UT7",{args:{params:e}})},r.flatCloneDocWithMeta=function(e){var t=(0,M.flatClone)(e);return t._meta=(0,M.flatClone)(e._meta),t},r.getAttachmentSize=n,r.getSingleDocument=async function(e,t){e=(await e.findDocumentsById([t],!1))[t];return e||null},r.getUniqueDeterministicEventKey=k,r.getWrappedStorageInstance=function(o,a,r){s.overwritable.deepFreezeWhenDevMode(r);var n=(0,u.getPrimaryFieldOfPrimaryKey)(r.primaryKey);var e={originalStorageInstance:a,schema:a.schema,internals:a.internals,collectionName:a.collectionName,databaseName:a.databaseName,options:a.options,bulkWrite(e,i){var t=e.map(e=>{return t=e,(e=(0,M.flatClone)(t.document))._meta=(0,M.flatClone)(e._meta),s.overwritable.isDevMode()&&(e=(0,u.fillPrimaryKey)(n,r,e),t.previous,t.previous)&&Object.keys(t.previous._meta).forEach(e=>{if(!t.document._meta.hasOwnProperty(e))throw(0,E.newRxError)("SNH",{dataBefore:t.previous,dataAfter:t.document})}),e._meta.lwt=(0,M.now)(),e._rev=(0,M.createRevision)(o.token,t.previous),{document:e,previous:t.previous};var t});return o.lockedRun(()=>a.bulkWrite(t,i)).then(e=>{var t,r,n=Object.values(e.error).filter(e=>!(409!==e.status||e.writeRow.previous||e.writeRow.document._deleted||!(0,M.ensureNotFalsy)(e.documentInDb)._deleted));return 0<n.length?(t={error:(0,M.flatClone)(e.error),success:(0,M.flatClone)(e.success)},r=n.map(e=>(delete t.error[e.documentId],{previous:e.documentInDb,document:Object.assign({},e.writeRow.document,{_rev:(0,M.createRevision)(o.token,e.documentInDb)})})),o.lockedRun(()=>a.bulkWrite(r,i)).then(e=>(t.error=Object.assign(t.error,e.error),t.success=Object.assign(t.success,e.success),t))):e})},query(e){return o.lockedRun(()=>a.query(e))},count(e){return o.lockedRun(()=>a.count(e))},findDocumentsById(e,t){return o.lockedRun(()=>a.findDocumentsById(e,t))},getAttachmentData(e,t,r){return o.lockedRun(()=>a.getAttachmentData(e,t,r))},getChangedDocumentsSince(e,t){return o.lockedRun(()=>a.getChangedDocumentsSince((0,M.ensureNotFalsy)(e),t))},cleanup(e){return o.lockedRun(()=>a.cleanup(e))},remove(){return o.storageInstances.delete(e),o.lockedRun(()=>a.remove())},close(){return o.storageInstances.delete(e),o.lockedRun(()=>a.close())},changeStream(){return a.changeStream()},conflictResultionTasks(){return a.conflictResultionTasks()},resolveConflictResultionTask(e){var t;return e.output.isEqual?a.resolveConflictResultionTask(e):(t=Object.assign({},e.output.documentData,{_meta:(0,M.getDefaultRxDocumentMeta)(),_rev:(0,M.getDefaultRevision)(),_attachments:{}}),delete(t=(0,M.flatClone)(t))._meta,delete t._rev,delete t._attachments,a.resolveConflictResultionTask({id:e.id,output:{isEqual:!1,documentData:t}}))}};return o.storageInstances.add(e),e},r.hasEncryption=o,r.stackCheckpoints=function(e){return Object.assign({},...e)},r.storageChangeEventToRxChangeEvent=function(e,t,r){var n=t.documentData,i=t.previousDocumentData;return{eventId:t.eventId,documentId:t.documentId,collectionName:r?r.name:void 0,startTime:t.startTime,endTime:t.endTime,isLocal:e,operation:t.operation,documentData:s.overwritable.deepFreezeWhenDevMode(n),previousDocumentData:s.overwritable.deepFreezeWhenDevMode(i)}},r.stripAttachmentsDataFromDocument=I,r.stripAttachmentsDataFromRow=A,r.throwIfIsStorageWriteError=function(e,t,r,n){if(n)throw 409===n.status?(0,E.newRxError)("CONFLICT",{collection:e.name,id:t,writeError:n,data:r}):422===n.status?(0,E.newRxError)("VD2",{collection:e.name,id:t,writeError:n,data:r}):n},r.writeSingle=async function(e,t,r){e=await e.bulkWrite([t],r);{if(0<Object.keys(e.error).length)throw(0,M.firstPropertyValueOfObject)(e.error);return(0,M.firstPropertyValueOfObject)(e.success)}};var s=e("./overwritable"),E=e("./rx-error"),u=e("./rx-schema-helper"),M=e("./plugins/utils");r.INTERNAL_STORAGE_NAME="_rxdb_internal";function A(e){return{previous:e.previous,document:I(e.document)}}function n(e){return atob(e).length}function i(e){var t=e.data;return t?{digest:(0,M.defaultHashSha256)(t),length:n(t),type:e.type}:e}function I(e){var r=(0,M.flatClone)(e);return r._attachments={},Object.entries(e._attachments).forEach(([e,t])=>{r._attachments[e]=i(t)}),r}function k(e,t,r,n){return e+"|"+t+"|"+r+"|"+n.document._rev}function o(e){return!!(e.encrypted&&0<e.encrypted.length||e.attachments&&e.attachments.encrypted)}r.RX_DATABASE_LOCAL_DOCS_STORAGE_NAME="rxdatabase_storage_local"},{"./overwritable":329,"./plugins/utils":360,"./rx-error":394,"./rx-schema-helper":398}],401:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.BROADCAST_CHANNEL_BY_TOKEN=void 0,r.addRxStorageMultiInstanceSupport=function(t,r,e,n){var i,o,a,s,u,c,l,f;r.multiInstance&&(i=n||h(r.databaseInstanceToken,e.databaseName,e),o=new d.Subject,a=e=>{e.storageName===t&&e.databaseName===r.databaseName&&e.collectionName===r.collectionName&&e.version===r.schema.version&&o.next(e.eventBulk)},i.addEventListener("message",a),s=e.changeStream(),u=!1,c=s.subscribe(e=>{u||i.postMessage({storageName:t,databaseName:r.databaseName,collectionName:r.collectionName,version:r.schema.version,eventBulk:e})}),e.changeStream=function(){return o.asObservable().pipe((0,p.mergeWith)(s))},l=e.close.bind(e),e.close=async function(){return u=!0,c.unsubscribe(),i.removeEventListener("message",a),n||await y(r.databaseInstanceToken,e),l()},f=e.remove.bind(e),e.remove=async function(){return u=!0,c.unsubscribe(),i.removeEventListener("message",a),n||await y(r.databaseInstanceToken,e),f()})},r.getBroadcastChannelReference=h,r.removeBroadcastChannelReference=y;var d=e("rxjs"),p=e("rxjs/operators"),i=e("broadcast-channel"),o=new Map;function h(e,t,r){var n=o.get(e);return n||(n={bc:new i.BroadcastChannel("RxDB:"+t),refs:new Set},o.set(e,n)),n.refs.add(r),n.bc}function y(e,t){var r=o.get(e);if(r)return r.refs.delete(t),0===r.refs.size?(o.delete(e),r.bc.close()):void 0}r.BROADCAST_CHANNEL_BY_TOKEN=o},{"broadcast-channel":22,rxjs:415,"rxjs/operators":640}],402:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RxStorageDefaultStatics=void 0;var n=e("./rx-error"),i=e("./query-planner"),e={prepareQuery(e,t){if(t.sort)return{query:t,queryPlan:(0,i.getQueryPlan)(e,t)};throw(0,n.newRxError)("SNH",{query:t})},checkpointSchema:e("./rx-schema-helper").DEFAULT_CHECKPOINT_SCHEMA};r.RxStorageDefaultStatics=e},{"./query-planner":379,"./rx-error":394,"./rx-schema-helper":398}],403:[function(e,n,t){var i=e("./setPrototypeOf.js"),o=e("./isNativeReflectConstruct.js");function a(e,t,r){return o()?n.exports=a=Reflect.construct.bind():n.exports=a=function(e,t,r){var n=[null];n.push.apply(n,t);t=new(Function.bind.apply(e,n));return r&&i(t,r.prototype),t},n.exports.__esModule=!0,n.exports.default=n.exports,a.apply(null,arguments)}n.exports=a,n.exports.__esModule=!0,n.exports.default=n.exports},{"./isNativeReflectConstruct.js":409,"./setPrototypeOf.js":410}],404:[function(e,t,r){var i=e("./toPropertyKey.js");function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,i(n.key),n)}}t.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPropertyKey.js":412}],405:[function(e,t,r){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],406:[function(e,t,r){var n=e("./setPrototypeOf.js");t.exports=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n(e,t)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./setPrototypeOf.js":410}],407:[function(e,t,r){t.exports=function(e){return e&&e.__esModule?e:{default:e}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],408:[function(e,t,r){t.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},t.exports.__esModule=!0,t.exports.default=t.exports},{}],409:[function(e,t,r){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports},{}],410:[function(e,r,t){function n(e,t){return r.exports=n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r.exports.__esModule=!0,r.exports.default=r.exports,n(e,t)}r.exports=n,r.exports.__esModule=!0,r.exports.default=r.exports},{}],411:[function(e,t,r){var n=e("./typeof.js").default;t.exports=function(e,t){if("object"!==n(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);if(r=r.call(e,t||"default"),"object"!==n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")},t.exports.__esModule=!0,t.exports.default=t.exports},{"./typeof.js":413}],412:[function(e,t,r){var n=e("./typeof.js").default,i=e("./toPrimitive.js");t.exports=function(e){return e=i(e,"string"),"symbol"===n(e)?e:String(e)},t.exports.__esModule=!0,t.exports.default=t.exports},{"./toPrimitive.js":411,"./typeof.js":413}],413:[function(e,t,r){function n(e){return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t.exports.__esModule=!0,t.exports.default=t.exports,n(e)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},{}],414:[function(e,t,r){var n=e("./getPrototypeOf.js"),i=e("./setPrototypeOf.js"),o=e("./isNativeFunction.js"),a=e("./construct.js");function s(e){var r="function"==typeof Map?new Map:void 0;return t.exports=s=function(e){if(null===e||!o(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return a(e,arguments,n(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports,s(e)}t.exports=s,t.exports.__esModule=!0,t.exports.default=t.exports},{"./construct.js":403,"./getPrototypeOf.js":405,"./isNativeFunction.js":408,"./setPrototypeOf.js":410}],415:[function(e,T,t){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),r=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},i=(Object.defineProperty(t,"__esModule",{value:!0}),t.interval=t.iif=t.generate=t.fromEventPattern=t.fromEvent=t.from=t.forkJoin=t.empty=t.defer=t.connectable=t.concat=t.combineLatest=t.bindNodeCallback=t.bindCallback=t.UnsubscriptionError=t.TimeoutError=t.SequenceError=t.ObjectUnsubscribedError=t.NotFoundError=t.EmptyError=t.ArgumentOutOfRangeError=t.firstValueFrom=t.lastValueFrom=t.isObservable=t.identity=t.noop=t.pipe=t.NotificationKind=t.Notification=t.Subscriber=t.Subscription=t.Scheduler=t.VirtualAction=t.VirtualTimeScheduler=t.animationFrameScheduler=t.animationFrame=t.queueScheduler=t.queue=t.asyncScheduler=t.async=t.asapScheduler=t.asap=t.AsyncSubject=t.ReplaySubject=t.BehaviorSubject=t.Subject=t.animationFrames=t.observable=t.ConnectableObservable=t.Observable=void 0,t.filter=t.expand=t.exhaustMap=t.exhaustAll=t.exhaust=t.every=t.endWith=t.elementAt=t.distinctUntilKeyChanged=t.distinctUntilChanged=t.distinct=t.dematerialize=t.delayWhen=t.delay=t.defaultIfEmpty=t.debounceTime=t.debounce=t.count=t.connect=t.concatWith=t.concatMapTo=t.concatMap=t.concatAll=t.combineLatestWith=t.combineLatestAll=t.combineAll=t.catchError=t.bufferWhen=t.bufferToggle=t.bufferTime=t.bufferCount=t.buffer=t.auditTime=t.audit=t.config=t.NEVER=t.EMPTY=t.scheduled=t.zip=t.using=t.timer=t.throwError=t.range=t.race=t.partition=t.pairs=t.onErrorResumeNext=t.of=t.never=t.merge=void 0,t.switchMap=t.switchAll=t.subscribeOn=t.startWith=t.skipWhile=t.skipUntil=t.skipLast=t.skip=t.single=t.shareReplay=t.share=t.sequenceEqual=t.scan=t.sampleTime=t.sample=t.refCount=t.retryWhen=t.retry=t.repeatWhen=t.repeat=t.reduce=t.raceWith=t.publishReplay=t.publishLast=t.publishBehavior=t.publish=t.pluck=t.pairwise=t.onErrorResumeNextWith=t.observeOn=t.multicast=t.min=t.mergeWith=t.mergeScan=t.mergeMapTo=t.mergeMap=t.flatMap=t.mergeAll=t.max=t.materialize=t.mapTo=t.map=t.last=t.isEmpty=t.ignoreElements=t.groupBy=t.first=t.findIndex=t.find=t.finalize=void 0,t.zipWith=t.zipAll=t.withLatestFrom=t.windowWhen=t.windowToggle=t.windowTime=t.windowCount=t.window=t.toArray=t.timestamp=t.timeoutWith=t.timeout=t.timeInterval=t.throwIfEmpty=t.throttleTime=t.throttle=t.tap=t.takeWhile=t.takeUntil=t.takeLast=t.take=t.switchScan=t.switchMapTo=void 0,e("./internal/Observable")),o=(Object.defineProperty(t,"Observable",{enumerable:!0,get:function(){return i.Observable}}),e("./internal/observable/ConnectableObservable")),a=(Object.defineProperty(t,"ConnectableObservable",{enumerable:!0,get:function(){return o.ConnectableObservable}}),e("./internal/symbol/observable")),s=(Object.defineProperty(t,"observable",{enumerable:!0,get:function(){return a.observable}}),e("./internal/observable/dom/animationFrames")),u=(Object.defineProperty(t,"animationFrames",{enumerable:!0,get:function(){return s.animationFrames}}),e("./internal/Subject")),c=(Object.defineProperty(t,"Subject",{enumerable:!0,get:function(){return u.Subject}}),e("./internal/BehaviorSubject")),l=(Object.defineProperty(t,"BehaviorSubject",{enumerable:!0,get:function(){return c.BehaviorSubject}}),e("./internal/ReplaySubject")),f=(Object.defineProperty(t,"ReplaySubject",{enumerable:!0,get:function(){return l.ReplaySubject}}),e("./internal/AsyncSubject")),d=(Object.defineProperty(t,"AsyncSubject",{enumerable:!0,get:function(){return f.AsyncSubject}}),e("./internal/scheduler/asap")),p=(Object.defineProperty(t,"asap",{enumerable:!0,get:function(){return d.asap}}),Object.defineProperty(t,"asapScheduler",{enumerable:!0,get:function(){return d.asapScheduler}}),e("./internal/scheduler/async")),h=(Object.defineProperty(t,"async",{enumerable:!0,get:function(){return p.async}}),Object.defineProperty(t,"asyncScheduler",{enumerable:!0,get:function(){return p.asyncScheduler}}),e("./internal/scheduler/queue")),y=(Object.defineProperty(t,"queue",{enumerable:!0,get:function(){return h.queue}}),Object.defineProperty(t,"queueScheduler",{enumerable:!0,get:function(){return h.queueScheduler}}),e("./internal/scheduler/animationFrame")),m=(Object.defineProperty(t,"animationFrame",{enumerable:!0,get:function(){return y.animationFrame}}),Object.defineProperty(t,"animationFrameScheduler",{enumerable:!0,get:function(){return y.animationFrameScheduler}}),e("./internal/scheduler/VirtualTimeScheduler")),b=(Object.defineProperty(t,"VirtualTimeScheduler",{enumerable:!0,get:function(){return m.VirtualTimeScheduler}}),Object.defineProperty(t,"VirtualAction",{enumerable:!0,get:function(){return m.VirtualAction}}),e("./internal/Scheduler")),v=(Object.defineProperty(t,"Scheduler",{enumerable:!0,get:function(){return b.Scheduler}}),e("./internal/Subscription")),g=(Object.defineProperty(t,"Subscription",{enumerable:!0,get:function(){return v.Subscription}}),e("./internal/Subscriber")),O=(Object.defineProperty(t,"Subscriber",{enumerable:!0,get:function(){return g.Subscriber}}),e("./internal/Notification")),_=(Object.defineProperty(t,"Notification",{enumerable:!0,get:function(){return O.Notification}}),Object.defineProperty(t,"NotificationKind",{enumerable:!0,get:function(){return O.NotificationKind}}),e("./internal/util/pipe")),w=(Object.defineProperty(t,"pipe",{enumerable:!0,get:function(){return _.pipe}}),e("./internal/util/noop")),S=(Object.defineProperty(t,"noop",{enumerable:!0,get:function(){return w.noop}}),e("./internal/util/identity")),x=(Object.defineProperty(t,"identity",{enumerable:!0,get:function(){return S.identity}}),e("./internal/util/isObservable")),j=(Object.defineProperty(t,"isObservable",{enumerable:!0,get:function(){return x.isObservable}}),e("./internal/lastValueFrom")),P=(Object.defineProperty(t,"lastValueFrom",{enumerable:!0,get:function(){return j.lastValueFrom}}),e("./internal/firstValueFrom")),E=(Object.defineProperty(t,"firstValueFrom",{enumerable:!0,get:function(){return P.firstValueFrom}}),e("./internal/util/ArgumentOutOfRangeError")),M=(Object.defineProperty(t,"ArgumentOutOfRangeError",{enumerable:!0,get:function(){return E.ArgumentOutOfRangeError}}),e("./internal/util/EmptyError")),A=(Object.defineProperty(t,"EmptyError",{enumerable:!0,get:function(){return M.EmptyError}}),e("./internal/util/NotFoundError")),I=(Object.defineProperty(t,"NotFoundError",{enumerable:!0,get:function(){return A.NotFoundError}}),e("./internal/util/ObjectUnsubscribedError")),k=(Object.defineProperty(t,"ObjectUnsubscribedError",{enumerable:!0,get:function(){return I.ObjectUnsubscribedError}}),e("./internal/util/SequenceError")),C=(Object.defineProperty(t,"SequenceError",{enumerable:!0,get:function(){return k.SequenceError}}),e("./internal/operators/timeout")),R=(Object.defineProperty(t,"TimeoutError",{enumerable:!0,get:function(){return C.TimeoutError}}),e("./internal/util/UnsubscriptionError")),D=(Object.defineProperty(t,"UnsubscriptionError",{enumerable:!0,get:function(){return R.UnsubscriptionError}}),e("./internal/observable/bindCallback")),N=(Object.defineProperty(t,"bindCallback",{enumerable:!0,get:function(){return D.bindCallback}}),e("./internal/observable/bindNodeCallback")),$=(Object.defineProperty(t,"bindNodeCallback",{enumerable:!0,get:function(){return N.bindNodeCallback}}),e("./internal/observable/combineLatest")),F=(Object.defineProperty(t,"combineLatest",{enumerable:!0,get:function(){return $.combineLatest}}),e("./internal/observable/concat")),L=(Object.defineProperty(t,"concat",{enumerable:!0,get:function(){return F.concat}}),e("./internal/observable/connectable")),B=(Object.defineProperty(t,"connectable",{enumerable:!0,get:function(){return L.connectable}}),e("./internal/observable/defer")),q=(Object.defineProperty(t,"defer",{enumerable:!0,get:function(){return B.defer}}),e("./internal/observable/empty")),U=(Object.defineProperty(t,"empty",{enumerable:!0,get:function(){return q.empty}}),e("./internal/observable/forkJoin")),W=(Object.defineProperty(t,"forkJoin",{enumerable:!0,get:function(){return U.forkJoin}}),e("./internal/observable/from")),V=(Object.defineProperty(t,"from",{enumerable:!0,get:function(){return W.from}}),e("./internal/observable/fromEvent")),z=(Object.defineProperty(t,"fromEvent",{enumerable:!0,get:function(){return V.fromEvent}}),e("./internal/observable/fromEventPattern")),K=(Object.defineProperty(t,"fromEventPattern",{enumerable:!0,get:function(){return z.fromEventPattern}}),e("./internal/observable/generate")),Q=(Object.defineProperty(t,"generate",{enumerable:!0,get:function(){return K.generate}}),e("./internal/observable/iif")),H=(Object.defineProperty(t,"iif",{enumerable:!0,get:function(){return Q.iif}}),e("./internal/observable/interval")),G=(Object.defineProperty(t,"interval",{enumerable:!0,get:function(){return H.interval}}),e("./internal/observable/merge")),J=(Object.defineProperty(t,"merge",{enumerable:!0,get:function(){return G.merge}}),e("./internal/observable/never")),Y=(Object.defineProperty(t,"never",{enumerable:!0,get:function(){return J.never}}),e("./internal/observable/of")),X=(Object.defineProperty(t,"of",{enumerable:!0,get:function(){return Y.of}}),e("./internal/observable/onErrorResumeNext")),Z=(Object.defineProperty(t,"onErrorResumeNext",{enumerable:!0,get:function(){return X.onErrorResumeNext}}),e("./internal/observable/pairs")),ee=(Object.defineProperty(t,"pairs",{enumerable:!0,get:function(){return Z.pairs}}),e("./internal/observable/partition")),te=(Object.defineProperty(t,"partition",{enumerable:!0,get:function(){return ee.partition}}),e("./internal/observable/race")),re=(Object.defineProperty(t,"race",{enumerable:!0,get:function(){return te.race}}),e("./internal/observable/range")),ne=(Object.defineProperty(t,"range",{enumerable:!0,get:function(){return re.range}}),e("./internal/observable/throwError")),ie=(Object.defineProperty(t,"throwError",{enumerable:!0,get:function(){return ne.throwError}}),e("./internal/observable/timer")),oe=(Object.defineProperty(t,"timer",{enumerable:!0,get:function(){return ie.timer}}),e("./internal/observable/using")),ae=(Object.defineProperty(t,"using",{enumerable:!0,get:function(){return oe.using}}),e("./internal/observable/zip")),se=(Object.defineProperty(t,"zip",{enumerable:!0,get:function(){return ae.zip}}),e("./internal/scheduled/scheduled")),ue=(Object.defineProperty(t,"scheduled",{enumerable:!0,get:function(){return se.scheduled}}),e("./internal/observable/empty")),ce=(Object.defineProperty(t,"EMPTY",{enumerable:!0,get:function(){return ue.EMPTY}}),e("./internal/observable/never")),le=(Object.defineProperty(t,"NEVER",{enumerable:!0,get:function(){return ce.NEVER}}),r(e("./internal/types"),t),e("./internal/config")),fe=(Object.defineProperty(t,"config",{enumerable:!0,get:function(){return le.config}}),e("./internal/operators/audit")),de=(Object.defineProperty(t,"audit",{enumerable:!0,get:function(){return fe.audit}}),e("./internal/operators/auditTime")),pe=(Object.defineProperty(t,"auditTime",{enumerable:!0,get:function(){return de.auditTime}}),e("./internal/operators/buffer")),he=(Object.defineProperty(t,"buffer",{enumerable:!0,get:function(){return pe.buffer}}),e("./internal/operators/bufferCount")),ye=(Object.defineProperty(t,"bufferCount",{enumerable:!0,get:function(){return he.bufferCount}}),e("./internal/operators/bufferTime")),me=(Object.defineProperty(t,"bufferTime",{enumerable:!0,get:function(){return ye.bufferTime}}),e("./internal/operators/bufferToggle")),be=(Object.defineProperty(t,"bufferToggle",{enumerable:!0,get:function(){return me.bufferToggle}}),e("./internal/operators/bufferWhen")),ve=(Object.defineProperty(t,"bufferWhen",{enumerable:!0,get:function(){return be.bufferWhen}}),e("./internal/operators/catchError")),ge=(Object.defineProperty(t,"catchError",{enumerable:!0,get:function(){return ve.catchError}}),e("./internal/operators/combineAll")),Oe=(Object.defineProperty(t,"combineAll",{enumerable:!0,get:function(){return ge.combineAll}}),e("./internal/operators/combineLatestAll")),_e=(Object.defineProperty(t,"combineLatestAll",{enumerable:!0,get:function(){return Oe.combineLatestAll}}),e("./internal/operators/combineLatestWith")),we=(Object.defineProperty(t,"combineLatestWith",{enumerable:!0,get:function(){return _e.combineLatestWith}}),e("./internal/operators/concatAll")),Se=(Object.defineProperty(t,"concatAll",{enumerable:!0,get:function(){return we.concatAll}}),e("./internal/operators/concatMap")),xe=(Object.defineProperty(t,"concatMap",{enumerable:!0,get:function(){return Se.concatMap}}),e("./internal/operators/concatMapTo")),je=(Object.defineProperty(t,"concatMapTo",{enumerable:!0,get:function(){return xe.concatMapTo}}),e("./internal/operators/concatWith")),Pe=(Object.defineProperty(t,"concatWith",{enumerable:!0,get:function(){return je.concatWith}}),e("./internal/operators/connect")),Ee=(Object.defineProperty(t,"connect",{enumerable:!0,get:function(){return Pe.connect}}),e("./internal/operators/count")),Me=(Object.defineProperty(t,"count",{enumerable:!0,get:function(){return Ee.count}}),e("./internal/operators/debounce")),Ae=(Object.defineProperty(t,"debounce",{enumerable:!0,get:function(){return Me.debounce}}),e("./internal/operators/debounceTime")),Ie=(Object.defineProperty(t,"debounceTime",{enumerable:!0,get:function(){return Ae.debounceTime}}),e("./internal/operators/defaultIfEmpty")),ke=(Object.defineProperty(t,"defaultIfEmpty",{enumerable:!0,get:function(){return Ie.defaultIfEmpty}}),e("./internal/operators/delay")),Ce=(Object.defineProperty(t,"delay",{enumerable:!0,get:function(){return ke.delay}}),e("./internal/operators/delayWhen")),Re=(Object.defineProperty(t,"delayWhen",{enumerable:!0,get:function(){return Ce.delayWhen}}),e("./internal/operators/dematerialize")),De=(Object.defineProperty(t,"dematerialize",{enumerable:!0,get:function(){return Re.dematerialize}}),e("./internal/operators/distinct")),Ne=(Object.defineProperty(t,"distinct",{enumerable:!0,get:function(){return De.distinct}}),e("./internal/operators/distinctUntilChanged")),Te=(Object.defineProperty(t,"distinctUntilChanged",{enumerable:!0,get:function(){return Ne.distinctUntilChanged}}),e("./internal/operators/distinctUntilKeyChanged")),$e=(Object.defineProperty(t,"distinctUntilKeyChanged",{enumerable:!0,get:function(){return Te.distinctUntilKeyChanged}}),e("./internal/operators/elementAt")),Fe=(Object.defineProperty(t,"elementAt",{enumerable:!0,get:function(){return $e.elementAt}}),e("./internal/operators/endWith")),Le=(Object.defineProperty(t,"endWith",{enumerable:!0,get:function(){return Fe.endWith}}),e("./internal/operators/every")),Be=(Object.defineProperty(t,"every",{enumerable:!0,get:function(){return Le.every}}),e("./internal/operators/exhaust")),qe=(Object.defineProperty(t,"exhaust",{enumerable:!0,get:function(){return Be.exhaust}}),e("./internal/operators/exhaustAll")),Ue=(Object.defineProperty(t,"exhaustAll",{enumerable:!0,get:function(){return qe.exhaustAll}}),e("./internal/operators/exhaustMap")),We=(Object.defineProperty(t,"exhaustMap",{enumerable:!0,get:function(){return Ue.exhaustMap}}),e("./internal/operators/expand")),Ve=(Object.defineProperty(t,"expand",{enumerable:!0,get:function(){return We.expand}}),e("./internal/operators/filter")),ze=(Object.defineProperty(t,"filter",{enumerable:!0,get:function(){return Ve.filter}}),e("./internal/operators/finalize")),Ke=(Object.defineProperty(t,"finalize",{enumerable:!0,get:function(){return ze.finalize}}),e("./internal/operators/find")),Qe=(Object.defineProperty(t,"find",{enumerable:!0,get:function(){return Ke.find}}),e("./internal/operators/findIndex")),He=(Object.defineProperty(t,"findIndex",{enumerable:!0,get:function(){return Qe.findIndex}}),e("./internal/operators/first")),Ge=(Object.defineProperty(t,"first",{enumerable:!0,get:function(){return He.first}}),e("./internal/operators/groupBy")),Je=(Object.defineProperty(t,"groupBy",{enumerable:!0,get:function(){return Ge.groupBy}}),e("./internal/operators/ignoreElements")),Ye=(Object.defineProperty(t,"ignoreElements",{enumerable:!0,get:function(){return Je.ignoreElements}}),e("./internal/operators/isEmpty")),Xe=(Object.defineProperty(t,"isEmpty",{enumerable:!0,get:function(){return Ye.isEmpty}}),e("./internal/operators/last")),Ze=(Object.defineProperty(t,"last",{enumerable:!0,get:function(){return Xe.last}}),e("./internal/operators/map")),et=(Object.defineProperty(t,"map",{enumerable:!0,get:function(){return Ze.map}}),e("./internal/operators/mapTo")),tt=(Object.defineProperty(t,"mapTo",{enumerable:!0,get:function(){return et.mapTo}}),e("./internal/operators/materialize")),rt=(Object.defineProperty(t,"materialize",{enumerable:!0,get:function(){return tt.materialize}}),e("./internal/operators/max")),nt=(Object.defineProperty(t,"max",{enumerable:!0,get:function(){return rt.max}}),e("./internal/operators/mergeAll")),it=(Object.defineProperty(t,"mergeAll",{enumerable:!0,get:function(){return nt.mergeAll}}),e("./internal/operators/flatMap")),ot=(Object.defineProperty(t,"flatMap",{enumerable:!0,get:function(){return it.flatMap}}),e("./internal/operators/mergeMap")),at=(Object.defineProperty(t,"mergeMap",{enumerable:!0,get:function(){return ot.mergeMap}}),e("./internal/operators/mergeMapTo")),st=(Object.defineProperty(t,"mergeMapTo",{enumerable:!0,get:function(){return at.mergeMapTo}}),e("./internal/operators/mergeScan")),ut=(Object.defineProperty(t,"mergeScan",{enumerable:!0,get:function(){return st.mergeScan}}),e("./internal/operators/mergeWith")),ct=(Object.defineProperty(t,"mergeWith",{enumerable:!0,get:function(){return ut.mergeWith}}),e("./internal/operators/min")),lt=(Object.defineProperty(t,"min",{enumerable:!0,get:function(){return ct.min}}),e("./internal/operators/multicast")),ft=(Object.defineProperty(t,"multicast",{enumerable:!0,get:function(){return lt.multicast}}),e("./internal/operators/observeOn")),dt=(Object.defineProperty(t,"observeOn",{enumerable:!0,get:function(){return ft.observeOn}}),e("./internal/operators/onErrorResumeNextWith")),pt=(Object.defineProperty(t,"onErrorResumeNextWith",{enumerable:!0,get:function(){return dt.onErrorResumeNextWith}}),e("./internal/operators/pairwise")),ht=(Object.defineProperty(t,"pairwise",{enumerable:!0,get:function(){return pt.pairwise}}),e("./internal/operators/pluck")),yt=(Object.defineProperty(t,"pluck",{enumerable:!0,get:function(){return ht.pluck}}),e("./internal/operators/publish")),mt=(Object.defineProperty(t,"publish",{enumerable:!0,get:function(){return yt.publish}}),e("./internal/operators/publishBehavior")),bt=(Object.defineProperty(t,"publishBehavior",{enumerable:!0,get:function(){return mt.publishBehavior}}),e("./internal/operators/publishLast")),vt=(Object.defineProperty(t,"publishLast",{enumerable:!0,get:function(){return bt.publishLast}}),e("./internal/operators/publishReplay")),gt=(Object.defineProperty(t,"publishReplay",{enumerable:!0,get:function(){return vt.publishReplay}}),e("./internal/operators/raceWith")),Ot=(Object.defineProperty(t,"raceWith",{enumerable:!0,get:function(){return gt.raceWith}}),e("./internal/operators/reduce")),_t=(Object.defineProperty(t,"reduce",{enumerable:!0,get:function(){return Ot.reduce}}),e("./internal/operators/repeat")),wt=(Object.defineProperty(t,"repeat",{enumerable:!0,get:function(){return _t.repeat}}),e("./internal/operators/repeatWhen")),St=(Object.defineProperty(t,"repeatWhen",{enumerable:!0,get:function(){return wt.repeatWhen}}),e("./internal/operators/retry")),xt=(Object.defineProperty(t,"retry",{enumerable:!0,get:function(){return St.retry}}),e("./internal/operators/retryWhen")),jt=(Object.defineProperty(t,"retryWhen",{enumerable:!0,get:function(){return xt.retryWhen}}),e("./internal/operators/refCount")),Pt=(Object.defineProperty(t,"refCount",{enumerable:!0,get:function(){return jt.refCount}}),e("./internal/operators/sample")),Et=(Object.defineProperty(t,"sample",{enumerable:!0,get:function(){return Pt.sample}}),e("./internal/operators/sampleTime")),Mt=(Object.defineProperty(t,"sampleTime",{enumerable:!0,get:function(){return Et.sampleTime}}),e("./internal/operators/scan")),At=(Object.defineProperty(t,"scan",{enumerable:!0,get:function(){return Mt.scan}}),e("./internal/operators/sequenceEqual")),It=(Object.defineProperty(t,"sequenceEqual",{enumerable:!0,get:function(){return At.sequenceEqual}}),e("./internal/operators/share")),kt=(Object.defineProperty(t,"share",{enumerable:!0,get:function(){return It.share}}),e("./internal/operators/shareReplay")),Ct=(Object.defineProperty(t,"shareReplay",{enumerable:!0,get:function(){return kt.shareReplay}}),e("./internal/operators/single")),Rt=(Object.defineProperty(t,"single",{enumerable:!0,get:function(){return Ct.single}}),e("./internal/operators/skip")),Dt=(Object.defineProperty(t,"skip",{enumerable:!0,get:function(){return Rt.skip}}),e("./internal/operators/skipLast")),Nt=(Object.defineProperty(t,"skipLast",{enumerable:!0,get:function(){return Dt.skipLast}}),e("./internal/operators/skipUntil")),Tt=(Object.defineProperty(t,"skipUntil",{enumerable:!0,get:function(){return Nt.skipUntil}}),e("./internal/operators/skipWhile")),$t=(Object.defineProperty(t,"skipWhile",{enumerable:!0,get:function(){return Tt.skipWhile}}),e("./internal/operators/startWith")),Ft=(Object.defineProperty(t,"startWith",{enumerable:!0,get:function(){return $t.startWith}}),e("./internal/operators/subscribeOn")),Lt=(Object.defineProperty(t,"subscribeOn",{enumerable:!0,get:function(){return Ft.subscribeOn}}),e("./internal/operators/switchAll")),Bt=(Object.defineProperty(t,"switchAll",{enumerable:!0,get:function(){return Lt.switchAll}}),e("./internal/operators/switchMap")),qt=(Object.defineProperty(t,"switchMap",{enumerable:!0,get:function(){return Bt.switchMap}}),e("./internal/operators/switchMapTo")),Ut=(Object.defineProperty(t,"switchMapTo",{enumerable:!0,get:function(){return qt.switchMapTo}}),e("./internal/operators/switchScan")),Wt=(Object.defineProperty(t,"switchScan",{enumerable:!0,get:function(){return Ut.switchScan}}),e("./internal/operators/take")),Vt=(Object.defineProperty(t,"take",{enumerable:!0,get:function(){return Wt.take}}),e("./internal/operators/takeLast")),zt=(Object.defineProperty(t,"takeLast",{enumerable:!0,get:function(){return Vt.takeLast}}),e("./internal/operators/takeUntil")),Kt=(Object.defineProperty(t,"takeUntil",{enumerable:!0,get:function(){return zt.takeUntil}}),e("./internal/operators/takeWhile")),Qt=(Object.defineProperty(t,"takeWhile",{enumerable:!0,get:function(){return Kt.takeWhile}}),e("./internal/operators/tap")),Ht=(Object.defineProperty(t,"tap",{enumerable:!0,get:function(){return Qt.tap}}),e("./internal/operators/throttle")),Gt=(Object.defineProperty(t,"throttle",{enumerable:!0,get:function(){return Ht.throttle}}),e("./internal/operators/throttleTime")),Jt=(Object.defineProperty(t,"throttleTime",{enumerable:!0,get:function(){return Gt.throttleTime}}),e("./internal/operators/throwIfEmpty")),Yt=(Object.defineProperty(t,"throwIfEmpty",{enumerable:!0,get:function(){return Jt.throwIfEmpty}}),e("./internal/operators/timeInterval")),Xt=(Object.defineProperty(t,"timeInterval",{enumerable:!0,get:function(){return Yt.timeInterval}}),e("./internal/operators/timeout")),Zt=(Object.defineProperty(t,"timeout",{enumerable:!0,get:function(){return Xt.timeout}}),e("./internal/operators/timeoutWith")),er=(Object.defineProperty(t,"timeoutWith",{enumerable:!0,get:function(){return Zt.timeoutWith}}),e("./internal/operators/timestamp")),tr=(Object.defineProperty(t,"timestamp",{enumerable:!0,get:function(){return er.timestamp}}),e("./internal/operators/toArray")),rr=(Object.defineProperty(t,"toArray",{enumerable:!0,get:function(){return tr.toArray}}),e("./internal/operators/window")),nr=(Object.defineProperty(t,"window",{enumerable:!0,get:function(){return rr.window}}),e("./internal/operators/windowCount")),ir=(Object.defineProperty(t,"windowCount",{enumerable:!0,get:function(){return nr.windowCount}}),e("./internal/operators/windowTime")),or=(Object.defineProperty(t,"windowTime",{enumerable:!0,get:function(){return ir.windowTime}}),e("./internal/operators/windowToggle")),ar=(Object.defineProperty(t,"windowToggle",{enumerable:!0,get:function(){return or.windowToggle}}),e("./internal/operators/windowWhen")),sr=(Object.defineProperty(t,"windowWhen",{enumerable:!0,get:function(){return ar.windowWhen}}),e("./internal/operators/withLatestFrom")),ur=(Object.defineProperty(t,"withLatestFrom",{enumerable:!0,get:function(){return sr.withLatestFrom}}),e("./internal/operators/zipAll")),cr=(Object.defineProperty(t,"zipAll",{enumerable:!0,get:function(){return ur.zipAll}}),e("./internal/operators/zipWith"));Object.defineProperty(t,"zipWith",{enumerable:!0,get:function(){return cr.zipWith}})},{"./internal/AsyncSubject":416,"./internal/BehaviorSubject":417,"./internal/Notification":418,"./internal/Observable":420,"./internal/ReplaySubject":421,"./internal/Scheduler":422,"./internal/Subject":423,"./internal/Subscriber":424,"./internal/Subscription":425,"./internal/config":426,"./internal/firstValueFrom":427,"./internal/lastValueFrom":428,"./internal/observable/ConnectableObservable":429,"./internal/observable/bindCallback":430,"./internal/observable/bindNodeCallback":432,"./internal/observable/combineLatest":433,"./internal/observable/concat":434,"./internal/observable/connectable":435,"./internal/observable/defer":436,"./internal/observable/dom/animationFrames":437,"./internal/observable/empty":438,"./internal/observable/forkJoin":439,"./internal/observable/from":440,"./internal/observable/fromEvent":441,"./internal/observable/fromEventPattern":442,"./internal/observable/generate":444,"./internal/observable/iif":445,"./internal/observable/interval":447,"./internal/observable/merge":448,"./internal/observable/never":449,"./internal/observable/of":450,"./internal/observable/onErrorResumeNext":451,"./internal/observable/pairs":452,"./internal/observable/partition":453,"./internal/observable/race":454,"./internal/observable/range":455,"./internal/observable/throwError":456,"./internal/observable/timer":457,"./internal/observable/using":458,"./internal/observable/zip":459,"./internal/operators/audit":461,"./internal/operators/auditTime":462,"./internal/operators/buffer":463,"./internal/operators/bufferCount":464,"./internal/operators/bufferTime":465,"./internal/operators/bufferToggle":466,"./internal/operators/bufferWhen":467,"./internal/operators/catchError":468,"./internal/operators/combineAll":469,"./internal/operators/combineLatestAll":471,"./internal/operators/combineLatestWith":472,"./internal/operators/concatAll":474,"./internal/operators/concatMap":475,"./internal/operators/concatMapTo":476,"./internal/operators/concatWith":477,"./internal/operators/connect":478,"./internal/operators/count":479,"./internal/operators/debounce":480,"./internal/operators/debounceTime":481,"./internal/operators/defaultIfEmpty":482,"./internal/operators/delay":483,"./internal/operators/delayWhen":484,"./internal/operators/dematerialize":485,"./internal/operators/distinct":486,"./internal/operators/distinctUntilChanged":487,"./internal/operators/distinctUntilKeyChanged":488,"./internal/operators/elementAt":489,"./internal/operators/endWith":490,"./internal/operators/every":491,"./internal/operators/exhaust":492,"./internal/operators/exhaustAll":493,"./internal/operators/exhaustMap":494,"./internal/operators/expand":495,"./internal/operators/filter":496,"./internal/operators/finalize":497,"./internal/operators/find":498,"./internal/operators/findIndex":499,"./internal/operators/first":500,"./internal/operators/flatMap":501,"./internal/operators/groupBy":502,"./internal/operators/ignoreElements":503,"./internal/operators/isEmpty":504,"./internal/operators/last":506,"./internal/operators/map":507,"./internal/operators/mapTo":508,"./internal/operators/materialize":509,"./internal/operators/max":510,"./internal/operators/mergeAll":512,"./internal/operators/mergeMap":514,"./internal/operators/mergeMapTo":515,"./internal/operators/mergeScan":516,"./internal/operators/mergeWith":517,"./internal/operators/min":518,"./internal/operators/multicast":519,"./internal/operators/observeOn":520,"./internal/operators/onErrorResumeNextWith":521,"./internal/operators/pairwise":522,"./internal/operators/pluck":524,"./internal/operators/publish":525,"./internal/operators/publishBehavior":526,"./internal/operators/publishLast":527,"./internal/operators/publishReplay":528,"./internal/operators/raceWith":530,"./internal/operators/reduce":531,"./internal/operators/refCount":532,"./internal/operators/repeat":533,"./internal/operators/repeatWhen":534,"./internal/operators/retry":535,"./internal/operators/retryWhen":536,"./internal/operators/sample":537,"./internal/operators/sampleTime":538,"./internal/operators/scan":539,"./internal/operators/sequenceEqual":541,"./internal/operators/share":542,"./internal/operators/shareReplay":543,"./internal/operators/single":544,"./internal/operators/skip":545,"./internal/operators/skipLast":546,"./internal/operators/skipUntil":547,"./internal/operators/skipWhile":548,"./internal/operators/startWith":549,"./internal/operators/subscribeOn":550,"./internal/operators/switchAll":551,"./internal/operators/switchMap":552,"./internal/operators/switchMapTo":553,"./internal/operators/switchScan":554,"./internal/operators/take":555,"./internal/operators/takeLast":556,"./internal/operators/takeUntil":557,"./internal/operators/takeWhile":558,"./internal/operators/tap":559,"./internal/operators/throttle":560,"./internal/operators/throttleTime":561,"./internal/operators/throwIfEmpty":562,"./internal/operators/timeInterval":563,"./internal/operators/timeout":564,"./internal/operators/timeoutWith":565,"./internal/operators/timestamp":566,"./internal/operators/toArray":567,"./internal/operators/window":568,"./internal/operators/windowCount":569,"./internal/operators/windowTime":570,"./internal/operators/windowToggle":571,"./internal/operators/windowWhen":572,"./internal/operators/withLatestFrom":573,"./internal/operators/zipAll":575,"./internal/operators/zipWith":576,"./internal/scheduled/scheduled":583,"./internal/scheduler/VirtualTimeScheduler":593,"./internal/scheduler/animationFrame":594,"./internal/scheduler/asap":596,"./internal/scheduler/async":597,"./internal/scheduler/queue":602,"./internal/symbol/observable":605,"./internal/types":606,"./internal/util/ArgumentOutOfRangeError":607,"./internal/util/EmptyError":608,"./internal/util/NotFoundError":610,"./internal/util/ObjectUnsubscribedError":611,"./internal/util/SequenceError":612,"./internal/util/UnsubscriptionError":613,"./internal/util/identity":622,"./internal/util/isObservable":629,"./internal/util/noop":635,"./internal/util/pipe":637}],416:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),e=(Object.defineProperty(r,"__esModule",{value:!0}),r.AsyncSubject=void 0,e("./Subject")),e=(i=e.Subject,o(a,i),a.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,r=this._hasValue,n=this._value,i=this.thrownError,o=this.isStopped,a=this._isComplete;t?e.error(i):(o||a)&&(r&&e.next(n),e.complete())},a.prototype.next=function(e){this.isStopped||(this._value=e,this._hasValue=!0)},a.prototype.complete=function(){var e=this._hasValue,t=this._value;this._isComplete||(this._isComplete=!0,e&&i.prototype.next.call(this,t),i.prototype.complete.call(this))},a);function a(){var e=null!==i&&i.apply(this,arguments)||this;return e._value=null,e._hasValue=!1,e._isComplete=!1,e}r.AsyncSubject=e},{"./Subject":423}],417:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),e=(Object.defineProperty(r,"__esModule",{value:!0}),r.BehaviorSubject=void 0,e("./Subject")),e=(i=e.Subject,o(a,i),Object.defineProperty(a.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),a.prototype._subscribe=function(e){var t=i.prototype._subscribe.call(this,e);return t.closed||e.next(this._value),t},a.prototype.getValue=function(){var e=this.hasError,t=this.thrownError,r=this._value;if(e)throw t;return this._throwIfClosed(),r},a.prototype.next=function(e){i.prototype.next.call(this,this._value=e)},a);function a(e){var t=i.call(this)||this;return t._value=e,t}r.BehaviorSubject=e},{"./Subject":423}],418:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.observeNotification=r.Notification=r.NotificationKind=void 0;var n=e("./observable/empty"),i=e("./observable/of"),o=e("./observable/throwError"),a=e("./util/isFunction"),e=((e=r.NotificationKind||(r.NotificationKind={})).NEXT="N",e.ERROR="E",e.COMPLETE="C",s.prototype.observe=function(e){return u(this,e)},s.prototype.do=function(e,t,r){var n=this.kind,i=this.value,o=this.error;return"N"===n?null==e?void 0:e(i):"E"===n?null==t?void 0:t(o):null==r?void 0:r()},s.prototype.accept=function(e,t,r){var n;return a.isFunction(null==(n=e)?void 0:n.next)?this.observe(e):this.do(e,t,r)},s.prototype.toObservable=function(){var e=this.kind,t=this.value,r=this.error,t="N"===e?i.of(t):"E"===e?o.throwError(function(){return r}):"C"===e?n.EMPTY:0;if(t)return t;throw new TypeError("Unexpected notification kind "+e)},s.createNext=function(e){return new s("N",e)},s.createError=function(e){return new s("E",void 0,e)},s.createComplete=function(){return s.completeNotification},s.completeNotification=new s("C"),s);function s(e,t,r){this.kind=e,this.value=t,this.error=r,this.hasValue="N"===e}function u(e,t){var r,n=e.kind,i=e.value,e=e.error;if("string"!=typeof n)throw new TypeError('Invalid notification, missing "kind"');"N"===n?null!=(r=t.next)&&r.call(t,i):"E"===n?null!=(r=t.error)&&r.call(t,e):null!=(i=t.complete)&&i.call(t)}r.Notification=e,r.observeNotification=u},{"./observable/empty":438,"./observable/of":450,"./observable/throwError":456,"./util/isFunction":626}],419:[function(e,t,r){"use strict";function n(e,t,r){return{kind:e,value:t,error:r}}Object.defineProperty(r,"__esModule",{value:!0}),r.createNotification=r.nextNotification=r.errorNotification=r.COMPLETE_NOTIFICATION=void 0,r.COMPLETE_NOTIFICATION=n("C",void 0,void 0),r.errorNotification=function(e){return n("E",void 0,e)},r.nextNotification=function(e){return n("N",e,void 0)},r.createNotification=n},{}],420:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Observable=void 0;var a=e("./Subscriber"),s=e("./Subscription"),n=e("./symbol/observable"),i=e("./util/pipe"),o=e("./config"),u=e("./util/isFunction"),c=e("./util/errorContext");function l(e){e&&(this._subscribe=e)}function f(e){return null!=(e=null!=e?e:o.config.Promise)?e:Promise}l.prototype.lift=function(e){var t=new l;return t.source=this,t.operator=e,t},l.prototype.subscribe=function(e,t,r){var n,i=this,o=(n=e)&&n instanceof a.Subscriber||function(e){return e&&u.isFunction(e.next)&&u.isFunction(e.error)&&u.isFunction(e.complete)}(n)&&s.isSubscription(n)?e:new a.SafeSubscriber(e,t,r);return c.errorContext(function(){var e=i.operator,t=i.source;o.add(e?e.call(o,t):t?i._subscribe(o):i._trySubscribe(o))}),o},l.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},l.prototype.forEach=function(n,e){var i=this;return new(e=f(e))(function(e,t){var r=new a.SafeSubscriber({next:function(e){try{n(e)}catch(e){t(e),r.unsubscribe()}},error:t,complete:e});i.subscribe(r)})},l.prototype._subscribe=function(e){var t;return null==(t=this.source)?void 0:t.subscribe(e)},l.prototype[n.observable]=function(){return this},l.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.pipeFromArray(e)(this)},l.prototype.toPromise=function(e){var n=this;return new(e=f(e))(function(e,t){var r;n.subscribe(function(e){return r=e},function(e){return t(e)},function(){return e(r)})})},l.create=function(e){return new l(e)},r.Observable=l},{"./Subscriber":424,"./Subscription":425,"./config":426,"./symbol/observable":605,"./util/errorContext":620,"./util/isFunction":626,"./util/pipe":637}],421:[function(e,t,r){"use strict";var n,a,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=(Object.defineProperty(r,"__esModule",{value:!0}),r.ReplaySubject=void 0,e("./Subject")),s=e("./scheduler/dateTimestampProvider"),e=(a=o.Subject,i(u,a),u.prototype.next=function(e){var t=this.isStopped,r=this._buffer,n=this._infiniteTimeWindow,i=this._timestampProvider,o=this._windowTime;t||(r.push(e),n)||r.push(i.now()+o),this._trimBuffer(),a.prototype.next.call(this,e)},u.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),r=this._infiniteTimeWindow,n=this._buffer.slice(),i=0;i<n.length&&!e.closed;i+=r?1:2)e.next(n[i]);return this._checkFinalizedStatuses(e),t},u.prototype._trimBuffer=function(){var e=this._bufferSize,t=this._timestampProvider,r=this._buffer,n=this._infiniteTimeWindow,i=(n?1:2)*e;if(e<1/0&&i<r.length&&r.splice(0,r.length-i),!n){for(var o=t.now(),a=0,s=1;s<r.length&&r[s]<=o;s+=2)a=s;a&&r.splice(0,a+1)}},u);function u(e,t,r){void 0===e&&(e=1/0),void 0===t&&(t=1/0),void 0===r&&(r=s.dateTimestampProvider);var n=a.call(this)||this;return n._bufferSize=e,n._windowTime=t,n._timestampProvider=r,n._buffer=[],n._infiniteTimeWindow=!0,n._infiniteTimeWindow=t===1/0,n._bufferSize=Math.max(1,e),n._windowTime=Math.max(1,t),n}r.ReplaySubject=e},{"./Subject":423,"./scheduler/dateTimestampProvider":598}],422:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Scheduler=void 0;e=e("./scheduler/dateTimestampProvider");function n(e,t){void 0===t&&(t=n.now),this.schedulerActionCtor=e,this.now=t}n.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=e.dateTimestampProvider.now,r.Scheduler=n},{"./scheduler/dateTimestampProvider":598}],423:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=(Object.defineProperty(r,"__esModule",{value:!0}),r.AnonymousSubject=r.Subject=void 0,e("./Observable")),u=e("./Subscription"),c=e("./util/ObjectUnsubscribedError"),l=e("./util/arrRemove"),f=e("./util/errorContext"),e=(i=s.Observable,o(d,i),d.prototype.lift=function(e){var t=new h(this,this);return t.operator=e,t},d.prototype._throwIfClosed=function(){if(this.closed)throw new c.ObjectUnsubscribedError},d.prototype.next=function(i){var o=this;f.errorContext(function(){var t,e;if(o._throwIfClosed(),!o.isStopped){o.currentObservers||(o.currentObservers=Array.from(o.observers));try{for(var r=a(o.currentObservers),n=r.next();!n.done;n=r.next())n.value.next(i)}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}}})},d.prototype.error=function(t){var r=this;f.errorContext(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var e=r.observers;e.length;)e.shift().error(t)}})},d.prototype.complete=function(){var t=this;f.errorContext(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}})},d.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(d.prototype,"observed",{get:function(){var e;return 0<(null==(e=this.observers)?void 0:e.length)},enumerable:!1,configurable:!0}),d.prototype._trySubscribe=function(e){return this._throwIfClosed(),i.prototype._trySubscribe.call(this,e)},d.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},d.prototype._innerSubscribe=function(e){var t=this,r=this.hasError,n=this.isStopped,i=this.observers;return r||n?u.EMPTY_SUBSCRIPTION:(this.currentObservers=null,i.push(e),new u.Subscription(function(){t.currentObservers=null,l.arrRemove(i,e)}))},d.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,r=this.thrownError,n=this.isStopped;t?e.error(r):n&&e.complete()},d.prototype.asObservable=function(){var e=new s.Observable;return e.source=this,e},d.create=function(e,t){return new h(e,t)},d);function d(){var e=i.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}r.Subject=e;o(y,p=e),y.prototype.next=function(e){var t,r;null!=(r=null==(t=this.destination)?void 0:t.next)&&r.call(t,e)},y.prototype.error=function(e){var t,r;null!=(r=null==(t=this.destination)?void 0:t.error)&&r.call(t,e)},y.prototype.complete=function(){var e,t;null!=(t=null==(e=this.destination)?void 0:e.complete)&&t.call(e)},y.prototype._subscribe=function(e){var t;return null!=(t=null==(t=this.source)?void 0:t.subscribe(e))?t:u.EMPTY_SUBSCRIPTION};var p,h=y;function y(e,t){var r=p.call(this)||this;return r.destination=e,r.source=t,r}r.AnonymousSubject=h},{"./Observable":420,"./Subscription":425,"./util/ObjectUnsubscribedError":611,"./util/arrRemove":617,"./util/errorContext":620}],424:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=(Object.defineProperty(r,"__esModule",{value:!0}),r.EMPTY_OBSERVER=r.SafeSubscriber=r.Subscriber=void 0,e("./util/isFunction")),s=e("./Subscription"),u=e("./config"),c=e("./util/reportUnhandledError"),l=e("./util/noop"),f=e("./NotificationFactories"),d=e("./scheduler/timeoutProvider"),p=e("./util/errorContext"),e=(i=s.Subscription,o(h,i),h.create=function(e,t,r){return new O(e,t,r)},h.prototype.next=function(e){this.isStopped?S(f.nextNotification(e),this):this._next(e)},h.prototype.error=function(e){this.isStopped?S(f.errorNotification(e),this):(this.isStopped=!0,this._error(e))},h.prototype.complete=function(){this.isStopped?S(f.COMPLETE_NOTIFICATION,this):(this.isStopped=!0,this._complete())},h.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,i.prototype.unsubscribe.call(this),this.destination=null)},h.prototype._next=function(e){this.destination.next(e)},h.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},h.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},h);function h(e){var t=i.call(this)||this;return t.isStopped=!1,e?(t.destination=e,s.isSubscription(e)&&e.add(t)):t.destination=r.EMPTY_OBSERVER,t}r.Subscriber=e;var y=Function.prototype.bind;function m(e,t){return y.call(e,t)}v.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){w(e)}},v.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){w(e)}else w(e)},v.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){w(e)}};var b=v;function v(e){this.partialObserver=e}o(_,g=e);var g,O=_;function _(e,t,r){var n=g.call(this)||this;return r=a.isFunction(e)||!e?{next:null!=e?e:void 0,error:null!=t?t:void 0,complete:null!=r?r:void 0}:n&&u.config.useDeprecatedNextContext?((t=Object.create(e)).unsubscribe=function(){return n.unsubscribe()},{next:e.next&&m(e.next,t),error:e.error&&m(e.error,t),complete:e.complete&&m(e.complete,t)}):e,n.destination=new b(r),n}function w(e){u.config.useDeprecatedSynchronousErrorHandling?p.captureError(e):c.reportUnhandledError(e)}function S(e,t){var r=u.config.onStoppedNotification;r&&d.timeoutProvider.setTimeout(function(){return r(e,t)})}r.SafeSubscriber=O,r.EMPTY_OBSERVER={closed:!0,next:l.noop,error:function(e){throw e},complete:l.noop}},{"./NotificationFactories":419,"./Subscription":425,"./config":426,"./scheduler/timeoutProvider":603,"./util/errorContext":620,"./util/isFunction":626,"./util/noop":635,"./util/reportUnhandledError":638}],425:[function(e,t,r){"use strict";var f=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},d=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},p=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},h=(Object.defineProperty(r,"__esModule",{value:!0}),r.isSubscription=r.EMPTY_SUBSCRIPTION=r.Subscription=void 0,e("./util/isFunction")),y=e("./util/UnsubscriptionError"),n=e("./util/arrRemove"),i=(o.prototype.unsubscribe=function(){var t,e,r;if(!this.closed){this.closed=!0;var n=this._parentage;if(n)if(this._parentage=null,Array.isArray(n))try{for(var i=f(n),o=i.next();!o.done;o=i.next())o.value.remove(this)}catch(e){s={error:e}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(s)throw s.error}}else n.remove(this);var a=this.initialTeardown;if(h.isFunction(a))try{a()}catch(e){r=e instanceof y.UnsubscriptionError?e.errors:[e]}var s=this._finalizers;if(s){this._finalizers=null;try{for(var u=f(s),c=u.next();!c.done;c=u.next()){var l=c.value;try{m(l)}catch(e){r=null!=r?r:[],e instanceof y.UnsubscriptionError?r=p(p([],d(r)),d(e.errors)):r.push(e)}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(e=u.return)&&e.call(u)}finally{if(t)throw t.error}}}if(r)throw new y.UnsubscriptionError(r)}},o.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)m(e);else{if(e instanceof o){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!=(t=this._finalizers)?t:[]).push(e)}},o.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},o.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},o.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&n.arrRemove(t,e)},o.prototype.remove=function(e){var t=this._finalizers;t&&n.arrRemove(t,e),e instanceof o&&e._removeParent(this)},o.EMPTY=((e=new o).closed=!0,e),o);function o(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}function m(e){h.isFunction(e)?e():e.unsubscribe()}r.Subscription=i,r.EMPTY_SUBSCRIPTION=i.EMPTY,r.isSubscription=function(e){return e instanceof i||e&&"closed"in e&&h.isFunction(e.remove)&&h.isFunction(e.add)&&h.isFunction(e.unsubscribe)}},{"./util/UnsubscriptionError":613,"./util/arrRemove":617,"./util/isFunction":626}],426:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.config=void 0,r.config={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},{}],427:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.firstValueFrom=void 0;var a=e("./util/EmptyError"),s=e("./Subscriber");r.firstValueFrom=function(n,i){var o="object"==typeof i;return new Promise(function(t,e){var r=new s.SafeSubscriber({next:function(e){t(e),r.unsubscribe()},error:e,complete:function(){o?t(i.defaultValue):e(new a.EmptyError)}});n.subscribe(r)})}},{"./Subscriber":424,"./util/EmptyError":608}],428:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.lastValueFrom=void 0;var s=e("./util/EmptyError");r.lastValueFrom=function(i,o){var a="object"==typeof o;return new Promise(function(e,t){var r,n=!1;i.subscribe({next:function(e){r=e,n=!0},error:t,complete:function(){n?e(r):a?e(o.defaultValue):t(new s.EmptyError)}})})}},{"./util/EmptyError":608}],429:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=(Object.defineProperty(r,"__esModule",{value:!0}),r.ConnectableObservable=void 0,e("../Observable")),s=e("../Subscription"),u=e("../operators/refCount"),c=e("../operators/OperatorSubscriber"),l=e("../util/lift"),e=(i=a.Observable,o(f,i),f.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},f.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},f.prototype._teardown=function(){this._refCount=0;var e=this._connection;(this._subject=this._connection=null)!=e&&e.unsubscribe()},f.prototype.connect=function(){var t,r=this,e=this._connection;return e||(e=this._connection=new s.Subscription,t=this.getSubject(),e.add(this.source.subscribe(c.createOperatorSubscriber(t,void 0,function(){r._teardown(),t.complete()},function(e){r._teardown(),t.error(e)},function(){return r._teardown()}))),e.closed&&(this._connection=null,e=s.Subscription.EMPTY)),e},f.prototype.refCount=function(){return u.refCount()(this)},f);function f(e,t){var r=i.call(this)||this;return r.source=e,r.subjectFactory=t,r._subject=null,r._refCount=0,r._connection=null,l.hasLift(e)&&(r.lift=e.lift),r}r.ConnectableObservable=e},{"../Observable":420,"../Subscription":425,"../operators/OperatorSubscriber":460,"../operators/refCount":532,"../util/lift":633}],430:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.bindCallback=void 0;var n=e("./bindCallbackInternals");r.bindCallback=function(e,t,r){return n.bindCallbackInternals(!1,e,t,r)}},{"./bindCallbackInternals":431}],431:[function(e,t,r){"use strict";var c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},l=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},o=(Object.defineProperty(r,"__esModule",{value:!0}),r.bindCallbackInternals=void 0,e("../util/isScheduler")),f=e("../Observable"),a=e("../operators/subscribeOn"),d=e("../util/mapOneOrManyArgs"),p=e("../operators/observeOn"),h=e("../AsyncSubject");r.bindCallbackInternals=function r(s,u,n,i){if(n){if(!o.isScheduler(n))return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(s,u,i).apply(this,e).pipe(d.mapOneOrManyArgs(n))};i=n}return i?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(s,u).apply(this,e).pipe(a.subscribeOn(i),p.observeOn(i))}:function(){for(var t=this,r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var o=new h.AsyncSubject,a=!0;return new f.Observable(function(e){var n,i,e=o.subscribe(e);return a&&(n=a=!1,i=!1,u.apply(t,l(l([],c(r)),[function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(s){var r=e.shift();if(null!=r)return void o.error(r)}o.next(1<e.length?e:e[0]),i=!0,n&&o.complete()}])),i&&o.complete(),n=!0),e})}}},{"../AsyncSubject":416,"../Observable":420,"../operators/observeOn":520,"../operators/subscribeOn":550,"../util/isScheduler":632,"../util/mapOneOrManyArgs":634}],432:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.bindNodeCallback=void 0;var n=e("./bindCallbackInternals");r.bindNodeCallback=function(e,t,r){return n.bindCallbackInternals(!0,e,t,r)}},{"./bindCallbackInternals":431}],433:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.combineLatestInit=r.combineLatest=void 0;var s=e("../Observable"),u=e("../util/argsArgArrayOrObject"),l=e("./from"),f=e("../util/identity"),c=e("../util/mapOneOrManyArgs"),d=e("../util/args"),p=e("../util/createObject"),h=e("../operators/OperatorSubscriber"),n=e("../util/executeSchedule");function y(s,u,c){return void 0===c&&(c=f.identity),function(a){m(u,function(){for(var e=s.length,n=new Array(e),i=e,o=e,t=0;t<e;t++)!function(r){m(u,function(){var e=l.from(s[r],u),t=!1;e.subscribe(h.createOperatorSubscriber(a,function(e){n[r]=e,t||(t=!0,o--),o||a.next(c(n.slice()))},function(){--i||a.complete()}))},a)}(t)},a)}}function m(e,t,r){e?n.executeSchedule(r,e,t):t()}r.combineLatest=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=d.popScheduler(e),n=d.popResultSelector(e),i=u.argsArgArrayOrObject(e),o=i.args,a=i.keys;return 0===o.length?l.from([],r):(i=new s.Observable(y(o,r,a?function(e){return p.createObject(a,e)}:f.identity)),n?i.pipe(c.mapOneOrManyArgs(n)):i)},r.combineLatestInit=y},{"../Observable":420,"../operators/OperatorSubscriber":460,"../util/args":614,"../util/argsArgArrayOrObject":615,"../util/createObject":619,"../util/executeSchedule":621,"../util/identity":622,"../util/mapOneOrManyArgs":634,"./from":440}],434:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.concat=void 0;var n=e("../operators/concatAll"),i=e("../util/args"),o=e("./from");r.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.concatAll()(o.from(e,i.popScheduler(e)))}},{"../operators/concatAll":474,"../util/args":614,"./from":440}],435:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.connectable=void 0;var n=e("../Subject"),a=e("../Observable"),s=e("./defer"),u={connector:function(){return new n.Subject},resetOnDisconnect:!0};r.connectable=function(e,t){var r=null,n=(t=void 0===t?u:t).connector,i=void 0===(t=t.resetOnDisconnect)||t,o=n();return(t=new a.Observable(function(e){return o.subscribe(e)})).connect=function(){return r&&!r.closed||(r=s.defer(function(){return e}).subscribe(o),i&&r.add(function(){return o=n()})),r},t}},{"../Observable":420,"../Subject":423,"./defer":436}],436:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defer=void 0;var n=e("../Observable"),i=e("./innerFrom");r.defer=function(t){return new n.Observable(function(e){i.innerFrom(t()).subscribe(e)})}},{"../Observable":420,"./innerFrom":446}],437:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.animationFrames=void 0;var n=e("../../Observable"),u=e("../../scheduler/performanceTimestampProvider"),c=e("../../scheduler/animationFrameProvider");function i(s){return new n.Observable(function(r){var n=s||u.performanceTimestampProvider,i=n.now(),o=0,a=function(){r.closed||(o=c.animationFrameProvider.requestAnimationFrame(function(e){o=0;var t=n.now();r.next({timestamp:s?t:e,elapsed:t-i}),a()}))};return a(),function(){o&&c.animationFrameProvider.cancelAnimationFrame(o)}})}r.animationFrames=function(e){return e?i(e):o};var o=i()},{"../../Observable":420,"../../scheduler/animationFrameProvider":595,"../../scheduler/performanceTimestampProvider":601}],438:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.empty=r.EMPTY=void 0;var n=e("../Observable");r.EMPTY=new n.Observable(function(e){return e.complete()}),r.empty=function(e){return e?(t=e,new n.Observable(function(e){return t.schedule(function(){return e.complete()})})):r.EMPTY;var t}},{"../Observable":420}],439:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.forkJoin=void 0;var i=e("../Observable"),o=e("../util/argsArgArrayOrObject"),u=e("./innerFrom"),c=e("../util/args"),l=e("../operators/OperatorSubscriber"),f=e("../util/mapOneOrManyArgs"),d=e("../util/createObject");r.forkJoin=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=c.popResultSelector(e),a=(n=o.argsArgArrayOrObject(e)).args,s=n.keys,n=new i.Observable(function(e){var t=a.length;if(t)for(var n=new Array(t),i=t,o=t,r=0;r<t;r++)!function(t){var r=!1;u.innerFrom(a[t]).subscribe(l.createOperatorSubscriber(e,function(e){r||(r=!0,o--),n[t]=e},function(){return i--},void 0,function(){i&&r||(o||e.next(s?d.createObject(s,n):n),e.complete())}))}(r);else e.complete()});return r?n.pipe(f.mapOneOrManyArgs(r)):n}},{"../Observable":420,"../operators/OperatorSubscriber":460,"../util/args":614,"../util/argsArgArrayOrObject":615,"../util/createObject":619,"../util/mapOneOrManyArgs":634,"./innerFrom":446}],440:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.from=void 0;var n=e("../scheduled/scheduled"),i=e("./innerFrom");r.from=function(e,t){return t?n.scheduled(e,t):i.innerFrom(e)}},{"../scheduled/scheduled":583,"./innerFrom":446}],441:[function(e,t,r){"use strict";var s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},u=(Object.defineProperty(r,"__esModule",{value:!0}),r.fromEvent=void 0,e("../observable/innerFrom")),c=e("../Observable"),l=e("../operators/mergeMap"),f=e("../util/isArrayLike"),d=e("../util/isFunction"),p=e("../util/mapOneOrManyArgs"),h=["addListener","removeListener"],y=["addEventListener","removeEventListener"],m=["on","off"];function b(r,n){return function(t){return function(e){return r[t](n,e)}}}r.fromEvent=function t(r,n,i,e){if(d.isFunction(i)&&(e=i,i=void 0),e)return t(r,n,i).pipe(p.mapOneOrManyArgs(e));var e=s((e=r,d.isFunction(e.addEventListener)&&d.isFunction(e.removeEventListener)?y.map(function(t){return function(e){return r[t](n,e,i)}}):(e=r,d.isFunction(e.addListener)&&d.isFunction(e.removeListener)?h.map(b(r,n)):(e=r,d.isFunction(e.on)&&d.isFunction(e.off)?m.map(b(r,n)):[]))),2),o=e[0],a=e[1];if(!o&&f.isArrayLike(r))return l.mergeMap(function(e){return t(e,n,i)})(u.innerFrom(r));if(o)return new c.Observable(function(r){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.next(1<e.length?e:e[0])}return o(e),function(){return a(e)}});throw new TypeError("Invalid event target")}},{"../Observable":420,"../observable/innerFrom":446,"../operators/mergeMap":514,"../util/isArrayLike":623,"../util/isFunction":626,"../util/mapOneOrManyArgs":634}],442:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fromEventPattern=void 0;var o=e("../Observable"),a=e("../util/isFunction"),s=e("../util/mapOneOrManyArgs");r.fromEventPattern=function e(n,i,t){return t?e(n,i).pipe(s.mapOneOrManyArgs(t)):new o.Observable(function(r){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.next(1===e.length?e[0]:e)}var t=n(e);return a.isFunction(i)?function(){return i(e,t)}:void 0})}},{"../Observable":420,"../util/isFunction":626,"../util/mapOneOrManyArgs":634}],443:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fromSubscribable=void 0;var n=e("../Observable");r.fromSubscribable=function(t){return new n.Observable(function(e){return t.subscribe(e)})}},{"../Observable":420}],444:[function(e,t,r){"use strict";var c=this&&this.__generator||function(n,i){var o,a,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(r){return function(e){var t=[r,e];if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,a&&(s=2&t[0]?a.return:t[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,a=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))u.label=t[1];else if(6===t[0]&&u.label<s[1])u.label=s[1],s=t;else{if(!(s&&u.label<s[2])){s[2]&&u.ops.pop(),u.trys.pop();continue}u.label=s[2],u.ops.push(t)}}t=i.call(n,u)}catch(e){t=[6,e],a=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},l=(Object.defineProperty(r,"__esModule",{value:!0}),r.generate=void 0,e("../util/identity")),f=e("../util/isScheduler"),d=e("./defer"),p=e("../scheduled/scheduleIterable");r.generate=function(e,r,n,t,i){var o,a,s;function u(){var t;return c(this,function(e){switch(e.label){case 0:t=s,e.label=1;case 1:return r&&!r(t)?[3,4]:[4,a(t)];case 2:e.sent(),e.label=3;case 3:return t=n(t),[3,1];case 4:return[2]}})}return 1===arguments.length?(s=e.initialState,r=e.condition,n=e.iterate,o=e.resultSelector,a=void 0===o?l.identity:o,i=e.scheduler):(s=e,!t||f.isScheduler(t)?(a=l.identity,i=t):a=t),d.defer(i?function(){return p.scheduleIterable(u(),i)}:u)}},{"../scheduled/scheduleIterable":579,"../util/identity":622,"../util/isScheduler":632,"./defer":436}],445:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.iif=void 0;var n=e("./defer");r.iif=function(e,t,r){return n.defer(function(){return e()?t:r})}},{"./defer":436}],446:[function(w,e,S){!function(e){!function(){"use strict";var u=this&&this.__awaiter||function(e,a,s,u){return new(s=s||Promise)(function(r,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(n,i)}o((u=u.apply(e,a||[])).next())})},c=this&&this.__generator||function(n,i){var o,a,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(r){return function(e){var t=[r,e];if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,a&&(s=2&t[0]?a.return:t[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,a=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))u.label=t[1];else if(6===t[0]&&u.label<s[1])u.label=s[1],s=t;else{if(!(s&&u.label<s[2])){s[2]&&u.ops.pop(),u.trys.pop();continue}u.label=s[2],u.ops.push(t)}}t=i.call(n,u)}catch(e){t=[6,e],a=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},l=this&&this.__asyncValues||function(a){var e,t;if(Symbol.asyncIterator)return(e=a[Symbol.asyncIterator])?e.call(a):(a="function"==typeof s?s(a):a[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);throw new TypeError("Symbol.asyncIterator is not defined.");function r(o){t[o]=a[o]&&function(i){return new Promise(function(e,t){var r,n;i=a[o](i),r=e,e=t,n=i.done,t=i.value,Promise.resolve(t).then(function(e){r({value:e,done:n})},e)})}}},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},t=(Object.defineProperty(S,"__esModule",{value:!0}),S.fromReadableStreamLike=S.fromAsyncIterable=S.fromIterable=S.fromPromise=S.fromArrayLike=S.fromInteropObservable=S.innerFrom=void 0,w("../util/isArrayLike")),r=w("../util/isPromise"),n=w("../Observable"),i=w("../util/isInteropObservable"),o=w("../util/isAsyncIterable"),a=w("../util/throwUnobservableError"),f=w("../util/isIterable"),d=w("../util/isReadableStreamLike"),p=w("../util/isFunction"),h=w("../util/reportUnhandledError"),y=w("../symbol/observable");function m(r){return new n.Observable(function(e){var t=r[y.observable]();if(p.isFunction(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function b(r){return new n.Observable(function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}function v(e){return new n.Observable(function(t){e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,h.reportUnhandledError)})}function g(a){return new n.Observable(function(e){var t,r;try{for(var n=s(a),i=n.next();!i.done;i=n.next()){var o=i.value;if(e.next(o),e.closed)return}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}e.complete()})}function O(e){return new n.Observable(function(t){!function(r,n){var i,o,a,s;return u(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:e.trys.push([0,5,6,11]),i=l(r),e.label=1;case 1:return[4,i.next()];case 2:if((o=e.sent()).done)return[3,4];if(t=o.value,n.next(t),n.closed)return[2];e.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return t=e.sent(),a={error:t},[3,11];case 6:return(e.trys.push([6,,9,10]),o&&!o.done&&(s=i.return))?[4,s.call(i)]:[3,8];case 7:e.sent(),e.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return n.complete(),[2]}})})}(e,t).catch(function(e){return t.error(e)})})}function _(e){return O(d.readableStreamLikeToAsyncGenerator(e))}S.innerFrom=function(e){if(e instanceof n.Observable)return e;if(null!=e){if(i.isInteropObservable(e))return m(e);if(t.isArrayLike(e))return b(e);if(r.isPromise(e))return v(e);if(o.isAsyncIterable(e))return O(e);if(f.isIterable(e))return g(e);if(d.isReadableStreamLike(e))return _(e)}throw a.createInvalidObservableTypeError(e)},S.fromInteropObservable=m,S.fromArrayLike=b,S.fromPromise=v,S.fromIterable=g,S.fromAsyncIterable=O,S.fromReadableStreamLike=_}.call(this)}.call(this,w("_process"))},{"../Observable":420,"../symbol/observable":605,"../util/isArrayLike":623,"../util/isAsyncIterable":624,"../util/isFunction":626,"../util/isInteropObservable":627,"../util/isIterable":628,"../util/isPromise":630,"../util/isReadableStreamLike":631,"../util/reportUnhandledError":638,"../util/throwUnobservableError":639,_process:651}],447:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.interval=void 0;var n=e("../scheduler/async"),i=e("./timer");r.interval=function(e,t){return void 0===t&&(t=n.asyncScheduler),i.timer(e=(e=void 0===e?0:e)<0?0:e,e,t)}},{"../scheduler/async":597,"./timer":457}],448:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.merge=void 0;var o=e("../operators/mergeAll"),a=e("./innerFrom"),s=e("./empty"),u=e("../util/args"),c=e("./from");r.merge=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=u.popScheduler(e),n=u.popNumber(e,1/0),i=e;return i.length?1===i.length?a.innerFrom(i[0]):o.mergeAll(n)(c.from(i,r)):s.EMPTY}},{"../operators/mergeAll":512,"../util/args":614,"./empty":438,"./from":440,"./innerFrom":446}],449:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.never=r.NEVER=void 0;var n=e("../Observable"),e=e("../util/noop");r.NEVER=new n.Observable(e.noop),r.never=function(){return r.NEVER}},{"../Observable":420,"../util/noop":635}],450:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.of=void 0;var n=e("../util/args"),i=e("./from");r.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=n.popScheduler(e);return i.from(e,r)}},{"../util/args":614,"./from":440}],451:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.onErrorResumeNext=void 0;var n=e("../Observable"),i=e("../util/argsOrArgArray"),a=e("../operators/OperatorSubscriber"),s=e("../util/noop"),u=e("./innerFrom");r.onErrorResumeNext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=i.argsOrArgArray(e);return new n.Observable(function(r){var n=0,i=function(){if(n<o.length){var e=void 0;try{e=u.innerFrom(o[n++])}catch(e){return void i()}var t=new a.OperatorSubscriber(r,void 0,s.noop,s.noop);e.subscribe(t),t.add(i)}else r.complete()};i()})}},{"../Observable":420,"../operators/OperatorSubscriber":460,"../util/argsOrArgArray":616,"../util/noop":635,"./innerFrom":446}],452:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.pairs=void 0;var n=e("./from");r.pairs=function(e,t){return n.from(Object.entries(e),t)}},{"./from":440}],453:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.partition=void 0;var n=e("../util/not"),i=e("../operators/filter"),o=e("./innerFrom");r.partition=function(e,t,r){return[i.filter(t,r)(o.innerFrom(e)),i.filter(n.not(t,r))(o.innerFrom(e))]}},{"../operators/filter":496,"../util/not":636,"./innerFrom":446}],454:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.raceInit=r.race=void 0;var n=e("../Observable"),o=e("./innerFrom"),i=e("../util/argsOrArgArray"),a=e("../operators/OperatorSubscriber");function s(t){return function(n){for(var i=[],e=0;i&&!n.closed&&e<t.length;e++)!function(r){i.push(o.innerFrom(t[r]).subscribe(a.createOperatorSubscriber(n,function(e){if(i){for(var t=0;t<i.length;t++)t!==r&&i[t].unsubscribe();i=null}n.next(e)})))}(e)}}r.race=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===(e=i.argsOrArgArray(e)).length?o.innerFrom(e[0]):new n.Observable(s(e))},r.raceInit=s},{"../Observable":420,"../operators/OperatorSubscriber":460,"../util/argsOrArgArray":616,"./innerFrom":446}],455:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.range=void 0;var o=e("../Observable"),a=e("./empty");r.range=function(r,e,n){var i;return null==e&&(e=r,r=0),e<=0?a.EMPTY:(i=e+r,new o.Observable(n?function(e){var t=r;return n.schedule(function(){t<i?(e.next(t++),this.schedule()):e.complete()})}:function(e){for(var t=r;t<i&&!e.closed;)e.next(t++);e.complete()}))}},{"../Observable":420,"./empty":438}],456:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.throwError=void 0;var i=e("../Observable"),o=e("../util/isFunction");r.throwError=function(e,t){function r(e){return e.error(n())}var n=o.isFunction(e)?e:function(){return e};return new i.Observable(t?function(e){return t.schedule(r,0,e)}:r)}},{"../Observable":420,"../util/isFunction":626}],457:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.timer=void 0;var a=e("../Observable"),s=e("../scheduler/async"),u=e("../util/isScheduler"),c=e("../util/isDate");r.timer=function(n,e,i){void 0===n&&(n=0),void 0===i&&(i=s.async);var o=-1;return null!=e&&(u.isScheduler(e)?i=e:o=e),new a.Observable(function(e){var t=c.isValidDate(n)?+n-i.now():n,r=0;return i.schedule(function(){e.closed||(e.next(r++),0<=o?this.schedule(void 0,o):e.complete())},t=t<0?0:t)})}},{"../Observable":420,"../scheduler/async":597,"../util/isDate":625,"../util/isScheduler":632}],458:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.using=void 0;var o=e("../Observable"),a=e("./innerFrom"),s=e("./empty");r.using=function(n,i){return new o.Observable(function(e){var t=n(),r=i(t);return(r?a.innerFrom(r):s.EMPTY).subscribe(e),function(){t&&t.unsubscribe()}})}},{"../Observable":420,"./empty":438,"./innerFrom":446}],459:[function(e,t,r){"use strict";var s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},u=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},n=(Object.defineProperty(r,"__esModule",{value:!0}),r.zip=void 0,e("../Observable")),c=e("./innerFrom"),i=e("../util/argsOrArgArray"),l=e("./empty"),f=e("../operators/OperatorSubscriber"),d=e("../util/args");r.zip=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=d.popResultSelector(e),a=i.argsOrArgArray(e);return a.length?new n.Observable(function(r){for(var n=a.map(function(){return[]}),i=a.map(function(){return!1}),e=(r.add(function(){n=i=null}),0);!r.closed&&e<a.length;e++)!function(t){c.innerFrom(a[t]).subscribe(f.createOperatorSubscriber(r,function(e){n[t].push(e),n.every(function(e){return e.length})&&(e=n.map(function(e){return e.shift()}),r.next(o?o.apply(void 0,u([],s(e))):e),n.some(function(e,t){return!e.length&&i[t]}))&&r.complete()},function(){i[t]=!0,n[t].length||r.complete()}))}(e);return function(){n=i=null}}):l.EMPTY}},{"../Observable":420,"../operators/OperatorSubscriber":460,"../util/args":614,"../util/argsOrArgArray":616,"./empty":438,"./innerFrom":446}],460:[function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),e=(Object.defineProperty(r,"__esModule",{value:!0}),r.OperatorSubscriber=r.createOperatorSubscriber=void 0,e("../Subscriber"));r.createOperatorSubscriber=function(e,t,r,n,i){return new o(e,t,r,n,i)};s=e.Subscriber,i(a,s),a.prototype.unsubscribe=function(){var e;this.shouldUnsubscribe&&!this.shouldUnsubscribe()||(e=this.closed,s.prototype.unsubscribe.call(this),e)||null==(e=this.onFinalize)||e.call(this)};var s,o=a;function a(t,r,e,n,i,o){var a=s.call(this,t)||this;return a.onFinalize=i,a.shouldUnsubscribe=o,a._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:s.prototype._next,a._error=n?function(e){try{n(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:s.prototype._error,a._complete=e?function(){try{e()}catch(e){t.error(e)}finally{this.unsubscribe()}}:s.prototype._complete,a}r.OperatorSubscriber=o},{"../Subscriber":424}],461:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.audit=void 0;var n=e("../util/lift"),c=e("../observable/innerFrom"),l=e("./OperatorSubscriber");r.audit=function(u){return n.operate(function(e,t){function r(){var e;null!=a&&a.unsubscribe(),a=null,i&&(i=!1,e=o,o=null,t.next(e)),s&&t.complete()}function n(){a=null,s&&t.complete()}var i=!1,o=null,a=null,s=!1;e.subscribe(l.createOperatorSubscriber(t,function(e){i=!0,o=e,a||c.innerFrom(u(e)).subscribe(a=l.createOperatorSubscriber(t,r,n))},function(){s=!0,i&&a&&!a.closed||t.complete()}))})}},{"../observable/innerFrom":446,"../util/lift":633,"./OperatorSubscriber":460}],462:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.auditTime=void 0;var n=e("../scheduler/async"),i=e("./audit"),o=e("../observable/timer");r.auditTime=function(e,t){return void 0===t&&(t=n.asyncScheduler),i.audit(function(){return o.timer(e,t)})}},{"../observable/timer":457,"../scheduler/async":597,"./audit":461}],463:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.buffer=void 0;var i=e("../util/lift"),o=e("../util/noop"),a=e("./OperatorSubscriber"),s=e("../observable/innerFrom");r.buffer=function(n){return i.operate(function(e,t){var r=[];return e.subscribe(a.createOperatorSubscriber(t,function(e){return r.push(e)},function(){t.next(r),t.complete()})),s.innerFrom(n).subscribe(a.createOperatorSubscriber(t,function(){var e=r;r=[],t.next(e)},o.noop)),function(){r=null}})}},{"../observable/innerFrom":446,"../util/lift":633,"../util/noop":635,"./OperatorSubscriber":460}],464:[function(e,t,r){"use strict";var m=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},n=(Object.defineProperty(r,"__esModule",{value:!0}),r.bufferCount=void 0,e("../util/lift")),i=e("./OperatorSubscriber"),b=e("../util/arrRemove");r.bufferCount=function(h,y){return y=null!=(y=void 0===y?null:y)?y:h,n.operate(function(e,f){var d=[],p=0;e.subscribe(i.createOperatorSubscriber(f,function(e){var t,r,n,i,o=null;p++%y==0&&d.push([]);try{for(var a=m(d),s=a.next();!s.done;s=a.next())(l=s.value).push(e),h<=l.length&&(o=null!=o?o:[]).push(l)}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}if(o)try{for(var u=m(o),c=u.next();!c.done;c=u.next()){var l=c.value;b.arrRemove(d,l),f.next(l)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}},function(){var t,e;try{for(var r=m(d),n=r.next();!n.done;n=r.next()){var i=n.value;f.next(i)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}f.complete()},void 0,function(){d=null}))})}},{"../util/arrRemove":617,"../util/lift":633,"./OperatorSubscriber":460}],465:[function(e,t,r){"use strict";var f=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},d=(Object.defineProperty(r,"__esModule",{value:!0}),r.bufferTime=void 0,e("../Subscription")),n=e("../util/lift"),p=e("./OperatorSubscriber"),h=e("../util/arrRemove"),i=e("../scheduler/async"),u=e("../util/args"),y=e("../util/executeSchedule");r.bufferTime=function(o){for(var e,t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var a=null!=(e=u.popScheduler(t))?e:i.asyncScheduler,s=null!=(e=t[0])?e:null,l=t[1]||1/0;return n.operate(function(e,r){var u=[],n=!1,c=function(e){var t=e.buffer;e.subs.unsubscribe(),h.arrRemove(u,e),r.next(t),n&&i()},i=function(){var e,t;u&&(e=new d.Subscription,r.add(e),u.push(t={buffer:[],subs:e}),y.executeSchedule(e,a,function(){return c(t)},o))},t=(null!==s&&0<=s?y.executeSchedule(r,a,i,s,!0):n=!0,i(),p.createOperatorSubscriber(r,function(e){var t,r,n=u.slice();try{for(var i=f(n),o=i.next();!o.done;o=i.next()){var a=o.value,s=a.buffer;s.push(e),l<=s.length&&c(a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},function(){for(;null!=u&&u.length;)r.next(u.shift().buffer);null!=t&&t.unsubscribe(),r.complete(),r.unsubscribe()},void 0,function(){return u=null}));e.subscribe(t)})}},{"../Subscription":425,"../scheduler/async":597,"../util/args":614,"../util/arrRemove":617,"../util/executeSchedule":621,"../util/lift":633,"./OperatorSubscriber":460}],466:[function(e,t,r){"use strict";var a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=(Object.defineProperty(r,"__esModule",{value:!0}),r.bufferToggle=void 0,e("../Subscription")),n=e("../util/lift"),u=e("../observable/innerFrom"),c=e("./OperatorSubscriber"),l=e("../util/noop"),f=e("../util/arrRemove");r.bufferToggle=function(t,i){return n.operate(function(e,n){var o=[];u.innerFrom(t).subscribe(c.createOperatorSubscriber(n,function(e){var t=[],r=(o.push(t),new s.Subscription);r.add(u.innerFrom(i(e)).subscribe(c.createOperatorSubscriber(n,function(){f.arrRemove(o,t),n.next(t),r.unsubscribe()},l.noop)))},l.noop)),e.subscribe(c.createOperatorSubscriber(n,function(e){var t,r;try{for(var n=a(o),i=n.next();!i.done;i=n.next())i.value.push(e)}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},function(){for(;0<o.length;)n.next(o.shift());n.complete()}))})}},{"../Subscription":425,"../observable/innerFrom":446,"../util/arrRemove":617,"../util/lift":633,"../util/noop":635,"./OperatorSubscriber":460}],467:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.bufferWhen=void 0;var n=e("../util/lift"),a=e("../util/noop"),s=e("./OperatorSubscriber"),u=e("../observable/innerFrom");r.bufferWhen=function(o){return n.operate(function(e,t){var r=null,n=null,i=function(){null!=n&&n.unsubscribe();var e=r;r=[],e&&t.next(e),u.innerFrom(o()).subscribe(n=s.createOperatorSubscriber(t,i,a.noop))};i(),e.subscribe(s.createOperatorSubscriber(t,function(e){return null==r?void 0:r.push(e)},function(){r&&t.next(r),t.complete()},void 0,function(){return r=n=null}))})}},{"../observable/innerFrom":446,"../util/lift":633,"../util/noop":635,"./OperatorSubscriber":460}],468:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.catchError=void 0;var u=e("../observable/innerFrom"),c=e("./OperatorSubscriber"),n=e("../util/lift");r.catchError=function a(s){return n.operate(function(t,r){var n,i=null,o=!1,i=t.subscribe(c.createOperatorSubscriber(r,void 0,void 0,function(e){n=u.innerFrom(s(e,a(s)(t))),i?(i.unsubscribe(),i=null,n.subscribe(r)):o=!0}));o&&(i.unsubscribe(),i=null,n.subscribe(r))})}},{"../observable/innerFrom":446,"../util/lift":633,"./OperatorSubscriber":460}],469:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.combineAll=void 0;e=e("./combineLatestAll");r.combineAll=e.combineLatestAll},{"./combineLatestAll":471}],470:[function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},o=(Object.defineProperty(r,"__esModule",{value:!0}),r.combineLatest=void 0,e("../observable/combineLatest")),a=e("../util/lift"),s=e("../util/argsOrArgArray"),u=e("../util/mapOneOrManyArgs"),c=e("../util/pipe"),l=e("../util/args");function f(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=l.popResultSelector(r);return t?c.pipe(f.apply(void 0,i([],n(r))),u.mapOneOrManyArgs(t)):a.operate(function(e,t){o.combineLatestInit(i([e],n(s.argsOrArgArray(r))))(t)})}r.combineLatest=f},{"../observable/combineLatest":433,"../util/args":614,"../util/argsOrArgArray":616,"../util/lift":633,"../util/mapOneOrManyArgs":634,"../util/pipe":637}],471:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.combineLatestAll=void 0;var n=e("../observable/combineLatest"),i=e("./joinAllInternals");r.combineLatestAll=function(e){return i.joinAllInternals(n.combineLatest,e)}},{"../observable/combineLatest":433,"./joinAllInternals":505}],472:[function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},o=(Object.defineProperty(r,"__esModule",{value:!0}),r.combineLatestWith=void 0,e("./combineLatest"));r.combineLatestWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o.combineLatest.apply(void 0,i([],n(e)))}},{"./combineLatest":470}],473:[function(e,t,r){"use strict";var i=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},a=(Object.defineProperty(r,"__esModule",{value:!0}),r.concat=void 0,e("../util/lift")),s=e("./concatAll"),u=e("../util/args"),c=e("../observable/from");r.concat=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var n=u.popScheduler(r);return a.operate(function(e,t){s.concatAll()(c.from(o([e],i(r)),n)).subscribe(t)})}},{"../observable/from":440,"../util/args":614,"../util/lift":633,"./concatAll":474}],474:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.concatAll=void 0;var n=e("./mergeAll");r.concatAll=function(){return n.mergeAll(1)}},{"./mergeAll":512}],475:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.concatMap=void 0;var n=e("./mergeMap"),i=e("../util/isFunction");r.concatMap=function(e,t){return i.isFunction(t)?n.mergeMap(e,t,1):n.mergeMap(e,1)}},{"../util/isFunction":626,"./mergeMap":514}],476:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.concatMapTo=void 0;var n=e("./concatMap"),i=e("../util/isFunction");r.concatMapTo=function(e,t){return i.isFunction(t)?n.concatMap(function(){return e},t):n.concatMap(function(){return e})}},{"../util/isFunction":626,"./concatMap":475}],477:[function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},o=(Object.defineProperty(r,"__esModule",{value:!0}),r.concatWith=void 0,e("./concat"));r.concatWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o.concat.apply(void 0,i([],n(e)))}},{"./concat":473}],478:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.connect=void 0;var n=e("../Subject"),o=e("../observable/innerFrom"),a=e("../util/lift"),s=e("../observable/fromSubscribable"),u={connector:function(){return new n.Subject}};r.connect=function(n,e){var i=(e=void 0===e?u:e).connector;return a.operate(function(e,t){var r=i();o.innerFrom(n(s.fromSubscribable(r))).subscribe(t),t.add(e.subscribe(r))})}},{"../Subject":423,"../observable/fromSubscribable":443,"../observable/innerFrom":446,"../util/lift":633}],479:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.count=void 0;var i=e("./reduce");r.count=function(n){return i.reduce(function(e,t,r){return!n||n(t,r)?e+1:e},0)}},{"./reduce":531}],480:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.debounce=void 0;var n=e("../util/lift"),s=e("../util/noop"),u=e("./OperatorSubscriber"),c=e("../observable/innerFrom");r.debounce=function(a){return n.operate(function(e,t){function r(){var e;null!=o&&o.unsubscribe(),o=null,n&&(n=!1,e=i,i=null,t.next(e))}var n=!1,i=null,o=null;e.subscribe(u.createOperatorSubscriber(t,function(e){null!=o&&o.unsubscribe(),n=!0,i=e,o=u.createOperatorSubscriber(t,r,s.noop),c.innerFrom(a(e)).subscribe(o)},function(){r(),t.complete()},void 0,function(){i=o=null}))})}},{"../observable/innerFrom":446,"../util/lift":633,"../util/noop":635,"./OperatorSubscriber":460}],481:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.debounceTime=void 0;var n=e("../scheduler/async"),i=e("../util/lift"),c=e("./OperatorSubscriber");r.debounceTime=function(s,u){return void 0===u&&(u=n.asyncScheduler),i.operate(function(e,r){var n=null,t=null,i=null,o=function(){var e;n&&(n.unsubscribe(),e=t,t=n=null,r.next(e))};function a(){var e=i+s,t=u.now();t<e?(n=this.schedule(void 0,e-t),r.add(n)):o()}e.subscribe(c.createOperatorSubscriber(r,function(e){t=e,i=u.now(),n||(n=u.schedule(a,s),r.add(n))},function(){o(),r.complete()},void 0,function(){t=n=null}))})}},{"../scheduler/async":597,"../util/lift":633,"./OperatorSubscriber":460}],482:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.defaultIfEmpty=void 0;var i=e("../util/lift"),o=e("./OperatorSubscriber");r.defaultIfEmpty=function(n){return i.operate(function(e,t){var r=!1;e.subscribe(o.createOperatorSubscriber(t,function(e){r=!0,t.next(e)},function(){r||t.next(n),t.complete()}))})}},{"../util/lift":633,"./OperatorSubscriber":460}],483:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.delay=void 0;var n=e("../scheduler/async"),i=e("./delayWhen"),o=e("../observable/timer");r.delay=function(e,t){void 0===t&&(t=n.asyncScheduler);var r=o.timer(e,t);return i.delayWhen(function(){return r})}},{"../observable/timer":457,"../scheduler/async":597,"./delayWhen":484}],484:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.delayWhen=void 0;var i=e("../observable/concat"),o=e("./take"),a=e("./ignoreElements"),s=e("./mapTo"),u=e("./mergeMap"),c=e("../observable/innerFrom");r.delayWhen=function t(r,n){return n?function(e){return i.concat(n.pipe(o.take(1),a.ignoreElements()),e.pipe(t(r)))}:u.mergeMap(function(e,t){return c.innerFrom(r(e,t)).pipe(o.take(1),s.mapTo(e))})}},{"../observable/concat":434,"../observable/innerFrom":446,"./ignoreElements":503,"./mapTo":508,"./mergeMap":514,"./take":555}],485:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.dematerialize=void 0;var n=e("../Notification"),i=e("../util/lift"),o=e("./OperatorSubscriber");r.dematerialize=function(){return i.operate(function(e,t){e.subscribe(o.createOperatorSubscriber(t,function(e){return n.observeNotification(e,t)}))})}},{"../Notification":418,"../util/lift":633,"./OperatorSubscriber":460}],486:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.distinct=void 0;var n=e("../util/lift"),o=e("./OperatorSubscriber"),a=e("../util/noop"),s=e("../observable/innerFrom");r.distinct=function(i,t){return n.operate(function(e,r){var n=new Set;e.subscribe(o.createOperatorSubscriber(r,function(e){var t=i?i(e):e;n.has(t)||(n.add(t),r.next(e))})),t&&s.innerFrom(t).subscribe(o.createOperatorSubscriber(r,function(){return n.clear()},a.noop))})}},{"../observable/innerFrom":446,"../util/lift":633,"../util/noop":635,"./OperatorSubscriber":460}],487:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.distinctUntilChanged=void 0;var n=e("../util/identity"),i=e("../util/lift"),s=e("./OperatorSubscriber");function u(e,t){return e===t}r.distinctUntilChanged=function(o,a){return void 0===a&&(a=n.identity),o=null!=o?o:u,i.operate(function(e,r){var n,i=!0;e.subscribe(s.createOperatorSubscriber(r,function(e){var t=a(e);!i&&o(n,t)||(i=!1,n=t,r.next(e))}))})}},{"../util/identity":622,"../util/lift":633,"./OperatorSubscriber":460}],488:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.distinctUntilKeyChanged=void 0;var i=e("./distinctUntilChanged");r.distinctUntilKeyChanged=function(r,n){return i.distinctUntilChanged(function(e,t){return n?n(e[r],t[r]):e[r]===t[r]})}},{"./distinctUntilChanged":487}],489:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.elementAt=void 0;var i=e("../util/ArgumentOutOfRangeError"),o=e("./filter"),a=e("./throwIfEmpty"),s=e("./defaultIfEmpty"),u=e("./take");r.elementAt=function(r,t){if(r<0)throw new i.ArgumentOutOfRangeError;var n=2<=arguments.length;return function(e){return e.pipe(o.filter(function(e,t){return t===r}),u.take(1),n?s.defaultIfEmpty(t):a.throwIfEmpty(function(){return new i.ArgumentOutOfRangeError}))}}},{"../util/ArgumentOutOfRangeError":607,"./defaultIfEmpty":482,"./filter":496,"./take":555,"./throwIfEmpty":562}],490:[function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},o=(Object.defineProperty(r,"__esModule",{value:!0}),r.endWith=void 0,e("../observable/concat")),a=e("../observable/of");r.endWith=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return o.concat(e,a.of.apply(void 0,i([],n(t))))}}},{"../observable/concat":434,"../observable/of":450}],491:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.every=void 0;var n=e("../util/lift"),a=e("./OperatorSubscriber");r.every=function(i,o){return n.operate(function(t,r){var n=0;t.subscribe(a.createOperatorSubscriber(r,function(e){i.call(o,e,n++,t)||(r.next(!1),r.complete())},function(){r.next(!0),r.complete()}))})}},{"../util/lift":633,"./OperatorSubscriber":460}],492:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.exhaust=void 0;e=e("./exhaustAll");r.exhaust=e.exhaustAll},{"./exhaustAll":493}],493:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.exhaustAll=void 0;var n=e("./exhaustMap"),i=e("../util/identity");r.exhaustAll=function(){return n.exhaustMap(i.identity)}},{"../util/identity":622,"./exhaustMap":494}],494:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.exhaustMap=void 0;var a=e("./map"),s=e("../observable/innerFrom"),n=e("../util/lift"),u=e("./OperatorSubscriber");r.exhaustMap=function t(o,i){return i?function(e){return e.pipe(t(function(r,n){return s.innerFrom(o(r,n)).pipe(a.map(function(e,t){return i(r,e,n,t)}))}))}:n.operate(function(e,t){var r=0,n=null,i=!1;e.subscribe(u.createOperatorSubscriber(t,function(e){n||(n=u.createOperatorSubscriber(t,void 0,function(){n=null,i&&t.complete()}),s.innerFrom(o(e,r++)).subscribe(n))},function(){i=!0,n||t.complete()}))})}},{"../observable/innerFrom":446,"../util/lift":633,"./OperatorSubscriber":460,"./map":507}],495:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.expand=void 0;var o=e("../util/lift"),a=e("./mergeInternals");r.expand=function(r,n,i){return n=((n=void 0===n?1/0:n)||0)<1?1/0:n,o.operate(function(e,t){return a.mergeInternals(e,t,r,n,void 0,!0,i)})}},{"../util/lift":633,"./mergeInternals":513}],496:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filter=void 0;var o=e("../util/lift"),a=e("./OperatorSubscriber");r.filter=function(n,i){return o.operate(function(e,t){var r=0;e.subscribe(a.createOperatorSubscriber(t,function(e){return n.call(i,e,r++)&&t.next(e)}))})}},{"../util/lift":633,"./OperatorSubscriber":460}],497:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.finalize=void 0;var n=e("../util/lift");r.finalize=function(r){return n.operate(function(e,t){try{e.subscribe(t)}finally{t.add(r)}})}},{"../util/lift":633}],498:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createFind=r.find=void 0;var n=e("../util/lift"),u=e("./OperatorSubscriber");function i(o,a,e){var s="index"===e;return function(r,n){var i=0;r.subscribe(u.createOperatorSubscriber(n,function(e){var t=i++;o.call(a,e,t,r)&&(n.next(s?t:e),n.complete())},function(){n.next(s?-1:void 0),n.complete()}))}}r.find=function(e,t){return n.operate(i(e,t,"value"))},r.createFind=i},{"../util/lift":633,"./OperatorSubscriber":460}],499:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.findIndex=void 0;var n=e("../util/lift"),i=e("./find");r.findIndex=function(e,t){return n.operate(i.createFind(e,t,"index"))}},{"../util/lift":633,"./find":498}],500:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.first=void 0;var i=e("../util/EmptyError"),o=e("./filter"),a=e("./take"),s=e("./defaultIfEmpty"),u=e("./throwIfEmpty"),c=e("../util/identity");r.first=function(n,e){var t=2<=arguments.length;return function(r){return r.pipe(n?o.filter(function(e,t){return n(e,t,r)}):c.identity,a.take(1),t?s.defaultIfEmpty(e):u.throwIfEmpty(function(){return new i.EmptyError}))}}},{"../util/EmptyError":608,"../util/identity":622,"./defaultIfEmpty":482,"./filter":496,"./take":555,"./throwIfEmpty":562}],501:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.flatMap=void 0;e=e("./mergeMap");r.flatMap=e.mergeMap},{"./mergeMap":514}],502:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.groupBy=void 0;var v=e("../Observable"),g=e("../observable/innerFrom"),O=e("../Subject"),n=e("../util/lift"),_=e("./OperatorSubscriber");r.groupBy=function(y,t,m,b){return n.operate(function(e,u){function c(t){return r(function(e){return e.error(t)})}t&&"function"!=typeof t?(m=t.duration,l=t.element,b=t.connector):l=t;var l,f=new Map,r=function(e){f.forEach(e),e(u)},d=0,p=!1,h=new _.OperatorSubscriber(u,function(e){try{var t,r,n=y(e),i=f.get(n);i||(f.set(n,i=b?b():new O.Subject),o=n,a=i,(s=new v.Observable(function(e){d++;var t=a.subscribe(e);return function(){t.unsubscribe(),0==--d&&p&&h.unsubscribe()}})).key=o,t=s,u.next(t),m&&(r=_.createOperatorSubscriber(i,function(){i.complete(),null!=r&&r.unsubscribe()},void 0,void 0,function(){return f.delete(n)}),h.add(g.innerFrom(m(t)).subscribe(r)))),i.next(l?l(e):e)}catch(e){c(e)}var o,a,s},function(){return r(function(e){return e.complete()})},c,function(){return f.clear()},function(){return p=!0,0===d});e.subscribe(h)})}},{"../Observable":420,"../Subject":423,"../observable/innerFrom":446,"../util/lift":633,"./OperatorSubscriber":460}],503:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ignoreElements=void 0;var n=e("../util/lift"),i=e("./OperatorSubscriber"),o=e("../util/noop");r.ignoreElements=function(){return n.operate(function(e,t){e.subscribe(i.createOperatorSubscriber(t,o.noop))})}},{"../util/lift":633,"../util/noop":635,"./OperatorSubscriber":460}],504:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isEmpty=void 0;var n=e("../util/lift"),i=e("./OperatorSubscriber");r.isEmpty=function(){return n.operate(function(e,t){e.subscribe(i.createOperatorSubscriber(t,function(){t.next(!1),t.complete()},function(){t.next(!0),t.complete()}))})}},{"../util/lift":633,"./OperatorSubscriber":460}],505:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.joinAllInternals=void 0;var n=e("../util/identity"),i=e("../util/mapOneOrManyArgs"),o=e("../util/pipe"),a=e("./mergeMap"),s=e("./toArray");r.joinAllInternals=function(t,e){return o.pipe(s.toArray(),a.mergeMap(function(e){return t(e)}),e?i.mapOneOrManyArgs(e):n.identity)}},{"../util/identity":622,"../util/mapOneOrManyArgs":634,"../util/pipe":637,"./mergeMap":514,"./toArray":567}],506:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.last=void 0;var i=e("../util/EmptyError"),o=e("./filter"),a=e("./takeLast"),s=e("./throwIfEmpty"),u=e("./defaultIfEmpty"),c=e("../util/identity");r.last=function(n,e){var t=2<=arguments.length;return function(r){return r.pipe(n?o.filter(function(e,t){return n(e,t,r)}):c.identity,a.takeLast(1),t?u.defaultIfEmpty(e):s.throwIfEmpty(function(){return new i.EmptyError}))}}},{"../util/EmptyError":608,"../util/identity":622,"./defaultIfEmpty":482,"./filter":496,"./takeLast":556,"./throwIfEmpty":562}],507:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.map=void 0;var o=e("../util/lift"),a=e("./OperatorSubscriber");r.map=function(n,i){return o.operate(function(e,t){var r=0;e.subscribe(a.createOperatorSubscriber(t,function(e){t.next(n.call(i,e,r++))}))})}},{"../util/lift":633,"./OperatorSubscriber":460}],508:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.mapTo=void 0;var n=e("./map");r.mapTo=function(e){return n.map(function(){return e})}},{"./map":507}],509:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.materialize=void 0;var n=e("../Notification"),i=e("../util/lift"),o=e("./OperatorSubscriber");r.materialize=function(){return i.operate(function(e,t){e.subscribe(o.createOperatorSubscriber(t,function(e){t.next(n.Notification.createNext(e))},function(){t.next(n.Notification.createComplete()),t.complete()},function(e){t.next(n.Notification.createError(e)),t.complete()}))})}},{"../Notification":418,"../util/lift":633,"./OperatorSubscriber":460}],510:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.max=void 0;var n=e("./reduce"),i=e("../util/isFunction");r.max=function(r){return n.reduce(i.isFunction(r)?function(e,t){return 0<r(e,t)?e:t}:function(e,t){return t<e?e:t})}},{"../util/isFunction":626,"./reduce":531}],511:[function(e,t,r){"use strict";var o=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},a=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},s=(Object.defineProperty(r,"__esModule",{value:!0}),r.merge=void 0,e("../util/lift")),u=e("../util/argsOrArgArray"),c=e("./mergeAll"),l=e("../util/args"),f=e("../observable/from");r.merge=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var n=l.popScheduler(r),i=l.popNumber(r,1/0),r=u.argsOrArgArray(r);return s.operate(function(e,t){c.mergeAll(i)(f.from(a([e],o(r)),n)).subscribe(t)})}},{"../observable/from":440,"../util/args":614,"../util/argsOrArgArray":616,"../util/lift":633,"./mergeAll":512}],512:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.mergeAll=void 0;var n=e("./mergeMap"),i=e("../util/identity");r.mergeAll=function(e){return n.mergeMap(i.identity,e=void 0===e?1/0:e)}},{"../util/identity":622,"./mergeMap":514}],513:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.mergeInternals=void 0;var h=e("../observable/innerFrom"),y=e("../util/executeSchedule"),m=e("./OperatorSubscriber");r.mergeInternals=function(e,r,n,i,o,a,s,t){var u=[],c=0,l=0,f=function(){u.length||c||r.complete()},d=function(e){return c<i?p(e):u.push(e)},p=function(e){a&&r.next(e),c++;var t=!1;h.innerFrom(n(e,l++)).subscribe(m.createOperatorSubscriber(r,function(e){null!=o&&o(e),a?d(e):r.next(e)},function(){t=!0},void 0,function(){if(t)try{c--;for(;u.length&&c<i;)!function(){var e=u.shift();s?y.executeSchedule(r,s,function(){return p(e)}):p(e)}();f()}catch(e){r.error(e)}}))};return e.subscribe(m.createOperatorSubscriber(r,d,function(){f()})),function(){null!=t&&t()}}},{"../observable/innerFrom":446,"../util/executeSchedule":621,"./OperatorSubscriber":460}],514:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.mergeMap=void 0;var a=e("./map"),s=e("../observable/innerFrom"),n=e("../util/lift"),u=e("./mergeInternals"),c=e("../util/isFunction");r.mergeMap=function e(i,o,r){return void 0===r&&(r=1/0),c.isFunction(o)?e(function(r,n){return a.map(function(e,t){return o(r,e,n,t)})(s.innerFrom(i(r,n)))},r):("number"==typeof o&&(r=o),n.operate(function(e,t){return u.mergeInternals(e,t,i,r)}))}},{"../observable/innerFrom":446,"../util/isFunction":626,"../util/lift":633,"./map":507,"./mergeInternals":513}],515:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.mergeMapTo=void 0;var n=e("./mergeMap"),i=e("../util/isFunction");r.mergeMapTo=function(e,t,r){return void 0===r&&(r=1/0),i.isFunction(t)?n.mergeMap(function(){return e},t,r):n.mergeMap(function(){return e},r="number"==typeof t?t:r)}},{"../util/isFunction":626,"./mergeMap":514}],516:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.mergeScan=void 0;var a=e("../util/lift"),s=e("./mergeInternals");r.mergeScan=function(n,i,o){return void 0===o&&(o=1/0),a.operate(function(e,t){var r=i;return s.mergeInternals(e,t,function(e,t){return n(r,e,t)},o,function(e){r=e},!1,void 0,function(){return r=null})})}},{"../util/lift":633,"./mergeInternals":513}],517:[function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},o=(Object.defineProperty(r,"__esModule",{value:!0}),r.mergeWith=void 0,e("./merge"));r.mergeWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o.merge.apply(void 0,i([],n(e)))}},{"./merge":511}],518:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.min=void 0;var n=e("./reduce"),i=e("../util/isFunction");r.min=function(r){return n.reduce(i.isFunction(r)?function(e,t){return r(e,t)<0?e:t}:function(e,t){return e<t?e:t})}},{"../util/isFunction":626,"./reduce":531}],519:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.multicast=void 0;var n=e("../observable/ConnectableObservable"),i=e("../util/isFunction"),o=e("./connect");r.multicast=function(e,t){var r=i.isFunction(e)?e:function(){return e};return i.isFunction(t)?o.connect(t,{connector:r}):function(e){return new n.ConnectableObservable(e,r)}}},{"../observable/ConnectableObservable":429,"../util/isFunction":626,"./connect":478}],520:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.observeOn=void 0;var i=e("../util/executeSchedule"),o=e("../util/lift"),a=e("./OperatorSubscriber");r.observeOn=function(r,n){return void 0===n&&(n=0),o.operate(function(e,t){e.subscribe(a.createOperatorSubscriber(t,function(e){return i.executeSchedule(t,r,function(){return t.next(e)},n)},function(){return i.executeSchedule(t,r,function(){return t.complete()},n)},function(e){return i.executeSchedule(t,r,function(){return t.error(e)},n)}))})}},{"../util/executeSchedule":621,"../util/lift":633,"./OperatorSubscriber":460}],521:[function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},o=(Object.defineProperty(r,"__esModule",{value:!0}),r.onErrorResumeNext=r.onErrorResumeNextWith=void 0,e("../util/argsOrArgArray")),a=e("../observable/onErrorResumeNext");function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=o.argsOrArgArray(e);return function(e){return a.onErrorResumeNext.apply(void 0,i([e],n(r)))}}r.onErrorResumeNextWith=s,r.onErrorResumeNext=s},{"../observable/onErrorResumeNext":451,"../util/argsOrArgArray":616}],522:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.pairwise=void 0;var n=e("../util/lift"),o=e("./OperatorSubscriber");r.pairwise=function(){return n.operate(function(e,r){var n,i=!1;e.subscribe(o.createOperatorSubscriber(r,function(e){var t=n;n=e,i&&r.next([t,e]),i=!0}))})}},{"../util/lift":633,"./OperatorSubscriber":460}],523:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.partition=void 0;var n=e("../util/not"),i=e("./filter");r.partition=function(t,r){return function(e){return[i.filter(t,r)(e),i.filter(n.not(t,r))(e)]}}},{"../util/not":636,"./filter":496}],524:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.pluck=void 0;var n=e("./map");r.pluck=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];var o=i.length;if(0===o)throw new Error("list of properties cannot be empty.");return n.map(function(e){for(var t=e,r=0;r<o;r++){var n=null==t?void 0:t[i[r]];if(void 0===n)return;t=n}return t})}},{"./map":507}],525:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.publish=void 0;var n=e("../Subject"),i=e("./multicast"),o=e("./connect");r.publish=function(t){return t?function(e){return o.connect(t)(e)}:function(e){return i.multicast(new n.Subject)(e)}}},{"../Subject":423,"./connect":478,"./multicast":519}],526:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.publishBehavior=void 0;var n=e("../BehaviorSubject"),i=e("../observable/ConnectableObservable");r.publishBehavior=function(r){return function(e){var t=new n.BehaviorSubject(r);return new i.ConnectableObservable(e,function(){return t})}}},{"../BehaviorSubject":417,"../observable/ConnectableObservable":429}],527:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.publishLast=void 0;var n=e("../AsyncSubject"),i=e("../observable/ConnectableObservable");r.publishLast=function(){return function(e){var t=new n.AsyncSubject;return new i.ConnectableObservable(e,function(){return t})}}},{"../AsyncSubject":416,"../observable/ConnectableObservable":429}],528:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.publishReplay=void 0;var o=e("../ReplaySubject"),a=e("./multicast"),s=e("../util/isFunction");r.publishReplay=function(t,r,e,n){e&&!s.isFunction(e)&&(n=e);var i=s.isFunction(e)?e:void 0;return function(e){return a.multicast(new o.ReplaySubject(t,r,n),i)(e)}}},{"../ReplaySubject":421,"../util/isFunction":626,"./multicast":519}],529:[function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},o=(Object.defineProperty(r,"__esModule",{value:!0}),r.race=void 0,e("../util/argsOrArgArray")),a=e("./raceWith");r.race=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a.raceWith.apply(void 0,i([],n(o.argsOrArgArray(e))))}},{"../util/argsOrArgArray":616,"./raceWith":530}],530:[function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},o=(Object.defineProperty(r,"__esModule",{value:!0}),r.raceWith=void 0,e("../observable/race")),a=e("../util/lift"),s=e("../util/identity");r.raceWith=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return r.length?a.operate(function(e,t){o.raceInit(i([e],n(r)))(t)}):s.identity}},{"../observable/race":454,"../util/identity":622,"../util/lift":633}],531:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.reduce=void 0;var n=e("./scanInternals"),i=e("../util/lift");r.reduce=function(e,t){return i.operate(n.scanInternals(e,t,2<=arguments.length,!1,!0))}},{"../util/lift":633,"./scanInternals":540}],532:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.refCount=void 0;var n=e("../util/lift"),o=e("./OperatorSubscriber");r.refCount=function(){return n.operate(function(r,n){var i=null,e=(r._refCount++,o.createOperatorSubscriber(n,void 0,void 0,void 0,function(){var e,t;!r||r._refCount<=0||0<--r._refCount?i=null:(e=r._connection,t=i,i=null,!e||t&&e!==t||e.unsubscribe(),n.unsubscribe())}));r.subscribe(e),e.closed||(i=r.connect())})}},{"../util/lift":633,"./OperatorSubscriber":460}],533:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.repeat=void 0;var n=e("../observable/empty"),i=e("../util/lift"),c=e("./OperatorSubscriber"),l=e("../observable/innerFrom"),f=e("../observable/timer");r.repeat=function(e){var t,s,u=1/0;return null!=e&&("object"==typeof e?(t=e.count,u=void 0===t?1/0:t,s=e.delay):u=e),u<=0?function(){return n.EMPTY}:i.operate(function(t,r){function n(){var e=!1;i=t.subscribe(c.createOperatorSubscriber(r,void 0,function(){++o<u?i?a():e=!0:r.complete()})),e&&a()}var i,o=0,a=function(){var e,t;null!=i&&i.unsubscribe(),(i=null)!=s?(e="number"==typeof s?f.timer(s):l.innerFrom(s(o)),t=c.createOperatorSubscriber(r,function(){t.unsubscribe(),n()}),e.subscribe(t)):n()};n()})}},{"../observable/empty":438,"../observable/innerFrom":446,"../observable/timer":457,"../util/lift":633,"./OperatorSubscriber":460}],534:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.repeatWhen=void 0;var f=e("../observable/innerFrom"),d=e("../Subject"),n=e("../util/lift"),p=e("./OperatorSubscriber");r.repeatWhen=function(l){return n.operate(function(e,t){var r,n,i=!1,o=!1,a=!1,s=function(){return a&&o&&(t.complete(),!0)},u=function(){return n||(n=new d.Subject,f.innerFrom(l(n)).subscribe(p.createOperatorSubscriber(t,function(){r?c():i=!0},function(){o=!0,s()}))),n},c=function(){a=!1,r=e.subscribe(p.createOperatorSubscriber(t,void 0,function(){a=!0,s()||u().next()})),i&&(r.unsubscribe(),r=null,i=!1,c())};c()})}},{"../Subject":423,"../observable/innerFrom":446,"../util/lift":633,"./OperatorSubscriber":460}],535:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.retry=void 0;var n=e("../util/lift"),f=e("./OperatorSubscriber"),i=e("../util/identity"),d=e("../observable/timer"),p=e("../observable/innerFrom");r.retry=function(e){var t=(e=(e=void 0===e?1/0:e)&&"object"==typeof e?e:{count:e}).count,c=void 0===t?1/0:t,l=e.delay,r=void 0!==(t=e.resetOnSuccess)&&t;return c<=0?i.identity:n.operate(function(e,o){var a,s=0,u=function(){var i=!1;a=e.subscribe(f.createOperatorSubscriber(o,function(e){r&&(s=0),o.next(e)},void 0,function(e){var t,r,n;s++<c?(t=function(){a?(a.unsubscribe(),a=null,u()):i=!0},null!=l?(r="number"==typeof l?d.timer(l):p.innerFrom(l(e,s)),n=f.createOperatorSubscriber(o,function(){n.unsubscribe(),t()},function(){o.complete()}),r.subscribe(n)):t()):o.error(e)})),i&&(a.unsubscribe(),a=null,u())};u()})}},{"../observable/innerFrom":446,"../observable/timer":457,"../util/identity":622,"../util/lift":633,"./OperatorSubscriber":460}],536:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.retryWhen=void 0;var s=e("../observable/innerFrom"),u=e("../Subject"),n=e("../util/lift"),c=e("./OperatorSubscriber");r.retryWhen=function(a){return n.operate(function(e,t){var r,n,i=!1,o=function(){r=e.subscribe(c.createOperatorSubscriber(t,void 0,void 0,function(e){n||(n=new u.Subject,s.innerFrom(a(n)).subscribe(c.createOperatorSubscriber(t,function(){return r?o():i=!0}))),n&&n.next(e)})),i&&(r.unsubscribe(),r=null,i=!1,o())};o()})}},{"../Subject":423,"../observable/innerFrom":446,"../util/lift":633,"./OperatorSubscriber":460}],537:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.sample=void 0;var o=e("../observable/innerFrom"),n=e("../util/lift"),a=e("../util/noop"),s=e("./OperatorSubscriber");r.sample=function(i){return n.operate(function(e,t){var r=!1,n=null;e.subscribe(s.createOperatorSubscriber(t,function(e){r=!0,n=e})),o.innerFrom(i).subscribe(s.createOperatorSubscriber(t,function(){var e;r&&(r=!1,e=n,n=null,t.next(e))},a.noop))})}},{"../observable/innerFrom":446,"../util/lift":633,"../util/noop":635,"./OperatorSubscriber":460}],538:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.sampleTime=void 0;var n=e("../scheduler/async"),i=e("./sample"),o=e("../observable/interval");r.sampleTime=function(e,t){return void 0===t&&(t=n.asyncScheduler),i.sample(o.interval(e,t))}},{"../observable/interval":447,"../scheduler/async":597,"./sample":537}],539:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.scan=void 0;var n=e("../util/lift"),i=e("./scanInternals");r.scan=function(e,t){return n.operate(i.scanInternals(e,t,2<=arguments.length,!0))}},{"../util/lift":633,"./scanInternals":540}],540:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.scanInternals=void 0;var l=e("./OperatorSubscriber");r.scanInternals=function(a,t,s,u,c){return function(e,r){var n=s,i=t,o=0;e.subscribe(l.createOperatorSubscriber(r,function(e){var t=o++;i=n?a(i,e,t):(n=!0,e),u&&r.next(i)},c&&function(){n&&r.next(i),r.complete()}))}}},{"./OperatorSubscriber":460}],541:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.sequenceEqual=void 0;var n=e("../util/lift"),u=e("./OperatorSubscriber"),c=e("../observable/innerFrom");function l(){return{buffer:[],complete:!1}}r.sequenceEqual=function(a,s){return void 0===s&&(s=function(e,t){return e===t}),n.operate(function(e,t){function r(n,i){var r=u.createOperatorSubscriber(t,function(e){var t=i.buffer,r=i.complete;0===t.length?r?o(!1):n.buffer.push(e):s(e,t.shift())||o(!1)},function(){n.complete=!0;var e=i.complete,t=i.buffer;e&&o(0===t.length),null!=r&&r.unsubscribe()});return r}var n=l(),i=l(),o=function(e){t.next(e),t.complete()};e.subscribe(r(n,i)),c.innerFrom(a).subscribe(r(i,n))})}},{"../observable/innerFrom":446,"../util/lift":633,"./OperatorSubscriber":460}],542:[function(e,t,r){"use strict";var o=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},a=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},m=(Object.defineProperty(r,"__esModule",{value:!0}),r.share=void 0,e("../observable/innerFrom")),n=e("../Subject"),b=e("../Subscriber"),v=e("../util/lift");function g(e,t){for(var r,n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!0===t)e();else if(!1!==t)return r=new b.SafeSubscriber({next:function(){r.unsubscribe(),e()}}),m.innerFrom(t.apply(void 0,a([],o(n)))).subscribe(r)}r.share=function(e){var t=(e=void 0===e?{}:e).connector,d=void 0===t?function(){return new n.Subject}:t,p=void 0===(t=e.resetOnError)||t,h=void 0===(t=e.resetOnComplete)||t,y=void 0===(t=e.resetOnRefCountZero)||t;return function(e){function n(){var e=i;f(),null!=e&&e.unsubscribe()}var i,o,a,s=0,u=!1,c=!1,l=function(){null!=o&&o.unsubscribe(),o=void 0},f=function(){l(),i=a=void 0,u=c=!1};return v.operate(function(e,t){s++,c||u||l();var r=a=null!=a?a:d();t.add(function(){0!==--s||c||u||(o=g(n,y))}),r.subscribe(t),!i&&0<s&&(i=new b.SafeSubscriber({next:function(e){return r.next(e)},error:function(e){c=!0,l(),o=g(f,p,e),r.error(e)},complete:function(){u=!0,l(),o=g(f,h),r.complete()}}),m.innerFrom(e).subscribe(i))})(e)}}},{"../Subject":423,"../Subscriber":424,"../observable/innerFrom":446,"../util/lift":633}],543:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shareReplay=void 0;var a=e("../ReplaySubject"),s=e("./share");r.shareReplay=function(e,t,r){var n,i,o=!1;return e&&"object"==typeof e?(n=e.bufferSize,i=void 0===n?1/0:n,n=e.windowTime,t=void 0===n?1/0:n,o=void 0!==(n=e.refCount)&&n,r=e.scheduler):i=null!=e?e:1/0,s.share({connector:function(){return new a.ReplaySubject(i,t,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:o})}},{"../ReplaySubject":421,"./share":542}],544:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.single=void 0;var u=e("../util/EmptyError"),c=e("../util/SequenceError"),l=e("../util/NotFoundError"),n=e("../util/lift"),f=e("./OperatorSubscriber");r.single=function(s){return n.operate(function(t,r){var n,i=!1,o=!1,a=0;t.subscribe(f.createOperatorSubscriber(r,function(e){o=!0,s&&!s(e,a++,t)||(i&&r.error(new c.SequenceError("Too many matching values")),i=!0,n=e)},function(){i?(r.next(n),r.complete()):r.error(o?new l.NotFoundError("No matching values"):new u.EmptyError)}))})}},{"../util/EmptyError":608,"../util/NotFoundError":610,"../util/SequenceError":612,"../util/lift":633,"./OperatorSubscriber":460}],545:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.skip=void 0;var n=e("./filter");r.skip=function(r){return n.filter(function(e,t){return r<=t})}},{"./filter":496}],546:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.skipLast=void 0;var n=e("../util/identity"),i=e("../util/lift"),s=e("./OperatorSubscriber");r.skipLast=function(a){return a<=0?n.identity:i.operate(function(e,n){var i=new Array(a),o=0;return e.subscribe(s.createOperatorSubscriber(n,function(e){var t,r=o++;r<a?i[r]=e:(t=i[r=r%a],i[r]=e,n.next(t))})),function(){i=null}})}},{"../util/identity":622,"../util/lift":633,"./OperatorSubscriber":460}],547:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.skipUntil=void 0;var n=e("../util/lift"),o=e("./OperatorSubscriber"),a=e("../observable/innerFrom"),s=e("../util/noop");r.skipUntil=function(i){return n.operate(function(e,t){var r=!1,n=o.createOperatorSubscriber(t,function(){null!=n&&n.unsubscribe(),r=!0},s.noop);a.innerFrom(i).subscribe(n),e.subscribe(o.createOperatorSubscriber(t,function(e){return r&&t.next(e)}))})}},{"../observable/innerFrom":446,"../util/lift":633,"../util/noop":635,"./OperatorSubscriber":460}],548:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.skipWhile=void 0;var n=e("../util/lift"),o=e("./OperatorSubscriber");r.skipWhile=function(i){return n.operate(function(e,t){var r=!1,n=0;e.subscribe(o.createOperatorSubscriber(t,function(e){return(r=r||!i(e,n++))&&t.next(e)}))})}},{"../util/lift":633,"./OperatorSubscriber":460}],549:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.startWith=void 0;var i=e("../observable/concat"),o=e("../util/args"),a=e("../util/lift");r.startWith=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var n=o.popScheduler(r);return a.operate(function(e,t){(n?i.concat(r,e,n):i.concat(r,e)).subscribe(t)})}},{"../observable/concat":434,"../util/args":614,"../util/lift":633}],550:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.subscribeOn=void 0;var i=e("../util/lift");r.subscribeOn=function(r,n){return void 0===n&&(n=0),i.operate(function(e,t){t.add(r.schedule(function(){return e.subscribe(t)},n))})}},{"../util/lift":633}],551:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.switchAll=void 0;var n=e("./switchMap"),i=e("../util/identity");r.switchAll=function(){return n.switchMap(i.identity)}},{"../util/identity":622,"./switchMap":552}],552:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.switchMap=void 0;var l=e("../observable/innerFrom"),n=e("../util/lift"),f=e("./OperatorSubscriber");r.switchMap=function(u,c){return n.operate(function(e,i){function o(){t&&!a&&i.complete()}var a=null,s=0,t=!1;e.subscribe(f.createOperatorSubscriber(i,function(t){null!=a&&a.unsubscribe();var r=0,n=s++;l.innerFrom(u(t,n)).subscribe(a=f.createOperatorSubscriber(i,function(e){return i.next(c?c(t,e,n,r++):e)},function(){a=null,o()}))},function(){t=!0,o()}))})}},{"../observable/innerFrom":446,"../util/lift":633,"./OperatorSubscriber":460}],553:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.switchMapTo=void 0;var n=e("./switchMap"),i=e("../util/isFunction");r.switchMapTo=function(e,t){return i.isFunction(t)?n.switchMap(function(){return e},t):n.switchMap(function(){return e})}},{"../util/isFunction":626,"./switchMap":552}],554:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.switchScan=void 0;var o=e("./switchMap"),a=e("../util/lift");r.switchScan=function(n,i){return a.operate(function(e,t){var r=i;return o.switchMap(function(e,t){return n(r,e,t)},function(e,t){return r=t})(e).subscribe(t),function(){r=null}})}},{"../util/lift":633,"./switchMap":552}],555:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.take=void 0;var i=e("../observable/empty"),o=e("../util/lift"),a=e("./OperatorSubscriber");r.take=function(n){return n<=0?function(){return i.EMPTY}:o.operate(function(e,t){var r=0;e.subscribe(a.createOperatorSubscriber(t,function(e){++r<=n&&(t.next(e),n<=r)&&t.complete()}))})}},{"../observable/empty":438,"../util/lift":633,"./OperatorSubscriber":460}],556:[function(e,t,r){"use strict";var s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},n=(Object.defineProperty(r,"__esModule",{value:!0}),r.takeLast=void 0,e("../observable/empty")),i=e("../util/lift"),u=e("./OperatorSubscriber");r.takeLast=function(t){return t<=0?function(){return n.EMPTY}:i.operate(function(e,o){var a=[];e.subscribe(u.createOperatorSubscriber(o,function(e){a.push(e),t<a.length&&a.shift()},function(){var t,e;try{for(var r=s(a),n=r.next();!n.done;n=r.next()){var i=n.value;o.next(i)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}o.complete()},void 0,function(){a=null}))})}},{"../observable/empty":438,"../util/lift":633,"./OperatorSubscriber":460}],557:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.takeUntil=void 0;var n=e("../util/lift"),i=e("./OperatorSubscriber"),o=e("../observable/innerFrom"),a=e("../util/noop");r.takeUntil=function(r){return n.operate(function(e,t){o.innerFrom(r).subscribe(i.createOperatorSubscriber(t,function(){return t.complete()},a.noop)),t.closed||e.subscribe(t)})}},{"../observable/innerFrom":446,"../util/lift":633,"../util/noop":635,"./OperatorSubscriber":460}],558:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.takeWhile=void 0;var n=e("../util/lift"),a=e("./OperatorSubscriber");r.takeWhile=function(i,o){return void 0===o&&(o=!1),n.operate(function(e,r){var n=0;e.subscribe(a.createOperatorSubscriber(r,function(e){var t=i(e,n++);(t||o)&&r.next(e),t||r.complete()}))})}},{"../util/lift":633,"./OperatorSubscriber":460}],559:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.tap=void 0;var n=e("../util/isFunction"),o=e("../util/lift"),a=e("./OperatorSubscriber"),s=e("../util/identity");r.tap=function(e,t,r){var i=n.isFunction(e)||t||r?{next:e,error:t,complete:r}:e;return i?o.operate(function(e,r){null!=(t=i.subscribe)&&t.call(i);var t,n=!0;e.subscribe(a.createOperatorSubscriber(r,function(e){var t;null!=(t=i.next)&&t.call(i,e),r.next(e)},function(){var e;n=!1,null!=(e=i.complete)&&e.call(i),r.complete()},function(e){var t;n=!1,null!=(t=i.error)&&t.call(i,e),r.error(e)},function(){var e;n&&null!=(e=i.unsubscribe)&&e.call(i),null!=(e=i.finalize)&&e.call(i)}))}):s.identity}},{"../util/identity":622,"../util/isFunction":626,"../util/lift":633,"./OperatorSubscriber":460}],560:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.throttle=void 0;var n=e("../util/lift"),m=e("./OperatorSubscriber"),b=e("../observable/innerFrom");r.throttle=function(h,y){return n.operate(function(e,t){function r(){var e;s&&(s=!1,e=u,u=null,t.next(e),l||p(e))}var n=null!=y?y:{},i=n.leading,o=void 0===i||i,i=n.trailing,a=void 0!==i&&i,s=!1,u=null,c=null,l=!1,f=function(){null!=c&&c.unsubscribe(),c=null,a&&(r(),l)&&t.complete()},d=function(){c=null,l&&t.complete()},p=function(e){return c=b.innerFrom(h(e)).subscribe(m.createOperatorSubscriber(t,f,d))};e.subscribe(m.createOperatorSubscriber(t,function(e){s=!0,u=e,c&&!c.closed||(o?r():p(e))},function(){l=!0,a&&s&&c&&!c.closed||t.complete()}))})}},{"../observable/innerFrom":446,"../util/lift":633,"./OperatorSubscriber":460}],561:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.throttleTime=void 0;var i=e("../scheduler/async"),o=e("./throttle"),a=e("../observable/timer");r.throttleTime=function(e,t,r){void 0===t&&(t=i.asyncScheduler);var n=a.timer(e,t);return o.throttle(function(){return n},r)}},{"../observable/timer":457,"../scheduler/async":597,"./throttle":560}],562:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.throwIfEmpty=void 0;var n=e("../util/EmptyError"),i=e("../util/lift"),o=e("./OperatorSubscriber");function a(){return new n.EmptyError}r.throwIfEmpty=function(n){return void 0===n&&(n=a),i.operate(function(e,t){var r=!1;e.subscribe(o.createOperatorSubscriber(t,function(e){r=!0,t.next(e)},function(){return r?t.complete():t.error(n())}))})}},{"../util/EmptyError":608,"../util/lift":633,"./OperatorSubscriber":460}],563:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TimeInterval=r.timeInterval=void 0;var n=e("../scheduler/async"),i=e("../util/lift"),a=e("./OperatorSubscriber");r.timeInterval=function(o){return void 0===o&&(o=n.asyncScheduler),i.operate(function(e,n){var i=o.now();e.subscribe(a.createOperatorSubscriber(n,function(e){var t=o.now(),r=t-i;i=t,n.next(new s(e,r))}))})};var s=function(e,t){this.value=e,this.interval=t};r.TimeInterval=s},{"../scheduler/async":597,"../util/lift":633,"./OperatorSubscriber":460}],564:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.timeout=r.TimeoutError=void 0;var n=e("../scheduler/async"),i=e("../util/isDate"),o=e("../util/lift"),d=e("../observable/innerFrom"),a=e("../util/createErrorClass"),p=e("./OperatorSubscriber"),h=e("../util/executeSchedule");function y(e){throw new r.TimeoutError(e)}r.TimeoutError=a.createErrorClass(function(t){return function(e){void 0===e&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}}),r.timeout=function(e,t){var s=(e=i.isValidDate(e)?{first:e}:"number"==typeof e?{each:e}:e).first,u=e.each,r=e.with,c=void 0===r?y:r,l=void 0===(r=e.scheduler)?null!=t?t:n.asyncScheduler:r,f=void 0===(t=e.meta)?null:t;if(null==s&&null==u)throw new TypeError("No timeout provided.");return o.operate(function(e,t){function r(e){n=h.executeSchedule(t,l,function(){try{a.unsubscribe(),d.innerFrom(c({meta:f,lastValue:i,seen:o})).subscribe(t)}catch(e){t.error(e)}},e)}var n,i=null,o=0,a=e.subscribe(p.createOperatorSubscriber(t,function(e){null!=n&&n.unsubscribe(),o++,t.next(i=e),0<u&&r(u)},void 0,void 0,function(){null!=n&&n.closed||null!=n&&n.unsubscribe(),i=null}));o||r(null!=s?"number"==typeof s?s:+s-l.now():u)})}},{"../observable/innerFrom":446,"../scheduler/async":597,"../util/createErrorClass":618,"../util/executeSchedule":621,"../util/isDate":625,"../util/lift":633,"./OperatorSubscriber":460}],565:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.timeoutWith=void 0;var o=e("../scheduler/async"),a=e("../util/isDate"),s=e("./timeout");r.timeoutWith=function(e,t,r){var n,i;if(r=null!=r?r:o.async,a.isValidDate(e)?n=e:"number"==typeof e&&(i=e),!t)throw new TypeError("No observable provided to switch to");if(e=function(){return t},null==n&&null==i)throw new TypeError("No timeout provided.");return s.timeout({first:n,each:i,scheduler:r,with:e})}},{"../scheduler/async":597,"../util/isDate":625,"./timeout":564}],566:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.timestamp=void 0;var n=e("../scheduler/dateTimestampProvider"),i=e("./map");r.timestamp=function(t){return void 0===t&&(t=n.dateTimestampProvider),i.map(function(e){return{value:e,timestamp:t.now()}})}},{"../scheduler/dateTimestampProvider":598,"./map":507}],567:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.toArray=void 0;function n(e,t){return e.push(t),e}var i=e("./reduce"),o=e("../util/lift");r.toArray=function(){return o.operate(function(e,t){i.reduce(n,[])(e).subscribe(t)})}},{"../util/lift":633,"./reduce":531}],568:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.window=void 0;var o=e("../Subject"),n=e("../util/lift"),a=e("./OperatorSubscriber"),s=e("../util/noop"),u=e("../observable/innerFrom");r.window=function(i){return n.operate(function(e,t){function r(e){n.error(e),t.error(e)}var n=new o.Subject;t.next(n.asObservable());return e.subscribe(a.createOperatorSubscriber(t,function(e){return null==n?void 0:n.next(e)},function(){n.complete(),t.complete()},r)),u.innerFrom(i).subscribe(a.createOperatorSubscriber(t,function(){n.complete(),t.next(n=new o.Subject)},s.noop,r)),function(){null!=n&&n.unsubscribe(),n=null}})}},{"../Subject":423,"../observable/innerFrom":446,"../util/lift":633,"../util/noop":635,"./OperatorSubscriber":460}],569:[function(e,t,r){"use strict";var l=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},f=(Object.defineProperty(r,"__esModule",{value:!0}),r.windowCount=void 0,e("../Subject")),n=e("../util/lift"),i=e("./OperatorSubscriber");r.windowCount=function(u,e){var c=0<(e=void 0===e?0:e)?e:u;return n.operate(function(e,o){var a=[new f.Subject],s=0;o.next(a[0].asObservable()),e.subscribe(i.createOperatorSubscriber(o,function(e){try{for(var t=l(a),r=t.next();!r.done;r=t.next())r.value.next(e)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=t.return)&&i.call(t)}finally{if(n)throw n.error}}var n,i=s-u+1;0<=i&&i%c==0&&a.shift().complete(),++s%c==0&&(n=new f.Subject,a.push(n),o.next(n.asObservable()))},function(){for(;0<a.length;)a.shift().complete();o.complete()},function(e){for(;0<a.length;)a.shift().error(e);o.error(e)},function(){a=null}))})}},{"../Subject":423,"../util/lift":633,"./OperatorSubscriber":460}],570:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.windowTime=void 0;var p=e("../Subject"),n=e("../scheduler/async"),h=e("../Subscription"),i=e("../util/lift"),y=e("./OperatorSubscriber"),m=e("../util/arrRemove"),o=e("../util/args"),b=e("../util/executeSchedule");r.windowTime=function(c){for(var e,t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var l=null!=(e=o.popScheduler(t))?e:n.asyncScheduler,f=null!=(e=t[0])?e:null,d=t[1]||1/0;return i.operate(function(e,n){function r(t){u(function(e){e=e.window;return t(e)}),t(n),n.unsubscribe()}var i=[],o=!1,a=function(e){var t=e.window,r=e.subs;t.complete(),r.unsubscribe(),m.arrRemove(i,e),o&&s()},s=function(){var e,t,r;i&&(e=new h.Subscription,n.add(e),t=new p.Subject,i.push(r={window:t,subs:e,seen:0}),n.next(t.asObservable()),b.executeSchedule(e,l,function(){return a(r)},c))},u=(null!==f&&0<=f?b.executeSchedule(n,l,s,f,!0):o=!0,s(),function(e){return i.slice().forEach(e)});return e.subscribe(y.createOperatorSubscriber(n,function(t){u(function(e){e.window.next(t),d<=++e.seen&&a(e)})},function(){return r(function(e){return e.complete()})},function(t){return r(function(e){return e.error(t)})})),function(){i=null}})}},{"../Subject":423,"../Subscription":425,"../scheduler/async":597,"../util/args":614,"../util/arrRemove":617,"../util/executeSchedule":621,"../util/lift":633,"./OperatorSubscriber":460}],571:[function(e,t,r){"use strict";var u=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},c=(Object.defineProperty(r,"__esModule",{value:!0}),r.windowToggle=void 0,e("../Subject")),l=e("../Subscription"),n=e("../util/lift"),f=e("../observable/innerFrom"),d=e("./OperatorSubscriber"),p=e("../util/noop"),h=e("../util/arrRemove");r.windowToggle=function(t,s){return n.operate(function(e,i){function o(e){for(;0<a.length;)a.shift().error(e);i.error(e)}var a=[];f.innerFrom(t).subscribe(d.createOperatorSubscriber(i,function(e){var t,r=new c.Subject,n=(a.push(r),new l.Subscription);try{t=f.innerFrom(s(e))}catch(e){return void o(e)}i.next(r.asObservable()),n.add(t.subscribe(d.createOperatorSubscriber(i,function(){h.arrRemove(a,r),r.complete(),n.unsubscribe()},p.noop,o)))},p.noop)),e.subscribe(d.createOperatorSubscriber(i,function(e){var t,r,n=a.slice();try{for(var i=u(n),o=i.next();!o.done;o=i.next())o.value.next(e)}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},function(){for(;0<a.length;)a.shift().complete();i.complete()},o,function(){for(;0<a.length;)a.shift().unsubscribe()}))})}},{"../Subject":423,"../Subscription":425,"../observable/innerFrom":446,"../util/arrRemove":617,"../util/lift":633,"../util/noop":635,"./OperatorSubscriber":460}],572:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.windowWhen=void 0;var s=e("../Subject"),n=e("../util/lift"),u=e("./OperatorSubscriber"),c=e("../observable/innerFrom");r.windowWhen=function(a){return n.operate(function(e,t){var r,n,i=function(e){r.error(e),t.error(e)},o=function(){var e;null!=n&&n.unsubscribe(),null!=r&&r.complete(),r=new s.Subject,t.next(r.asObservable());try{e=c.innerFrom(a())}catch(e){return void i(e)}e.subscribe(n=u.createOperatorSubscriber(t,o,o,i))};o(),e.subscribe(u.createOperatorSubscriber(t,function(e){return r.next(e)},function(){r.complete(),t.complete()},i,function(){null!=n&&n.unsubscribe(),r=null}))})}},{"../Subject":423,"../observable/innerFrom":446,"../util/lift":633,"./OperatorSubscriber":460}],573:[function(e,t,r){"use strict";var c=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},l=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},n=(Object.defineProperty(r,"__esModule",{value:!0}),r.withLatestFrom=void 0,e("../util/lift")),f=e("./OperatorSubscriber"),d=e("../observable/innerFrom"),p=e("../util/identity"),h=e("../util/noop"),i=e("../util/args");r.withLatestFrom=function(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];var u=i.popResultSelector(s);return n.operate(function(e,r){for(var t=s.length,n=new Array(t),i=s.map(function(){return!1}),o=!1,a=0;a<t;a++)!function(t){d.innerFrom(s[t]).subscribe(f.createOperatorSubscriber(r,function(e){n[t]=e,!o&&!i[t]&&(i[t]=!0,o=i.every(p.identity))&&(i=null)},h.noop))}(a);e.subscribe(f.createOperatorSubscriber(r,function(e){o&&(e=l([e],c(n)),r.next(u?u.apply(void 0,l([],c(e))):e))}))})}},{"../observable/innerFrom":446,"../util/args":614,"../util/identity":622,"../util/lift":633,"../util/noop":635,"./OperatorSubscriber":460}],574:[function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},o=(Object.defineProperty(r,"__esModule",{value:!0}),r.zip=void 0,e("../observable/zip")),a=e("../util/lift");r.zip=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return a.operate(function(e,t){o.zip.apply(void 0,i([e],n(r))).subscribe(t)})}},{"../observable/zip":459,"../util/lift":633}],575:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.zipAll=void 0;var n=e("../observable/zip"),i=e("./joinAllInternals");r.zipAll=function(e){return i.joinAllInternals(n.zip,e)}},{"../observable/zip":459,"./joinAllInternals":505}],576:[function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},o=(Object.defineProperty(r,"__esModule",{value:!0}),r.zipWith=void 0,e("./zip"));r.zipWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o.zip.apply(void 0,i([],n(e)))}},{"./zip":574}],577:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.scheduleArray=void 0;var i=e("../Observable");r.scheduleArray=function(r,n){return new i.Observable(function(e){var t=0;return n.schedule(function(){t===r.length?e.complete():(e.next(r[t++]),e.closed||this.schedule())})})}},{"../Observable":420}],578:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.scheduleAsyncIterable=void 0;var i=e("../Observable"),o=e("../util/executeSchedule");r.scheduleAsyncIterable=function(r,n){if(r)return new i.Observable(function(t){o.executeSchedule(t,n,function(){var e=r[Symbol.asyncIterator]();o.executeSchedule(t,n,function(){e.next().then(function(e){e.done?t.complete():t.next(e.value)})},0,!0)})});throw new Error("Iterable cannot be null")}},{"../Observable":420,"../util/executeSchedule":621}],579:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.scheduleIterable=void 0;var n=e("../Observable"),o=e("../symbol/iterator"),a=e("../util/isFunction"),s=e("../util/executeSchedule");r.scheduleIterable=function(e,t){return new n.Observable(function(n){var i;return s.executeSchedule(n,t,function(){i=e[o.iterator](),s.executeSchedule(n,t,function(){var e,t,r;try{t=(e=i.next()).value,r=e.done}catch(e){return void n.error(e)}r?n.complete():n.next(t)},0,!0)}),function(){return a.isFunction(null==i?void 0:i.return)&&i.return()}})}},{"../Observable":420,"../symbol/iterator":604,"../util/executeSchedule":621,"../util/isFunction":626}],580:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.scheduleObservable=void 0;var n=e("../observable/innerFrom"),i=e("../operators/observeOn"),o=e("../operators/subscribeOn");r.scheduleObservable=function(e,t){return n.innerFrom(e).pipe(o.subscribeOn(t),i.observeOn(t))}},{"../observable/innerFrom":446,"../operators/observeOn":520,"../operators/subscribeOn":550}],581:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.schedulePromise=void 0;var n=e("../observable/innerFrom"),i=e("../operators/observeOn"),o=e("../operators/subscribeOn");r.schedulePromise=function(e,t){return n.innerFrom(e).pipe(o.subscribeOn(t),i.observeOn(t))}},{"../observable/innerFrom":446,"../operators/observeOn":520,"../operators/subscribeOn":550}],582:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.scheduleReadableStreamLike=void 0;var n=e("./scheduleAsyncIterable"),i=e("../util/isReadableStreamLike");r.scheduleReadableStreamLike=function(e,t){return n.scheduleAsyncIterable(i.readableStreamLikeToAsyncGenerator(e),t)}},{"../util/isReadableStreamLike":631,"./scheduleAsyncIterable":578}],583:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.scheduled=void 0;var n=e("./scheduleObservable"),i=e("./schedulePromise"),o=e("./scheduleArray"),a=e("./scheduleIterable"),s=e("./scheduleAsyncIterable"),u=e("../util/isInteropObservable"),c=e("../util/isPromise"),l=e("../util/isArrayLike"),f=e("../util/isIterable"),d=e("../util/isAsyncIterable"),p=e("../util/throwUnobservableError"),h=e("../util/isReadableStreamLike"),y=e("./scheduleReadableStreamLike");r.scheduled=function(e,t){if(null!=e){if(u.isInteropObservable(e))return n.scheduleObservable(e,t);if(l.isArrayLike(e))return o.scheduleArray(e,t);if(c.isPromise(e))return i.schedulePromise(e,t);if(d.isAsyncIterable(e))return s.scheduleAsyncIterable(e,t);if(f.isIterable(e))return a.scheduleIterable(e,t);if(h.isReadableStreamLike(e))return y.scheduleReadableStreamLike(e,t)}throw p.createInvalidObservableTypeError(e)}},{"../util/isArrayLike":623,"../util/isAsyncIterable":624,"../util/isInteropObservable":627,"../util/isIterable":628,"../util/isPromise":630,"../util/isReadableStreamLike":631,"../util/throwUnobservableError":639,"./scheduleArray":577,"./scheduleAsyncIterable":578,"./scheduleIterable":579,"./scheduleObservable":580,"./schedulePromise":581,"./scheduleReadableStreamLike":582}],584:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),e=(Object.defineProperty(r,"__esModule",{value:!0}),r.Action=void 0,e("../Subscription")),e=(i=e.Subscription,o(a,i),a.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},a);function a(e,t){return i.call(this)||this}r.Action=e},{"../Subscription":425}],585:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=(Object.defineProperty(r,"__esModule",{value:!0}),r.AnimationFrameAction=void 0,e("./AsyncAction")),s=e("./animationFrameProvider"),e=(i=a.AsyncAction,o(u,i),u.prototype.requestAsyncId=function(e,t,r){return null!==(r=void 0===r?0:r)&&0<r?i.prototype.requestAsyncId.call(this,e,t,r):(e.actions.push(this),e._scheduled||(e._scheduled=s.animationFrameProvider.requestAnimationFrame(function(){return e.flush(void 0)})))},u.prototype.recycleAsyncId=function(e,t,r){if(null!=(r=void 0===r?0:r)?0<r:0<this.delay)return i.prototype.recycleAsyncId.call(this,e,t,r);var r=e.actions;null!=t&&(null==(r=r[r.length-1])?void 0:r.id)!==t&&(s.animationFrameProvider.cancelAnimationFrame(t),e._scheduled=void 0)},u);function u(e,t){var r=i.call(this,e,t)||this;return r.scheduler=e,r.work=t,r}r.AnimationFrameAction=e},{"./AsyncAction":589,"./animationFrameProvider":595}],586:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),e=(Object.defineProperty(r,"__esModule",{value:!0}),r.AnimationFrameScheduler=void 0,e("./AsyncScheduler")),e=(i=e.AsyncScheduler,o(a,i),a.prototype.flush=function(e){this._active=!0;var t,r=this._scheduled,n=(this._scheduled=void 0,this.actions);e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while((e=n[0])&&e.id===r&&n.shift());if(this._active=!1,t){for(;(e=n[0])&&e.id===r&&n.shift();)e.unsubscribe();throw t}},a);function a(){return null!==i&&i.apply(this,arguments)||this}r.AnimationFrameScheduler=e},{"./AsyncScheduler":590}],587:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=(Object.defineProperty(r,"__esModule",{value:!0}),r.AsapAction=void 0,e("./AsyncAction")),s=e("./immediateProvider"),e=(i=a.AsyncAction,o(u,i),u.prototype.requestAsyncId=function(e,t,r){return null!==(r=void 0===r?0:r)&&0<r?i.prototype.requestAsyncId.call(this,e,t,r):(e.actions.push(this),e._scheduled||(e._scheduled=s.immediateProvider.setImmediate(e.flush.bind(e,void 0))))},u.prototype.recycleAsyncId=function(e,t,r){if(null!=(r=void 0===r?0:r)?0<r:0<this.delay)return i.prototype.recycleAsyncId.call(this,e,t,r);var r=e.actions;null!=t&&(null==(r=r[r.length-1])?void 0:r.id)!==t&&(s.immediateProvider.clearImmediate(t),e._scheduled===t)&&(e._scheduled=void 0)},u);function u(e,t){var r=i.call(this,e,t)||this;return r.scheduler=e,r.work=t,r}r.AsapAction=e},{"./AsyncAction":589,"./immediateProvider":599}],588:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),e=(Object.defineProperty(r,"__esModule",{value:!0}),r.AsapScheduler=void 0,e("./AsyncScheduler")),e=(i=e.AsyncScheduler,o(a,i),a.prototype.flush=function(e){this._active=!0;var t,r=this._scheduled,n=(this._scheduled=void 0,this.actions);e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while((e=n[0])&&e.id===r&&n.shift());if(this._active=!1,t){for(;(e=n[0])&&e.id===r&&n.shift();)e.unsubscribe();throw t}},a);function a(){return null!==i&&i.apply(this,arguments)||this}r.AsapScheduler=e},{"./AsyncScheduler":590}],589:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=(Object.defineProperty(r,"__esModule",{value:!0}),r.AsyncAction=void 0,e("./Action")),s=e("./intervalProvider"),u=e("../util/arrRemove"),e=(i=a.Action,o(c,i),c.prototype.schedule=function(e,t){var r;return void 0===t&&(t=0),this.closed||(this.state=e,e=this.id,r=this.scheduler,null!=e&&(this.id=this.recycleAsyncId(r,e,t)),this.pending=!0,this.delay=t,this.id=null!=(e=this.id)?e:this.requestAsyncId(r,this.id,t)),this},c.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),s.intervalProvider.setInterval(e.flush.bind(e,this),r)},c.prototype.recycleAsyncId=function(e,t,r){if(null!=(r=void 0===r?0:r)&&this.delay===r&&!1===this.pending)return t;null!=t&&s.intervalProvider.clearInterval(t)},c.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;e=this._execute(e,t);if(e)return e;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},c.prototype._execute=function(e,t){var r,n=!1;try{this.work(e)}catch(e){n=!0,r=e||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r},c.prototype.unsubscribe=function(){var e,t,r;this.closed||(e=this.id,r=(t=this.scheduler).actions,this.work=this.state=this.scheduler=null,this.pending=!1,u.arrRemove(r,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,i.prototype.unsubscribe.call(this))},c);function c(e,t){var r=i.call(this,e,t)||this;return r.scheduler=e,r.work=t,r.pending=!1,r}r.AsyncAction=e},{"../util/arrRemove":617,"./Action":584,"./intervalProvider":600}],590:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=(Object.defineProperty(r,"__esModule",{value:!0}),r.AsyncScheduler=void 0,e("../Scheduler")),e=(i=a.Scheduler,o(s,i),s.prototype.flush=function(e){var t,r=this.actions;if(this._active)r.push(e);else{this._active=!0;do{if(t=e.execute(e.state,e.delay))break}while(e=r.shift());if(this._active=!1,t){for(;e=r.shift();)e.unsubscribe();throw t}}},s);function s(e,t){void 0===t&&(t=a.Scheduler.now);e=i.call(this,e,t)||this;return e.actions=[],e._active=!1,e}r.AsyncScheduler=e},{"../Scheduler":422}],591:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),e=(Object.defineProperty(r,"__esModule",{value:!0}),r.QueueAction=void 0,e("./AsyncAction")),e=(i=e.AsyncAction,o(a,i),a.prototype.schedule=function(e,t){return 0<(t=void 0===t?0:t)?i.prototype.schedule.call(this,e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)},a.prototype.execute=function(e,t){return 0<t||this.closed?i.prototype.execute.call(this,e,t):this._execute(e,t)},a.prototype.requestAsyncId=function(e,t,r){return null!=(r=void 0===r?0:r)&&0<r||null==r&&0<this.delay?i.prototype.requestAsyncId.call(this,e,t,r):(e.flush(this),0)},a);function a(e,t){var r=i.call(this,e,t)||this;return r.scheduler=e,r.work=t,r}r.QueueAction=e},{"./AsyncAction":589}],592:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),e=(Object.defineProperty(r,"__esModule",{value:!0}),r.QueueScheduler=void 0,e("./AsyncScheduler")),e=(i=e.AsyncScheduler,o(a,i),a);function a(){return null!==i&&i.apply(this,arguments)||this}r.QueueScheduler=e},{"./AsyncScheduler":590}],593:[function(e,t,r){"use strict";var n,i,o=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=(Object.defineProperty(r,"__esModule",{value:!0}),r.VirtualAction=r.VirtualTimeScheduler=void 0,e("./AsyncAction")),s=e("../Subscription"),e=e("./AsyncScheduler"),e=(i=e.AsyncScheduler,o(u,i),u.prototype.flush=function(){for(var e,t,r=this.actions,n=this.maxFrames;(t=r[0])&&t.delay<=n&&(r.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=r.shift();)t.unsubscribe();throw e}},u.frameTimeFactor=10,u);function u(e,t){void 0===t&&(t=1/0);var r=i.call(this,e=void 0===e?l:e,function(){return r.frame})||this;return r.maxFrames=t,r.frame=0,r.index=-1,r}r.VirtualTimeScheduler=e;c=a.AsyncAction,o(f,c),f.prototype.schedule=function(e,t){if(void 0===t&&(t=0),Number.isFinite(t)){if(!this.id)return c.prototype.schedule.call(this,e,t);this.active=!1;var r=new f(this.scheduler,this.work);return this.add(r),r.schedule(e,t)}return s.Subscription.EMPTY},f.prototype.requestAsyncId=function(e,t,r){this.delay=e.frame+(r=void 0===r?0:r);r=e.actions;return r.push(this),r.sort(f.sortActions),1},f.prototype.recycleAsyncId=function(e,t,r){void 0===r&&(r=0)},f.prototype._execute=function(e,t){if(!0===this.active)return c.prototype._execute.call(this,e,t)},f.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1};var c,l=f;function f(e,t,r){void 0===r&&(r=e.index+=1);var n=c.call(this,e,t)||this;return n.scheduler=e,n.work=t,n.index=r,n.active=!0,n.index=e.index=r,n}r.VirtualAction=l},{"../Subscription":425,"./AsyncAction":589,"./AsyncScheduler":590}],594:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.animationFrame=r.animationFrameScheduler=void 0;var n=e("./AnimationFrameAction"),e=e("./AnimationFrameScheduler");r.animationFrameScheduler=new e.AnimationFrameScheduler(n.AnimationFrameAction),r.animationFrame=r.animationFrameScheduler},{"./AnimationFrameAction":585,"./AnimationFrameScheduler":586}],595:[function(e,t,o){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},a=(Object.defineProperty(o,"__esModule",{value:!0}),o.animationFrameProvider=void 0,e("../Subscription"));o.animationFrameProvider={schedule:function(t){var e=requestAnimationFrame,r=cancelAnimationFrame,n=o.animationFrameProvider.delegate,i=(n&&(e=n.requestAnimationFrame,r=n.cancelAnimationFrame),e(function(e){r=void 0,t(e)}));return new a.Subscription(function(){return null==r?void 0:r(i)})},requestAnimationFrame:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=o.animationFrameProvider.delegate;return((null==r?void 0:r.requestAnimationFrame)||requestAnimationFrame).apply(void 0,i([],n(e)))},cancelAnimationFrame:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=o.animationFrameProvider.delegate;return((null==r?void 0:r.cancelAnimationFrame)||cancelAnimationFrame).apply(void 0,i([],n(e)))},delegate:void 0}},{"../Subscription":425}],596:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.asap=r.asapScheduler=void 0;var n=e("./AsapAction"),e=e("./AsapScheduler");r.asapScheduler=new e.AsapScheduler(n.AsapAction),r.asap=r.asapScheduler},{"./AsapAction":587,"./AsapScheduler":588}],597:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.async=r.asyncScheduler=void 0;var n=e("./AsyncAction"),e=e("./AsyncScheduler");r.asyncScheduler=new e.AsyncScheduler(n.AsyncAction),r.async=r.asyncScheduler},{"./AsyncAction":589,"./AsyncScheduler":590}],598:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.dateTimestampProvider=void 0,r.dateTimestampProvider={now:function(){return(r.dateTimestampProvider.delegate||Date).now()},delegate:void 0}},{}],599:[function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},o=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},e=(Object.defineProperty(n,"__esModule",{value:!0}),n.immediateProvider=void 0,e("../util/Immediate")),a=e.Immediate.setImmediate,r=e.Immediate.clearImmediate;n.immediateProvider={setImmediate:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=n.immediateProvider.delegate;return((null==r?void 0:r.setImmediate)||a).apply(void 0,o([],i(e)))},clearImmediate:function(e){var t=n.immediateProvider.delegate;return((null==t?void 0:t.clearImmediate)||r)(e)},delegate:void 0}},{"../util/Immediate":609}],600:[function(e,t,o){"use strict";var a=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},s=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e};Object.defineProperty(o,"__esModule",{value:!0}),o.intervalProvider=void 0,o.intervalProvider={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=o.intervalProvider.delegate;return null!=i&&i.setInterval?i.setInterval.apply(i,s([e,t],a(r))):setInterval.apply(void 0,s([e,t],a(r)))},clearInterval:function(e){var t=o.intervalProvider.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0}},{}],601:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.performanceTimestampProvider=void 0,r.performanceTimestampProvider={now:function(){return(r.performanceTimestampProvider.delegate||performance).now()},delegate:void 0}},{}],602:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.queue=r.queueScheduler=void 0;var n=e("./QueueAction"),e=e("./QueueScheduler");r.queueScheduler=new e.QueueScheduler(n.QueueAction),r.queue=r.queueScheduler},{"./QueueAction":591,"./QueueScheduler":592}],603:[function(e,t,o){"use strict";var a=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},s=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e};Object.defineProperty(o,"__esModule",{value:!0}),o.timeoutProvider=void 0,o.timeoutProvider={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=o.timeoutProvider.delegate;return null!=i&&i.setTimeout?i.setTimeout.apply(i,s([e,t],a(r))):setTimeout.apply(void 0,s([e,t],a(r)))},clearTimeout:function(e){var t=o.timeoutProvider.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0}},{}],604:[function(e,t,r){"use strict";function n(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}Object.defineProperty(r,"__esModule",{value:!0}),r.iterator=r.getSymbolIterator=void 0,r.getSymbolIterator=n,r.iterator=n()},{}],605:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.observable=void 0,r.observable="function"==typeof Symbol&&Symbol.observable||"@@observable"},{}],606:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0})},{}],607:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ArgumentOutOfRangeError=void 0;e=e("./createErrorClass");r.ArgumentOutOfRangeError=e.createErrorClass(function(e){return function(){e(this),this.name="ArgumentOutOfRangeError",this.message="argument out of range"}})},{"./createErrorClass":618}],608:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.EmptyError=void 0;e=e("./createErrorClass");r.EmptyError=e.createErrorClass(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}})},{"./createErrorClass":618}],609:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.TestTools=r.Immediate=void 0;var n,i=1,o={};function a(e){return e in o&&(delete o[e],!0)}r.Immediate={setImmediate:function(e){var t=i++;return o[t]=!0,(n=n||Promise.resolve()).then(function(){return a(t)&&e()}),t},clearImmediate:function(e){a(e)}},r.TestTools={pending:function(){return Object.keys(o).length}}},{}],610:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.NotFoundError=void 0;e=e("./createErrorClass");r.NotFoundError=e.createErrorClass(function(t){return function(e){t(this),this.name="NotFoundError",this.message=e}})},{"./createErrorClass":618}],611:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ObjectUnsubscribedError=void 0;e=e("./createErrorClass");r.ObjectUnsubscribedError=e.createErrorClass(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})},{"./createErrorClass":618}],612:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.SequenceError=void 0;e=e("./createErrorClass");r.SequenceError=e.createErrorClass(function(t){return function(e){t(this),this.name="SequenceError",this.message=e}})},{"./createErrorClass":618}],613:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.UnsubscriptionError=void 0;e=e("./createErrorClass");r.UnsubscriptionError=e.createErrorClass(function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}})},{"./createErrorClass":618}],614:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.popNumber=r.popScheduler=r.popResultSelector=void 0;var n=e("./isFunction"),i=e("./isScheduler");function o(e){return e[e.length-1]}r.popResultSelector=function(e){return n.isFunction(o(e))?e.pop():void 0},r.popScheduler=function(e){return i.isScheduler(o(e))?e.pop():void 0},r.popNumber=function(e,t){return"number"==typeof o(e)?e.pop():t}},{"./isFunction":626,"./isScheduler":632}],615:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.argsArgArrayOrObject=void 0;var n=Array.isArray,i=Object.getPrototypeOf,o=Object.prototype,a=Object.keys;r.argsArgArrayOrObject=function(e){if(1===e.length){var t=e[0];if(n(t))return{args:t,keys:null};if((r=t)&&"object"==typeof r&&i(r)===o)return{args:(r=a(t)).map(function(e){return t[e]}),keys:r}}var r;return{args:e,keys:null}}},{}],616:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.argsOrArgArray=void 0;var n=Array.isArray;r.argsOrArgArray=function(e){return 1===e.length&&n(e[0])?e[0]:e}},{}],617:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.arrRemove=void 0,r.arrRemove=function(e,t){e&&0<=(t=e.indexOf(t))&&e.splice(t,1)}},{}],618:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createErrorClass=void 0,r.createErrorClass=function(e){return(e=e(function(e){Error.call(e),e.stack=(new Error).stack})).prototype=Object.create(Error.prototype),e.prototype.constructor=e}},{}],619:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createObject=void 0,r.createObject=function(e,n){return e.reduce(function(e,t,r){return e[t]=n[r],e},{})}},{}],620:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.captureError=r.errorContext=void 0;var n=e("../config"),i=null;r.errorContext=function(e){if(n.config.useDeprecatedSynchronousErrorHandling){var t=!i;if(t&&(i={errorThrown:!1,error:null}),e(),t){var t=i,r=t.errorThrown,t=t.error;if(i=null,r)throw t}}else e()},r.captureError=function(e){n.config.useDeprecatedSynchronousErrorHandling&&i&&(i.errorThrown=!0,i.error=e)}},{"../config":426}],621:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.executeSchedule=void 0,r.executeSchedule=function(e,t,r,n,i){if(void 0===n&&(n=0),void 0===i&&(i=!1),t=t.schedule(function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()},n),e.add(t),!i)return t}},{}],622:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.identity=void 0,r.identity=function(e){return e}},{}],623:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isArrayLike=void 0,r.isArrayLike=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e}},{}],624:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isAsyncIterable=void 0;var n=e("./isFunction");r.isAsyncIterable=function(e){return Symbol.asyncIterator&&n.isFunction(null==e?void 0:e[Symbol.asyncIterator])}},{"./isFunction":626}],625:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isValidDate=void 0,r.isValidDate=function(e){return e instanceof Date&&!isNaN(e)}},{}],626:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isFunction=void 0,r.isFunction=function(e){return"function"==typeof e}},{}],627:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isInteropObservable=void 0;var n=e("../symbol/observable"),i=e("./isFunction");r.isInteropObservable=function(e){return i.isFunction(e[n.observable])}},{"../symbol/observable":605,"./isFunction":626}],628:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isIterable=void 0;var n=e("../symbol/iterator"),i=e("./isFunction");r.isIterable=function(e){return i.isFunction(null==e?void 0:e[n.iterator])}},{"../symbol/iterator":604,"./isFunction":626}],629:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isObservable=void 0;var n=e("../Observable"),i=e("./isFunction");r.isObservable=function(e){return!!e&&(e instanceof n.Observable||i.isFunction(e.lift)&&i.isFunction(e.subscribe))}},{"../Observable":420,"./isFunction":626}],630:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isPromise=void 0;var n=e("./isFunction");r.isPromise=function(e){return n.isFunction(null==e?void 0:e.then)}},{"./isFunction":626}],631:[function(e,t,r){"use strict";var o=this&&this.__generator||function(n,i){var o,a,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(r){return function(e){var t=[r,e];if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,a&&(s=2&t[0]?a.return:t[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,(t=s?[2&t[0],s.value]:t)[0]){case 0:case 1:s=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,a=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3]))u.label=t[1];else if(6===t[0]&&u.label<s[1])u.label=s[1],s=t;else{if(!(s&&u.label<s[2])){s[2]&&u.ops.pop(),u.trys.pop();continue}u.label=s[2],u.ops.push(t)}}t=i.call(n,u)}catch(e){t=[6,e],a=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}},f=this&&this.__await||function(e){return this instanceof f?(this.v=e,this):new f(e)},n=this&&this.__asyncGenerator||function(e,t,r){var i,o,a;if(Symbol.asyncIterator)return i=r.apply(e,t||[]),o=[],a={},n("next"),n("throw"),n("return"),a[Symbol.asyncIterator]=function(){return this},a;throw new TypeError("Symbol.asyncIterator is not defined.");function n(n){i[n]&&(a[n]=function(r){return new Promise(function(e,t){1<o.push([n,r,e,t])||s(n,r)})})}function s(e,t){try{(r=i[e](t)).value instanceof f?Promise.resolve(r.value.v).then(u,c):l(o[0][2],r)}catch(e){l(o[0][3],e)}var r}function u(e){s("next",e)}function c(e){s("throw",e)}function l(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}},i=(Object.defineProperty(r,"__esModule",{value:!0}),r.isReadableStreamLike=r.readableStreamLikeToAsyncGenerator=void 0,e("./isFunction"));r.readableStreamLikeToAsyncGenerator=function(i){return n(this,arguments,function(){var t,r,n;return o(this,function(e){switch(e.label){case 0:t=i.getReader(),e.label=1;case 1:e.trys.push([1,,9,10]),e.label=2;case 2:return[4,f(t.read())];case 3:return(r=e.sent(),n=r.value,r.done)?[4,f(void 0)]:[3,5];case 4:return[2,e.sent()];case 5:return[4,f(n)];case 6:return[4,e.sent()];case 7:return e.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})},r.isReadableStreamLike=function(e){return i.isFunction(null==e?void 0:e.getReader)}},{"./isFunction":626}],632:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isScheduler=void 0;var n=e("./isFunction");r.isScheduler=function(e){return e&&n.isFunction(e.schedule)}},{"./isFunction":626}],633:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.operate=r.hasLift=void 0;var n=e("./isFunction");function i(e){return n.isFunction(null==e?void 0:e.lift)}r.hasLift=i,r.operate=function(t){return function(e){if(i(e))return e.lift(function(e){try{return t(e,this)}catch(e){this.error(e)}});throw new TypeError("Unable to lift unknown Observable type")}}},{"./isFunction":626}],634:[function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},i=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},o=(Object.defineProperty(r,"__esModule",{value:!0}),r.mapOneOrManyArgs=void 0,e("../operators/map")),a=Array.isArray;r.mapOneOrManyArgs=function(r){return o.map(function(e){return t=r,a(e=e)?t.apply(void 0,i([],n(e))):t(e);var t})}},{"../operators/map":507}],635:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.noop=void 0,r.noop=function(){}},{}],636:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.not=void 0,r.not=function(r,n){return function(e,t){return!r.call(n,e,t)}}},{}],637:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.pipeFromArray=r.pipe=void 0;var n=e("./identity");function i(t){return 0===t.length?n.identity:1===t.length?t[0]:function(e){return t.reduce(function(e,t){return t(e)},e)}}r.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i(e)},r.pipeFromArray=i},{"./identity":622}],638:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.reportUnhandledError=void 0;var n=e("../config"),i=e("../scheduler/timeoutProvider");r.reportUnhandledError=function(t){i.timeoutProvider.setTimeout(function(){var e=n.config.onUnhandledError;if(!e)throw t;e(t)})}},{"../config":426,"../scheduler/timeoutProvider":603}],639:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createInvalidObservableTypeError=void 0,r.createInvalidObservableTypeError=function(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}},{}],640:[function(e,T,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeAll=t.merge=t.max=t.materialize=t.mapTo=t.map=t.last=t.isEmpty=t.ignoreElements=t.groupBy=t.first=t.findIndex=t.find=t.finalize=t.filter=t.expand=t.exhaustMap=t.exhaustAll=t.exhaust=t.every=t.endWith=t.elementAt=t.distinctUntilKeyChanged=t.distinctUntilChanged=t.distinct=t.dematerialize=t.delayWhen=t.delay=t.defaultIfEmpty=t.debounceTime=t.debounce=t.count=t.connect=t.concatWith=t.concatMapTo=t.concatMap=t.concatAll=t.concat=t.combineLatestWith=t.combineLatest=t.combineLatestAll=t.combineAll=t.catchError=t.bufferWhen=t.bufferToggle=t.bufferTime=t.bufferCount=t.buffer=t.auditTime=t.audit=void 0,t.timeInterval=t.throwIfEmpty=t.throttleTime=t.throttle=t.tap=t.takeWhile=t.takeUntil=t.takeLast=t.take=t.switchScan=t.switchMapTo=t.switchMap=t.switchAll=t.subscribeOn=t.startWith=t.skipWhile=t.skipUntil=t.skipLast=t.skip=t.single=t.shareReplay=t.share=t.sequenceEqual=t.scan=t.sampleTime=t.sample=t.refCount=t.retryWhen=t.retry=t.repeatWhen=t.repeat=t.reduce=t.raceWith=t.race=t.publishReplay=t.publishLast=t.publishBehavior=t.publish=t.pluck=t.partition=t.pairwise=t.onErrorResumeNext=t.observeOn=t.multicast=t.min=t.mergeWith=t.mergeScan=t.mergeMapTo=t.mergeMap=t.flatMap=void 0,t.zipWith=t.zipAll=t.zip=t.withLatestFrom=t.windowWhen=t.windowToggle=t.windowTime=t.windowCount=t.window=t.toArray=t.timestamp=t.timeoutWith=t.timeout=void 0;var r=e("../internal/operators/audit"),n=(Object.defineProperty(t,"audit",{enumerable:!0,get:function(){return r.audit}}),e("../internal/operators/auditTime")),i=(Object.defineProperty(t,"auditTime",{enumerable:!0,get:function(){return n.auditTime}}),e("../internal/operators/buffer")),o=(Object.defineProperty(t,"buffer",{enumerable:!0,get:function(){return i.buffer}}),e("../internal/operators/bufferCount")),a=(Object.defineProperty(t,"bufferCount",{enumerable:!0,get:function(){return o.bufferCount}}),e("../internal/operators/bufferTime")),s=(Object.defineProperty(t,"bufferTime",{enumerable:!0,get:function(){return a.bufferTime}}),e("../internal/operators/bufferToggle")),u=(Object.defineProperty(t,"bufferToggle",{enumerable:!0,get:function(){return s.bufferToggle}}),e("../internal/operators/bufferWhen")),c=(Object.defineProperty(t,"bufferWhen",{enumerable:!0,get:function(){return u.bufferWhen}}),e("../internal/operators/catchError")),l=(Object.defineProperty(t,"catchError",{enumerable:!0,get:function(){return c.catchError}}),e("../internal/operators/combineAll")),f=(Object.defineProperty(t,"combineAll",{enumerable:!0,get:function(){return l.combineAll}}),e("../internal/operators/combineLatestAll")),d=(Object.defineProperty(t,"combineLatestAll",{enumerable:!0,get:function(){return f.combineLatestAll}}),e("../internal/operators/combineLatest")),p=(Object.defineProperty(t,"combineLatest",{enumerable:!0,get:function(){return d.combineLatest}}),e("../internal/operators/combineLatestWith")),h=(Object.defineProperty(t,"combineLatestWith",{enumerable:!0,get:function(){return p.combineLatestWith}}),e("../internal/operators/concat")),y=(Object.defineProperty(t,"concat",{enumerable:!0,get:function(){return h.concat}}),e("../internal/operators/concatAll")),m=(Object.defineProperty(t,"concatAll",{enumerable:!0,get:function(){return y.concatAll}}),e("../internal/operators/concatMap")),b=(Object.defineProperty(t,"concatMap",{enumerable:!0,get:function(){return m.concatMap}}),e("../internal/operators/concatMapTo")),v=(Object.defineProperty(t,"concatMapTo",{enumerable:!0,get:function(){return b.concatMapTo}}),e("../internal/operators/concatWith")),g=(Object.defineProperty(t,"concatWith",{enumerable:!0,get:function(){return v.concatWith}}),e("../internal/operators/connect")),O=(Object.defineProperty(t,"connect",{enumerable:!0,get:function(){return g.connect}}),e("../internal/operators/count")),_=(Object.defineProperty(t,"count",{enumerable:!0,get:function(){return O.count}}),e("../internal/operators/debounce")),w=(Object.defineProperty(t,"debounce",{enumerable:!0,get:function(){return _.debounce}}),e("../internal/operators/debounceTime")),S=(Object.defineProperty(t,"debounceTime",{enumerable:!0,get:function(){return w.debounceTime}}),e("../internal/operators/defaultIfEmpty")),x=(Object.defineProperty(t,"defaultIfEmpty",{enumerable:!0,get:function(){return S.defaultIfEmpty}}),e("../internal/operators/delay")),j=(Object.defineProperty(t,"delay",{enumerable:!0,get:function(){return x.delay}}),e("../internal/operators/delayWhen")),P=(Object.defineProperty(t,"delayWhen",{enumerable:!0,get:function(){return j.delayWhen}}),e("../internal/operators/dematerialize")),E=(Object.defineProperty(t,"dematerialize",{enumerable:!0,get:function(){return P.dematerialize}}),e("../internal/operators/distinct")),M=(Object.defineProperty(t,"distinct",{enumerable:!0,get:function(){return E.distinct}}),e("../internal/operators/distinctUntilChanged")),A=(Object.defineProperty(t,"distinctUntilChanged",{enumerable:!0,get:function(){return M.distinctUntilChanged}}),e("../internal/operators/distinctUntilKeyChanged")),I=(Object.defineProperty(t,"distinctUntilKeyChanged",{enumerable:!0,get:function(){return A.distinctUntilKeyChanged}}),e("../internal/operators/elementAt")),k=(Object.defineProperty(t,"elementAt",{enumerable:!0,get:function(){return I.elementAt}}),e("../internal/operators/endWith")),C=(Object.defineProperty(t,"endWith",{enumerable:!0,get:function(){return k.endWith}}),e("../internal/operators/every")),R=(Object.defineProperty(t,"every",{enumerable:!0,get:function(){return C.every}}),e("../internal/operators/exhaust")),D=(Object.defineProperty(t,"exhaust",{enumerable:!0,get:function(){return R.exhaust}}),e("../internal/operators/exhaustAll")),N=(Object.defineProperty(t,"exhaustAll",{enumerable:!0,get:function(){return D.exhaustAll}}),e("../internal/operators/exhaustMap")),$=(Object.defineProperty(t,"exhaustMap",{enumerable:!0,get:function(){return N.exhaustMap}}),e("../internal/operators/expand")),F=(Object.defineProperty(t,"expand",{enumerable:!0,get:function(){return $.expand}}),e("../internal/operators/filter")),L=(Object.defineProperty(t,"filter",{enumerable:!0,get:function(){return F.filter}}),e("../internal/operators/finalize")),B=(Object.defineProperty(t,"finalize",{enumerable:!0,get:function(){return L.finalize}}),e("../internal/operators/find")),q=(Object.defineProperty(t,"find",{enumerable:!0,get:function(){return B.find}}),e("../internal/operators/findIndex")),U=(Object.defineProperty(t,"findIndex",{enumerable:!0,get:function(){return q.findIndex}}),e("../internal/operators/first")),W=(Object.defineProperty(t,"first",{enumerable:!0,get:function(){return U.first}}),e("../internal/operators/groupBy")),V=(Object.defineProperty(t,"groupBy",{enumerable:!0,get:function(){return W.groupBy}}),e("../internal/operators/ignoreElements")),z=(Object.defineProperty(t,"ignoreElements",{enumerable:!0,get:function(){return V.ignoreElements}}),e("../internal/operators/isEmpty")),K=(Object.defineProperty(t,"isEmpty",{enumerable:!0,get:function(){return z.isEmpty}}),e("../internal/operators/last")),Q=(Object.defineProperty(t,"last",{enumerable:!0,get:function(){return K.last}}),e("../internal/operators/map")),H=(Object.defineProperty(t,"map",{enumerable:!0,get:function(){return Q.map}}),e("../internal/operators/mapTo")),G=(Object.defineProperty(t,"mapTo",{enumerable:!0,get:function(){return H.mapTo}}),e("../internal/operators/materialize")),J=(Object.defineProperty(t,"materialize",{enumerable:!0,get:function(){return G.materialize}}),e("../internal/operators/max")),Y=(Object.defineProperty(t,"max",{enumerable:!0,get:function(){return J.max}}),e("../internal/operators/merge")),X=(Object.defineProperty(t,"merge",{enumerable:!0,get:function(){return Y.merge}}),e("../internal/operators/mergeAll")),Z=(Object.defineProperty(t,"mergeAll",{enumerable:!0,get:function(){return X.mergeAll}}),e("../internal/operators/flatMap")),ee=(Object.defineProperty(t,"flatMap",{enumerable:!0,get:function(){return Z.flatMap}}),e("../internal/operators/mergeMap")),te=(Object.defineProperty(t,"mergeMap",{enumerable:!0,get:function(){return ee.mergeMap}}),e("../internal/operators/mergeMapTo")),re=(Object.defineProperty(t,"mergeMapTo",{enumerable:!0,get:function(){return te.mergeMapTo}}),e("../internal/operators/mergeScan")),ne=(Object.defineProperty(t,"mergeScan",{enumerable:!0,get:function(){return re.mergeScan}}),e("../internal/operators/mergeWith")),ie=(Object.defineProperty(t,"mergeWith",{enumerable:!0,get:function(){return ne.mergeWith}}),e("../internal/operators/min")),oe=(Object.defineProperty(t,"min",{enumerable:!0,get:function(){return ie.min}}),e("../internal/operators/multicast")),ae=(Object.defineProperty(t,"multicast",{enumerable:!0,get:function(){return oe.multicast}}),e("../internal/operators/observeOn")),se=(Object.defineProperty(t,"observeOn",{enumerable:!0,get:function(){return ae.observeOn}}),e("../internal/operators/onErrorResumeNextWith")),ue=(Object.defineProperty(t,"onErrorResumeNext",{enumerable:!0,get:function(){return se.onErrorResumeNext}}),e("../internal/operators/pairwise")),ce=(Object.defineProperty(t,"pairwise",{enumerable:!0,get:function(){return ue.pairwise}}),e("../internal/operators/partition")),le=(Object.defineProperty(t,"partition",{enumerable:!0,get:function(){return ce.partition}}),e("../internal/operators/pluck")),fe=(Object.defineProperty(t,"pluck",{enumerable:!0,get:function(){return le.pluck}}),e("../internal/operators/publish")),de=(Object.defineProperty(t,"publish",{enumerable:!0,get:function(){return fe.publish}}),e("../internal/operators/publishBehavior")),pe=(Object.defineProperty(t,"publishBehavior",{enumerable:!0,get:function(){return de.publishBehavior}}),e("../internal/operators/publishLast")),he=(Object.defineProperty(t,"publishLast",{enumerable:!0,get:function(){return pe.publishLast}}),e("../internal/operators/publishReplay")),ye=(Object.defineProperty(t,"publishReplay",{enumerable:!0,get:function(){return he.publishReplay}}),e("../internal/operators/race")),me=(Object.defineProperty(t,"race",{enumerable:!0,get:function(){return ye.race}}),e("../internal/operators/raceWith")),be=(Object.defineProperty(t,"raceWith",{enumerable:!0,get:function(){return me.raceWith}}),e("../internal/operators/reduce")),ve=(Object.defineProperty(t,"reduce",{enumerable:!0,get:function(){return be.reduce}}),e("../internal/operators/repeat")),ge=(Object.defineProperty(t,"repeat",{enumerable:!0,get:function(){return ve.repeat}}),e("../internal/operators/repeatWhen")),Oe=(Object.defineProperty(t,"repeatWhen",{enumerable:!0,get:function(){return ge.repeatWhen}}),e("../internal/operators/retry")),_e=(Object.defineProperty(t,"retry",{enumerable:!0,get:function(){return Oe.retry}}),e("../internal/operators/retryWhen")),we=(Object.defineProperty(t,"retryWhen",{enumerable:!0,get:function(){return _e.retryWhen}}),e("../internal/operators/refCount")),Se=(Object.defineProperty(t,"refCount",{enumerable:!0,get:function(){return we.refCount}}),e("../internal/operators/sample")),xe=(Object.defineProperty(t,"sample",{enumerable:!0,get:function(){return Se.sample}}),e("../internal/operators/sampleTime")),je=(Object.defineProperty(t,"sampleTime",{enumerable:!0,get:function(){return xe.sampleTime}}),e("../internal/operators/scan")),Pe=(Object.defineProperty(t,"scan",{enumerable:!0,get:function(){return je.scan}}),e("../internal/operators/sequenceEqual")),Ee=(Object.defineProperty(t,"sequenceEqual",{enumerable:!0,get:function(){return Pe.sequenceEqual}}),e("../internal/operators/share")),Me=(Object.defineProperty(t,"share",{enumerable:!0,get:function(){return Ee.share}}),e("../internal/operators/shareReplay")),Ae=(Object.defineProperty(t,"shareReplay",{enumerable:!0,get:function(){return Me.shareReplay}}),e("../internal/operators/single")),Ie=(Object.defineProperty(t,"single",{enumerable:!0,get:function(){return Ae.single}}),e("../internal/operators/skip")),ke=(Object.defineProperty(t,"skip",{enumerable:!0,get:function(){return Ie.skip}}),e("../internal/operators/skipLast")),Ce=(Object.defineProperty(t,"skipLast",{enumerable:!0,get:function(){return ke.skipLast}}),e("../internal/operators/skipUntil")),Re=(Object.defineProperty(t,"skipUntil",{enumerable:!0,get:function(){return Ce.skipUntil}}),e("../internal/operators/skipWhile")),De=(Object.defineProperty(t,"skipWhile",{enumerable:!0,get:function(){return Re.skipWhile}}),e("../internal/operators/startWith")),Ne=(Object.defineProperty(t,"startWith",{enumerable:!0,get:function(){return De.startWith}}),e("../internal/operators/subscribeOn")),Te=(Object.defineProperty(t,"subscribeOn",{enumerable:!0,get:function(){return Ne.subscribeOn}}),e("../internal/operators/switchAll")),$e=(Object.defineProperty(t,"switchAll",{enumerable:!0,get:function(){return Te.switchAll}}),e("../internal/operators/switchMap")),Fe=(Object.defineProperty(t,"switchMap",{enumerable:!0,get:function(){return $e.switchMap}}),e("../internal/operators/switchMapTo")),Le=(Object.defineProperty(t,"switchMapTo",{enumerable:!0,get:function(){return Fe.switchMapTo}}),e("../internal/operators/switchScan")),Be=(Object.defineProperty(t,"switchScan",{enumerable:!0,get:function(){return Le.switchScan}}),e("../internal/operators/take")),qe=(Object.defineProperty(t,"take",{enumerable:!0,get:function(){return Be.take}}),e("../internal/operators/takeLast")),Ue=(Object.defineProperty(t,"takeLast",{enumerable:!0,get:function(){return qe.takeLast}}),e("../internal/operators/takeUntil")),We=(Object.defineProperty(t,"takeUntil",{enumerable:!0,get:function(){return Ue.takeUntil}}),e("../internal/operators/takeWhile")),Ve=(Object.defineProperty(t,"takeWhile",{enumerable:!0,get:function(){return We.takeWhile}}),e("../internal/operators/tap")),ze=(Object.defineProperty(t,"tap",{enumerable:!0,get:function(){return Ve.tap}}),e("../internal/operators/throttle")),Ke=(Object.defineProperty(t,"throttle",{enumerable:!0,get:function(){return ze.throttle}}),e("../internal/operators/throttleTime")),Qe=(Object.defineProperty(t,"throttleTime",{enumerable:!0,get:function(){return Ke.throttleTime}}),e("../internal/operators/throwIfEmpty")),He=(Object.defineProperty(t,"throwIfEmpty",{enumerable:!0,get:function(){return Qe.throwIfEmpty}}),e("../internal/operators/timeInterval")),Ge=(Object.defineProperty(t,"timeInterval",{enumerable:!0,get:function(){return He.timeInterval}}),e("../internal/operators/timeout")),Je=(Object.defineProperty(t,"timeout",{enumerable:!0,get:function(){return Ge.timeout}}),e("../internal/operators/timeoutWith")),Ye=(Object.defineProperty(t,"timeoutWith",{enumerable:!0,get:function(){return Je.timeoutWith}}),e("../internal/operators/timestamp")),Xe=(Object.defineProperty(t,"timestamp",{enumerable:!0,get:function(){return Ye.timestamp}}),e("../internal/operators/toArray")),Ze=(Object.defineProperty(t,"toArray",{enumerable:!0,get:function(){return Xe.toArray}}),e("../internal/operators/window")),et=(Object.defineProperty(t,"window",{enumerable:!0,get:function(){return Ze.window}}),e("../internal/operators/windowCount")),tt=(Object.defineProperty(t,"windowCount",{enumerable:!0,get:function(){return et.windowCount}}),e("../internal/operators/windowTime")),rt=(Object.defineProperty(t,"windowTime",{enumerable:!0,get:function(){return tt.windowTime}}),e("../internal/operators/windowToggle")),nt=(Object.defineProperty(t,"windowToggle",{enumerable:!0,get:function(){return rt.windowToggle}}),e("../internal/operators/windowWhen")),it=(Object.defineProperty(t,"windowWhen",{enumerable:!0,get:function(){return nt.windowWhen}}),e("../internal/operators/withLatestFrom")),ot=(Object.defineProperty(t,"withLatestFrom",{enumerable:!0,get:function(){return it.withLatestFrom}}),e("../internal/operators/zip")),at=(Object.defineProperty(t,"zip",{enumerable:!0,get:function(){return ot.zip}}),e("../internal/operators/zipAll")),st=(Object.defineProperty(t,"zipAll",{enumerable:!0,get:function(){return at.zipAll}}),e("../internal/operators/zipWith"));Object.defineProperty(t,"zipWith",{enumerable:!0,get:function(){return st.zipWith}})},{"../internal/operators/audit":461,"../internal/operators/auditTime":462,"../internal/operators/buffer":463,"../internal/operators/bufferCount":464,"../internal/operators/bufferTime":465,"../internal/operators/bufferToggle":466,"../internal/operators/bufferWhen":467,"../internal/operators/catchError":468,"../internal/operators/combineAll":469,"../internal/operators/combineLatest":470,"../internal/operators/combineLatestAll":471,"../internal/operators/combineLatestWith":472,"../internal/operators/concat":473,"../internal/operators/concatAll":474,"../internal/operators/concatMap":475,"../internal/operators/concatMapTo":476,"../internal/operators/concatWith":477,"../internal/operators/connect":478,"../internal/operators/count":479,"../internal/operators/debounce":480,"../internal/operators/debounceTime":481,"../internal/operators/defaultIfEmpty":482,"../internal/operators/delay":483,"../internal/operators/delayWhen":484,"../internal/operators/dematerialize":485,"../internal/operators/distinct":486,"../internal/operators/distinctUntilChanged":487,"../internal/operators/distinctUntilKeyChanged":488,"../internal/operators/elementAt":489,"../internal/operators/endWith":490,"../internal/operators/every":491,"../internal/operators/exhaust":492,"../internal/operators/exhaustAll":493,"../internal/operators/exhaustMap":494,"../internal/operators/expand":495,"../internal/operators/filter":496,"../internal/operators/finalize":497,"../internal/operators/find":498,"../internal/operators/findIndex":499,"../internal/operators/first":500,"../internal/operators/flatMap":501,"../internal/operators/groupBy":502,"../internal/operators/ignoreElements":503,"../internal/operators/isEmpty":504,"../internal/operators/last":506,"../internal/operators/map":507,"../internal/operators/mapTo":508,"../internal/operators/materialize":509,"../internal/operators/max":510,"../internal/operators/merge":511,"../internal/operators/mergeAll":512,"../internal/operators/mergeMap":514,"../internal/operators/mergeMapTo":515,"../internal/operators/mergeScan":516,"../internal/operators/mergeWith":517,"../internal/operators/min":518,"../internal/operators/multicast":519,"../internal/operators/observeOn":520,"../internal/operators/onErrorResumeNextWith":521,"../internal/operators/pairwise":522,"../internal/operators/partition":523,"../internal/operators/pluck":524,"../internal/operators/publish":525,"../internal/operators/publishBehavior":526,"../internal/operators/publishLast":527,"../internal/operators/publishReplay":528,"../internal/operators/race":529,"../internal/operators/raceWith":530,"../internal/operators/reduce":531,"../internal/operators/refCount":532,"../internal/operators/repeat":533,"../internal/operators/repeatWhen":534,"../internal/operators/retry":535,"../internal/operators/retryWhen":536,"../internal/operators/sample":537,"../internal/operators/sampleTime":538,"../internal/operators/scan":539,"../internal/operators/sequenceEqual":541,"../internal/operators/share":542,"../internal/operators/shareReplay":543,"../internal/operators/single":544,"../internal/operators/skip":545,"../internal/operators/skipLast":546,"../internal/operators/skipUntil":547,"../internal/operators/skipWhile":548,"../internal/operators/startWith":549,"../internal/operators/subscribeOn":550,"../internal/operators/switchAll":551,"../internal/operators/switchMap":552,"../internal/operators/switchMapTo":553,"../internal/operators/switchScan":554,"../internal/operators/take":555,"../internal/operators/takeLast":556,"../internal/operators/takeUntil":557,"../internal/operators/takeWhile":558,"../internal/operators/tap":559,"../internal/operators/throttle":560,"../internal/operators/throttleTime":561,"../internal/operators/throwIfEmpty":562,"../internal/operators/timeInterval":563,"../internal/operators/timeout":564,"../internal/operators/timeoutWith":565,"../internal/operators/timestamp":566,"../internal/operators/toArray":567,"../internal/operators/window":568,"../internal/operators/windowCount":569,"../internal/operators/windowTime":570,"../internal/operators/windowToggle":571,"../internal/operators/windowWhen":572,"../internal/operators/withLatestFrom":573,"../internal/operators/zip":574,"../internal/operators/zipAll":575,"../internal/operators/zipWith":576}],641:[function(e,t,r){"use strict";var n=e("get-intrinsic"),a=e("define-data-property"),s=e("has-property-descriptors")(),u=e("gopd"),c=n("%TypeError%"),l=n("%Math.floor%");t.exports=function(e,t){if("function"!=typeof e)throw new c("`fn` is not a function");if("number"!=typeof t||t<0||4294967295<t||l(t)!==t)throw new c("`length` must be a positive 32-bit integer");var r,n=2<arguments.length&&!!arguments[2],i=!0,o=!0;return"length"in e&&u&&((r=u(e,"length"))&&!r.configurable&&(i=!1),r)&&!r.writable&&(o=!1),!i&&!o&&n||(s?a(e,"length",t,!0,!0):a(e,"length",t)),e}},{"define-data-property":41,"get-intrinsic":54,gopd:55,"has-property-descriptors":56}],642:[function(e,t,r){"use strict";var n=e("define-data-property"),i=e("has-property-descriptors")(),o=e("functions-have-names").functionsHaveConfigurableNames(),a=TypeError;t.exports=function(e,t){if("function"!=typeof e)throw new a("`fn` is not a function");return 2<arguments.length&&!!arguments[2]&&!o||(i?n(e,"name",t,!0,!0):n(e,"name",t)),e}},{"define-data-property":41,"functions-have-names":53,"has-property-descriptors":56}],643:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.addBrowser=function(e){{var t;"function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?(t=self.close.bind(self),self.close=function(){return e(),t()}):"function"==typeof window.addEventListener&&(window.addEventListener("beforeunload",function(){e()},!0),window.addEventListener("unload",function(){e()},!0))}}},{}],644:[function(s,e,u){!function(a){!function(){"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.add=function(e){if(i||(i=!0,r(o)),"function"!=typeof e)throw new Error("Listener is no function");return n.add(e),{remove:function(){return n.delete(e)},run:function(){return n.delete(e),e()}}},u.getSize=function(){return n.size},u.removeAll=function(){n.clear()},u.runAll=o;var e=s("./browser.js"),t=s("./node.js"),r="[object process]"===Object.prototype.toString.call(void 0!==a?a:0)?t.addNode:e.addBrowser,n=new Set,i=!1;function o(){var t=[];return n.forEach(function(e){t.push(e()),n.delete(e)}),Promise.all(t)}}.call(this)}.call(this,s("_process"))},{"./browser.js":643,"./node.js":645,_process:651}],645:[function(e,t,n){!function(r){!function(){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.addNode=function(t){r.on("exit",function(){return t()}),r.on("beforeExit",function(){return t().then(function(){return r.exit()})}),r.on("SIGINT",function(){return t().then(function(){return r.exit()})}),r.on("uncaughtException",function(e){return t().then(function(){console.trace(e),r.exit(101)})})}}.call(this)}.call(this,e("_process"))},{_process:651}],646:[function(e,t,r){"use strict";var o=e("rxdb"),n=e("rxdb/plugins/dev-mode"),i=e("rxdb/plugins/update"),a=e("rxdb/plugins/json-dump"),u=e("rxdb/plugins/storage-dexie"),c=e("rxdb/plugins/storage-lokijs"),l=e("rxdb/plugins/storage-memory");function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(){A=function(){return a};var u,a={},e=Object.prototype,c=e.hasOwnProperty,l=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",i=t.toStringTag||"@@toStringTag";function o(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(u){o=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var i,o,a,s,t=t&&t.prototype instanceof b?t:b,t=Object.create(t.prototype),n=new P(n||[]);return l(t,"_invoke",{value:(i=e,o=r,a=n,s=d,function(e,t){if(s===h)throw new Error("Generator is already running");if(s===y){if("throw"===e)throw t;return{value:u,done:!0}}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,i=t.iterator[n];if(i===u)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=u,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;n=f(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,m;i=n.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=u),r.delegate=null,m):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}(r,a);if(r){if(r===m)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(s===d)throw s=y,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s=h;r=f(i,o,a);if("normal"===r.type){if(s=a.done?y:p,r.arg===m)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s=y,a.method="throw",a.arg=r.arg)}})}),t}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=s;var d="suspendedStart",p="suspendedYield",h="executing",y="completed",m={};function b(){}function v(){}function g(){}var t={},O=(o(t,n,function(){return this}),Object.getPrototypeOf),O=O&&O(O(E([]))),_=(O&&O!==e&&c.call(O,n)&&(t=O),g.prototype=b.prototype=Object.create(t));function w(e){["next","throw","return"].forEach(function(t){o(e,t,function(e){return this._invoke(t,e)})})}function S(a,s){var t;l(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,i){var o,e=f(a[e],a,r);if("throw"!==e.type)return(r=(o=e.arg).value)&&"object"==M(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,i)},function(e){t("throw",e,n,i)}):s.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,i)});i(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function E(t){if(t||""===t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=u,e.done=!0,e}).next=e}throw new TypeError(M(t)+" is not iterable")}return l(_,"constructor",{value:v.prototype=g,configurable:!0}),l(g,"constructor",{value:v,configurable:!0}),v.displayName=o(g,i,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,o(e,i,"GeneratorFunction")),e.prototype=Object.create(_),e},a.awrap=function(e){return{__await:e}},w(S.prototype),o(S.prototype,r,function(){return this}),a.AsyncIterator=S,a.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var o=new S(s(e,t,r,n),i);return a.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},w(_),o(_,i,"Generator"),o(_,n,function(){return this}),o(_,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=E,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=u,this.done=!1,this.delegate=null,this.method="next",this.arg=u,this.tryEntries.forEach(j),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=u)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=u),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=c.call(i,"catchLoc"),s=c.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}var o=(i=i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc?null:i)?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,i=this.tryEntries[t];if(i.tryLoc===e)return"throw"===(r=i.completion).type&&(n=r.arg,j(i)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=u),m}},a}function s(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function f(n){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?s(Object(i),!0).forEach(function(e){var t,r;t=n,r=i[e=e],(e=function(e){e=function(e,t){if("object"!=M(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=M(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==M(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})}return n}function d(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}e={addRxPlugin:o.addRxPlugin,createRxDB:function(){return p.apply(this,arguments)},removeRxDatabase:o.removeRxDatabase,isRxDatabase:o.isRxDatabase,RxDBDevModePlugin:n.RxDBDevModePlugin,RxDBUpdatePlugin:i.RxDBUpdatePlugin,RxDBJsonDumpPlugin:a.RxDBJsonDumpPlugin};function p(){var s;return s=A().mark(function e(){var t,r,n,i=arguments;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=0<i.length&&void 0!==i[0]?i[0]:"dexie",t=1<i.length&&void 0!==i[1]?i[1]:{},e.t0=n,e.next="dexie"===e.t0?5:"lokijs"===e.t0?7:"memory"===e.t0?9:11;break;case 5:return r=(0,u.getRxStorageDexie)(),e.abrupt("break",12);case 7:return r=(0,c.getRxStorageLoki)(),e.abrupt("break",12);case 9:return r=(0,l.getRxStorageMemory)(),e.abrupt("break",12);case 11:return e.abrupt("break",12);case 12:return e.next=14,(0,o.createRxDatabase)(f({storage:r},t));case 14:return n=e.sent,e.abrupt("return",n);case 16:case"end":return e.stop()}},e)}),(p=function(){var e=this,a=arguments;return new Promise(function(t,r){var n=s.apply(e,a);function i(e){d(n,t,r,i,o,"next",e)}function o(e){d(n,t,r,i,o,"throw",e)}i(void 0)})}).apply(this,arguments)}window.RxDBCustom=e},{rxdb:328,"rxdb/plugins/dev-mode":339,"rxdb/plugins/json-dump":341,"rxdb/plugins/storage-dexie":345,"rxdb/plugins/storage-lokijs":348,"rxdb/plugins/storage-memory":354,"rxdb/plugins/update":359}],647:[function(e,t,r){},{}],648:[function(e,t,r){"use strict";r.byteLength=function(e){var e=l(e),t=e[0],e=e[1];return 3*(t+e)/4-e},r.toByteArray=function(e){var t,r,n=l(e),i=n[0],n=n[1],o=new c(function(e,t){return 3*(e+t)/4-t}(i,n)),a=0,s=0<n?i-4:i;for(r=0;r<s;r+=4)t=u[e.charCodeAt(r)]<<18|u[e.charCodeAt(r+1)]<<12|u[e.charCodeAt(r+2)]<<6|u[e.charCodeAt(r+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=255&t;2===n&&(t=u[e.charCodeAt(r)]<<2|u[e.charCodeAt(r+1)]>>4,o[a++]=255&t);1===n&&(t=u[e.charCodeAt(r)]<<10|u[e.charCodeAt(r+1)]<<4|u[e.charCodeAt(r+2)]>>2,o[a++]=t>>8&255,o[a++]=255&t);return o},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,i=[],o=0,a=r-n;o<a;o+=16383)i.push(function(e,t,r){for(var n,i=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(function(e){return s[e>>18&63]+s[e>>12&63]+s[e>>6&63]+s[63&e]}(n));return i.join("")}(e,o,a<o+16383?a:o+16383));1==n?(t=e[r-1],i.push(s[t>>2]+s[t<<4&63]+"==")):2==n&&(t=(e[r-2]<<8)+e[r-1],i.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"="));return i.join("")};for(var s=[],u=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=n.length;i<o;++i)s[i]=n[i],u[n.charCodeAt(i)]=i;function l(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("="),t=(e=-1===e?t:e)===t?0:4-e%4;return[e,t]}u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63},{}],649:[function(k,e,C){!function(e){!function(){"use strict";var x=k("base64-js"),o=k("ieee754"),t=(C.Buffer=f,C.SlowBuffer=function(e){+e!=e&&(e=0);return f.alloc(+e)},C.INSPECT_MAX_BYTES=50,2147483647);function u(e){if(t<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');e=new Uint8Array(e);return e.__proto__=f.prototype,e}function f(e,t,r){if("number"!=typeof e)return n(e,t,r);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return a(e)}function n(e,t,r){if("string"==typeof e){var n=e,i=t;if(f.isEncoding(i="string"==typeof i&&""!==i?i:"utf8"))return o=0|d(n,i),a=u(o),a=(n=a.write(n,i))!==o?a.slice(0,n):a;throw new TypeError("Unknown encoding: "+i)}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(A(e,ArrayBuffer)||e&&A(e.buffer,ArrayBuffer)){var o=e,n=t,a=r;if(n<0||o.byteLength<n)throw new RangeError('"offset" is outside of buffer bounds');if(o.byteLength<n+(a||0))throw new RangeError('"length" is outside of buffer bounds');return(o=void 0===n&&void 0===a?new Uint8Array(o):void 0===a?new Uint8Array(o,n):new Uint8Array(o,n,a)).__proto__=f.prototype,o}if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return f.from(i,t,r);var s=function(e){{var t,r;if(f.isBuffer(e))return t=0|l(e.length),0!==(r=u(t)).length&&e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||I(e.length)?u(0):c(e);if("Buffer"===e.type&&Array.isArray(e.data))return c(e.data)}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return f.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function i(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function a(e){return i(e),u(e<0?0:0|l(e))}function c(e){for(var t=e.length<0?0:0|l(e.length),r=u(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function l(e){if(t<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+t.toString(16)+" bytes");return 0|e}function d(e,t){if(f.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||A(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=2<arguments.length&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return P(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return E(e).length;default:if(i)return n?-1:P(e).length;t=(""+t).toLowerCase(),i=!0}}function r(e,t,r){var n,i=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((r=void 0===r||r>this.length?this.length:r)<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var o=this,a=t,s=r,u=o.length;(!s||s<0||u<s)&&(s=u);for(var c="",l=a=!a||a<0?0:a;l<s;++l)c+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(o[l]);return c;case"utf8":case"utf-8":return j(this,t,r);case"ascii":var f=this,u=t,d=r,p="";d=Math.min(f.length,d);for(var h=u;h<d;++h)p+=String.fromCharCode(127&f[h]);return p;case"latin1":case"binary":var y=this,a=t,m=r,b="";m=Math.min(y.length,m);for(var v=a;v<m;++v)b+=String.fromCharCode(y[v]);return b;case"base64":return g=this,n=r,0===(O=t)&&n===g.length?x.fromByteArray(g):x.fromByteArray(g.slice(O,n));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var g=t,O=r,_=this.slice(g,O),w="",S=0;S<_.length;S+=2)w+=String.fromCharCode(_[S]+256*_[S+1]);return w;default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function s(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function p(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),(r=(r=I(r=+r)?i?0:e.length-1:r)<0?e.length+r:r)>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=f.from(t,n)),f.isBuffer(t))return 0===t.length?-1:h(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?(i?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,r):h(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function h(e,t,r,n,i){var o=1,a=e.length,s=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a/=o=2,s/=2,r/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i)for(var c=-1,l=r;l<a;l++)if(u(e,l)===u(t,-1===c?0:l-c)){if(l-(c=-1===c?l:c)+1===s)return c*o}else-1!==c&&(l-=l-c),c=-1;else for(l=r=a<r+s?a-s:r;0<=l;l--){for(var f=!0,d=0;d<s;d++)if(u(e,l+d)!==u(t,d)){f=!1;break}if(f)return l}return-1}function m(e,t,r,n){return M(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function b(e,t,r,n){return M(function(e,t){for(var r,n,i=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i.push(r%256),i.push(n);return i}(t,e.length-r),e,r,n)}function j(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,u,c=e[i],l=null,f=239<c?4:223<c?3:191<c?2:1;if(i+f<=r)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&127<(u=(31&c)<<6|63&o)&&(l=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&2047<(u=(15&c)<<12|(63&o)<<6|63&a)&&(u<55296||57343<u)&&(l=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&65535<(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)&&u<1114112&&(l=u)}null===l?(l=65533,f=1):65535<l&&(n.push((l-=65536)>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=f}var d=n,p=d.length;if(p<=v)return String.fromCharCode.apply(String,d);for(var h="",y=0;y<p;)h+=String.fromCharCode.apply(String,d.slice(y,y+=v));return h}C.kMaxLength=t,(f.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&f[Symbol.species]===f&&Object.defineProperty(f,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),f.poolSize=8192,f.from=n,f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array,f.alloc=function(e,t,r){return t=t,r=r,i(e=e),!(e<=0)&&void 0!==t?"string"==typeof r?u(e).fill(t,r):u(e).fill(t):u(e)},f.allocUnsafe=a,f.allocUnsafeSlow=a,f.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==f.prototype},f.compare=function(e,t){if(A(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),A(t,Uint8Array)&&(t=f.from(t,t.offset,t.byteLength)),!f.isBuffer(e)||!f.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},f.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return f.alloc(0);if(void 0===t)for(i=t=0;i<e.length;++i)t+=e[i].length;for(var r=f.allocUnsafe(t),n=0,i=0;i<e.length;++i){var o=e[i];if(A(o,Uint8Array)&&(o=f.from(o)),!f.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,n),n+=o.length}return r},f.byteLength=d,f.prototype._isBuffer=!0,f.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)s(this,t,t+1);return this},f.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)s(this,t,t+3),s(this,t+1,t+2);return this},f.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)s(this,t,t+7),s(this,t+1,t+6),s(this,t+2,t+5),s(this,t+3,t+4);return this},f.prototype.toLocaleString=f.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?j(this,0,e):r.apply(this,arguments)},f.prototype.equals=function(e){if(f.isBuffer(e))return this===e||0===f.compare(this,e);throw new TypeError("Argument must be a Buffer")},f.prototype.inspect=function(){var e="",t=C.INSPECT_MAX_BYTES,e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim();return this.length>t&&(e+=" ... "),"<Buffer "+e+">"},f.prototype.compare=function(e,t,r,n,i){if(A(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),!f.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),(t=void 0===t?0:t)<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(i<=n&&r<=t)return 0;if(i<=n)return-1;if(r<=t)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),s=Math.min(o,a),u=this.slice(n,i),c=e.slice(t,r),l=0;l<s;++l)if(u[l]!==c[l]){o=u[l],a=c[l];break}return o<a?-1:a<o?1:0},f.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},f.prototype.indexOf=function(e,t,r){return p(this,e,t,r,!0)},f.prototype.lastIndexOf=function(e,t,r){return p(this,e,t,r,!1)},f.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||i<r)&&(r=i),0<e.length&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var o,a,s,u=!1;;)switch(n){case"hex":var c=this,l=e,f=t,d=r,p=(f=Number(f)||0,c.length-f);(!d||p<(d=Number(d)))&&(d=p),(p=l.length)/2<d&&(d=p/2);for(var h=0;h<d;++h){var y=parseInt(l.substr(2*h,2),16);if(I(y))return h;c[f+h]=y}return h;case"utf8":case"utf-8":return p=t,s=r,M(P(e,(a=this).length-p),a,p,s);case"ascii":return m(this,e,t,r);case"latin1":case"binary":return m(this,e,t,r);case"base64":return a=this,s=t,o=r,M(E(e),a,s,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,e,t,r);default:if(u)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),u=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var v=4096;function y(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function g(e,t,r,n,i,o){if(!f.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<t||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function O(e,t,r,n){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function _(e,t,r,n,i){return t=+t,r>>>=0,i||O(e,0,r,4),o.write(e,t,r,n,23,4),r+4}function w(e,t,r,n,i){return t=+t,r>>>=0,i||O(e,0,r,8),o.write(e,t,r,n,52,8),r+8}f.prototype.slice=function(e,t){var r=this.length,r=((e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e),this.subarray(e,t));return r.__proto__=f.prototype,r},f.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||y(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},f.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||y(e,t,this.length);for(var n=this[e+--t],i=1;0<t&&(i*=256);)n+=this[e+--t]*i;return n},f.prototype.readUInt8=function(e,t){return e>>>=0,t||y(e,1,this.length),this[e]},f.prototype.readUInt16LE=function(e,t){return e>>>=0,t||y(e,2,this.length),this[e]|this[e+1]<<8},f.prototype.readUInt16BE=function(e,t){return e>>>=0,t||y(e,2,this.length),this[e]<<8|this[e+1]},f.prototype.readUInt32LE=function(e,t){return e>>>=0,t||y(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},f.prototype.readUInt32BE=function(e,t){return e>>>=0,t||y(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},f.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||y(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return(i*=128)<=n&&(n-=Math.pow(2,8*t)),n},f.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||y(e,t,this.length);for(var n=t,i=1,o=this[e+--n];0<n&&(i*=256);)o+=this[e+--n]*i;return(i*=128)<=o&&(o-=Math.pow(2,8*t)),o},f.prototype.readInt8=function(e,t){return e>>>=0,t||y(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},f.prototype.readInt16LE=function(e,t){e>>>=0,t||y(e,2,this.length);t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},f.prototype.readInt16BE=function(e,t){e>>>=0,t||y(e,2,this.length);t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},f.prototype.readInt32LE=function(e,t){return e>>>=0,t||y(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},f.prototype.readInt32BE=function(e,t){return e>>>=0,t||y(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},f.prototype.readFloatLE=function(e,t){return e>>>=0,t||y(e,4,this.length),o.read(this,e,!0,23,4)},f.prototype.readFloatBE=function(e,t){return e>>>=0,t||y(e,4,this.length),o.read(this,e,!1,23,4)},f.prototype.readDoubleLE=function(e,t){return e>>>=0,t||y(e,8,this.length),o.read(this,e,!0,52,8)},f.prototype.readDoubleBE=function(e,t){return e>>>=0,t||y(e,8,this.length),o.read(this,e,!1,52,8)},f.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||g(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},f.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||g(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;0<=--i&&(o*=256);)this[t+i]=e/o&255;return t+r},f.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,1,255,0),this[t]=255&e,t+1},f.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},f.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},f.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},f.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},f.prototype.writeIntLE=function(e,t,r,n){e=+e,t>>>=0,n||g(this,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);var i=0,o=1,a=0;for(this[t]=255&e;++i<r&&(o*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+r},f.prototype.writeIntBE=function(e,t,r,n){e=+e,t>>>=0,n||g(this,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);var i=r-1,o=1,a=0;for(this[t+i]=255&e;0<=--i&&(o*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+r},f.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,1,127,-128),this[t]=255&(e=e<0?255+e+1:e),t+1},f.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},f.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},f.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},f.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,4,2147483647,-2147483648),this[t]=(e=e<0?4294967295+e+1:e)>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},f.prototype.writeFloatLE=function(e,t,r){return _(this,e,t,!0,r)},f.prototype.writeFloatBE=function(e,t,r){return _(this,e,t,!1,r)},f.prototype.writeDoubleLE=function(e,t,r){return w(this,e,t,!0,r)},f.prototype.writeDoubleBE=function(e,t,r){return w(this,e,t,!1,r)},f.prototype.copy=function(e,t,r,n){if(!f.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r=r||0,n||0===n||(n=this.length),t>=e.length&&(t=e.length),(n=0<n&&n<r?r:n)===r)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length);var i=(n=e.length-t<n-r?e.length-t+r:n)-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var o=i-1;0<=o;--o)e[o+t]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},f.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!f.isEncoding(n))throw new TypeError("Unknown encoding: "+n);var i;1===e.length&&(i=e.charCodeAt(0),"utf8"===n&&i<128||"latin1"===n)&&(e=i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");var o;if(!(r<=t))if(t>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(e=e||0))for(o=t;o<r;++o)this[o]=e;else{var a=f.isBuffer(e)?e:f.from(e,n),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<r-t;++o)this[o+t]=a[o%s]}return this};var S=/[^+/0-9A-Za-z-_]/g;function P(e,t){t=t||1/0;for(var r,n=e.length,i=null,o=[],a=0;a<n;++a){if(55295<(r=e.charCodeAt(a))&&r<57344){if(!i){if(56319<r){-1<(t-=3)&&o.push(239,191,189);continue}if(a+1===n){-1<(t-=3)&&o.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(t-=3)&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(t-=3)&&o.push(239,191,189);if(i=null,r<128){if(--t<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function E(e){return x.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(S,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function M(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function A(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function I(e){return e!=e}}.call(this)}.call(this,k("buffer").Buffer)},{"base64-js":648,buffer:649,ieee754:650}],650:[function(e,t,r){r.read=function(e,t,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,c=u>>1,l=-7,f=r?i-1:0,d=r?-1:1,i=e[t+f];for(f+=d,o=i&(1<<-l)-1,i>>=-l,l+=s;0<l;o=256*o+e[t+f],f+=d,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;0<l;a=256*a+e[t+f],f+=d,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(i?-1:1);a+=Math.pow(2,n),o-=c}return(i?-1:1)*a*Math.pow(2,o-n)},r.write=function(e,t,r,n,i,o){var a,s,u=8*o-i-1,c=(1<<u)-1,l=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,o=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-a))<1&&(a--,n*=2),2<=(t+=1<=a+l?f/n:f*Math.pow(2,1-l))*n&&(a++,n/=2),c<=a+l?(s=0,a=c):1<=a+l?(s=(t*n-1)*Math.pow(2,i),a+=l):(s=t*Math.pow(2,l-1)*Math.pow(2,i),a=0));8<=i;e[r+d]=255&s,d+=p,s/=256,i-=8);for(a=a<<i|s,u+=i;0<u;e[r+d]=255&a,d+=p,a/=256,u-=8);e[r+d-p]|=128*o}},{}],651:[function(e,t,r){var n,i,t=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return(n=setTimeout)(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}var u,c=[],l=!1,f=-1;function d(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length)&&p()}function p(){if(!l){for(var e=s(d),t=(l=!0,c.length);t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,!function(t){if(i===clearTimeout)return clearTimeout(t);if((i===a||!i)&&clearTimeout)return(i=clearTimeout)(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function y(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new h(e,t)),1!==c.length||l||s(p)},h.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=y,t.addListener=y,t.once=y,t.off=y,t.removeListener=y,t.removeAllListeners=y,t.emit=y,t.prependListener=y,t.prependOnceListener=y,t.listeners=function(e){return[]},t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],652:[function(u,e,c){!function(r,s){!function(){var n=u("process/browser.js").nextTick,e=Function.prototype.apply,i=Array.prototype.slice,o={},a=0;function t(e,t){this._id=e,this._clearFn=t}c.setTimeout=function(){return new t(e.call(setTimeout,window,arguments),clearTimeout)},c.setInterval=function(){return new t(e.call(setInterval,window,arguments),clearInterval)},c.clearTimeout=c.clearInterval=function(e){e.close()},t.prototype.unref=t.prototype.ref=function(){},t.prototype.close=function(){this._clearFn.call(window,this._id)},c.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},c.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},c._unrefActive=c.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},c.setImmediate="function"==typeof r?r:function(e){var t=a++,r=!(arguments.length<2)&&i.call(arguments,1);return o[t]=!0,n(function(){o[t]&&(r?e.apply(null,r):e.call(null),c.clearImmediate(t))}),t},c.clearImmediate="function"==typeof s?s:function(e){delete o[e]}}.call(this)}.call(this,u("timers").setImmediate,u("timers").clearImmediate)},{"process/browser.js":651,timers:652}]},{},[646]);
